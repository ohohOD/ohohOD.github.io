import{m as o}from"./index-Bgn5HBnd.js";const s="vnlog-save-",i=5,l="vnlog-autosave";class a{static save(e,n){try{const r=e===null?l:`${s}${e}`,c={...n,timestamp:Date.now(),version:"1.0.0"};return localStorage.setItem(r,JSON.stringify(c)),console.log(`저장 완료: ${r}`),!0}catch(r){return console.error("저장 실패:",r),!1}}static load(e){try{const n=e===null?l:`${s}${e}`,r=localStorage.getItem(n);if(!r)return null;const c=JSON.parse(r);return console.log(`불러오기 완료: ${n}`),c}catch(n){return console.error("불러오기 실패:",n),null}}static deleteSave(e){try{const n=`${s}${e}`;return localStorage.removeItem(n),console.log(`삭제 완료: ${n}`),!0}catch(n){return console.error("삭제 실패:",n),!1}}static getAllSaves(){const e=[];for(let n=0;n<i;n++){const r=this.load(n);e.push({slotIndex:n,isEmpty:!r,timestamp:(r==null?void 0:r.timestamp)||null,logTitle:(r==null?void 0:r.logTitle)||"",currentSceneIndex:(r==null?void 0:r.currentSceneIndex)||0,currentStepIndex:(r==null?void 0:r.currentStepIndex)||0,totalSteps:(r==null?void 0:r.totalSteps)||0})}return e}static autoSave(e){return this.save(null,e)}static loadAutoSave(){return this.load(null)}static canSave(){try{const e="vnlog-test";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("LocalStorage 사용 불가:",e),!1}}static createSaveData(e){return{logTitle:e.vnData.title||"제목 없음",currentSceneIndex:e.playback.currentSceneIndex,currentStepIndex:e.playback.currentStepIndex,totalSteps:e.vnData.scenes.reduce((n,r)=>n+r.steps.length,0)}}static applySaveData(e,n){try{return!n||!e.vnData.scenes.length?!1:(e.playback.currentSceneIndex=n.currentSceneIndex,e.playback.currentStepIndex=n.currentStepIndex,console.log("진행도 복원 완료:",n),!0)}catch(r){return console.error("진행도 복원 실패:",r),!1}}static formatSaveInfo(e){if(e.isEmpty)return{title:"빈 슬롯",subtitle:"",date:""};const n=new Date(e.timestamp),r=n.toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}),c=n.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}),u=e.totalSteps>0?Math.round(e.currentStepIndex/e.totalSteps*100):0;return{title:e.logTitle,subtitle:`진행도: ${u}% (${e.currentStepIndex}/${e.totalSteps})`,date:`${r} ${c}`}}}const S=o("log",{state:()=>({rawLog:null,vnData:{title:"",scenes:[],characters:{},handouts:[]},playback:{currentSceneIndex:0,currentStepIndex:0,isPlaying:!1,autoPlayEnabled:!1,autoPlaySpeed:2e3},settings:{textSpeed:50,skipUnread:!1}}),getters:{currentScene:t=>t.vnData.scenes[t.playback.currentSceneIndex]||null,currentStep:t=>{const e=t.vnData.scenes[t.playback.currentSceneIndex];return(e==null?void 0:e.steps[t.playback.currentStepIndex])||null},hasNextStep:t=>{const e=t.vnData.scenes[t.playback.currentSceneIndex];return e?t.playback.currentStepIndex<e.steps.length-1?!0:t.playback.currentSceneIndex<t.vnData.scenes.length-1:!1},hasPreviousStep:t=>t.playback.currentStepIndex>0||t.playback.currentSceneIndex>0},actions:{setRawLog(t){this.rawLog=t},setVNData(t){this.vnData=t,this.playback.currentSceneIndex=0,this.playback.currentStepIndex=0},nextStep(){const t=this.vnData.scenes[this.playback.currentSceneIndex];return t?this.playback.currentStepIndex<t.steps.length-1?(this.playback.currentStepIndex++,!0):this.playback.currentSceneIndex<this.vnData.scenes.length-1?(this.playback.currentSceneIndex++,this.playback.currentStepIndex=0,!0):!1:!1},previousStep(){if(this.playback.currentStepIndex>0)return this.playback.currentStepIndex--,!0;if(this.playback.currentSceneIndex>0){this.playback.currentSceneIndex--;const t=this.vnData.scenes[this.playback.currentSceneIndex];return this.playback.currentStepIndex=t.steps.length-1,!0}return!1},goToStep(t,e){return t>=0&&t<this.vnData.scenes.length&&e>=0&&e<this.vnData.scenes[t].steps.length?(this.playback.currentSceneIndex=t,this.playback.currentStepIndex=e,!0):!1},toggleAutoPlay(){this.playback.autoPlayEnabled=!this.playback.autoPlayEnabled},setPlaying(t){this.playback.isPlaying=t},reset(){this.rawLog=null,this.vnData={title:"",scenes:[],characters:{},handouts:[]},this.playback.currentSceneIndex=0,this.playback.currentStepIndex=0,this.playback.isPlaying=!1},saveProgress(t){const e=a.createSaveData(this);return a.save(t,e)},loadProgress(t){const e=a.load(t);return e?a.applySaveData(this,e):!1},autoSave(){const t=a.createSaveData(this);return a.autoSave(t)},loadAutoSave(){const t=a.loadAutoSave();return t?a.applySaveData(this,t):!1}}});export{a as S,S as u};
