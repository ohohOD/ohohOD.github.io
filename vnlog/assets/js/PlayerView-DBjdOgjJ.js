import{S as T,u as _}from"./logStore-CgbBBt5j.js";import{B as N,D as V,a as j,S as F,P as R,C as H,b as X}from"./BGMPlayer-DSeIPiFc.js";import{_ as x,g as k,w as C,T as w,r as v,o as u,c as d,f as g,a as s,h as f,d as c,t as y,e as h,i as m,v as b,j as D,k as G,l as P,F as K,m as W,n as I}from"./index-WAJ_Ey0A.js";const Y={name:"HandoutDisplay",props:{handout:{type:Object,default:()=>({id:null,title:"",imageUrl:"",description:""})},isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{imageLoadError:!1}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},handleImageError(){this.imageLoadError=!0,console.error(`Ìï∏ÎìúÏïÑÏõÉ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${this.handout.imageUrl}`)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.imageLoadError=!1)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},J={key:0,class:"handout-header"},q={class:"handout-title"},Q={class:"handout-content"},Z=["src","alt"],$={key:1,class:"handout-placeholder"},ee={key:2,class:"handout-description"};function te(t,e,n,r,o,l){const a=v("EmojiToIcon");return u(),k(w,{name:"handout-overlay"},{default:C(()=>[n.isVisible?(u(),d("div",{key:0,class:"handout-overlay",onClick:e[3]||(e[3]=(...i)=>l.handleOverlayClick&&l.handleOverlayClick(...i))},[s("div",{class:"handout-container",onClick:e[2]||(e[2]=f(()=>{},["stop"]))},[s("button",{class:"close-button",onClick:e[0]||(e[0]=(...i)=>l.close&&l.close(...i)),title:"Îã´Í∏∞ (ESC)"},[c(a,{emoji:"‚úñÔ∏è",size:24})]),n.handout.title?(u(),d("div",J,[s("h2",q,y(n.handout.title),1)])):g("",!0),s("div",Q,[n.handout.imageUrl?(u(),d("img",{key:0,src:n.handout.imageUrl,alt:n.handout.title||"Ìï∏ÎìúÏïÑÏõÉ",class:"handout-image",onError:e[1]||(e[1]=(...i)=>l.handleImageError&&l.handleImageError(...i))},null,40,Z)):(u(),d("div",$,[c(a,{emoji:"üñºÔ∏è",size:64}),e[4]||(e[4]=s("p",null,"Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§",-1))])),n.handout.description?(u(),d("div",ee,[s("p",null,y(n.handout.description),1)])):g("",!0)])])])):g("",!0)]),_:1})}const oe=x(Y,[["render",te],["__scopeId","data-v-051f2115"]]),se={name:"ThemeSettingsModal",props:{isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{localSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",bgSecondary:"#1f1f1f5",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard",bgImageUrl:"",bgImageOpacity:.3,bgImageSize:"cover",bgmUrl:"",bgmType:"youtube",bgmVolume:.5,bgmAutoPlay:!1},defaultSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",bgSecondary:"#1f1f1f5",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard",bgImageUrl:"",bgImageOpacity:.3,bgImageSize:"cover",bgmUrl:"",bgmType:"youtube",bgmVolume:.5,bgmAutoPlay:!1},youtubeVideoId:"",isLoadingFile:!1}},computed:{previewStyles(){const t={"--preview-primary":this.localSettings.primaryColor,"--preview-bg":this.localSettings.bgColor,"--preview-text":this.localSettings.textColor,"--preview-border":this.localSettings.borderColor,fontFamily:this.localSettings.fontFamily};return this.localSettings.bgImageUrl&&(t.backgroundImage=`linear-gradient(rgba(0, 0, 0, ${1-this.localSettings.bgImageOpacity}), rgba(0, 0, 0, ${1-this.localSettings.bgImageOpacity})), url(${this.localSettings.bgImageUrl})`,t.backgroundSize=this.localSettings.bgImageSize,t.backgroundPosition="center",t.backgroundRepeat="no-repeat"),t},extractedYoutubeId(){if(this.localSettings.bgmType!=="youtube"||!this.localSettings.bgmUrl)return"";const t=[/(?:youtube\.com\/watch\?v=)([\w-]+)/,/(?:youtu\.be\/)([\w-]+)/,/(?:youtube\.com\/embed\/)([\w-]+)/,/^([\w-]{11})$/];for(const e of t){const n=this.localSettings.bgmUrl.match(e);if(n)return n[1]}return""}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},loadSettings(){const t=localStorage.getItem("vnlog-theme-settings");if(t)try{this.localSettings={...this.defaultSettings,...JSON.parse(t)}}catch(e){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®:",e)}},saveSettings(){localStorage.setItem("vnlog-theme-settings",JSON.stringify(this.localSettings)),this.applyTheme(this.localSettings),this.$emit("bgm-change",{url:this.localSettings.bgmUrl,type:this.localSettings.bgmType,volume:this.localSettings.bgmVolume,autoPlay:this.localSettings.bgmAutoPlay}),this.$emit("save",this.localSettings),this.$emit("close")},applyTheme(t){const e=document.documentElement;if(e.style.setProperty("--primary-color",t.primaryColor),e.style.setProperty("--bg-color",t.bgColor),e.style.setProperty("--bg-secondary",t.bgSecondary),e.style.setProperty("--text-color",t.textColor),e.style.setProperty("--border-color",t.borderColor),e.style.setProperty("--font-family",t.fontFamily),t.bgImageUrl){const n=`linear-gradient(rgba(0, 0, 0, ${1-t.bgImageOpacity}), rgba(0, 0, 0, ${1-t.bgImageOpacity}))`;e.style.setProperty("--bg-image",`${n}, url(${t.bgImageUrl})`),e.style.setProperty("--bg-image-size",t.bgImageSize)}else e.style.setProperty("--bg-image","none")},resetToDefault(){this.localSettings={...this.defaultSettings}},async handleBgImageFileSelect(t){const e=t.target.files[0];if(e){if(e.size>2*1024*1024){alert("Ïù¥ÎØ∏ÏßÄ ÌååÏùº ÌÅ¨Í∏∞Îäî 2MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§."),t.target.value="";return}this.isLoadingFile=!0;try{const n=await this.fileToBase64(e);this.localSettings.bgImageUrl=n,console.log("[ThemeSettings] Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å:",{fileName:e.name,fileSize:e.size,base64Length:n.length})}catch(n){console.error("[ThemeSettings] ÌååÏùº Î°úÎìú Ïã§Ìå®:",n),alert("ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}finally{this.isLoadingFile=!1,t.target.value=""}}},async handleBgmFileSelect(t){const e=t.target.files[0];if(e){if(e.size>10*1024*1024){alert("BGM ÌååÏùº ÌÅ¨Í∏∞Îäî 10MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§."),t.target.value="";return}this.isLoadingFile=!0;try{const n=await this.fileToBase64(e);this.localSettings.bgmUrl=n,console.log("[ThemeSettings] BGM ÌååÏùº Î°úÎìú ÏôÑÎ£å:",{fileName:e.name,fileSize:e.size,base64Length:n.length})}catch(n){console.error("[ThemeSettings] ÌååÏùº Î°úÎìú Ïã§Ìå®:",n),alert("ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}finally{this.isLoadingFile=!1,t.target.value=""}}},fileToBase64(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)})},clearBgImage(){this.localSettings.bgImageUrl=""},clearBgm(){this.localSettings.bgmUrl=""},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSettings(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="")}}},mounted(){this.loadSettings(),this.applyTheme(this.localSettings)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},le={class:"modal-header"},ie={class:"modal-title"},ne={class:"modal-content"},re={class:"setting-group"},ae={class:"setting-label"},ce={class:"color-picker-wrapper"},ue={class:"setting-group"},de={class:"setting-label"},ge={class:"color-picker-wrapper"},he={class:"setting-group"},pe={class:"setting-label"},me={class:"color-picker-wrapper"},ye={class:"setting-group"},be={class:"setting-label"},ve={class:"color-picker-wrapper"},Se={class:"setting-group"},fe={class:"setting-label"},ke={class:"color-picker-wrapper"},Ce={class:"setting-group"},we={class:"setting-label"},xe={class:"setting-group"},Te={class:"setting-label"},De={class:"file-input-group"},Pe={class:"hint-text"},Ie={key:0,class:"setting-group"},Be={class:"setting-label"},Oe={key:1,class:"setting-group"},Ee={class:"setting-label"},Ae={class:"setting-group"},Me={class:"setting-label"},Ue={class:"setting-group"},Le={class:"setting-label"},ze={class:"file-input-group"},_e=["placeholder"],Ne={key:0,class:"hint-text"},Ve={key:1,class:"hint-text"},je={key:2,class:"setting-group"},Fe={class:"setting-label"},Re={key:3,class:"setting-group"},He={class:"checkbox-label"},Xe={class:"preview-section"},Ge={class:"modal-footer"},Ke={class:"button-group"};function We(t,e,n,r,o,l){const a=v("EmojiToIcon");return u(),k(w,{name:"modal-overlay"},{default:C(()=>[n.isVisible?(u(),d("div",{key:0,class:"modal-overlay",onClick:e[29]||(e[29]=(...i)=>l.handleOverlayClick&&l.handleOverlayClick(...i))},[s("div",{class:"modal-container",onClick:e[28]||(e[28]=f(()=>{},["stop"]))},[s("div",le,[s("h2",ie,[c(a,{emoji:"üé®",size:24}),e[30]||(e[30]=h(" ÌÖåÎßà ÏÑ§Ï†ï ",-1))]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...i)=>l.close&&l.close(...i)),title:"Îã´Í∏∞ (ESC)"},[c(a,{emoji:"‚úñÔ∏è",size:20})])]),s("div",ne,[s("div",re,[s("label",ae,[c(a,{emoji:"üé®",size:16}),e[31]||(e[31]=h(" Ï£ºÏöî ÏÉâÏÉÅ ",-1))]),s("div",ce,[m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>o.localSettings.primaryColor=i),type:"color",class:"color-picker"},null,512),[[b,o.localSettings.primaryColor]]),m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.localSettings.primaryColor=i),type:"text",class:"color-input",placeholder:"#6366f1"},null,512),[[b,o.localSettings.primaryColor]])])]),s("div",ue,[s("label",de,[c(a,{emoji:"üñºÔ∏è",size:16}),e[32]||(e[32]=h(" Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),s("div",ge,[m(s("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>o.localSettings.bgColor=i),type:"color",class:"color-picker"},null,512),[[b,o.localSettings.bgColor]]),m(s("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>o.localSettings.bgColor=i),type:"text",class:"color-input",placeholder:"#1a1a2e"},null,512),[[b,o.localSettings.bgColor]])])]),s("div",he,[s("label",pe,[c(a,{emoji:"üé®",size:16}),e[33]||(e[33]=h(" Î≥¥Ï°∞ Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),s("div",me,[m(s("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>o.localSettings.bgSecondary=i),type:"color",class:"color-picker"},null,512),[[b,o.localSettings.bgSecondary]]),m(s("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>o.localSettings.bgSecondary=i),type:"text",class:"color-input",placeholder:"#f5f5f5"},null,512),[[b,o.localSettings.bgSecondary]])])]),s("div",ye,[s("label",be,[c(a,{emoji:"üìù",size:16}),e[34]||(e[34]=h(" ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ ",-1))]),s("div",ve,[m(s("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>o.localSettings.textColor=i),type:"color",class:"color-picker"},null,512),[[b,o.localSettings.textColor]]),m(s("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>o.localSettings.textColor=i),type:"text",class:"color-input",placeholder:"#ffffff"},null,512),[[b,o.localSettings.textColor]])])]),s("div",Se,[s("label",fe,[c(a,{emoji:"‚¨ú",size:16}),e[35]||(e[35]=h(" ÌÖåÎëêÎ¶¨ ÏÉâÏÉÅ ",-1))]),s("div",ke,[m(s("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>o.localSettings.borderColor=i),type:"color",class:"color-picker"},null,512),[[b,o.localSettings.borderColor]]),m(s("input",{"onUpdate:modelValue":e[10]||(e[10]=i=>o.localSettings.borderColor=i),type:"text",class:"color-input",placeholder:"#666666"},null,512),[[b,o.localSettings.borderColor]])])]),s("div",Ce,[s("label",we,[c(a,{emoji:"üî§",size:16}),e[36]||(e[36]=h(" Ìè∞Ìä∏ ",-1))]),m(s("select",{"onUpdate:modelValue":e[11]||(e[11]=i=>o.localSettings.fontFamily=i),class:"font-select"},[...e[37]||(e[37]=[s("option",{value:"Pretendard"},"Pretendard (Í∏∞Î≥∏)",-1),s("option",{value:"NanumSquare"},"NanumSquare",-1),s("option",{value:"Nanum Myeongjo"},"Nanum Myeongjo",-1),s("option",{value:"NotoSerifKR"},"Noto Serif KR",-1)])],512),[[D,o.localSettings.fontFamily]])]),s("div",xe,[s("label",Te,[c(a,{emoji:"üåÑ",size:16}),e[38]||(e[38]=h(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ URL ",-1))]),s("div",De,[m(s("input",{"onUpdate:modelValue":e[12]||(e[12]=i=>o.localSettings.bgImageUrl=i),type:"text",class:"url-input",placeholder:"Ïù¥ÎØ∏ÏßÄ URL ÏûÖÎ†• ÎòêÎäî ÌååÏùº ÏÑ†ÌÉù"},null,512),[[b,o.localSettings.bgImageUrl]]),s("input",{ref:"bgImageFileInput",type:"file",accept:"image/*",onChange:e[13]||(e[13]=(...i)=>l.handleBgImageFileSelect&&l.handleBgImageFileSelect(...i)),style:{display:"none"}},null,544),s("button",{onClick:e[14]||(e[14]=i=>t.$refs.bgImageFileInput.click()),class:"file-select-button"},[c(a,{emoji:"üìÅ",size:14}),e[39]||(e[39]=h(" ÌååÏùº ",-1))]),o.localSettings.bgImageUrl?(u(),d("button",{key:0,onClick:e[15]||(e[15]=(...i)=>l.clearBgImage&&l.clearBgImage(...i)),class:"clear-button"},[c(a,{emoji:"‚úñÔ∏è",size:14})])):g("",!0)]),s("p",Pe,[c(a,{emoji:"üí°",size:12}),e[40]||(e[40]=h(" Î°úÏª¨ ÌååÏùºÏùÄ base64Î°ú Ïù∏ÏΩîÎî© (2MB Ïù¥Ìïò) ",-1))])]),o.localSettings.bgImageUrl?(u(),d("div",Ie,[s("label",Be,[c(a,{emoji:"üíß",size:16}),h(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ Ìà¨Î™ÖÎèÑ ("+y(Math.round(o.localSettings.bgImageOpacity*100))+"%) ",1)]),m(s("input",{"onUpdate:modelValue":e[16]||(e[16]=i=>o.localSettings.bgImageOpacity=i),type:"range",min:"0",max:"1",step:"0.05",class:"slider"},null,512),[[b,o.localSettings.bgImageOpacity,void 0,{number:!0}]])])):g("",!0),o.localSettings.bgImageUrl?(u(),d("div",Oe,[s("label",Ee,[c(a,{emoji:"üìè",size:16}),e[41]||(e[41]=h(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ",-1))]),m(s("select",{"onUpdate:modelValue":e[17]||(e[17]=i=>o.localSettings.bgImageSize=i),class:"font-select"},[...e[42]||(e[42]=[s("option",{value:"cover"},"ÌôîÎ©¥ Ï±ÑÏö∞Í∏∞ (Cover)",-1),s("option",{value:"contain"},"ÎπÑÏú® Ïú†ÏßÄ (Contain)",-1),s("option",{value:"auto"},"ÏõêÎ≥∏ ÌÅ¨Í∏∞ (Auto)",-1)])],512),[[D,o.localSettings.bgImageSize]])])):g("",!0),e[51]||(e[51]=s("div",{class:"divider"},null,-1)),s("div",Ae,[s("label",Me,[c(a,{emoji:"üéµ",size:16}),e[43]||(e[43]=h(" BGM ÌÉÄÏûÖ ",-1))]),m(s("select",{"onUpdate:modelValue":e[18]||(e[18]=i=>o.localSettings.bgmType=i),class:"font-select"},[...e[44]||(e[44]=[s("option",{value:"youtube"},"Ïú†ÌäúÎ∏å ÏòÅÏÉÅ",-1),s("option",{value:"audio"},"Ïò§ÎîîÏò§ ÌååÏùº (MP3 Îì±)",-1)])],512),[[D,o.localSettings.bgmType]])]),s("div",Ue,[s("label",Le,[c(a,{emoji:"üîó",size:16}),e[45]||(e[45]=h(" BGM URL ",-1))]),s("div",ze,[m(s("input",{"onUpdate:modelValue":e[19]||(e[19]=i=>o.localSettings.bgmUrl=i),type:"text",class:"url-input",placeholder:o.localSettings.bgmType==="youtube"?"https://www.youtube.com/watch?v=...":"BGM URL ÏûÖÎ†• ÎòêÎäî ÌååÏùº ÏÑ†ÌÉù"},null,8,_e),[[b,o.localSettings.bgmUrl]]),o.localSettings.bgmType==="audio"?(u(),d("input",{key:0,ref:"bgmFileInput",type:"file",accept:"audio/*",onChange:e[20]||(e[20]=(...i)=>l.handleBgmFileSelect&&l.handleBgmFileSelect(...i)),style:{display:"none"}},null,544)):g("",!0),o.localSettings.bgmType==="audio"?(u(),d("button",{key:1,onClick:e[21]||(e[21]=i=>t.$refs.bgmFileInput.click()),class:"file-select-button"},[c(a,{emoji:"üìÅ",size:14}),e[46]||(e[46]=h(" ÌååÏùº ",-1))])):g("",!0),o.localSettings.bgmUrl?(u(),d("button",{key:2,onClick:e[22]||(e[22]=(...i)=>l.clearBgm&&l.clearBgm(...i)),class:"clear-button"},[c(a,{emoji:"‚úñÔ∏è",size:14})])):g("",!0)]),o.localSettings.bgmType==="youtube"&&l.extractedYoutubeId?(u(),d("div",Ne,[c(a,{emoji:"‚úì",size:12}),h(" ÎπÑÎîîÏò§ ID: "+y(l.extractedYoutubeId),1)])):o.localSettings.bgmType==="audio"?(u(),d("p",Ve,[c(a,{emoji:"üí°",size:12}),e[47]||(e[47]=h(" Î°úÏª¨ ÌååÏùºÏùÄ base64Î°ú Ïù∏ÏΩîÎî© (10MB Ïù¥Ìïò) ",-1))])):g("",!0)]),o.localSettings.bgmUrl?(u(),d("div",je,[s("label",Fe,[c(a,{emoji:"üîä",size:16}),h(" BGM Î≥ºÎ•® ("+y(Math.round(o.localSettings.bgmVolume*100))+"%) ",1)]),m(s("input",{"onUpdate:modelValue":e[23]||(e[23]=i=>o.localSettings.bgmVolume=i),type:"range",min:"0",max:"1",step:"0.05",class:"slider"},null,512),[[b,o.localSettings.bgmVolume,void 0,{number:!0}]])])):g("",!0),o.localSettings.bgmUrl?(u(),d("div",Re,[s("label",He,[m(s("input",{"onUpdate:modelValue":e[24]||(e[24]=i=>o.localSettings.bgmAutoPlay=i),type:"checkbox",class:"checkbox-input"},null,512),[[G,o.localSettings.bgmAutoPlay]]),c(a,{emoji:"‚ñ∂Ô∏è",size:16}),e[48]||(e[48]=s("span",null,"PlayerView ÏßÑÏûÖ Ïãú ÏûêÎèô Ïû¨ÏÉù",-1))])])):g("",!0),s("div",Xe,[e[50]||(e[50]=s("p",{class:"preview-label"},"ÎØ∏Î¶¨Î≥¥Í∏∞",-1)),s("div",{class:"preview-box",style:P(l.previewStyles)},[...e[49]||(e[49]=[s("p",null,"ÏïàÎÖïÌïòÏÑ∏Ïöî!",-1),s("button",{class:"preview-button"},"Î≤ÑÌäº",-1)])],4)])]),s("div",Ge,[s("button",{class:"action-button secondary",onClick:e[25]||(e[25]=(...i)=>l.resetToDefault&&l.resetToDefault(...i))},[c(a,{emoji:"üîÑ",size:16}),e[52]||(e[52]=h(" Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõê ",-1))]),s("div",Ke,[s("button",{class:"action-button secondary",onClick:e[26]||(e[26]=(...i)=>l.close&&l.close(...i))}," Ï∑®ÏÜå "),s("button",{class:"action-button primary",onClick:e[27]||(e[27]=(...i)=>l.saveSettings&&l.saveSettings(...i))},[c(a,{emoji:"üíæ",size:16}),e[53]||(e[53]=h(" Ï†ÄÏû• ",-1))])])])])])):g("",!0)]),_:1})}const Ye=x(se,[["render",We],["__scopeId","data-v-28fe693b"]]),Je={name:"SaveLoadModal",props:{isVisible:{type:Boolean,default:!1},mode:{type:String,default:"save",validator:t=>["save","load"].includes(t)},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{saveSlots:[],deleteConfirmSlot:null}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.deleteConfirmSlot===null&&this.close()},loadSaveSlots(){this.saveSlots=T.getAllSaves()},handleSlotClick(t){this.mode==="save"?(this.$emit("save",t),this.close()):this.saveSlots[t].isEmpty||(this.$emit("load",t),this.close())},confirmDelete(t){this.deleteConfirmSlot=t},cancelDelete(){this.deleteConfirmSlot=null},async executeDelete(){this.deleteConfirmSlot!==null&&(await T.deleteSaveAndCleanup(this.deleteConfirmSlot),this.loadSaveSlots(),this.deleteConfirmSlot=null)},formatInfo(t){return T.formatSaveInfo(t)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&(this.deleteConfirmSlot!==null?this.cancelDelete():this.close())}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSaveSlots(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.deleteConfirmSlot=null)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},qe={class:"modal-header"},Qe={class:"modal-title"},Ze={class:"modal-content"},$e=["onClick"],et={class:"slot-header"},tt={class:"slot-number"},ot=["onClick"],st={class:"slot-content"},lt={key:0,class:"empty-slot"},it={key:1,class:"save-info"},nt={class:"save-title"},rt={class:"save-subtitle"},at={class:"save-date"},ct={class:"modal-footer"},ut={class:"footer-note"},dt={class:"confirm-content"},gt={class:"confirm-buttons"};function ht(t,e,n,r,o,l){const a=v("EmojiToIcon");return u(),k(w,{name:"modal-overlay"},{default:C(()=>[n.isVisible?(u(),d("div",{key:0,class:"modal-overlay",onClick:e[5]||(e[5]=(...i)=>l.handleOverlayClick&&l.handleOverlayClick(...i))},[s("div",{class:"modal-container",onClick:e[1]||(e[1]=f(()=>{},["stop"]))},[s("div",qe,[s("h2",Qe,[c(a,{emoji:n.mode==="save"?"üíæ":"üìÇ",size:24},null,8,["emoji"]),h(" "+y(n.mode==="save"?"Ï†ÄÏû•ÌïòÍ∏∞":"Î∂àÎü¨Ïò§Í∏∞"),1)]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...i)=>l.close&&l.close(...i)),title:"Îã´Í∏∞ (ESC)"},[c(a,{emoji:"‚úñÔ∏è",size:20})])]),s("div",Ze,[(u(!0),d(K,null,W(o.saveSlots,i=>(u(),d("div",{key:i.slotIndex,class:I(["save-slot",{"is-empty":i.isEmpty}]),onClick:S=>l.handleSlotClick(i.slotIndex)},[s("div",et,[s("span",tt,"Ïä¨Î°Ø "+y(i.slotIndex+1),1),!i.isEmpty&&n.mode==="save"?(u(),d("button",{key:0,class:"delete-button",onClick:f(S=>l.confirmDelete(i.slotIndex),["stop"]),title:"ÏÇ≠Ï†ú"},[c(a,{emoji:"üóëÔ∏è",size:16})],8,ot)):g("",!0)]),s("div",st,[i.isEmpty?(u(),d("div",lt,[c(a,{emoji:"üì≠",size:32}),e[6]||(e[6]=s("p",null,"Îπà Ïä¨Î°Ø",-1))])):(u(),d("div",it,[s("h3",nt,y(l.formatInfo(i).title),1),s("p",rt,y(l.formatInfo(i).subtitle),1),s("p",at,y(l.formatInfo(i).date),1)]))])],10,$e))),128))]),s("div",ct,[s("p",ut,[c(a,{emoji:"‚ÑπÔ∏è",size:14}),h(" "+y(n.mode==="save"?"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÌòÑÏû¨ ÏßÑÌñâÎèÑÎ•º Ï†ÄÏû•Ìï©ÎãàÎã§.":"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ï†ÄÏû•Îêú ÏßÑÌñâÎèÑÎ•º Î∂àÎü¨ÏòµÎãàÎã§."),1)])])]),o.deleteConfirmSlot!==null?(u(),d("div",{key:0,class:"confirm-modal",onClick:e[4]||(e[4]=f(()=>{},["stop"]))},[s("div",dt,[e[7]||(e[7]=s("h3",null,"Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú",-1)),s("p",null,"Ïä¨Î°Ø "+y(o.deleteConfirmSlot+1)+"Ïùò Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",1),s("div",gt,[s("button",{class:"action-button secondary",onClick:e[2]||(e[2]=(...i)=>l.cancelDelete&&l.cancelDelete(...i))}," Ï∑®ÏÜå "),s("button",{class:"action-button danger",onClick:e[3]||(e[3]=(...i)=>l.executeDelete&&l.executeDelete(...i))}," ÏÇ≠Ï†ú ")])])])):g("",!0)])):g("",!0)]),_:1})}const pt=x(Je,[["render",ht],["__scopeId","data-v-2a4c857c"]]),mt={name:"PlayerView",components:{DialogBox:X,CharacterDisplay:H,PlaybackControls:R,HandoutDisplay:oe,ThemeSettingsModal:Ye,SaveLoadModal:pt,SceneSelectorModal:F,DiceRoll:j,DXCombo:V,BGMPlayer:N},setup(){return{logStore:_()}},data(){return{autoPlayTimer:null,typingSpeed:50,theaterMode:!1,autoPlaySpeed:1,showHandout:!1,currentHandout:null,showThemeSettings:!1,showSaveLoadModal:!1,saveLoadMode:"save",showSceneSelector:!1,bgmSettings:{url:"",type:"youtube",volume:.5,autoPlay:!1},showDiceOverlay:!1,currentDiceRolls:[],diceCharacterName:"",diceCharacterColor:"#ffffff",diceOverlayTimer:null,showComboOverlay:!1,currentDXCombos:[],comboCharacterName:"",comboCharacterColor:"#ffffff",comboOverlayTimer:null,previousSceneIndex:0,showSceneDescription:!1,sceneDescriptionData:null,sceneDescriptionTimer:null,isMobile:!1,isTablet:!1,isTouchDevice:!1,sfxAudio:null,currentBackground:null,previousBgmUrl:null,defaultThemeBackground:{url:"",opacity:.3,size:"cover"}}},watch:{"logStore.playback.currentSceneIndex"(t,e){t!==e&&this.onSceneChange()}},computed:{logTitle(){var t;return((t=this.logStore.vnData)==null?void 0:t.title)||"Î°úÍ∑∏ ÌîåÎ†àÏù¥Ïñ¥"},currentScene(){var n,r;const t=((n=this.logStore.vnData)==null?void 0:n.scenes)||[],e=((r=this.logStore.playback)==null?void 0:r.currentSceneIndex)||0;return t[e]||null},currentStep(){return this.logStore.currentStep},hasNextStep(){return this.logStore.hasNextStep},hasPreviousStep(){return this.logStore.hasPreviousStep},autoPlayEnabled(){var t;return((t=this.logStore.playback)==null?void 0:t.autoPlayEnabled)||!1},currentStepNumber(){var o,l,a,i;let t=0;const e=((o=this.logStore.vnData)==null?void 0:o.scenes)||[],n=((l=this.logStore.playback)==null?void 0:l.currentSceneIndex)||0,r=((a=this.logStore.playback)==null?void 0:a.currentStepIndex)||0;for(let S=0;S<n;S++)t+=((i=e[S])==null?void 0:i.steps.length)||0;return t+=r+1,t},totalSteps(){var e;return(((e=this.logStore.vnData)==null?void 0:e.scenes)||[]).reduce((n,r)=>{var o;return n+(((o=r==null?void 0:r.steps)==null?void 0:o.length)||0)},0)},currentSceneName(){const t=this.logStore.currentScene;return(t==null?void 0:t.name)||""},hasActiveOverlay(){return this.showDiceOverlay||this.showComboOverlay||this.showSceneDescription},dialogStepKey(){var n,r;const t=((n=this.logStore.playback)==null?void 0:n.currentSceneIndex)??0,e=((r=this.logStore.playback)==null?void 0:r.currentStepIndex)??0;return`${t}-${e}`}},methods:{navigateToTargetStep(){var o;const t=sessionStorage.getItem("player-target-step");if(!t)return;const e=parseInt(t,10);if(isNaN(e)||e<1){sessionStorage.removeItem("player-target-step");return}let n=0;const r=((o=this.logStore.vnData)==null?void 0:o.scenes)||[];for(let l=0;l<r.length;l++){const i=r[l].steps.length;if(e<=n+i){const S=e-n-1;this.logStore.goToStep(l,S),sessionStorage.removeItem("player-target-step");return}n+=i}sessionStorage.removeItem("player-target-step")},detectDevice(){const t=navigator.userAgent.toLowerCase(),e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t),n=/ipad|android(?!.*mobile)|tablet/i.test(t),r="ontouchstart"in window||navigator.maxTouchPoints>0,o=window.innerWidth,l=o<=767,a=o>=768&&o<=1023;this.isMobile=e&&l||r&&l,this.isTablet=n&&a||r&&a&&!e,this.isTouchDevice=r,this.isMobile&&(this.typingSpeed=30),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device"),this.isMobile?document.body.classList.add("device-mobile"):this.isTablet?document.body.classList.add("device-tablet"):document.body.classList.add("device-desktop"),this.isTouchDevice&&document.body.classList.add("touch-device"),console.log("Device Detection:",{isMobile:this.isMobile,isTablet:this.isTablet,isTouchDevice:this.isTouchDevice,screenWidth:o,userAgent:t})},getCharacterName(t){return t.type==="system"?t.character.name||"ÏãúÏä§ÌÖú":t.type==="narrator"?"":t.character.name},handleAdvance(){var t;console.log("[PlayerView] handleAdvance Ìò∏Ï∂ú:",{hasNextStep:this.hasNextStep,autoPlayEnabled:this.autoPlayEnabled,currentStepIndex:(t=this.logStore.playback)==null?void 0:t.currentStepIndex}),this.hasNextStep?this.nextStep():this.autoPlayEnabled&&this.logStore.toggleAutoPlay()},handleTypingComplete(){},goHome(){this.stopAutoPlay(),this.$router.push("/")},openEditor(){sessionStorage.setItem("editor-target-step",this.currentStepNumber),this.$router.push("/editor")},openSettings(){this.showThemeSettings=!0},closeSettings(){this.showThemeSettings=!1},handleThemeSave(t){},handleBgmChange(t){this.bgmSettings={...t}},openSceneSelector(){this.showSceneSelector=!0},closeSceneSelector(){this.showSceneSelector=!1},handleGoToStep(t,e){const n=this.logStore.playback.currentSceneIndex;this.logStore.goToStep(t,e),n!==t&&this.onSceneChange(),this.closeSceneSelector(),this.showOverlaysIfPresent()},openSaveModal(){this.saveLoadMode="save",this.showSaveLoadModal=!0},openLoadModal(){this.saveLoadMode="load",this.showSaveLoadModal=!0},closeSaveLoadModal(){this.showSaveLoadModal=!1},async handleSave(t){await this.logStore.saveProgress(t)},async handleLoad(t){await this.logStore.loadProgress(t)},openHandout(t){this.currentHandout=t,this.showHandout=!0},closeHandout(){this.showHandout=!1,this.currentHandout=null},onSceneChange(){this.showDiceOverlay=!1,this.showComboOverlay=!1,this.showHandout=!1,this.currentHandout=null,this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),this.displaySceneDescriptionIfPresent()},displaySceneDescriptionIfPresent(){if(!this.currentScene)return;const t=this.currentScene.steps[0];t&&t.type==="scene-description"&&(this.sceneDescriptionData={number:t.sceneNumber,title:t.sceneTitle,pcs:t.scenePCs,description:t.sceneDescription,fullText:t.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance())},closeSceneDescription(){this.showSceneDescription=!1;const t=this.sceneDescriptionTimer!==null;this.stopSceneDescriptionAutoAdvance(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startSceneDescriptionAutoAdvance(){this.stopSceneDescriptionAutoAdvance(),this.sceneDescriptionTimer=setTimeout(()=>{this.closeSceneDescription(),this.autoPlayEnabled&&(this.hasNextStep?this.nextStep():this.logStore.toggleAutoPlay())},3e3/this.autoPlaySpeed)},stopSceneDescriptionAutoAdvance(){this.sceneDescriptionTimer&&(clearTimeout(this.sceneDescriptionTimer),this.sceneDescriptionTimer=null)},nextStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.nextStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.applyStepEffects(),this.showOverlaysIfPresent(),this.logStore.playback.currentStepIndex%10===0&&this.logStore.autoSave()},previousStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.previousStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.applyStepEffects(),this.showOverlaysIfPresent()},showOverlaysIfPresent(){if(this.currentStep&&this.currentStep.type==="scene-description"){this.sceneDescriptionData={number:this.currentStep.sceneNumber,title:this.currentStep.sceneTitle,pcs:this.currentStep.scenePCs,description:this.currentStep.sceneDescription,fullText:this.currentStep.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance();return}const t=this.currentStep&&this.currentStep.diceRolls&&this.currentStep.diceRolls.length>0,e=this.currentStep&&this.currentStep.ougis&&this.currentStep.ougis.length>0,n=this.currentStep&&this.currentStep.shinobigamis&&this.currentStep.shinobigamis.length>0,r=this.currentStep&&this.currentStep.dxCombos&&this.currentStep.dxCombos.length>0;if(t||e||n){const o=[...this.currentStep.ougis||[],...this.currentStep.shinobigamis||[],...this.currentStep.diceRolls||[]];this.currentDiceRolls=o,this.diceCharacterName=this.getCharacterName(this.currentStep),this.diceCharacterColor=this.currentStep.character.color,this.showDiceOverlay=!0,this.autoPlayEnabled&&this.startDiceOverlayAutoClose();return}r&&(this.currentDXCombos=this.currentStep.dxCombos,this.comboCharacterName=this.getCharacterName(this.currentStep),this.comboCharacterColor=this.currentStep.character.color,this.showComboOverlay=!0,this.autoPlayEnabled&&this.startComboOverlayAutoClose())},closeDiceOverlay(){this.showDiceOverlay=!1;const t=this.diceOverlayTimer!==null;this.stopDiceOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startDiceOverlayAutoClose(){this.stopDiceOverlayAutoClose(),this.diceOverlayTimer=setTimeout(()=>{this.closeDiceOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3/this.autoPlaySpeed)},stopDiceOverlayAutoClose(){this.diceOverlayTimer&&(clearTimeout(this.diceOverlayTimer),this.diceOverlayTimer=null)},closeComboOverlay(){this.showComboOverlay=!1;const t=this.comboOverlayTimer!==null;this.stopComboOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startComboOverlayAutoClose(){this.stopComboOverlayAutoClose(),this.comboOverlayTimer=setTimeout(()=>{this.closeComboOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3/this.autoPlaySpeed)},stopComboOverlayAutoClose(){this.comboOverlayTimer&&(clearTimeout(this.comboOverlayTimer),this.comboOverlayTimer=null)},toggleAutoPlay(){const t=this.autoPlayEnabled;this.logStore.toggleAutoPlay(),!t&&this.autoPlayEnabled&&this.hasActiveOverlay},toggleTheaterMode(){this.theaterMode=!this.theaterMode,this.theaterMode&&!this.autoPlayEnabled&&(this.logStore.toggleAutoPlay(),!this.hasActiveOverlay&&this.hasNextStep&&this.nextStep()),console.log("[PlayerView] Í∞êÏÉÅ Î™®Îìú:",this.theaterMode?"ÌôúÏÑ±Ìôî":"ÎπÑÌôúÏÑ±Ìôî")},handleTheaterModeClick(t){if(this.theaterMode){if(t.target.closest("button")||t.target.closest(".dialog-box"))return;this.theaterMode=!1,console.log("[PlayerView] Í∞êÏÉÅ Î™®Îìú Ï¢ÖÎ£å (ÌÅ¥Î¶≠)")}},changeAutoPlaySpeed(t){this.autoPlaySpeed=t,console.log("[PlayerView] ÏûêÎèôÏû¨ÏÉù ÏÜçÎèÑ Î≥ÄÍ≤Ω:",t+"Î∞∞ÏÜç")},stopAutoPlay(){this.autoPlayTimer&&(clearInterval(this.autoPlayTimer),this.autoPlayTimer=null)},applyStepEffects(){if(!this.currentStep){console.log("[applyStepEffects] currentStepÏù¥ ÏóÜÏäµÎãàÎã§.");return}const t=this.currentStep.effects;console.log("[applyStepEffects] Ïä§ÌÖù Ìö®Í≥º Ï†ÅÏö©:",{stepNumber:this.currentStepNumber,hasEffects:!!t,effects:t}),t!=null&&t.sfx?(console.log("[applyStepEffects] Ìö®Í≥ºÏùå Î∞úÍ≤¨, Ïû¨ÏÉù ÏãúÏûë:",t.sfx),this.playSFX(t.sfx)):console.log("[applyStepEffects] Ìö®Í≥ºÏùå ÏóÜÏùå");const e=(t==null?void 0:t.bgm)||null;if(e&&e!==this.previousBgmUrl&&(this.changeBGM(e),this.previousBgmUrl=e),t!=null&&t.background){const n=t.backgroundOpacity??.3;this.changeBackground(t.background,n)}else this.currentBackground&&this.currentBackground!==this.defaultThemeBackground.url&&this.restoreDefaultBackground()},async playSFX(t){if(!t||!t.trim()){console.warn("[playSFX] Ìö®Í≥ºÏùå URLÏù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.");return}console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏãúÎèÑ:",t);try{let e=t.trim();if(e.includes("youtube.com")||e.includes("youtu.be")){console.warn("[playSFX] YouTube Ìö®Í≥ºÏùåÏùÄ Ïò§ÎîîÏò§ ÌååÏùº URLÎ°ú Î≥ÄÌôòÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.");return}if(e.includes("drive.google.com")||e.includes("docs.google.com")){let r=null;const o=e.match(/\/file\/d\/([^\/\?]+)/);o&&(r=o[1]);const l=e.match(/[?&]id=([^&]+)/);l&&(r=l[1]),r&&(e=`https://docs.google.com/uc?export=download&id=${r}`,console.log("[playSFX] Google Drive URL Î≥ÄÌôò:",e))}const n=new Audio(e);n.volume=.7,n.loop=!1,console.log("[playSFX] Audio Í∞ùÏ≤¥ ÏÉùÏÑ± ÏôÑÎ£å, Î°úÎî© Ï§ë..."),n.addEventListener("loadeddata",()=>{console.log("[playSFX] Ïò§ÎîîÏò§ Î°úÎìú ÏôÑÎ£å, Ïû¨ÏÉù ÏãúÏûë")}),n.addEventListener("ended",()=>{console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏôÑÎ£å"),n.src="",this.sfxAudio===n&&(this.sfxAudio=null)}),n.addEventListener("error",r=>{console.error("[playSFX] Ìö®Í≥ºÏùå Î°úÎìú/Ïû¨ÏÉù Ïã§Ìå®:",{error:r,url:e,readyState:n.readyState,networkState:n.networkState}),e.includes("youtube.com")||e.includes("youtu.be")?console.warn("[playSFX] YouTube URLÏùÄ ÏßÅÏ†ë Ïò§ÎîîÏò§ Ïû¨ÏÉùÏù¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§. Ïò§ÎîîÏò§ ÌååÏùº URLÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî."):e.includes("google.com")&&(console.error("[playSFX] Google Drive/Docs ÌååÏùº Ïû¨ÏÉù Ïã§Ìå®"),console.warn("Ìï¥Í≤∞ Î∞©Î≤ï:"),console.warn('1. ÌååÏùºÏù¥ "ÎßÅÌÅ¨Í∞Ä ÏûàÎäî Î™®Îì† ÏÇ¨Ïö©Ïûê" Í≥µÏú† ÏÑ§Ï†ïÏù∏ÏßÄ ÌôïÏù∏'),console.warn("2. ÎòêÎäî Îã§Î•∏ Ìò∏Ïä§ÌåÖ ÏÑúÎπÑÏä§ ÏÇ¨Ïö© (Ïòà: GitHub, Dropbox, ÏßÅÏ†ë ÏÑúÎ≤Ñ)"),console.warn("3. ÎòêÎäî base64 Ïù∏ÏΩîÎî©Îêú data URL ÏÇ¨Ïö©"))});try{await n.play(),console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏãúÏûë ÏÑ±Í≥µ")}catch(r){console.error("[playSFX] Ïû¨ÏÉù Ïã§Ìå®:",{error:r,message:r.message,name:r.name}),r.name==="NotAllowedError"&&console.warn("[playSFX] Î∏åÎùºÏö∞Ï†Ä ÏûêÎèôÏû¨ÏÉù Ï†ïÏ±ÖÏúºÎ°ú Ïù∏Ìï¥ Ìö®Í≥ºÏùå Ïû¨ÏÉùÏù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§. ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© ÌõÑ Ïû¨ÏãúÎèÑÌïòÏÑ∏Ïöî.")}this.sfxAudio=n}catch(e){console.error("[playSFX] Ìö®Í≥ºÏùå Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò:",e)}},changeBGM(t){const e=t.includes("youtube.com")||t.includes("youtu.be");this.bgmSettings={url:t,type:e?"youtube":"audio",volume:this.bgmSettings.volume||.5,autoPlay:!0}},changeBackground(t,e=.3){this.currentBackground=t;const n=`linear-gradient(rgba(0, 0, 0, ${1-e}), rgba(0, 0, 0, ${1-e}))`;document.documentElement.style.setProperty("--bg-image",`${n}, url(${t})`),document.documentElement.style.setProperty("--bg-image-size","cover")},applyCustomCSS(t){if(!t)return;const e=document.getElementById("vnlog-custom-css-player");e&&e.remove();let n="";if(t.cssVars)n=this.generateCSSFromVars(t.cssVars),t.userCustomCSS&&(n+=`
`+t.userCustomCSS);else if(Object.keys(t).length>0)n=this.generateCSSFromVars(t);else return;const r=this.wrapCSSWithPlayerScope(n),o=document.createElement("style");o.id="vnlog-custom-css-player",o.textContent=r,document.head.appendChild(o),console.log("[PlayerView] Ïª§Ïä§ÌÖÄ CSS Ï†ÅÏö© ÏôÑÎ£å")},generateCSSFromVars(t){const e=["/* VNLog Custom CSS - PlayerView */",":root {"];return t.dialogBackground&&e.push(`  --custom-dialog-bg: ${t.dialogBackground};`),t.dialogBorderColor&&e.push(`  --custom-dialog-border: ${t.dialogBorderColor};`),t.dialogTextColor&&e.push(`  --custom-dialog-text: ${t.dialogTextColor};`),t.dialogNameFontSize&&e.push(`  --custom-dialog-name-size: ${t.dialogNameFontSize};`),t.dialogTextFontSize&&e.push(`  --custom-dialog-text-size: ${t.dialogTextFontSize};`),t.dialogPadding&&e.push(`  --custom-dialog-padding: ${t.dialogPadding};`),t.dialogBorderRadius&&e.push(`  --custom-dialog-radius: ${t.dialogBorderRadius};`),t.characterMaxHeight&&e.push(`  --custom-character-max-height: ${t.characterMaxHeight};`),t.characterInactiveOpacity&&e.push(`  --custom-character-inactive-opacity: ${t.characterInactiveOpacity};`),t.characterTransition&&e.push(`  --custom-character-transition: ${t.characterTransition};`),t.controlsBackground&&e.push(`  --custom-controls-bg: ${t.controlsBackground};`),t.controlsButtonColor&&e.push(`  --custom-controls-button: ${t.controlsButtonColor};`),t.controlsButtonHoverColor&&e.push(`  --custom-controls-button-hover: ${t.controlsButtonHoverColor};`),t.controlsProgressColor&&e.push(`  --custom-controls-progress: ${t.controlsProgressColor};`),t.overlayBackground&&e.push(`  --custom-overlay-bg: ${t.overlayBackground};`),t.overlayBlur&&e.push(`  --custom-overlay-blur: ${t.overlayBlur};`),t.overlayContentBackground&&e.push(`  --custom-overlay-content-bg: ${t.overlayContentBackground};`),t.overlayTextColor&&e.push(`  --custom-overlay-text: ${t.overlayTextColor};`),t.globalBackground&&(e.push(`  --custom-global-bg: ${t.globalBackground};`),e.push(`  --bg-color: ${t.globalBackground};`)),t.globalTextColor&&(e.push(`  --custom-global-text: ${t.globalTextColor};`),e.push(`  --text-color: ${t.globalTextColor};`)),t.globalFontFamily&&(e.push(`  --custom-global-font: ${t.globalFontFamily};`),e.push(`  --font-pretendard: ${t.globalFontFamily};`)),t.globalLineHeight&&e.push(`  --custom-global-line-height: ${t.globalLineHeight};`),t.globalBackgroundImage&&t.globalBackgroundImage!=="none"&&e.push(`  --bg-image: ${t.globalBackgroundImage};`),t.globalBackgroundSize&&e.push(`  --bg-image-size: ${t.globalBackgroundSize};`),e.push("}"),e.push(""),e.push(".dialog-box {"),e.push("  background: var(--custom-dialog-bg, rgba(0, 0, 0, 0.85)) !important;"),e.push("  border-color: var(--custom-dialog-border, rgba(255, 255, 255, 0.2)) !important;"),e.push("  color: var(--custom-dialog-text, #ffffff) !important;"),e.push("  padding: var(--custom-dialog-padding, 1.5rem) !important;"),e.push("  border-radius: var(--custom-dialog-radius, 12px) !important;"),e.push("}"),e.join(`
`)},wrapCSSWithPlayerScope(t){const e=t.split(`
`),n=[];for(const r of e){const o=r.trim();if(o.startsWith("/*")||o.endsWith("*/")){n.push(r);continue}if(o===":root {"){n.push(".player-view {");continue}if(o.endsWith("{")&&!o.startsWith("}")){const l=o.slice(0,-1).trim();if(l.startsWith(".player-view"))n.push(r);else{const a=r.match(/^\s*/)[0];n.push(`${a}.player-view ${l} {`)}continue}n.push(r)}return n.join(`
`)},restoreDefaultBGM(){const t=localStorage.getItem("vnlog-theme-settings");if(t)try{const e=JSON.parse(t);if(e.bgmUrl){this.bgmSettings={url:e.bgmUrl,type:e.bgmType||"youtube",volume:e.bgmVolume||.5,autoPlay:!0};return}}catch(e){console.warn("ÌÖåÎßà ÏÑ§Ï†ï Î≥µÏõê Ïã§Ìå®:",e)}this.bgmSettings={url:"",type:"youtube",volume:this.bgmSettings.volume||.5,autoPlay:!1}},clearBackground(){this.currentBackground=null,document.documentElement.style.setProperty("--bg-image","none")},restoreDefaultBackground(){this.defaultThemeBackground.url?this.changeBackground(this.defaultThemeBackground.url,this.defaultThemeBackground.opacity):this.clearBackground()},handleKeyPress(t){if(!(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"))switch(t.key){case" ":case"Enter":t.preventDefault(),this.handleAdvance();break;case"ArrowLeft":t.preventDefault(),this.hasPreviousStep&&this.previousStep();break;case"ArrowRight":t.preventDefault(),this.hasNextStep&&this.nextStep();break}}},mounted(){var e,n,r;if(!this.logStore.rawLog){console.warn("Î°úÍ∑∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}if(!this.logStore.vnData||!this.logStore.vnData.scenes||this.logStore.vnData.scenes.length===0){console.warn("ÌååÏã±Îêú VN Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}const t=localStorage.getItem("vnlog-theme-settings");if(t)try{const o=JSON.parse(t);o.bgmUrl&&(this.bgmSettings={url:o.bgmUrl,type:o.bgmType||"youtube",volume:o.bgmVolume||.5,autoPlay:o.bgmAutoPlay||!1},this.previousBgmUrl=o.bgmUrl),o.bgImageUrl&&(this.defaultThemeBackground={url:o.bgImageUrl,opacity:o.bgImageOpacity??.3,size:o.bgImageSize||"cover"})}catch(o){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:",o)}this.detectDevice(),window.addEventListener("resize",this.detectDevice),window.addEventListener("keydown",this.handleKeyPress),this.navigateToTargetStep(),this.$nextTick(()=>{this.applyStepEffects(),this.showOverlaysIfPresent()}),(e=this.logStore.vnData)!=null&&e.customCSS&&this.applyCustomCSS(this.logStore.vnData.customCSS),console.log("PlayerView mounted:",{hasRawLog:!!this.logStore.rawLog,hasVNData:!!this.logStore.vnData,sceneCount:((r=(n=this.logStore.vnData)==null?void 0:n.scenes)==null?void 0:r.length)||0,currentStep:this.currentStep})},beforeUnmount(){this.stopAutoPlay(),this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),window.removeEventListener("keydown",this.handleKeyPress),window.removeEventListener("resize",this.detectDevice),this.sfxAudio&&(this.sfxAudio.pause(),this.sfxAudio=null),this.currentBackground&&(document.documentElement.style.removeProperty("--bg-image"),document.documentElement.style.removeProperty("--bg-image-size")),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device")}},yt={class:"player-container"},bt={class:"log-title"},vt={class:"header-buttons"},St=["title"],ft={class:"player-stage"},kt={key:1,class:"dialog-wrapper"},Ct={key:1,class:"dialog-placeholder"},wt={class:"dice-overlay-hint"},xt={class:"combo-overlay-header"},Tt={class:"combo-character-info"},Dt={class:"dice-overlay-hint"},Pt={class:"scene-description-content"},It={class:"scene-description-header"},Bt={class:"scene-number"},Ot={class:"scene-title"},Et={key:0,class:"scene-pcs"},At={class:"scene-pcs-value"},Mt={key:1,class:"scene-description-text"};function Ut(t,e,n,r,o,l){const a=v("EmojiToIcon"),i=v("CharacterDisplay"),S=v("DialogBox"),B=v("DiceRoll"),O=v("DXCombo"),E=v("PlaybackControls"),A=v("SceneSelectorModal"),M=v("HandoutDisplay"),U=v("ThemeSettingsModal"),L=v("SaveLoadModal"),z=v("BGMPlayer");return u(),d("div",{class:"player-view",onClick:e[12]||(e[12]=(...p)=>l.handleTheaterModeClick&&l.handleTheaterModeClick(...p))},[s("div",yt,[s("div",{class:I(["player-header",{"theater-mode":o.theaterMode}])},[s("button",{onClick:e[0]||(e[0]=(...p)=>l.goHome&&l.goHome(...p)),class:"back-button"},[c(a,{emoji:"üè†",size:20})]),s("h2",bt,y(l.logTitle),1),s("div",vt,[s("button",{onClick:e[1]||(e[1]=f((...p)=>l.toggleTheaterMode&&l.toggleTheaterMode(...p),["stop"])),class:"header-button",title:o.theaterMode?"Í∞êÏÉÅ Î™®Îìú Ï¢ÖÎ£å":"Í∞êÏÉÅ Î™®Îìú"},[c(a,{emoji:o.theaterMode?"üé¨":"üé•",size:20},null,8,["emoji"])],8,St),o.isMobile!=!0?(u(),d("button",{key:0,onClick:e[2]||(e[2]=(...p)=>l.openEditor&&l.openEditor(...p)),class:"header-button",title:"Ìö®Í≥º Ìé∏Ïßë"},[c(a,{emoji:"‚ú®",size:20})])):g("",!0),s("button",{onClick:e[3]||(e[3]=(...p)=>l.openSceneSelector&&l.openSceneSelector(...p)),class:"header-button",title:"Ïî¨ ÏÑ†ÌÉù"},[c(a,{emoji:"üìë",size:20})]),s("button",{onClick:e[4]||(e[4]=(...p)=>l.openSaveModal&&l.openSaveModal(...p)),class:"header-button",title:"Ï†ÄÏû•"},[c(a,{emoji:"üíæ",size:20})]),s("button",{onClick:e[5]||(e[5]=(...p)=>l.openLoadModal&&l.openLoadModal(...p)),class:"header-button",title:"Î∂àÎü¨Ïò§Í∏∞"},[c(a,{emoji:"üìÇ",size:20})]),s("button",{onClick:e[6]||(e[6]=(...p)=>l.openSettings&&l.openSettings(...p)),class:"header-button",title:"ÏÑ§Ï†ï"},[c(a,{emoji:"‚öôÔ∏è",size:20})])])],2),s("div",ft,[l.currentStep&&!l.currentStep.isSceneDescription&&r.logStore.vnData.characters?(u(),k(i,{key:0,"current-step":l.currentStep,characters:r.logStore.vnData.characters,layout:"single"},null,8,["current-step","characters"])):g("",!0),!l.currentStep||l.currentStep.type!=="scene-description"?(u(),d("div",kt,[l.currentStep&&l.currentStep.character?(u(),k(S,{key:0,"step-key":l.dialogStepKey,"step-type":l.currentStep.type||"dialogue","character-name":l.getCharacterName(l.currentStep),"character-color":l.currentStep.character.color,text:l.currentStep.text,"status-changes":l.currentStep.statusChanges||[],illustrations:l.currentStep.illustrations||[],"typing-speed":o.typingSpeed,"auto-play-speed":o.autoPlaySpeed,"auto-advance":l.autoPlayEnabled,"has-overlay":l.hasActiveOverlay,onAdvance:l.handleAdvance,onTypingComplete:l.handleTypingComplete},null,8,["step-key","step-type","character-name","character-color","text","status-changes","illustrations","typing-speed","auto-play-speed","auto-advance","has-overlay","onAdvance","onTypingComplete"])):(u(),d("div",Ct,[...e[13]||(e[13]=[s("p",null,"Î°úÍ∑∏Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...",-1)])]))])):g("",!0)]),c(w,{name:"dice-overlay"},{default:C(()=>[o.showDiceOverlay&&o.currentDiceRolls.length>0?(u(),d("div",{key:0,class:"dice-overlay",onClick:e[8]||(e[8]=(...p)=>l.closeDiceOverlay&&l.closeDiceOverlay(...p))},[s("div",{class:"dice-overlay-content",onClick:e[7]||(e[7]=f(()=>{},["stop"]))},[c(B,{"dice-rolls":o.currentDiceRolls,"character-name":o.diceCharacterName,"character-color":o.diceCharacterColor,animated:!0,"play-sound-effect":!1},null,8,["dice-rolls","character-name","character-color"]),s("div",wt,[c(a,{emoji:"üëÜ",size:14}),e[14]||(e[14]=s("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):g("",!0)]),_:1}),c(w,{name:"dice-overlay"},{default:C(()=>[o.showComboOverlay&&o.currentDXCombos.length>0?(u(),d("div",{key:0,class:"dice-overlay",onClick:e[10]||(e[10]=(...p)=>l.closeComboOverlay&&l.closeComboOverlay(...p))},[s("div",{class:"dice-overlay-content",onClick:e[9]||(e[9]=f(()=>{},["stop"]))},[s("div",xt,[s("div",Tt,[s("div",{class:"combo-character-name",style:P({color:o.comboCharacterColor})},y(o.comboCharacterName),5)])]),c(O,{dxCombos:o.currentDXCombos},null,8,["dxCombos"]),s("div",Dt,[c(a,{emoji:"üëÜ",size:14}),e[15]||(e[15]=s("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):g("",!0)]),_:1}),c(w,{name:"scene-description"},{default:C(()=>[o.showSceneDescription&&o.sceneDescriptionData?(u(),d("div",{key:0,class:"scene-description-overlay",onClick:e[11]||(e[11]=(...p)=>l.closeSceneDescription&&l.closeSceneDescription(...p))},[s("div",Pt,[s("div",It,[s("span",Bt,"Ïî¨ "+y(o.sceneDescriptionData.number),1),s("span",Ot,y(o.sceneDescriptionData.title),1)]),o.sceneDescriptionData.pcs?(u(),d("div",Et,[e[16]||(e[16]=s("span",{class:"scene-pcs-label"},"PC:",-1)),s("span",At,y(o.sceneDescriptionData.pcs),1)])):g("",!0),o.sceneDescriptionData.description?(u(),d("div",Mt,y(o.sceneDescriptionData.description),1)):g("",!0),e[17]||(e[17]=s("div",{class:"scene-description-hint"},"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])):g("",!0)]),_:1}),o.theaterMode?g("",!0):(u(),k(E,{key:0,"current-step-number":l.currentStepNumber,"total-steps":l.totalSteps,"current-scene-name":l.currentSceneName,"has-previous-step":l.hasPreviousStep,"has-next-step":l.hasNextStep,"auto-play-enabled":l.autoPlayEnabled,"auto-play-speed":o.autoPlaySpeed,"show-progress-bar":!0,"show-scene-selector":!0,onPrevious:l.previousStep,onNext:l.handleAdvance,onToggleAutoplay:l.toggleAutoPlay,onChangeSpeed:l.changeAutoPlaySpeed,onOpenSceneSelector:l.openSceneSelector},null,8,["current-step-number","total-steps","current-scene-name","has-previous-step","has-next-step","auto-play-enabled","auto-play-speed","onPrevious","onNext","onToggleAutoplay","onChangeSpeed","onOpenSceneSelector"]))]),c(A,{"is-visible":o.showSceneSelector,scenes:r.logStore.vnData.scenes,"current-scene-index":r.logStore.playback.currentSceneIndex,"current-step-index":r.logStore.playback.currentStepIndex,onClose:l.closeSceneSelector,onGoToStep:l.handleGoToStep},null,8,["is-visible","scenes","current-scene-index","current-step-index","onClose","onGoToStep"]),c(M,{handout:o.currentHandout,"is-visible":o.showHandout,onClose:l.closeHandout},null,8,["handout","is-visible","onClose"]),c(U,{"is-visible":o.showThemeSettings,onClose:l.closeSettings,onSave:l.handleThemeSave,onBgmChange:l.handleBgmChange},null,8,["is-visible","onClose","onSave","onBgmChange"]),c(L,{"is-visible":o.showSaveLoadModal,mode:o.saveLoadMode,onClose:l.closeSaveLoadModal,onSave:l.handleSave,onLoad:l.handleLoad},null,8,["is-visible","mode","onClose","onSave","onLoad"]),c(z,{"bgm-url":o.bgmSettings.url,"bgm-type":o.bgmSettings.type,volume:o.bgmSettings.volume,"auto-play":o.bgmSettings.autoPlay,"show-controls":!o.theaterMode},null,8,["bgm-url","bgm-type","volume","auto-play","show-controls"])])}const Nt=x(mt,[["render",Ut],["__scopeId","data-v-088a750f"]]);export{Nt as default};
