import{u as N}from"./logStore-ByxQ9vNo.js";import{_ as I,c,a as t,d as u,e as g,r as D,f as h,i as m,v as f,t as b,o as d,p as j,F as C,m as U,j as z,n as S,k as T,l as x,g as E,h as O}from"./index-DTPgpNM4.js";const F={name:"StepEffectsEditor",props:{totalSteps:{type:Number,required:!0},selectedStep:{type:Number,default:null},currentEffects:{type:Object,default:null}},data(){return{startStep:1,endStep:1,effects:{sfx:"",bgm:"",background:"",backgroundOpacity:.3},isLoadingFile:!1}},computed:{canApply(){return this.startStep>=1&&this.endStep>=this.startStep&&this.endStep<=this.totalSteps},hasAnyEffect(){return this.effects.sfx||this.effects.bgm||this.effects.background}},methods:{formatPreviewUrl(o){return o?o.startsWith("data:")?`[ë¡œì»¬ ${o.split(";")[0].split(":")[1].split("/")[0]==="audio"?"ì˜¤ë””ì˜¤":"ì´ë¯¸ì§€"} íŒŒì¼]`:o:""},formatPreviewUrl(o){return o?o.startsWith("data:")?`[ë¡œì»¬ ${o.split(";")[0].split(":")[1].split("/")[0]==="audio"?"ì˜¤ë””ì˜¤":"ì´ë¯¸ì§€"} íŒŒì¼]`:o:""},async handleSfxFileSelect(o){const e=o.target.files[0];if(e){if(e.size>5*1024*1024){alert("íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤."),o.target.value="";return}this.isLoadingFile=!0;try{const a=await this.fileToBase64(e);this.effects.sfx=a,console.log("[StepEffectsEditor] íš¨ê³¼ìŒ íŒŒì¼ ë¡œë“œ ì™„ë£Œ:",{fileName:e.name,fileSize:e.size,base64Length:a.length})}catch(a){console.error("[StepEffectsEditor] íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:",a),alert("íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{this.isLoadingFile=!1,o.target.value=""}}},fileToBase64(o){return new Promise((e,a)=>{const p=new FileReader;p.onload=()=>e(p.result),p.onerror=a,p.readAsDataURL(o)})},clearSfx(){this.effects.sfx=""},async handleBgmFileSelect(o){const e=o.target.files[0];if(e){if(e.size>10*1024*1024){alert("BGM íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤."),o.target.value="";return}this.isLoadingFile=!0;try{const a=await this.fileToBase64(e);this.effects.bgm=a,console.log("[StepEffectsEditor] BGM íŒŒì¼ ë¡œë“œ ì™„ë£Œ:",{fileName:e.name,fileSize:e.size,base64Length:a.length})}catch(a){console.error("[StepEffectsEditor] íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:",a),alert("íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{this.isLoadingFile=!1,o.target.value=""}}},clearBgm(){this.effects.bgm=""},async handleBgFileSelect(o){const e=o.target.files[0];if(e){if(e.size>2*1024*1024){alert("ì´ë¯¸ì§€ íŒŒì¼ í¬ê¸°ëŠ” 2MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤."),o.target.value="";return}this.isLoadingFile=!0;try{const a=await this.fileToBase64(e);this.effects.background=a,console.log("[StepEffectsEditor] ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ:",{fileName:e.name,fileSize:e.size,base64Length:a.length})}catch(a){console.error("[StepEffectsEditor] íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:",a),alert("íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{this.isLoadingFile=!1,o.target.value=""}}},clearBackground(){this.effects.background=""},convertToDirectURL(o){if(!o||!o.trim())return o;const e=o.trim();if(e.startsWith("data:"))return e;const a=e.match(/drive\.google\.com\/file\/d\/([^\/\?]+)/);return a?`https://docs.google.com/uc?export=download&id=${a[1]}`:e.includes("dropbox.com")?e.replace(/[?&]dl=0/,"?dl=1"):e.includes("1drv.ms")||e.includes("onedrive.live.com")?e.replace("/embed?","/download?"):e},applyEffects(){this.canApply&&(this.$emit("apply",{startStep:this.startStep,endStep:this.endStep,effects:{sfx:this.convertToDirectURL(this.effects.sfx)||null,bgm:this.convertToDirectURL(this.effects.bgm)||null,background:this.convertToDirectURL(this.effects.background)||null,backgroundOpacity:this.effects.backgroundOpacity}}),this.resetForm())},removeEffects(){this.canApply&&(this.$emit("remove",{startStep:this.startStep,endStep:this.endStep}),this.resetForm())},resetForm(){this.effects={sfx:"",bgm:"",background:"",backgroundOpacity:.3}},loadStepEffects(){this.selectedStep!==null&&(this.startStep=this.selectedStep,this.endStep=this.selectedStep),this.currentEffects&&(this.effects={sfx:this.currentEffects.sfx||"",bgm:this.currentEffects.bgm||"",background:this.currentEffects.background||"",backgroundOpacity:this.currentEffects.backgroundOpacity??.3})}},watch:{selectedStep:{immediate:!0,handler(){this.loadStepEffects()}},currentEffects:{immediate:!0,handler(){this.loadStepEffects()}}}},R={class:"step-effects-editor"},L={class:"editor-header"},A={class:"editor-body"},B={class:"section"},J={class:"step-range"},G={class:"input-group"},P=["max"],M={class:"input-group"},X=["min","max"],W={class:"section"},q={class:"file-input-group"},H={class:"hint-text"},Y={class:"section"},K={class:"file-input-group"},Q={class:"hint-text"},Z={class:"section"},$={class:"file-input-group"},ee={class:"hint-text"},te={key:0,class:"opacity-control"},se={key:0,class:"section preview-section"},le={class:"preview-list"},oe={key:0,class:"preview-item"},ie={key:1,class:"preview-item"},ae={key:2,class:"preview-item"},ne={key:3,class:"preview-item"},re={class:"actions"},de=["disabled"],ce=["disabled"];function ue(o,e,a,p,l,i){const n=D("EmojiToIcon");return d(),c("div",R,[t("div",L,[t("h3",null,[u(n,{emoji:"âœ¨",size:20}),e[17]||(e[17]=g(" ìŠ¤í… íš¨ê³¼ íŽ¸ì§‘ê¸° ",-1))])]),t("div",A,[t("div",B,[e[20]||(e[20]=t("h4",null,"ëŒ€ìƒ ìŠ¤í… ì„ íƒ",-1)),t("div",J,[t("div",G,[e[18]||(e[18]=t("label",null,"ì‹œìž‘ ìŠ¤í…",-1)),m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.startStep=s),type:"number",min:1,max:a.totalSteps,placeholder:"1"},null,8,P),[[f,l.startStep,void 0,{number:!0}]])]),t("div",M,[e[19]||(e[19]=t("label",null,"ì¢…ë£Œ ìŠ¤í…",-1)),m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.endStep=s),type:"number",min:l.startStep,max:a.totalSteps,placeholder:"1"},null,8,X),[[f,l.endStep,void 0,{number:!0}]])])]),e[21]||(e[21]=t("p",{class:"hint-text"}," ë‹¨ì¼ ìŠ¤í…: ì‹œìž‘ê³¼ ì¢…ë£Œë¥¼ ê°™ì€ ë²ˆí˜¸ë¡œ ì„¤ì • | ë²”ìœ„: ë‹¤ë¥¸ ë²ˆí˜¸ë¡œ ì„¤ì • ",-1))]),t("div",W,[t("h4",null,[u(n,{emoji:"ðŸ”Š",size:16}),e[22]||(e[22]=g(" íš¨ê³¼ìŒ (SFX) ",-1))]),t("div",q,[m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.effects.sfx=s),type:"text",placeholder:"íš¨ê³¼ìŒ URL ìž…ë ¥ ë˜ëŠ” íŒŒì¼ ì„ íƒ ë²„íŠ¼ í´ë¦­",class:"url-input"},null,512),[[f,l.effects.sfx]]),t("input",{ref:"sfxFileInput",type:"file",accept:"audio/*",onChange:e[3]||(e[3]=(...s)=>i.handleSfxFileSelect&&i.handleSfxFileSelect(...s)),style:{display:"none"}},null,544),t("button",{onClick:e[4]||(e[4]=s=>o.$refs.sfxFileInput.click()),class:"file-select-button"},[u(n,{emoji:"ðŸ“",size:14}),e[23]||(e[23]=g(" íŒŒì¼ ì„ íƒ ",-1))]),l.effects.sfx?(d(),c("button",{key:0,onClick:e[5]||(e[5]=(...s)=>i.clearSfx&&i.clearSfx(...s)),class:"clear-button"},[u(n,{emoji:"âœ–ï¸",size:14})])):h("",!0)]),t("p",H,[u(n,{emoji:"ðŸ’¡",size:12}),e[24]||(e[24]=g(" ë¡œì»¬ íŒŒì¼ì€ base64ë¡œ ì¸ì½”ë”©ë˜ì–´ ì €ìž¥ë©ë‹ˆë‹¤ (ì™¸ë¶€ í˜¸ìŠ¤íŒ… ë¶ˆí•„ìš”) ",-1))])]),t("div",Y,[t("h4",null,[u(n,{emoji:"ðŸŽµ",size:16}),e[25]||(e[25]=g(" ë°°ê²½ìŒì•… (BGM) ",-1))]),t("div",K,[m(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.effects.bgm=s),type:"text",placeholder:"BGM URL (YouTube) ìž…ë ¥ ë˜ëŠ” íŒŒì¼ ì„ íƒ ë²„íŠ¼ í´ë¦­",class:"url-input"},null,512),[[f,l.effects.bgm]]),t("input",{ref:"bgmFileInput",type:"file",accept:"audio/*",onChange:e[7]||(e[7]=(...s)=>i.handleBgmFileSelect&&i.handleBgmFileSelect(...s)),style:{display:"none"}},null,544),t("button",{onClick:e[8]||(e[8]=s=>o.$refs.bgmFileInput.click()),class:"file-select-button"},[u(n,{emoji:"ðŸ“",size:14}),e[26]||(e[26]=g(" íŒŒì¼ ì„ íƒ ",-1))]),l.effects.bgm?(d(),c("button",{key:0,onClick:e[9]||(e[9]=(...s)=>i.clearBgm&&i.clearBgm(...s)),class:"clear-button"},[u(n,{emoji:"âœ–ï¸",size:14})])):h("",!0)]),t("p",Q,[u(n,{emoji:"ðŸ’¡",size:12}),e[27]||(e[27]=g(" ë¡œì»¬ íŒŒì¼ì€ base64ë¡œ ì¸ì½”ë”© | YouTube URL ì§€ì› ",-1))])]),t("div",Z,[t("h4",null,[u(n,{emoji:"ðŸ–¼ï¸",size:16}),e[28]||(e[28]=g(" ë°°ê²½ ì´ë¯¸ì§€ ",-1))]),t("div",$,[m(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.effects.background=s),type:"text",placeholder:"ë°°ê²½ ì´ë¯¸ì§€ URL ìž…ë ¥ ë˜ëŠ” íŒŒì¼ ì„ íƒ ë²„íŠ¼ í´ë¦­",class:"url-input"},null,512),[[f,l.effects.background]]),t("input",{ref:"bgFileInput",type:"file",accept:"image/*",onChange:e[11]||(e[11]=(...s)=>i.handleBgFileSelect&&i.handleBgFileSelect(...s)),style:{display:"none"}},null,544),t("button",{onClick:e[12]||(e[12]=s=>o.$refs.bgFileInput.click()),class:"file-select-button"},[u(n,{emoji:"ðŸ“",size:14}),e[29]||(e[29]=g(" íŒŒì¼ ì„ íƒ ",-1))]),l.effects.background?(d(),c("button",{key:0,onClick:e[13]||(e[13]=(...s)=>i.clearBackground&&i.clearBackground(...s)),class:"clear-button"},[u(n,{emoji:"âœ–ï¸",size:14})])):h("",!0)]),t("p",ee,[u(n,{emoji:"ðŸ’¡",size:12}),e[30]||(e[30]=g(" ë¡œì»¬ ì´ë¯¸ì§€ëŠ” base64ë¡œ ì¸ì½”ë”©ë˜ì–´ ì €ìž¥ë©ë‹ˆë‹¤ ",-1))]),l.effects.background?(d(),c("div",te,[t("label",null,[u(n,{emoji:"ðŸ’§",size:14}),g(" ë°°ê²½ íˆ¬ëª…ë„ ("+b(Math.round(l.effects.backgroundOpacity*100))+"%) ",1)]),m(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>l.effects.backgroundOpacity=s),type:"range",min:"0",max:"1",step:"0.05",class:"opacity-slider"},null,512),[[f,l.effects.backgroundOpacity,void 0,{number:!0}]])])):h("",!0)]),i.hasAnyEffect?(d(),c("div",se,[t("h4",null,[u(n,{emoji:"ðŸ‘ï¸",size:16}),e[31]||(e[31]=g(" ì„¤ì • ë¯¸ë¦¬ë³´ê¸° ",-1))]),t("div",le,[l.effects.sfx?(d(),c("div",oe,[e[32]||(e[32]=t("strong",null,"íš¨ê³¼ìŒ:",-1)),t("span",null,b(i.formatPreviewUrl(l.effects.sfx)),1)])):h("",!0),l.effects.bgm?(d(),c("div",ie,[e[33]||(e[33]=t("strong",null,"BGM:",-1)),t("span",null,b(i.formatPreviewUrl(l.effects.bgm)),1)])):h("",!0),l.effects.background?(d(),c("div",ae,[e[34]||(e[34]=t("strong",null,"ë°°ê²½:",-1)),t("span",null,b(i.formatPreviewUrl(l.effects.background)),1)])):h("",!0),l.effects.background?(d(),c("div",ne,[e[35]||(e[35]=t("strong",null,"íˆ¬ëª…ë„:",-1)),t("span",null,b(Math.round(l.effects.backgroundOpacity*100))+"%",1)])):h("",!0)])])):h("",!0),t("div",re,[t("button",{onClick:e[15]||(e[15]=(...s)=>i.applyEffects&&i.applyEffects(...s)),class:"apply-button",disabled:!i.canApply},[u(n,{emoji:"âœ…",size:16}),e[36]||(e[36]=g(" íš¨ê³¼ ì ìš© ",-1))],8,de),t("button",{onClick:e[16]||(e[16]=(...s)=>i.removeEffects&&i.removeEffects(...s)),class:"remove-button",disabled:!i.canApply},[u(n,{emoji:"ðŸ—‘ï¸",size:16}),e[37]||(e[37]=g(" íš¨ê³¼ ì œê±° ",-1))],8,ce)])])])}const pe=I(F,[["render",ue],["__scopeId","data-v-f4f03fe6"]]),me={name:"StepInfoEditor",props:{stepData:{type:Object,default:null}},data(){return{localData:null,showRawJSON:!1,illustFileInputs:[],isLoadingFile:!1}},computed:{hasDice(){var o,e;return((e=(o=this.localData)==null?void 0:o.diceRolls)==null?void 0:e.length)>0},hasStatusChange(){var o,e;return((e=(o=this.localData)==null?void 0:o.statusChanges)==null?void 0:e.length)>0},hasDXCombo(){var o,e;return((e=(o=this.localData)==null?void 0:o.dxCombos)==null?void 0:e.length)>0},hasIllustration(){var o,e;return((e=(o=this.localData)==null?void 0:o.illustrations)==null?void 0:e.length)>0},hasOugi(){var o,e;return((e=(o=this.localData)==null?void 0:o.ougis)==null?void 0:e.length)>0},hasShinobigami(){var o,e;return((e=(o=this.localData)==null?void 0:o.shinobigamis)==null?void 0:e.length)>0}},watch:{"localData.statusChanges":{handler(o){o&&o.forEach(e=>{e.oldValue!==null&&e.newValue!==null&&(e.delta=e.newValue-e.oldValue)})},deep:!0},"localData.diceRolls":{handler(o){o&&o.forEach(e=>{e.type==="choice"&&e.optionsText&&(e.options=e.optionsText.split(",").map(a=>a.trim()))})},deep:!0}},methods:{initializeLocalData(){var o,e,a;if(!this.stepData){this.localData=null;return}this.localData={id:this.stepData.id,sceneNumber:this.stepData.sceneNumber,type:this.stepData.type||"dialogue",character:{name:((o=this.stepData.character)==null?void 0:o.name)||"",color:((e=this.stepData.character)==null?void 0:e.color)||"#ffffff",avatarUrl:((a=this.stepData.character)==null?void 0:a.avatarUrl)||""},text:this.stepData.text||"",rawText:this.stepData.rawText||"",isSceneDescription:this.stepData.isSceneDescription||!1,sceneTitle:this.stepData.sceneTitle||"",scenePCs:this.stepData.scenePCs||"",sceneDescription:this.stepData.sceneDescription||"",illustrations:JSON.parse(JSON.stringify(this.stepData.illustrations||[])),diceRolls:this.initializeDiceRolls(this.stepData.diceRolls||[]),statusChanges:JSON.parse(JSON.stringify(this.stepData.statusChanges||[])),dxCombos:JSON.parse(JSON.stringify(this.stepData.dxCombos||[])),ougis:this.initializeOugis(this.stepData.ougis||[]),shinobigamis:JSON.parse(JSON.stringify(this.stepData.shinobigamis||[])),effects:JSON.parse(JSON.stringify(this.stepData.effects||{sfx:null,bgm:null,background:null,backgroundOpacity:.3}))}},initializeDiceRolls(o){return o.map(e=>{const a={...e};return e.type==="choice"&&e.options&&Array.isArray(e.options)&&(a.optionsText=e.options.join(", ")),a})},initializeOugis(o){return o.map(e=>{const a={...e};return e.skills&&Array.isArray(e.skills)&&(a.skills=e.skills.join(", ")),a})},addIllustration(){this.localData.illustrations||(this.localData.illustrations=[]),this.localData.illustrations.push({url:"",alt:"img"})},removeIllustration(o){this.localData.illustrations.splice(o,1)},handleImageError(o){o.target.style.display="none"},async handleIllustFileSelect(o,e){var l;const a=(l=o.target.files)==null?void 0:l[0];if(!a)return;const p=2*1024*1024;if(a.size>p){alert("ì´ë¯¸ì§€ íŒŒì¼ í¬ê¸°ëŠ” 2MB ì´í•˜ë¡œ ì œí•œë©ë‹ˆë‹¤."),o.target.value="";return}this.isLoadingFile=!0;try{const i=await this.fileToBase64(a);this.localData.illustrations[e].url=i}catch(i){console.error("[handleIllustFileSelect] íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨:",i),alert("íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{this.isLoadingFile=!1,o.target.value=""}},clearIllustration(o){this.localData.illustrations[o].url="",this.illustFileInputs[o]&&(this.illustFileInputs[o].value="")},async handleAvatarFileSelect(o){var p;const e=(p=o.target.files)==null?void 0:p[0];if(!e)return;const a=2*1024*1024;if(e.size>a){alert("ì•„ë°”íƒ€ ì´ë¯¸ì§€ íŒŒì¼ í¬ê¸°ëŠ” 2MB ì´í•˜ë¡œ ì œí•œë©ë‹ˆë‹¤."),o.target.value="";return}this.isLoadingFile=!0;try{const l=await this.fileToBase64(e);this.localData.character.avatarUrl=l}catch(l){console.error("[handleAvatarFileSelect] íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨:",l),alert("íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{this.isLoadingFile=!1,o.target.value=""}},clearAvatar(){this.localData.character.avatarUrl="",this.$refs.avatarFileInput&&(this.$refs.avatarFileInput.value="")},fileToBase64(o){return new Promise((e,a)=>{const p=new FileReader;p.onload=()=>e(p.result),p.onerror=a,p.readAsDataURL(o)})},addDiceRoll(){this.localData.diceRolls||(this.localData.diceRolls=[]),this.localData.diceRolls.push({type:"normal",formula:"",result:0,fullFormula:"",diceRolls:"",command:"",checkName:"",judgement:"",options:[],optionsText:""})},removeDiceRoll(o){this.localData.diceRolls.splice(o,1)},addStatusChange(){this.localData.statusChanges||(this.localData.statusChanges=[]),this.localData.statusChanges.push({characterName:"",statusName:"",oldValue:null,newValue:null,delta:0})},toggleStatusMode(o,e){e.target.checked?(o.oldValue=0,o.newValue=0,o.delta=0):(o.oldValue=null,o.newValue=null)},computeDelta(o){return o.oldValue!==null&&o.newValue!==null?o.newValue-o.oldValue:o.delta||0},removeStatusChange(o){this.localData.statusChanges.splice(o,1)},addDXCombo(){this.localData.dxCombos||(this.localData.dxCombos=[]),this.localData.dxCombos.push({type:"dx-combo",isSingleEffect:!1,comboName:"",description:"",effects:[],timing:"",difficulty:"",target:"",range:"",erosion:"",erosionCost:null,diceRoll:null})},removeDXCombo(o){this.localData.dxCombos.splice(o,1)},addOugi(){this.localData.ougis||(this.localData.ougis=[]),this.localData.ougis.push({type:"ougi",ougiName:"",skills:"",presentation:"",ougiEffect:"",ninpouInfo:"",ougiType:""})},removeOugi(o){this.localData.ougis.splice(o,1)},addShinobigami(){this.localData.shinobigamis||(this.localData.shinobigamis=[]),this.localData.shinobigamis.push({type:"shinobigami",command:"",checkName:"",formula:"",diceRolls:"",diceExpression:"",result:0,judgement:"",additionalInfo:null})},removeShinobigami(o){this.localData.shinobigamis.splice(o,1)},addShinobiAdditionalInfo(o){o.additionalInfo={type:"",range:"",cost:"",skill:"",description:""}},deleteStep(){!this.stepData||!confirm(`ìŠ¤í… #${this.stepData.id}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
ì´ ìž‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)||this.$emit("delete",this.stepData.id)},duplicateStep(){this.stepData&&this.$emit("duplicate",this.stepData.id)},saveChanges(){if(!this.localData)return;const o={...this.localData,hasDice:this.hasDice,hasStatusChange:this.hasStatusChange,hasDXCombo:this.hasDXCombo,hasIllustration:this.hasIllustration,hasOugi:this.hasOugi,hasShinobigami:this.hasShinobigami};o.ougis&&(o.ougis=o.ougis.map(e=>({...e,skills:typeof e.skills=="string"?e.skills.split(/[,ã€]/).map(a=>a.trim()).filter(a=>a):e.skills}))),this.$emit("save",{id:this.stepData.id,updates:o})}},watch:{stepData:{immediate:!0,handler(){this.initializeLocalData(),this.showRawJSON=!1}}}},fe={class:"step-info-editor"},he={class:"editor-header"},ge={class:"editor-body"},ve={key:0,class:"no-selection"},be={key:1,class:"info-form"},ye={class:"field-group"},ke=["value"],_e={key:0,class:"field-group"},Ce={key:1,class:"field-group"},Se={key:2,class:"field-group"},Ue={class:"color-picker-wrapper"},we={key:3,class:"field-group"},De={class:"file-input-group"},xe=["placeholder","readonly"],Ie=["disabled"],Ve=["src"],je={key:4,class:"field-group"},Ee={key:5,class:"field-group"},ze=["value"],Te={key:6,class:"field-group"},Ne={class:"type-selection"},Oe={class:"radio-label"},Fe={class:"radio-label"},Re={class:"radio-label"},Le={class:"radio-label"},Ae={key:7,class:"scene-desc-section"},Be={class:"field-group"},Je={class:"field-label"},Ge={class:"field-row"},Pe={key:8,class:"field-group section-header"},Me={class:"field-label"},Xe={key:9,class:"items-list"},We={class:"item-content"},qe={class:"file-input-group"},He=["onUpdate:modelValue","placeholder","readonly"],Ye=["onChange"],Ke=["onClick","disabled"],Qe=["onClick"],Ze=["src"],$e=["onClick"],et={key:10,class:"field-group section-header"},tt={class:"field-label"},st={key:11,class:"items-list"},lt={class:"item-content"},ot={class:"field-row"},it=["onUpdate:modelValue"],at=["onUpdate:modelValue"],nt={key:0,class:"field-row"},rt=["onUpdate:modelValue"],dt={key:1,class:"dx3-fields"},ct={class:"field-row"},ut=["onUpdate:modelValue"],pt={class:"field-row"},mt=["onUpdate:modelValue"],ft={class:"field-row"},ht=["onUpdate:modelValue"],gt={key:2,class:"judgement-fields"},vt={class:"field-row"},bt=["onUpdate:modelValue"],yt=["onUpdate:modelValue"],kt={class:"field-row"},_t=["onUpdate:modelValue"],Ct=["onUpdate:modelValue"],St={key:3,class:"choice-fields"},Ut={class:"field-row"},wt=["onUpdate:modelValue"],Dt={class:"field-row"},xt=["onUpdate:modelValue"],It=["onClick"],Vt={key:12,class:"field-group section-header"},jt={class:"field-label"},Et={key:13,class:"items-list"},zt={class:"item-content"},Tt={class:"field-row"},Nt=["onUpdate:modelValue"],Ot=["onUpdate:modelValue"],Ft={class:"field-row"},Rt={class:"checkbox-label"},Lt=["checked","onChange"],At={key:0,class:"field-row"},Bt=["onUpdate:modelValue"],Jt=["onUpdate:modelValue"],Gt={key:1,class:"field-row"},Pt=["onUpdate:modelValue"],Mt=["onClick"],Xt={key:14,class:"field-group section-header"},Wt={class:"field-label"},qt={key:15,class:"items-list"},Ht={class:"item-content"},Yt=["onUpdate:modelValue"],Kt=["onUpdate:modelValue"],Qt=["onUpdate:modelValue"],Zt=["onUpdate:modelValue"],$t=["onUpdate:modelValue"],es=["onUpdate:modelValue"],ts=["onClick"],ss={key:16,class:"field-group section-header"},ls={class:"field-label"},os={key:17,class:"items-list"},is={class:"item-content"},as={class:"field-row"},ns=["onUpdate:modelValue"],rs=["onUpdate:modelValue"],ds={class:"field-row"},cs=["onUpdate:modelValue"],us=["onUpdate:modelValue"],ps={class:"field-row"},ms=["onUpdate:modelValue"],fs=["onUpdate:modelValue"],hs={key:0,class:"shinobi-additional-info"},gs={class:"field-row"},vs=["onUpdate:modelValue"],bs=["onUpdate:modelValue"],ys=["onUpdate:modelValue"],ks=["onUpdate:modelValue"],_s=["onUpdate:modelValue"],Cs=["onClick"],Ss=["onClick"],Us={key:18,class:"field-group section-header"},ws={class:"field-label"},Ds={key:19,class:"items-list"},xs={class:"item-content"},Is={class:"field-row"},Vs=["onUpdate:modelValue"],js={class:"checkbox-label"},Es=["onUpdate:modelValue"],zs=["onUpdate:modelValue"],Ts={class:"field-row"},Ns=["onUpdate:modelValue"],Os=["onUpdate:modelValue"],Fs={class:"field-row"},Rs=["onUpdate:modelValue"],Ls=["onUpdate:modelValue"],As=["onUpdate:modelValue"],Bs={class:"field-row"},Js=["onUpdate:modelValue"],Gs=["onUpdate:modelValue"],Ps=["onClick"],Ms={key:20,class:"field-group"},Xs={class:"field-label"},Ws={key:21,class:"json-viewer"},qs={key:22,class:"actions"},Hs={class:"action-group left"};function Ys(o,e,a,p,l,i){const n=D("EmojiToIcon");return d(),c("div",fe,[t("div",he,[t("h3",null,[u(n,{emoji:"ðŸ“",size:20}),e[29]||(e[29]=g(" ìŠ¤í… ì •ë³´ íŽ¸ì§‘ê¸° ",-1))])]),t("div",ge,[a.stepData?(d(),c("div",be,[t("div",ye,[e[31]||(e[31]=t("label",{class:"field-label"},"ìŠ¤í… ID (ì½ê¸° ì „ìš©)",-1)),t("input",{type:"text",value:a.stepData.id,disabled:"",class:"field-input disabled"},null,8,ke)]),l.localData?(d(),c("div",_e,[e[32]||(e[32]=t("label",{class:"field-label"},"ì”¬ ë²ˆí˜¸",-1)),m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.localData.sceneNumber=s),type:"number",class:"field-input",placeholder:"ì”¬ ë²ˆí˜¸"},null,512),[[f,l.localData.sceneNumber,void 0,{number:!0}]])])):h("",!0),l.localData?(d(),c("div",Ce,[e[33]||(e[33]=t("label",{class:"field-label"},"ìºë¦­í„° ì´ë¦„",-1)),m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.localData.character.name=s),type:"text",class:"field-input",placeholder:"ìºë¦­í„° ì´ë¦„"},null,512),[[f,l.localData.character.name]])])):h("",!0),l.localData?(d(),c("div",Se,[e[34]||(e[34]=t("label",{class:"field-label"},"ìºë¦­í„° ìƒ‰ìƒ",-1)),t("div",Ue,[m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.localData.character.color=s),type:"color",class:"color-picker"},null,512),[[f,l.localData.character.color]]),m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.localData.character.color=s),type:"text",class:"color-input",placeholder:"#ffffff"},null,512),[[f,l.localData.character.color]])])])):h("",!0),l.localData?(d(),c("div",we,[e[35]||(e[35]=t("label",{class:"field-label"},"ì•„ë°”íƒ€ URL",-1)),t("div",De,[m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.localData.character.avatarUrl=s),type:"text",class:"field-input",placeholder:l.localData.character.avatarUrl&&l.localData.character.avatarUrl.startsWith("data:image")?"[ë¡œì»¬ ì•„ë°”íƒ€ íŒŒì¼]":"https://example.com/avatar.png ë˜ëŠ” íŒŒì¼ ì„ íƒ",readonly:l.localData.character.avatarUrl&&l.localData.character.avatarUrl.startsWith("data:image")},null,8,xe),[[f,l.localData.character.avatarUrl]]),t("input",{type:"file",ref:"avatarFileInput",accept:"image/*",style:{display:"none"},onChange:e[5]||(e[5]=(...s)=>i.handleAvatarFileSelect&&i.handleAvatarFileSelect(...s))},null,544),t("button",{onClick:e[6]||(e[6]=s=>{var y;return(y=o.$refs.avatarFileInput)==null?void 0:y.click()}),class:"file-select-button",disabled:l.isLoadingFile},[u(n,{emoji:"ðŸ“",size:14}),g(" "+b(l.isLoadingFile?"ë¡œë”©...":"íŒŒì¼"),1)],8,Ie),l.localData.character.avatarUrl?(d(),c("button",{key:0,onClick:e[7]||(e[7]=(...s)=>i.clearAvatar&&i.clearAvatar(...s)),class:"clear-button",title:"ì´ˆê¸°í™”"},[u(n,{emoji:"âœ–ï¸",size:12})])):h("",!0)]),e[36]||(e[36]=t("p",{class:"hint-text"},"ì•„ë°”íƒ€ ì´ë¯¸ì§€ ê¶Œìž¥ í¬ê¸°: 2MB ì´í•˜",-1)),l.localData.character.avatarUrl?(d(),c("img",{key:0,src:l.localData.character.avatarUrl,class:"preview-img avatar-preview",onError:e[8]||(e[8]=(...s)=>i.handleImageError&&i.handleImageError(...s))},null,40,Ve)):h("",!0)])):h("",!0),l.localData?(d(),c("div",je,[e[37]||(e[37]=t("label",{class:"field-label"},"ëŒ€ì‚¬ í…ìŠ¤íŠ¸",-1)),m(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.localData.text=s),class:"field-textarea",rows:"4",placeholder:"ìºë¦­í„°ì˜ ëŒ€ì‚¬ë¥¼ ìž…ë ¥í•˜ì„¸ìš”"},null,512),[[f,l.localData.text]])])):h("",!0),a.stepData?(d(),c("div",Ee,[e[38]||(e[38]=t("label",{class:"field-label"},"ì›ë³¸ í…ìŠ¤íŠ¸ (ì½ê¸° ì „ìš©)",-1)),t("textarea",{value:a.stepData.rawText,disabled:"",class:"field-textarea disabled",rows:"3"},null,8,ze)])):h("",!0),l.localData?(d(),c("div",Te,[e[43]||(e[43]=t("label",{class:"field-label"},"ìŠ¤í… íƒ€ìž… (í•˜ë‚˜ë§Œ ì„ íƒ ê°€ëŠ¥)",-1)),t("div",Ne,[t("label",Oe,[m(t("input",{type:"radio",value:"dialogue","onUpdate:modelValue":e[10]||(e[10]=s=>l.localData.type=s)},null,512),[[j,l.localData.type]]),e[39]||(e[39]=t("span",null,"ì¼ë°˜ ëŒ€í™”",-1))]),t("label",Fe,[m(t("input",{type:"radio",value:"system","onUpdate:modelValue":e[11]||(e[11]=s=>l.localData.type=s)},null,512),[[j,l.localData.type]]),e[40]||(e[40]=t("span",null,"ì‹œìŠ¤í…œ ë©”ì‹œì§€",-1))]),t("label",Re,[m(t("input",{type:"radio",value:"narrator","onUpdate:modelValue":e[12]||(e[12]=s=>l.localData.type=s)},null,512),[[j,l.localData.type]]),e[41]||(e[41]=t("span",null,"ë‚˜ë ˆì´í„°",-1))]),t("label",Le,[m(t("input",{type:"radio",value:"scene-description","onUpdate:modelValue":e[13]||(e[13]=s=>l.localData.type=s)},null,512),[[j,l.localData.type]]),e[42]||(e[42]=t("span",null,"ì”¬ ì„¤ëª…",-1))])])])):h("",!0),l.localData&&l.localData.type==="scene-description"?(d(),c("div",Ae,[t("div",Be,[t("label",Je,[u(n,{emoji:"ðŸŽ¬",size:14}),e[44]||(e[44]=g(" ì”¬ ì •ë³´ ",-1))])]),t("div",Ge,[m(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>l.localData.sceneNumber=s),type:"text",class:"field-input small",placeholder:"ì”¬ ë²ˆí˜¸"},null,512),[[f,l.localData.sceneNumber]]),m(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>l.localData.sceneTitle=s),type:"text",class:"field-input",placeholder:"ì”¬ ì œëª©"},null,512),[[f,l.localData.sceneTitle]])]),m(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>l.localData.scenePCs=s),type:"text",class:"field-input",placeholder:"ì°¸ê°€ PC (ì˜ˆ: í™ê¸¸ë™, ê¹€ì² ìˆ˜)"},null,512),[[f,l.localData.scenePCs]]),m(t("textarea",{"onUpdate:modelValue":e[17]||(e[17]=s=>l.localData.sceneDescription=s),class:"field-textarea",rows:"3",placeholder:"ì”¬ ìƒì„¸ ì„¤ëª…"},null,512),[[f,l.localData.sceneDescription]])])):h("",!0),l.localData?(d(),c("div",Pe,[t("label",Me,[u(n,{emoji:"ðŸ–¼ï¸",size:14}),g(" ì¼ëŸ¬ìŠ¤íŠ¸ ("+b(l.localData.illustrations.length)+"ê°œ) ",1)]),t("button",{onClick:e[18]||(e[18]=(...s)=>i.addIllustration&&i.addIllustration(...s)),class:"add-button"},[u(n,{emoji:"âž•",size:12}),e[45]||(e[45]=g(" ì¶”ê°€ ",-1))])])):h("",!0),l.localData.illustrations.length>0?(d(),c("div",Xe,[(d(!0),c(C,null,U(l.localData.illustrations,(s,y)=>(d(),c("div",{key:y,class:"item-card"},[t("div",We,[t("div",qe,[m(t("input",{"onUpdate:modelValue":r=>s.url=r,type:"text",class:"field-input",placeholder:s.url&&s.url.startsWith("data:image")?"[ë¡œì»¬ ì´ë¯¸ì§€ íŒŒì¼]":"ì´ë¯¸ì§€ URL ë˜ëŠ” íŒŒì¼ ì„ íƒ",readonly:s.url&&s.url.startsWith("data:image")},null,8,He),[[f,s.url]]),t("input",{type:"file",ref_for:!0,ref:r=>{r&&(l.illustFileInputs[y]=r)},accept:"image/*",style:{display:"none"},onChange:r=>i.handleIllustFileSelect(r,y)},null,40,Ye),t("button",{onClick:()=>{var r;return(r=l.illustFileInputs[y])==null?void 0:r.click()},class:"file-select-button",disabled:l.isLoadingFile},[u(n,{emoji:"ðŸ“",size:14}),g(" "+b(l.isLoadingFile?"ë¡œë”©...":"íŒŒì¼"),1)],8,Ke),s.url?(d(),c("button",{key:0,onClick:()=>i.clearIllustration(y),class:"clear-button",title:"ì´ˆê¸°í™”"},[u(n,{emoji:"âœ–ï¸",size:12})],8,Qe)):h("",!0)]),e[46]||(e[46]=t("p",{class:"hint-text"},"ì´ë¯¸ì§€ íŒŒì¼ ê¶Œìž¥ í¬ê¸°: 2MB ì´í•˜",-1)),s.url?(d(),c("img",{key:0,src:s.url,class:"preview-img",onError:e[19]||(e[19]=(...r)=>i.handleImageError&&i.handleImageError(...r))},null,40,Ze)):h("",!0)]),t("button",{onClick:r=>i.removeIllustration(y),class:"remove-button"},[u(n,{emoji:"ðŸ—‘ï¸",size:14})],8,$e)]))),128))])):h("",!0),l.localData?(d(),c("div",et,[t("label",tt,[u(n,{emoji:"ðŸŽ²",size:14}),g(" ë‹¤ì´ìŠ¤ ë¡¤ ("+b(l.localData.diceRolls.length)+"ê°œ) ",1)]),t("button",{onClick:e[20]||(e[20]=(...s)=>i.addDiceRoll&&i.addDiceRoll(...s)),class:"add-button"},[u(n,{emoji:"âž•",size:12}),e[47]||(e[47]=g(" ì¶”ê°€ ",-1))])])):h("",!0),l.localData.diceRolls.length>0?(d(),c("div",st,[(d(!0),c(C,null,U(l.localData.diceRolls,(s,y)=>(d(),c("div",{key:y,class:"item-card dice-card"},[t("div",lt,[t("div",ot,[m(t("select",{"onUpdate:modelValue":r=>s.type=r,class:"field-input small"},[...e[48]||(e[48]=[t("option",{value:"normal"},"ì¼ë°˜",-1),t("option",{value:"dx3"},"DX3",-1),t("option",{value:"judgement"},"íŒì •",-1),t("option",{value:"choice"},"ì„ íƒ",-1)])],8,it),[[z,s.type]]),m(t("input",{"onUpdate:modelValue":r=>s.formula=r,type:"text",class:"field-input",placeholder:"ê³µì‹ (ì˜ˆ: 1D100, 8dx+16)"},null,8,at),[[f,s.formula]])]),s.type==="normal"?(d(),c("div",nt,[e[49]||(e[49]=t("span",{class:"field-label-inline"},"ê²°ê³¼:",-1)),m(t("input",{"onUpdate:modelValue":r=>s.result=r,type:"number",class:"field-input small",placeholder:"ê²°ê³¼"},null,8,rt),[[f,s.result,void 0,{number:!0}]])])):h("",!0),s.type==="dx3"?(d(),c("div",dt,[t("div",ct,[m(t("input",{"onUpdate:modelValue":r=>s.fullFormula=r,type:"text",class:"field-input",placeholder:"ì „ì²´ ê³µì‹ (ì˜ˆ: 8DX10+16)"},null,8,ut),[[f,s.fullFormula]])]),t("div",pt,[m(t("input",{"onUpdate:modelValue":r=>s.diceRolls=r,type:"text",class:"field-input",placeholder:"ë‹¤ì´ìŠ¤ ë¡¤ (ì˜ˆ: 10[5,6,7,8,9,10]+5[5]+16)"},null,8,mt),[[f,s.diceRolls]])]),t("div",ft,[e[50]||(e[50]=t("span",{class:"field-label-inline"},"ìµœì¢… ê²°ê³¼:",-1)),m(t("input",{"onUpdate:modelValue":r=>s.result=r,type:"number",class:"field-input small",placeholder:"ê²°ê³¼"},null,8,ht),[[f,s.result,void 0,{number:!0}]])])])):h("",!0),s.type==="judgement"?(d(),c("div",gt,[t("div",vt,[m(t("input",{"onUpdate:modelValue":r=>s.command=r,type:"text",class:"field-input small",placeholder:"ì»¤ë§¨ë“œ (cc<=70)"},null,8,bt),[[f,s.command]]),m(t("input",{"onUpdate:modelValue":r=>s.checkName=r,type:"text",class:"field-input",placeholder:"íŒì •ëª…"},null,8,yt),[[f,s.checkName]])]),t("div",kt,[m(t("input",{"onUpdate:modelValue":r=>s.result=r,type:"number",class:"field-input small",placeholder:"ê²°ê³¼"},null,8,_t),[[f,s.result,void 0,{number:!0}]]),m(t("input",{"onUpdate:modelValue":r=>s.judgement=r,type:"text",class:"field-input",placeholder:"íŒì • (ë³´í†µ ì„±ê³µ, ì‹¤íŒ¨ ë“±)"},null,8,Ct),[[f,s.judgement]])])])):h("",!0),s.type==="choice"?(d(),c("div",St,[t("div",Ut,[m(t("textarea",{"onUpdate:modelValue":r=>s.optionsText=r,class:"field-textarea small",rows:"2",placeholder:"ì„ íƒì§€ (ì‰¼í‘œë¡œ êµ¬ë¶„)"},null,8,wt),[[f,s.optionsText]])]),t("div",Dt,[e[51]||(e[51]=t("span",{class:"field-label-inline"},"ì„ íƒë¨:",-1)),m(t("input",{"onUpdate:modelValue":r=>s.result=r,type:"text",class:"field-input",placeholder:"ì„ íƒëœ ì˜µì…˜"},null,8,xt),[[f,s.result]])])])):h("",!0)]),t("button",{onClick:r=>i.removeDiceRoll(y),class:"remove-button"},[u(n,{emoji:"ðŸ—‘ï¸",size:14})],8,It)]))),128))])):h("",!0),l.localData?(d(),c("div",Vt,[t("label",jt,[u(n,{emoji:"ðŸ“Š",size:14}),g(" ìŠ¤í…Œì´í„°ìŠ¤ ë³€í™” ("+b(l.localData.statusChanges.length)+"ê°œ) ",1)]),t("button",{onClick:e[21]||(e[21]=(...s)=>i.addStatusChange&&i.addStatusChange(...s)),class:"add-button"},[u(n,{emoji:"âž•",size:12}),e[52]||(e[52]=g(" ì¶”ê°€ ",-1))])])):h("",!0),l.localData.statusChanges.length>0?(d(),c("div",Et,[(d(!0),c(C,null,U(l.localData.statusChanges,(s,y)=>(d(),c("div",{key:y,class:"item-card"},[t("div",zt,[t("div",Tt,[m(t("input",{"onUpdate:modelValue":r=>s.characterName=r,type:"text",class:"field-input",placeholder:"ìºë¦­í„°ëª…"},null,8,Nt),[[f,s.characterName]]),m(t("input",{"onUpdate:modelValue":r=>s.statusName=r,type:"text",class:"field-input",placeholder:"ìƒíƒœëª… (HP, ì¹¨ì‹ë¥  ë“±)"},null,8,Ot),[[f,s.statusName]])]),t("div",Ft,[t("label",Rt,[t("input",{type:"checkbox",checked:s.oldValue!==null&&s.newValue!==null,onChange:r=>i.toggleStatusMode(s,r)},null,40,Lt),e[53]||(e[53]=t("span",null,"ì´ì „ê°’/ìƒˆê°’ ëª¨ë“œ",-1))])]),s.oldValue!==null&&s.newValue!==null?(d(),c("div",At,[m(t("input",{"onUpdate:modelValue":r=>s.oldValue=r,type:"number",class:"field-input small",placeholder:"ì´ì „ê°’"},null,8,Bt),[[f,s.oldValue,void 0,{number:!0}]]),e[54]||(e[54]=t("span",{class:"arrow"},"â†’",-1)),m(t("input",{"onUpdate:modelValue":r=>s.newValue=r,type:"number",class:"field-input small",placeholder:"ìƒˆê°’"},null,8,Jt),[[f,s.newValue,void 0,{number:!0}]]),t("span",{class:S(["delta",{positive:i.computeDelta(s)>0,negative:i.computeDelta(s)<0}])},b(i.computeDelta(s)>0?"+":"")+b(i.computeDelta(s)),3)])):(d(),c("div",Gt,[e[55]||(e[55]=t("span",{class:"field-label-inline"},"ë³€í™”ëŸ‰:",-1)),m(t("input",{"onUpdate:modelValue":r=>s.delta=r,type:"number",class:"field-input small",placeholder:"Â±ë³€í™”ëŸ‰"},null,8,Pt),[[f,s.delta,void 0,{number:!0}]]),t("span",{class:S(["delta",{positive:s.delta>0,negative:s.delta<0}])},b(s.delta>0?"+":"")+b(s.delta),3)]))]),t("button",{onClick:r=>i.removeStatusChange(y),class:"remove-button"},[u(n,{emoji:"ðŸ—‘ï¸",size:14})],8,Mt)]))),128))])):h("",!0),l.localData?(d(),c("div",Xt,[t("label",Wt,[u(n,{emoji:"ðŸŒŸ",size:14}),g(" ì‹œë…¸ë¹„ê°€ë¯¸ ì˜¤ì˜ ("+b((l.localData.ougis||[]).length)+"ê°œ) ",1)]),t("button",{onClick:e[22]||(e[22]=(...s)=>i.addOugi&&i.addOugi(...s)),class:"add-button"},[u(n,{emoji:"âž•",size:12}),e[56]||(e[56]=g(" ì¶”ê°€ ",-1))])])):h("",!0),(l.localData.ougis||[]).length>0?(d(),c("div",qt,[(d(!0),c(C,null,U(l.localData.ougis,(s,y)=>(d(),c("div",{key:y,class:"item-card ougi-card"},[t("div",Ht,[m(t("input",{"onUpdate:modelValue":r=>s.ougiName=r,type:"text",class:"field-input",placeholder:"ì˜¤ì˜ëª… (ì˜ˆ: ì „ìŸì˜ ì§•ì¡°)"},null,8,Yt),[[f,s.ougiName]]),m(t("input",{"onUpdate:modelValue":r=>s.skills=r,type:"text",class:"field-input",placeholder:"ì§€ì • íŠ¹ê¸° (ì‰¼í‘œ êµ¬ë¶„, ì˜ˆ: ë„ê²€ìˆ , ì¸ë§¥)"},null,8,Kt),[[f,s.skills]]),m(t("textarea",{"onUpdate:modelValue":r=>s.presentation=r,class:"field-textarea small",rows:"2",placeholder:"ì—°ì¶œ (ì˜¤ì˜ ì‚¬ìš© ì‹œ ë¬˜ì‚¬)"},null,8,Qt),[[f,s.presentation]]),m(t("textarea",{"onUpdate:modelValue":r=>s.ougiEffect=r,class:"field-textarea small",rows:"2",placeholder:"ì˜¤ì˜ íš¨ê³¼ (ì „íˆ¬ì—ì„œì˜ íš¨ê³¼ ë“±, ì„ íƒì‚¬í•­)"},null,8,Zt),[[f,s.ougiEffect]]),m(t("input",{"onUpdate:modelValue":r=>s.ninpouInfo=r,type:"text",class:"field-input",placeholder:"ì¸ë²• ì •ë³´ (ì˜ˆ: ë§ºìŒ/í¬ë‚˜í° ë¶„ë…¸)"},null,8,$t),[[f,s.ninpouInfo]]),m(t("input",{"onUpdate:modelValue":r=>s.ougiType=r,type:"text",class:"field-input",placeholder:"ì˜¤ì˜ ì¢…ë¥˜ (ì˜ˆ: ì „ìŸì˜ ì‹ , ì ˆëŒ€ ë°©ì–´)"},null,8,es),[[f,s.ougiType]])]),t("button",{onClick:r=>i.removeOugi(y),class:"remove-button"},[u(n,{emoji:"ðŸ—‘ï¸",size:14})],8,ts)]))),128))])):h("",!0),l.localData?(d(),c("div",ss,[t("label",ls,[u(n,{emoji:"âš”ï¸",size:14}),g(" ì‹œë…¸ë¹„ê°€ë¯¸ ì¸ë²• ("+b((l.localData.shinobigamis||[]).length)+"ê°œ) ",1)]),t("button",{onClick:e[23]||(e[23]=(...s)=>i.addShinobigami&&i.addShinobigami(...s)),class:"add-button"},[u(n,{emoji:"âž•",size:12}),e[57]||(e[57]=g(" ì¶”ê°€ ",-1))])])):h("",!0),(l.localData.shinobigamis||[]).length>0?(d(),c("div",os,[(d(!0),c(C,null,U(l.localData.shinobigamis,(s,y)=>(d(),c("div",{key:y,class:"item-card shinobi-card"},[t("div",is,[t("div",as,[m(t("input",{"onUpdate:modelValue":r=>s.command=r,type:"text",class:"field-input small",placeholder:"ëª…ë ¹ì–´ (ì˜ˆ: SG@12#2>=5)"},null,8,ns),[[f,s.command]]),m(t("input",{"onUpdate:modelValue":r=>s.checkName=r,type:"text",class:"field-input",placeholder:"íŒì •ëª… (ì˜ˆ: ë„ê²€ìˆ , ê´´ë ¥)"},null,8,rs),[[f,s.checkName]])]),t("div",ds,[m(t("input",{"onUpdate:modelValue":r=>s.diceRolls=r,type:"text",class:"field-input small",placeholder:"ì£¼ì‚¬ìœ„ (ì˜ˆ: 1,2)"},null,8,cs),[[f,s.diceRolls]]),m(t("input",{"onUpdate:modelValue":r=>s.diceExpression=r,type:"text",class:"field-input",placeholder:"ë‹¤ì´ìŠ¤ í‘œí˜„ (ì˜ˆ: 3[1,2])"},null,8,us),[[f,s.diceExpression]])]),t("div",ps,[m(t("input",{"onUpdate:modelValue":r=>s.result=r,type:"number",class:"field-input small",placeholder:"ê²°ê³¼"},null,8,ms),[[f,s.result,void 0,{number:!0}]]),m(t("input",{"onUpdate:modelValue":r=>s.judgement=r,type:"text",class:"field-input small",placeholder:"íŒì • (æˆåŠŸ/å¤±æ•—)"},null,8,fs),[[f,s.judgement]])]),s.additionalInfo?(d(),c("div",hs,[t("div",gs,[m(t("input",{"onUpdate:modelValue":r=>s.additionalInfo.type=r,type:"text",class:"field-input small",placeholder:"íƒ€ìž…"},null,8,vs),[[f,s.additionalInfo.type]]),m(t("input",{"onUpdate:modelValue":r=>s.additionalInfo.range=r,type:"text",class:"field-input small",placeholder:"ì‚¬ê±°ë¦¬"},null,8,bs),[[f,s.additionalInfo.range]]),m(t("input",{"onUpdate:modelValue":r=>s.additionalInfo.cost=r,type:"text",class:"field-input small",placeholder:"ì½”ìŠ¤íŠ¸"},null,8,ys),[[f,s.additionalInfo.cost]])]),m(t("input",{"onUpdate:modelValue":r=>s.additionalInfo.skill=r,type:"text",class:"field-input",placeholder:"íŠ¹ê¸°"},null,8,ks),[[f,s.additionalInfo.skill]]),m(t("textarea",{"onUpdate:modelValue":r=>s.additionalInfo.description=r,class:"field-textarea small",rows:"2",placeholder:"ì„¤ëª…"},null,8,_s),[[f,s.additionalInfo.description]])])):(d(),c("button",{key:1,onClick:r=>i.addShinobiAdditionalInfo(s),class:"add-info-button"},[u(n,{emoji:"âž•",size:10}),e[58]||(e[58]=g(" ì¶”ê°€ ì •ë³´ ìž…ë ¥ ",-1))],8,Cs))]),t("button",{onClick:r=>i.removeShinobigami(y),class:"remove-button"},[u(n,{emoji:"ðŸ—‘ï¸",size:14})],8,Ss)]))),128))])):h("",!0),l.localData?(d(),c("div",Us,[t("label",ws,[u(n,{emoji:"âš”ï¸",size:14}),g(" DX ì½¤ë³´/ì´íŽ™íŠ¸ ("+b(l.localData.dxCombos.length)+"ê°œ) ",1)]),t("button",{onClick:e[24]||(e[24]=(...s)=>i.addDXCombo&&i.addDXCombo(...s)),class:"add-button"},[u(n,{emoji:"âž•",size:12}),e[59]||(e[59]=g(" ì¶”ê°€ ",-1))])])):h("",!0),l.localData.dxCombos.length>0?(d(),c("div",Ds,[(d(!0),c(C,null,U(l.localData.dxCombos,(s,y)=>(d(),c("div",{key:y,class:"item-card combo-card"},[t("div",xs,[t("div",Is,[m(t("select",{"onUpdate:modelValue":r=>s.type=r,class:"field-input small"},[...e[60]||(e[60]=[t("option",{value:"dx-combo"},"ì½¤ë³´",-1),t("option",{value:"dx-effect"},"ë‹¨ì¼ ì´íŽ™íŠ¸",-1)])],8,Vs),[[z,s.type]]),t("label",js,[m(t("input",{type:"checkbox","onUpdate:modelValue":r=>s.isSingleEffect=r},null,8,Es),[[T,s.isSingleEffect]]),e[61]||(e[61]=t("span",null,"ë‹¨ì¼ ì´íŽ™íŠ¸",-1))])]),m(t("input",{"onUpdate:modelValue":r=>s.comboName=r,type:"text",class:"field-input",placeholder:"ì½¤ë³´/ì´íŽ™íŠ¸ëª…"},null,8,zs),[[f,s.comboName]]),t("div",Ts,[m(t("input",{"onUpdate:modelValue":r=>s.timing=r,type:"text",class:"field-input",placeholder:"íƒ€ì´ë° (ë©”ì´ì €, ë§ˆì´ë„ˆ ë“±)"},null,8,Ns),[[f,s.timing]]),m(t("input",{"onUpdate:modelValue":r=>s.difficulty=r,type:"text",class:"field-input",placeholder:"ë‚œì´ë„ (ìžë™, ëŒ€í•­ ë“±)"},null,8,Os),[[f,s.difficulty]])]),t("div",Fs,[m(t("input",{"onUpdate:modelValue":r=>s.target=r,type:"text",class:"field-input",placeholder:"ëŒ€ìƒ"},null,8,Rs),[[f,s.target]]),m(t("input",{"onUpdate:modelValue":r=>s.range=r,type:"text",class:"field-input",placeholder:"ì‚¬ê±°ë¦¬"},null,8,Ls),[[f,s.range]])]),m(t("textarea",{"onUpdate:modelValue":r=>s.description=r,class:"field-textarea small",rows:"2",placeholder:"ì„¤ëª…/ê¸°ëŠ¥"},null,8,As),[[f,s.description]]),t("div",Bs,[m(t("input",{"onUpdate:modelValue":r=>s.erosion=r,type:"text",class:"field-input small",placeholder:"ì¹¨ì‹ì¹˜"},null,8,Js),[[f,s.erosion]]),m(t("input",{"onUpdate:modelValue":r=>s.erosionCost=r,type:"number",class:"field-input small",placeholder:"ì¹¨ì‹ ì½”ìŠ¤íŠ¸"},null,8,Gs),[[f,s.erosionCost,void 0,{number:!0}]])])]),t("button",{onClick:r=>i.removeDXCombo(y),class:"remove-button"},[u(n,{emoji:"ðŸ—‘ï¸",size:14})],8,Ps)]))),128))])):h("",!0),a.stepData?(d(),c("div",Ms,[t("label",Xs,[u(n,{emoji:"ðŸ”",size:14}),e[62]||(e[62]=g(" JSON ì›ë³¸ ë°ì´í„° ",-1))]),t("button",{onClick:e[25]||(e[25]=s=>l.showRawJSON=!l.showRawJSON),class:"toggle-json-button"},b(l.showRawJSON?"ìˆ¨ê¸°ê¸°":"ë³´ê¸°"),1)])):h("",!0),l.showRawJSON?(d(),c("div",Ws,[t("pre",null,b(JSON.stringify(a.stepData,null,2)),1)])):h("",!0),l.localData?(d(),c("div",qs,[t("div",Hs,[t("button",{onClick:e[26]||(e[26]=(...s)=>i.deleteStep&&i.deleteStep(...s)),class:"delete-button"},[u(n,{emoji:"ðŸ—‘ï¸",size:16}),e[63]||(e[63]=g(" ìŠ¤í… ì‚­ì œ ",-1))]),t("button",{onClick:e[27]||(e[27]=(...s)=>i.duplicateStep&&i.duplicateStep(...s)),class:"duplicate-button"},[u(n,{emoji:"ðŸ“‹",size:16}),e[64]||(e[64]=g(" ìŠ¤í… ë³µì‚¬ ",-1))])]),t("button",{onClick:e[28]||(e[28]=(...s)=>i.saveChanges&&i.saveChanges(...s)),class:"save-button"},[u(n,{emoji:"ðŸ’¾",size:16}),e[65]||(e[65]=g(" ë³€ê²½ì‚¬í•­ ì €ìž¥ ",-1))])])):h("",!0)])):(d(),c("div",ve,[u(n,{emoji:"ðŸ‘†",size:48}),e[30]||(e[30]=t("p",null,"ì™¼ìª½ì—ì„œ ìŠ¤í…ì„ ì„ íƒí•˜ì„¸ìš”",-1))]))])])}const Ks=I(me,[["render",Ys],["__scopeId","data-v-a8f9f26d"]]),Qs={name:"CharacterBulkEditor",props:{allSteps:{type:Array,required:!0}},data(){return{selectedCharacter:null,newCharacterName:"",newCharacterColor:"",isApplying:!1,progressCurrent:0,progressTotal:0}},computed:{characterGroups(){const o={};return this.allSteps.forEach(e=>{var l,i;const a=((l=e.character)==null?void 0:l.name)||"",p=((i=e.character)==null?void 0:i.color)||"#ffffff";o[a]||(o[a]={name:a,color:p,count:0}),o[a].count++}),Object.values(o).sort((e,a)=>a.count-e.count)},selectedGroup(){return this.selectedCharacter?this.characterGroups.find(o=>o.name===this.selectedCharacter):null},hasChanges(){if(!this.selectedCharacter)return!1;const o=this.newCharacterName&&this.newCharacterName!==this.selectedCharacter,e=this.newCharacterColor&&this.newCharacterColor!==this.selectedGroup.color;return o||e},progressPercentage(){return this.progressTotal===0?0:Math.round(this.progressCurrent/this.progressTotal*100)}},methods:{selectCharacter(o){this.selectedCharacter=o,this.newCharacterName=o,this.newCharacterColor=this.selectedGroup.color},resetForm(){this.selectedGroup&&(this.newCharacterName=this.selectedCharacter,this.newCharacterColor=this.selectedGroup.color)},async applyChanges(){if(!this.hasChanges||this.isApplying)return;const o=this.selectedCharacter,e=this.newCharacterName||o,a=this.newCharacterColor;this.isApplying=!0,this.progressCurrent=0,this.progressTotal=this.selectedGroup.count;try{this.$emit("bulk-update",{oldName:o,newName:e,newColor:a,onProgress:(p,l)=>{this.progressCurrent=p,this.progressTotal=l},onComplete:async p=>{await new Promise(l=>setTimeout(l,300)),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(l=>setTimeout(l,150)),alert(p.message),this.selectedCharacter=null,this.newCharacterName="",this.newCharacterColor=""}})}catch(p){console.error("ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",p),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(l=>setTimeout(l,150)),alert("ìºë¦­í„° ì¼ê´„ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}}},Zs={class:"character-bulk-editor"},$s={key:0,class:"loading-overlay"},el={class:"loading-content"},tl={class:"progress-section"},sl={class:"progress-bar"},ll={class:"progress-text"},ol={class:"editor-header"},il={class:"editor-body"},al={class:"info-message"},nl={class:"character-list"},rl={class:"list-header"},dl={class:"list-body"},cl=["onClick"],ul={class:"character-info"},pl={class:"character-name"},ml={class:"character-count"},fl={key:0,class:"edit-form"},hl={class:"form-header"},gl={class:"affected-count"},vl={class:"field-group"},bl=["placeholder"],yl={class:"field-group"},kl={class:"color-picker-wrapper"},_l=["placeholder"],Cl={class:"preview-section"},Sl={class:"preview-comparison"},Ul={class:"preview-item before"},wl={class:"preview-box"},Dl={class:"preview-arrow"},xl={class:"preview-item after"},Il={class:"preview-box"},Vl={class:"actions"},jl=["disabled"],El=["disabled"],zl={key:1,class:"no-selection"};function Tl(o,e,a,p,l,i){const n=D("EmojiToIcon");return d(),c("div",Zs,[l.isApplying?(d(),c("div",$s,[t("div",el,[e[5]||(e[5]=t("div",{class:"spinner"},null,-1)),e[6]||(e[6]=t("p",{class:"loading-text"},"ìºë¦­í„° ì •ë³´ë¥¼ ì¼ê´„ ë³€ê²½í•˜ëŠ” ì¤‘...",-1)),t("div",tl,[t("div",sl,[t("div",{class:"progress-fill",style:x({width:i.progressPercentage+"%"})},null,4)]),t("p",ll,b(l.progressCurrent)+" / "+b(l.progressTotal)+" ìŠ¤í… ("+b(i.progressPercentage)+"%)",1)]),e[7]||(e[7]=t("p",{class:"loading-subtext"},"ìž ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”",-1))])])):h("",!0),t("div",ol,[t("h3",null,[u(n,{emoji:"ðŸ‘¥",size:20}),e[8]||(e[8]=g(" ìºë¦­í„° ì¼ê´„ íŽ¸ì§‘ ",-1))])]),t("div",il,[t("div",al,[u(n,{emoji:"ðŸ’¡",size:18}),e[9]||(e[9]=t("p",null,"ê°™ì€ ì´ë¦„ì˜ ìºë¦­í„°ë¥¼ ëª¨ë‘ ì„ íƒí•˜ì—¬ ì´ë¦„ê³¼ ìƒ‰ìƒì„ ì¼ê´„ ë³€ê²½í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.",-1))]),t("div",nl,[t("div",rl,[t("h4",null,"ìºë¦­í„° ëª©ë¡ ("+b(i.characterGroups.length)+"ëª…)",1)]),t("div",dl,[(d(!0),c(C,null,U(i.characterGroups,s=>(d(),c("div",{key:s.name,class:S(["character-item",{selected:l.selectedCharacter===s.name}]),onClick:y=>i.selectCharacter(s.name)},[t("div",{class:"character-color-preview",style:x({backgroundColor:s.color})},null,4),t("div",ul,[t("div",pl,b(s.name||"(ì´ë¦„ ì—†ìŒ)"),1),t("div",ml,b(s.count)+"ê°œ ìŠ¤í…",1)])],10,cl))),128))])]),l.selectedCharacter?(d(),c("div",fl,[t("div",hl,[t("h4",null,[u(n,{emoji:"âœï¸",size:16}),g(' "'+b(l.selectedCharacter)+'" íŽ¸ì§‘ ',1)]),t("span",gl,b(i.selectedGroup.count)+"ê°œ ìŠ¤í…ì— ì ìš©ë©ë‹ˆë‹¤",1)]),t("div",vl,[e[10]||(e[10]=t("label",{class:"field-label"},"ìƒˆ ìºë¦­í„° ì´ë¦„",-1)),m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.newCharacterName=s),type:"text",class:"field-input",placeholder:l.selectedCharacter},null,8,bl),[[f,l.newCharacterName]])]),t("div",yl,[e[11]||(e[11]=t("label",{class:"field-label"},"ìƒˆ ìºë¦­í„° ìƒ‰ìƒ",-1)),t("div",kl,[m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.newCharacterColor=s),type:"color",class:"color-picker"},null,512),[[f,l.newCharacterColor]]),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.newCharacterColor=s),type:"text",class:"color-input",placeholder:i.selectedGroup.color},null,8,_l),[[f,l.newCharacterColor]])])]),t("div",Cl,[e[14]||(e[14]=t("h5",null,"ë³€ê²½ ì „/í›„ ë¯¸ë¦¬ë³´ê¸°",-1)),t("div",Sl,[t("div",Ul,[e[12]||(e[12]=t("span",{class:"preview-label"},"ë³€ê²½ ì „",-1)),t("div",wl,[t("div",{class:"preview-avatar",style:x({backgroundColor:i.selectedGroup.color})},b(l.selectedCharacter.charAt(0)),5),t("span",{class:"preview-name",style:x({color:i.selectedGroup.color})},b(l.selectedCharacter),5)])]),t("div",Dl,[u(n,{emoji:"âž¡ï¸",size:24})]),t("div",xl,[e[13]||(e[13]=t("span",{class:"preview-label"},"ë³€ê²½ í›„",-1)),t("div",Il,[t("div",{class:"preview-avatar",style:x({backgroundColor:l.newCharacterColor})},b((l.newCharacterName||l.selectedCharacter).charAt(0)),5),t("span",{class:"preview-name",style:x({color:l.newCharacterColor})},b(l.newCharacterName||l.selectedCharacter),5)])])])]),t("div",Vl,[t("button",{onClick:e[3]||(e[3]=(...s)=>i.resetForm&&i.resetForm(...s)),class:"reset-button",disabled:l.isApplying},[u(n,{emoji:"ðŸ”„",size:16}),e[15]||(e[15]=g(" ì´ˆê¸°í™” ",-1))],8,jl),t("button",{onClick:e[4]||(e[4]=(...s)=>i.applyChanges&&i.applyChanges(...s)),class:"apply-button",disabled:!i.hasChanges||l.isApplying},[l.isApplying?(d(),c(C,{key:0},[e[16]||(e[16]=t("div",{class:"button-spinner"},null,-1)),e[17]||(e[17]=g(" ì²˜ë¦¬ ì¤‘... ",-1))],64)):(d(),c(C,{key:1},[u(n,{emoji:"âœ…",size:16}),e[18]||(e[18]=g(" ì¼ê´„ ì ìš© ",-1))],64))],8,El)])])):(d(),c("div",zl,[u(n,{emoji:"ðŸ‘†",size:48}),e[19]||(e[19]=t("p",null,"ì™¼ìª½ì—ì„œ ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”",-1))]))])])}const Nl=I(Qs,[["render",Tl],["__scopeId","data-v-73d9619b"]]),Ol={name:"ImageBulkEditor",props:{vnData:{type:Object,required:!0}},data(){return{selectedImageUrl:null,newImageUrl:"",isApplying:!1,progressCurrent:0,progressTotal:0,activeFilter:"all",imageTypes:[{value:"all",label:"ì „ì²´",emoji:"ðŸŒ"},{value:"avatar",label:"ì•„ë°”íƒ€",emoji:"ðŸ‘¤"},{value:"background",label:"ë°°ê²½",emoji:"ðŸŽ¨"},{value:"handout",label:"í•¸ë“œì•„ì›ƒ",emoji:"ðŸ“„"},{value:"illustration",label:"ì¼ëŸ¬ìŠ¤íŠ¸",emoji:"ðŸ–¼ï¸"}],isLoadingFile:!1}},computed:{imageGroups(){const o={};return this.vnData.scenes&&this.vnData.scenes.forEach((e,a)=>{var p;(p=e.steps)==null||p.forEach((l,i)=>{var y,r;const n=(y=l.character)==null?void 0:y.avatarUrl;if(n){o[n]||(o[n]={url:n,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[n].count++,o[n].types.add("avatar");const _=l.character.name;o[n].locations.avatar.includes(_)||o[n].locations.avatar.push(_)}const s=(r=l.effects)==null?void 0:r.background;s&&(o[s]||(o[s]={url:s,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[s].count++,o[s].types.add("background"),o[s].locations.background.push(`ì”¬${a+1} ìŠ¤í…${i+1}`)),l.illustrations&&Array.isArray(l.illustrations)&&l.illustrations.forEach((_,v)=>{const k=_.url;k&&(o[k]||(o[k]={url:k,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[k].count++,o[k].types.add("illustration"),o[k].locations.illustration.push(`ì”¬${a+1} ìŠ¤í…${i+1}-${v+1}`))})})}),this.vnData.handouts&&this.vnData.handouts.forEach(e=>{const a=e.imageUrl;a&&(o[a]||(o[a]={url:a,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[a].count++,o[a].types.add("handout"),o[a].locations.handout.push(e.title||e.id))}),Object.values(o).map(e=>({...e,types:Array.from(e.types)})).sort((e,a)=>a.count-e.count)},filteredImageGroups(){return this.activeFilter==="all"?this.imageGroups:this.imageGroups.filter(o=>o.types.includes(this.activeFilter))},selectedGroup(){return this.selectedImageUrl?this.imageGroups.find(o=>o.url===this.selectedImageUrl):null},hasChanges(){return this.selectedImageUrl?this.newImageUrl&&this.newImageUrl!==this.selectedImageUrl:!1},progressPercentage(){return this.progressTotal===0?0:Math.round(this.progressCurrent/this.progressTotal*100)}},methods:{selectImage(o){this.selectedImageUrl=o,this.newImageUrl=o},resetForm(){this.selectedGroup&&(this.newImageUrl=this.selectedImageUrl)},async handleImageFileSelect(o){const e=o.target.files[0];if(e){if(e.size>2*1024*1024){alert("ì´ë¯¸ì§€ íŒŒì¼ í¬ê¸°ëŠ” 2MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤."),o.target.value="";return}this.isLoadingFile=!0;try{const a=await this.fileToBase64(e);this.newImageUrl=a,console.log("[ImageBulkEditor] ì´ë¯¸ì§€ íŒŒì¼ ë¡œë“œ ì™„ë£Œ:",{fileName:e.name,fileSize:e.size,base64Length:a.length})}catch(a){console.error("[ImageBulkEditor] íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:",a),alert("íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{this.isLoadingFile=!1,o.target.value=""}}},fileToBase64(o){return new Promise((e,a)=>{const p=new FileReader;p.onload=()=>e(p.result),p.onerror=a,p.readAsDataURL(o)})},clearNewImage(){this.newImageUrl=this.selectedImageUrl},truncateUrl(o,e=50){return o?o.length<=e?o:o.substring(0,e-3)+"...":""},handleImageError(o){o.target.style.display="none",o.target.parentElement.classList.add("error")},async applyChanges(){if(!this.hasChanges||this.isApplying)return;const o=this.selectedImageUrl,e=this.newImageUrl;this.isApplying=!0,this.progressCurrent=0,this.progressTotal=this.selectedGroup.count;try{this.$emit("bulk-update",{oldUrl:o,newUrl:e,onProgress:(a,p)=>{this.progressCurrent=a,this.progressTotal=p},onComplete:async a=>{await new Promise(p=>setTimeout(p,300)),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(p=>setTimeout(p,150)),alert(a.message),this.selectedImageUrl=null,this.newImageUrl=""}})}catch(a){console.error("ì¼ê´„ ë³€ê²½ ì‹¤íŒ¨:",a),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(p=>setTimeout(p,150)),alert("ì´ë¯¸ì§€ URL ì¼ê´„ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}}},Fl={class:"image-bulk-editor"},Rl={key:0,class:"loading-overlay"},Ll={class:"loading-content"},Al={class:"progress-section"},Bl={class:"progress-bar"},Jl={class:"progress-text"},Gl={class:"editor-header"},Pl={class:"editor-body"},Ml={class:"info-message"},Xl={class:"image-list"},Wl={class:"list-header"},ql={class:"filter-buttons"},Hl=["onClick"],Yl={class:"list-body"},Kl=["onClick"],Ql={class:"image-preview"},Zl=["src","alt"],$l={class:"image-info"},eo=["title"],to={class:"image-meta"},so={class:"usage-count"},lo={class:"usage-types"},oo={key:0,class:"edit-form"},io={class:"form-header"},ao={class:"affected-count"},no={class:"field-group"},ro={class:"current-url"},co={class:"field-group"},uo={class:"file-input-group"},po=["disabled"],mo=["disabled"],fo={class:"hint-text"},ho={class:"preview-section"},go={class:"preview-comparison"},vo={class:"preview-item before"},bo={class:"preview-box"},yo=["src"],ko={class:"preview-arrow"},_o={class:"preview-item after"},Co={class:"preview-box"},So=["src"],Uo={key:1,class:"preview-placeholder"},wo={class:"usage-details"},Do={class:"usage-list"},xo={key:0,class:"usage-type"},Io={key:1,class:"usage-type"},Vo={key:2,class:"usage-type"},jo={key:3,class:"usage-type"},Eo={class:"actions"},zo=["disabled"],To=["disabled"],No={key:1,class:"no-selection"};function Oo(o,e,a,p,l,i){const n=D("EmojiToIcon");return d(),c("div",Fl,[l.isApplying?(d(),c("div",Rl,[t("div",Ll,[e[9]||(e[9]=t("div",{class:"spinner"},null,-1)),e[10]||(e[10]=t("p",{class:"loading-text"},"ì´ë¯¸ì§€ URLì„ ì¼ê´„ ë³€ê²½í•˜ëŠ” ì¤‘...",-1)),t("div",Al,[t("div",Bl,[t("div",{class:"progress-fill",style:x({width:i.progressPercentage+"%"})},null,4)]),t("p",Jl,b(l.progressCurrent)+" / "+b(l.progressTotal)+" í•­ëª© ("+b(i.progressPercentage)+"%)",1)]),e[11]||(e[11]=t("p",{class:"loading-subtext"},"ìž ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”",-1))])])):h("",!0),t("div",Gl,[t("h3",null,[u(n,{emoji:"ðŸ–¼ï¸",size:20}),e[12]||(e[12]=g(" ì´ë¯¸ì§€ URL ì¼ê´„ íŽ¸ì§‘ ",-1))])]),t("div",Pl,[t("div",Ml,[u(n,{emoji:"ðŸ’¡",size:18}),e[13]||(e[13]=t("p",null,"ë™ì¼í•œ ì´ë¯¸ì§€ URLì„ ëª¨ë‘ ì„ íƒí•˜ì—¬ í•œ ë²ˆì— ë³€ê²½í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. (ì•„ë°”íƒ€, ë°°ê²½, í•¸ë“œì•„ì›ƒ ë“±)",-1))]),t("div",Xl,[t("div",Wl,[t("h4",null,"ì´ë¯¸ì§€ URL ëª©ë¡ ("+b(i.imageGroups.length)+"ê°œ)",1),t("div",ql,[(d(!0),c(C,null,U(l.imageTypes,s=>(d(),c("button",{key:s.value,class:S(["filter-button",{active:l.activeFilter===s.value}]),onClick:y=>l.activeFilter=s.value},[u(n,{emoji:s.emoji,size:14},null,8,["emoji"]),g(" "+b(s.label),1)],10,Hl))),128))])]),t("div",Yl,[(d(!0),c(C,null,U(i.filteredImageGroups,s=>(d(),c("div",{key:s.url,class:S(["image-item",{selected:l.selectedImageUrl===s.url}]),onClick:y=>i.selectImage(s.url)},[t("div",Ql,[t("img",{src:s.url,alt:s.url,onError:e[0]||(e[0]=(...y)=>i.handleImageError&&i.handleImageError(...y))},null,40,Zl)]),t("div",$l,[t("div",{class:"image-url",title:s.url},b(i.truncateUrl(s.url)),9,eo),t("div",to,[t("span",so,b(s.count)+"íšŒ ì‚¬ìš©",1),t("span",lo,[s.types.includes("avatar")?(d(),E(n,{key:0,emoji:"ðŸ‘¤",size:12,title:"ì•„ë°”íƒ€"})):h("",!0),s.types.includes("background")?(d(),E(n,{key:1,emoji:"ðŸŽ¨",size:12,title:"ë°°ê²½"})):h("",!0),s.types.includes("handout")?(d(),E(n,{key:2,emoji:"ðŸ“„",size:12,title:"í•¸ë“œì•„ì›ƒ"})):h("",!0),s.types.includes("illustration")?(d(),E(n,{key:3,emoji:"ðŸ–¼ï¸",size:12,title:"ì¼ëŸ¬ìŠ¤íŠ¸"})):h("",!0)])])])],10,Kl))),128))])]),l.selectedImageUrl?(d(),c("div",oo,[t("div",io,[t("h4",null,[u(n,{emoji:"âœï¸",size:16}),e[14]||(e[14]=g(" URL ë³€ê²½ ",-1))]),t("span",ao,b(i.selectedGroup.count)+"ê°œ í•­ëª©ì— ì ìš©ë©ë‹ˆë‹¤",1)]),t("div",no,[e[15]||(e[15]=t("label",{class:"field-label"},"í˜„ìž¬ ì´ë¯¸ì§€ URL",-1)),t("div",ro,b(l.selectedImageUrl),1)]),t("div",co,[e[18]||(e[18]=t("label",{class:"field-label"},"ìƒˆ ì´ë¯¸ì§€ URL",-1)),t("div",uo,[m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.newImageUrl=s),type:"text",class:"field-input",placeholder:"ìƒˆ ì´ë¯¸ì§€ URL ìž…ë ¥ ë˜ëŠ” íŒŒì¼ ì„ íƒ"},null,512),[[f,l.newImageUrl]]),t("input",{ref:"imageFileInput",type:"file",accept:"image/*",onChange:e[2]||(e[2]=(...s)=>i.handleImageFileSelect&&i.handleImageFileSelect(...s)),style:{display:"none"}},null,544),t("button",{onClick:e[3]||(e[3]=s=>o.$refs.imageFileInput.click()),class:"file-select-button",disabled:l.isApplying},[u(n,{emoji:"ðŸ“",size:14}),e[16]||(e[16]=g(" íŒŒì¼ ",-1))],8,po),l.newImageUrl?(d(),c("button",{key:0,onClick:e[4]||(e[4]=(...s)=>i.clearNewImage&&i.clearNewImage(...s)),class:"clear-button",disabled:l.isApplying},[u(n,{emoji:"âœ–ï¸",size:14})],8,mo)):h("",!0)]),t("p",fo,[u(n,{emoji:"ðŸ’¡",size:12}),e[17]||(e[17]=g(" ë¡œì»¬ íŒŒì¼ì€ base64ë¡œ ì¸ì½”ë”© (2MB ì´í•˜) ",-1))])]),t("div",ho,[e[22]||(e[22]=t("h5",null,"ë³€ê²½ ì „/í›„ ë¯¸ë¦¬ë³´ê¸°",-1)),t("div",go,[t("div",vo,[e[19]||(e[19]=t("span",{class:"preview-label"},"ë³€ê²½ ì „",-1)),t("div",bo,[t("img",{src:l.selectedImageUrl,alt:"ë³€ê²½ ì „",onError:e[5]||(e[5]=(...s)=>i.handleImageError&&i.handleImageError(...s))},null,40,yo)])]),t("div",ko,[u(n,{emoji:"âž¡ï¸",size:24})]),t("div",_o,[e[21]||(e[21]=t("span",{class:"preview-label"},"ë³€ê²½ í›„",-1)),t("div",Co,[l.newImageUrl?(d(),c("img",{key:0,src:l.newImageUrl,alt:"ë³€ê²½ í›„",onError:e[6]||(e[6]=(...s)=>i.handleImageError&&i.handleImageError(...s))},null,40,So)):(d(),c("div",Uo,[u(n,{emoji:"ðŸ–¼ï¸",size:32}),e[20]||(e[20]=t("span",null,"URLì„ ìž…ë ¥í•˜ì„¸ìš”",-1))]))])])])]),t("div",wo,[e[23]||(e[23]=t("h5",null,"ì‚¬ìš© ìœ„ì¹˜ ìƒì„¸",-1)),t("div",Do,[i.selectedGroup.types.includes("avatar")?(d(),c("div",xo,[u(n,{emoji:"ðŸ‘¤",size:16}),t("span",null,"ì•„ë°”íƒ€ ("+b(i.selectedGroup.locations.avatar.length)+"ê°œ ìºë¦­í„°)",1)])):h("",!0),i.selectedGroup.types.includes("background")?(d(),c("div",Io,[u(n,{emoji:"ðŸŽ¨",size:16}),t("span",null,"ë°°ê²½ ("+b(i.selectedGroup.locations.background.length)+"ê°œ ìŠ¤í…)",1)])):h("",!0),i.selectedGroup.types.includes("handout")?(d(),c("div",Vo,[u(n,{emoji:"ðŸ“„",size:16}),t("span",null,"í•¸ë“œì•„ì›ƒ ("+b(i.selectedGroup.locations.handout.length)+"ê°œ)",1)])):h("",!0),i.selectedGroup.types.includes("illustration")?(d(),c("div",jo,[u(n,{emoji:"ðŸ–¼ï¸",size:16}),t("span",null,"ì¼ëŸ¬ìŠ¤íŠ¸ ("+b(i.selectedGroup.locations.illustration.length)+"ê°œ)",1)])):h("",!0)])]),t("div",Eo,[t("button",{onClick:e[7]||(e[7]=(...s)=>i.resetForm&&i.resetForm(...s)),class:"reset-button",disabled:l.isApplying},[u(n,{emoji:"ðŸ”„",size:16}),e[24]||(e[24]=g(" ì´ˆê¸°í™” ",-1))],8,zo),t("button",{onClick:e[8]||(e[8]=(...s)=>i.applyChanges&&i.applyChanges(...s)),class:"apply-button",disabled:!i.hasChanges||l.isApplying},[l.isApplying?(d(),c(C,{key:0},[e[25]||(e[25]=t("div",{class:"button-spinner"},null,-1)),e[26]||(e[26]=g(" ì²˜ë¦¬ ì¤‘... ",-1))],64)):(d(),c(C,{key:1},[u(n,{emoji:"âœ…",size:16}),e[27]||(e[27]=g(" ì¼ê´„ ì ìš© ",-1))],64))],8,To)])])):(d(),c("div",No,[u(n,{emoji:"ðŸ‘†",size:48}),e[28]||(e[28]=t("p",null,"ì™¼ìª½ì—ì„œ ì´ë¯¸ì§€ URLì„ ì„ íƒí•˜ì„¸ìš”",-1))]))])])}const Fo=I(Ol,[["render",Oo],["__scopeId","data-v-68483758"]]),Ro={name:"EditorView",components:{StepEffectsEditor:pe,StepInfoEditor:Ks,CharacterBulkEditor:Nl,ImageBulkEditor:Fo},setup(){return{logStore:N()}},data(){return{activeTab:"info",selectedStepIndex:null,showEmbedModal:!1,embedJsonUrl:"https://ohohod.github.io/embeded-test.json",embedAutoplay:!1,embedCopied:!1,embedPreviewLoaded:!1}},computed:{allSteps(){var a;const o=[];return(((a=this.logStore.vnData)==null?void 0:a.scenes)||[]).forEach(p=>{o.push(...p.steps||[])}),o},totalSteps(){return this.allSteps.length},selectedStep(){return this.selectedStepIndex===null?null:this.allSteps[this.selectedStepIndex]||null},selectedStepEffects(){var o;return((o=this.selectedStep)==null?void 0:o.effects)||null},generatedEmbedCode(){if(!this.embedJsonUrl)return"<!-- JSON URLì„ ìž…ë ¥í•˜ì„¸ìš” -->";const o=window.location.origin,e="/vnlog/",a=this.embedAutoplay?"&autoplay=true":"";return`<iframe src="${`${o}${e}embed?json=${encodeURIComponent(this.embedJsonUrl)}${a}`}" width="800" height="600" frameborder="0" allowfullscreen></iframe>`},embedPreviewUrl(){if(!this.embedJsonUrl)return"";const o=window.location.origin,e="/vnlog/",a=this.embedAutoplay?"&autoplay=true":"";return`${o}${e}embed?json=${encodeURIComponent(this.embedJsonUrl)}${a}`}},methods:{selectStep(o){this.selectedStepIndex=o},goBack(){this.$router.push("/player")},saveAndPlay(){this.saveToLocalStorage(),this.selectedStepIndex!==null&&sessionStorage.setItem("player-target-step",this.selectedStepIndex+1),this.$router.push("/player")},showEmbedCodeModal(){this.showEmbedModal=!0,this.embedCopied=!1,this.embedPreviewLoaded=!1},closeEmbedModal(){this.showEmbedModal=!1},async copyEmbedCode(){if(!this.embedJsonUrl){alert("JSON URLì„ ë¨¼ì € ìž…ë ¥í•˜ì„¸ìš”.");return}try{await navigator.clipboard.writeText(this.generatedEmbedCode),this.embedCopied=!0,setTimeout(()=>{this.embedCopied=!1},2e3)}catch(o){console.error("í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:",o),alert("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},exportJSON(){const o=this.logStore.vnData;if(!o){alert("ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");return}const e=localStorage.getItem("vnlog-theme-settings");let a=null;if(e)try{a=JSON.parse(e)}catch(y){console.warn("í…Œë§ˆ ì„¤ì • íŒŒì‹± ì‹¤íŒ¨:",y)}const p={vnData:o,theme:a,exportedAt:new Date().toISOString(),version:"1.0.0"},l=JSON.stringify(p,null,2),i=new Blob([l],{type:"application/json"}),n=URL.createObjectURL(i),s=document.createElement("a");s.href=n,s.download=`${o.title||"vnlog"}_edited.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)},saveToLocalStorage(){try{const o=this.logStore.vnData;localStorage.setItem("vnlog-edited-data",JSON.stringify(o))}catch(o){console.error("ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ìž¥ ì‹¤íŒ¨:",o)}},handleSaveStepInfo({id:o,updates:e}){const a=this.allSteps.find(p=>p.id===o);if(!a){alert("ìŠ¤í…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}a.sceneNumber=e.sceneNumber,a.type=e.type,a.character.name=e.character.name,a.character.color=e.character.color,a.character.avatarUrl=e.character.avatarUrl,a.text=e.text,a.isSceneDescription=e.isSceneDescription,a.sceneTitle=e.sceneTitle,a.scenePCs=e.scenePCs,a.sceneDescription=e.sceneDescription,a.illustrations=JSON.parse(JSON.stringify(e.illustrations||[])),a.diceRolls=JSON.parse(JSON.stringify(e.diceRolls||[])),a.statusChanges=JSON.parse(JSON.stringify(e.statusChanges||[])),a.dxCombos=JSON.parse(JSON.stringify(e.dxCombos||[])),a.effects=JSON.parse(JSON.stringify(e.effects||{})),a.hasDice=e.hasDice,a.hasStatusChange=e.hasStatusChange,a.hasDXCombo=e.hasDXCombo,a.hasIllustration=e.hasIllustration,this.saveToLocalStorage(),alert("ìŠ¤í… ì •ë³´ê°€ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤.")},handleDeleteStep(o){const e=this.logStore.vnData.scenes;let a=!1;for(let l=0;l<e.length;l++){const i=e[l],n=i.steps.findIndex(s=>s.id===o);if(n!==-1){i.steps.splice(n,1),a=!0;break}}if(!a){alert("ìŠ¤í…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const p=this.allSteps.length;this.selectedStepIndex>=p&&(this.selectedStepIndex=p>0?p-1:null),this.saveToLocalStorage(),alert("ìŠ¤í…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")},handleDuplicateStep(o){const e=this.logStore.vnData.scenes;let a=!1,p=0;const i=(Math.max(...this.allSteps.map(n=>parseInt(n.id)||0))+1).toString();for(let n=0;n<e.length;n++){const s=e[n],y=s.steps.findIndex(r=>r.id===o);if(y!==-1){const r=s.steps[y],_=JSON.parse(JSON.stringify(r));_.id=i,s.steps.splice(y+1,0,_);for(let v=0;v<n;v++)p+=e[v].steps.length;p+=y+1,a=!0;break}p+=s.steps.length}if(!a){alert("ìŠ¤í…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}this.selectedStepIndex=p,this.saveToLocalStorage(),alert(`ìŠ¤í…ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. (ìƒˆ ID: ${i})`)},handleApplyEffects({startStep:o,endStep:e,effects:a}){const p=this.allSteps;for(let l=o-1;l<e&&l<p.length;l++){const i=p[l];i.effects&&(i.effects.sfx=a.sfx,i.effects.bgm=a.bgm,i.effects.background=a.background,i.effects.backgroundOpacity=a.backgroundOpacity)}this.saveToLocalStorage(),alert(`ìŠ¤í… ${o}~${e}ì— íš¨ê³¼ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`)},handleRemoveEffects({startStep:o,endStep:e}){const a=this.allSteps;for(let p=o-1;p<e&&p<a.length;p++){const l=a[p];l.effects&&(l.effects.sfx=null,l.effects.bgm=null,l.effects.background=null)}this.saveToLocalStorage(),alert(`ìŠ¤í… ${o}~${e}ì˜ íš¨ê³¼ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.`)},async handleBulkUpdateCharacter({oldName:o,newName:e,newColor:a,onProgress:p,onComplete:l}){let i=0,n=0;this.allSteps.forEach(s=>{s.character&&s.character.name===o&&n++});for(let s=0;s<this.allSteps.length;s++){const y=this.allSteps[s];y.character&&y.character.name===o&&(y.character.name=e,y.character.color=a,i++,p&&p(i,n),i%10===0&&await new Promise(r=>setTimeout(r,10)))}this.saveToLocalStorage(),l&&await l({success:!0,updatedCount:i,message:`"${o}" â†’ "${e}"
${i}ê°œ ìŠ¤í…ì˜ ìºë¦­í„° ì •ë³´ê°€ ì¼ê´„ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`})},async handleBulkUpdateImage({oldUrl:o,newUrl:e,onProgress:a,onComplete:p}){var s,y;let l=0,i=0;const n=this.logStore.vnData;if(n.scenes&&n.scenes.forEach(r=>{var _;(_=r.steps)==null||_.forEach(v=>{var k,w;((k=v.character)==null?void 0:k.avatarUrl)===o&&i++,((w=v.effects)==null?void 0:w.background)===o&&i++,v.illustrations&&Array.isArray(v.illustrations)&&v.illustrations.forEach(V=>{V.url===o&&i++})})}),n.handouts&&n.handouts.forEach(r=>{r.imageUrl===o&&i++}),n.scenes)for(let r=0;r<n.scenes.length;r++){const _=n.scenes[r];if(_.steps)for(let v=0;v<_.steps.length;v++){const k=_.steps[v];if(((s=k.character)==null?void 0:s.avatarUrl)===o&&(k.character.avatarUrl=e,l++,a&&a(l,i)),((y=k.effects)==null?void 0:y.background)===o&&(k.effects.background=e,l++,a&&a(l,i)),k.illustrations&&Array.isArray(k.illustrations))for(let w=0;w<k.illustrations.length;w++){const V=k.illustrations[w];V.url===o&&(V.url=e,l++,a&&a(l,i))}l%10===0&&await new Promise(w=>setTimeout(w,10))}}if(n.characters)for(const r in n.characters){const _=n.characters[r];_.avatarUrl===o&&(_.avatarUrl=e)}if(n.handouts)for(let r=0;r<n.handouts.length;r++){const _=n.handouts[r];_.imageUrl===o&&(_.imageUrl=e,l++,a&&a(l,i),l%10===0&&await new Promise(v=>setTimeout(v,10)))}this.saveToLocalStorage(),p&&await p({success:!0,updatedCount:l,message:`ì´ë¯¸ì§€ URLì´ ì¼ê´„ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
ì´ ${l}ê°œ í•­ëª©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.`})},hasEffects(o){return o.effects&&(o.effects.sfx||o.effects.bgm||o.effects.background)},truncateText(o,e){return o?o.length>e?o.substring(0,e)+"...":o:""},scrollToTargetStep(){const o=sessionStorage.getItem("editor-target-step");if(o){const e=parseInt(o,10);if(e>=1&&e<=this.totalSteps){const a=e-1;this.$nextTick(()=>{this.selectStep(a);const p=document.querySelectorAll(".step-item");p[a]&&p[a].scrollIntoView({behavior:"smooth",block:"center"})})}sessionStorage.removeItem("editor-target-step")}}},mounted(){if(!this.logStore.vnData){this.$router.push("/");return}this.scrollToTargetStep()}},Lo={class:"editor-view"},Ao={class:"editor-container"},Bo={class:"editor-header"},Jo={class:"header-actions"},Go={class:"modal-header"},Po={class:"modal-body"},Mo={class:"embed-step"},Xo={class:"embed-step"},Wo={class:"embed-step"},qo={class:"embed-options"},Ho={class:"option-item"},Yo={class:"embed-step"},Ko={class:"code-preview"},Qo={key:0,class:"embed-preview-section"},Zo={class:"embed-preview-frame"},$o={key:0,class:"preview-loading"},ei=["src"],ti={class:"help-text-small"},si={key:0,class:"help-text-small"},li={class:"editor-content"},oi={class:"steps-list"},ii={class:"list-header"},ai={class:"list-body"},ni=["onClick"],ri={class:"step-number"},di={class:"step-info"},ci={class:"step-character"},ui={class:"step-text"},pi={key:0,class:"step-effects-tags"},mi={key:0,class:"effect-tag sfx"},fi={key:1,class:"effect-tag bgm"},hi={key:2,class:"effect-tag bg"},gi={class:"editor-panel"},vi={class:"tab-header"},bi={class:"tab-content"},yi={key:0,class:"tab-pane"},ki={key:1,class:"tab-pane"},_i={key:2,class:"tab-pane"},Ci={key:3,class:"tab-pane"};function Si(o,e,a,p,l,i){const n=D("EmojiToIcon"),s=D("StepInfoEditor"),y=D("StepEffectsEditor"),r=D("CharacterBulkEditor"),_=D("ImageBulkEditor");return d(),c("div",Lo,[t("div",Ao,[t("header",Bo,[t("button",{onClick:e[0]||(e[0]=(...v)=>i.goBack&&i.goBack(...v)),class:"back-button"},[u(n,{emoji:"â¬…ï¸",size:20})]),t("h2",null,[u(n,{emoji:"âœï¸",size:24}),e[20]||(e[20]=g(" ë¡œê·¸ íŽ¸ì§‘ê¸° ",-1))]),t("div",Jo,[t("button",{onClick:e[1]||(e[1]=(...v)=>i.showEmbedCodeModal&&i.showEmbedCodeModal(...v)),class:"embed-button"},[u(n,{emoji:"ðŸ”—",size:18}),e[21]||(e[21]=g(" ìž„ë² ë“œ ì½”ë“œ ",-1))]),t("button",{onClick:e[2]||(e[2]=(...v)=>i.exportJSON&&i.exportJSON(...v)),class:"export-button"},[u(n,{emoji:"ðŸ“¤",size:18}),e[22]||(e[22]=g(" JSON ë‚´ë³´ë‚´ê¸° ",-1))]),t("button",{onClick:e[3]||(e[3]=(...v)=>i.saveAndPlay&&i.saveAndPlay(...v)),class:"save-button"},[u(n,{emoji:"â–¶ï¸",size:18}),e[23]||(e[23]=g(" ìž¬ìƒí•˜ê¸° ",-1))])])]),l.showEmbedModal?(d(),c("div",{key:0,class:"modal-overlay",onClick:e[11]||(e[11]=(...v)=>i.closeEmbedModal&&i.closeEmbedModal(...v))},[t("div",{class:"modal-content embed-modal",onClick:e[10]||(e[10]=O(()=>{},["stop"]))},[t("div",Go,[t("h3",null,[u(n,{emoji:"ðŸ”—",size:20}),e[24]||(e[24]=g(" ìž„ë² ë“œ ì½”ë“œ ìƒì„± ",-1))]),t("button",{onClick:e[4]||(e[4]=(...v)=>i.closeEmbedModal&&i.closeEmbedModal(...v)),class:"close-button"},[u(n,{emoji:"âœ–ï¸",size:18})])]),t("div",Po,[t("div",Mo,[e[26]||(e[26]=t("h4",null,"1ë‹¨ê³„: JSON íŒŒì¼ í˜¸ìŠ¤íŒ…",-1)),e[27]||(e[27]=t("p",{class:"help-text"}," ë¨¼ì € JSONì„ ë‚´ë³´ë‚´ê¸°í•˜ì—¬ ì›¹ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ê³³ì— ì—…ë¡œë“œí•˜ì„¸ìš”. (O) GitHub Pages, Dropbox | (X) Google Drive, OneDrive ",-1)),t("button",{onClick:e[5]||(e[5]=(...v)=>i.exportJSON&&i.exportJSON(...v)),class:"export-link-button"},[u(n,{emoji:"ðŸ“¤",size:16}),e[25]||(e[25]=g(" JSON ë‚´ë³´ë‚´ê¸° ",-1))])]),t("div",Xo,[e[28]||(e[28]=t("h4",null,"2ë‹¨ê³„: JSON URL ìž…ë ¥",-1)),m(t("input",{"onUpdate:modelValue":e[6]||(e[6]=v=>l.embedJsonUrl=v),type:"url",placeholder:"https://ohohod.github.io/embeded-test.json",class:"embed-url-input"},null,512),[[f,l.embedJsonUrl]])]),t("div",Wo,[e[30]||(e[30]=t("h4",null,"3ë‹¨ê³„: ì˜µì…˜ ì„¤ì •",-1)),t("div",qo,[t("label",Ho,[m(t("input",{"onUpdate:modelValue":e[7]||(e[7]=v=>l.embedAutoplay=v),type:"checkbox"},null,512),[[T,l.embedAutoplay]]),e[29]||(e[29]=t("span",null,"ìžë™ ìž¬ìƒ",-1))])])]),t("div",Yo,[e[31]||(e[31]=t("h4",null,"4ë‹¨ê³„: ìž„ë² ë“œ ì½”ë“œ ë³µì‚¬",-1)),t("div",Ko,[t("pre",null,[t("code",null,b(i.generatedEmbedCode),1)])]),t("button",{onClick:e[8]||(e[8]=(...v)=>i.copyEmbedCode&&i.copyEmbedCode(...v)),class:S(["copy-button",{copied:l.embedCopied}])},[u(n,{emoji:l.embedCopied?"âœ…":"ðŸ“‹",size:16},null,8,["emoji"]),g(" "+b(l.embedCopied?"ë³µì‚¬ ì™„ë£Œ!":"ì½”ë“œ ë³µì‚¬"),1)],2)]),l.embedJsonUrl?(d(),c("div",Qo,[t("h4",null,[u(n,{emoji:"ðŸ‘ï¸",size:18}),e[32]||(e[32]=g(" ë¯¸ë¦¬ë³´ê¸° ",-1))]),e[36]||(e[36]=t("p",{class:"help-text"},"ì‹¤ì œ ìž„ë² ë“œ í”Œë ˆì´ì–´ê°€ ì´ë ‡ê²Œ í‘œì‹œë©ë‹ˆë‹¤:",-1)),t("div",Zo,[l.embedPreviewLoaded?h("",!0):(d(),c("div",$o,[...e[33]||(e[33]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"ë¡œë”© ì¤‘...",-1)])])),t("iframe",{src:i.embedPreviewUrl,width:"100%",height:"100%",frameborder:"0",allowfullscreen:"",sandbox:"allow-scripts allow-same-origin allow-popups allow-forms",class:"preview-iframe",onLoad:e[9]||(e[9]=v=>l.embedPreviewLoaded=!0)},null,40,ei)]),t("p",ti,[u(n,{emoji:"ðŸ’¡",size:14}),e[34]||(e[34]=g(" ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ JSON URLì´ CORSë¥¼ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. ",-1))]),l.embedPreviewLoaded?(d(),c("p",si,[u(n,{emoji:"âš ï¸",size:14}),e[35]||(e[35]=g(" ìž„ë² ë“œ í”Œë ˆì´ì–´ëŠ” íƒ€ì‚¬ ì½˜í…ì¸ ë¥¼ í¬í•¨í•  ìˆ˜ ìžˆìœ¼ë©°, í•´ë‹¹ ì½˜í…ì¸ ì˜ ë²•ì  ì±…ìž„ì€ í•´ë‹¹ ì½˜í…ì¸  ì œê³µìžì—ê²Œ ìžˆìŠµë‹ˆë‹¤. ",-1))])):h("",!0)])):h("",!0)])])])):h("",!0),t("div",li,[t("div",oi,[t("div",ii,[t("h3",null,"ìŠ¤í… ëª©ë¡ ("+b(i.totalSteps)+"ê°œ)",1)]),t("div",ai,[(d(!0),c(C,null,U(i.allSteps,(v,k)=>(d(),c("div",{key:v.id,class:S(["step-item",{"has-effects":i.hasEffects(v),selected:l.selectedStepIndex===k}]),onClick:w=>i.selectStep(k)},[t("div",ri,b(k+1),1),t("div",di,[t("div",ci,b(v.character.name||"ì‹œìŠ¤í…œ"),1),t("div",ui,b(i.truncateText(v.text,50)),1),i.hasEffects(v)?(d(),c("div",pi,[v.effects.sfx?(d(),c("span",mi,[u(n,{emoji:"ðŸ”Š",size:12})])):h("",!0),v.effects.bgm?(d(),c("span",fi,[u(n,{emoji:"ðŸŽµ",size:12})])):h("",!0),v.effects.background?(d(),c("span",hi,[u(n,{emoji:"ðŸ–¼ï¸",size:12})])):h("",!0)])):h("",!0)])],10,ni))),128))])]),t("div",gi,[t("div",vi,[t("button",{class:S(["tab-button",{active:l.activeTab==="info"}]),onClick:e[12]||(e[12]=v=>l.activeTab="info")},[u(n,{emoji:"ðŸ“",size:16}),e[37]||(e[37]=g(" ì •ë³´ ìˆ˜ì • ",-1))],2),t("button",{class:S(["tab-button",{active:l.activeTab==="effects"}]),onClick:e[13]||(e[13]=v=>l.activeTab="effects")},[u(n,{emoji:"âœ¨",size:16}),e[38]||(e[38]=g(" íš¨ê³¼ íŽ¸ì§‘ ",-1))],2),t("button",{class:S(["tab-button",{active:l.activeTab==="characters"}]),onClick:e[14]||(e[14]=v=>l.activeTab="characters")},[u(n,{emoji:"ðŸ‘¥",size:16}),e[39]||(e[39]=g(" ìºë¦­í„° ì¼ê´„íŽ¸ì§‘ ",-1))],2),t("button",{class:S(["tab-button",{active:l.activeTab==="images"}]),onClick:e[15]||(e[15]=v=>l.activeTab="images")},[u(n,{emoji:"ðŸ–¼ï¸",size:16}),e[40]||(e[40]=g(" ì´ë¯¸ì§€ ì¼ê´„íŽ¸ì§‘ ",-1))],2)]),t("div",bi,[l.activeTab==="info"?(d(),c("div",yi,[u(s,{"step-data":i.selectedStep,onSave:i.handleSaveStepInfo,onDelete:i.handleDeleteStep,onDuplicate:i.handleDuplicateStep,onClose:e[16]||(e[16]=v=>l.activeTab="effects")},null,8,["step-data","onSave","onDelete","onDuplicate"])])):h("",!0),l.activeTab==="effects"?(d(),c("div",ki,[u(y,{"total-steps":i.totalSteps,"selected-step":l.selectedStepIndex!==null?l.selectedStepIndex+1:null,"current-effects":i.selectedStepEffects,onApply:i.handleApplyEffects,onRemove:i.handleRemoveEffects,onClose:e[17]||(e[17]=v=>l.activeTab="info")},null,8,["total-steps","selected-step","current-effects","onApply","onRemove"])])):h("",!0),l.activeTab==="characters"?(d(),c("div",_i,[u(r,{"all-steps":i.allSteps,onBulkUpdate:i.handleBulkUpdateCharacter,onClose:e[18]||(e[18]=v=>l.activeTab="info")},null,8,["all-steps","onBulkUpdate"])])):h("",!0),l.activeTab==="images"?(d(),c("div",Ci,[u(_,{"vn-data":p.logStore.vnData,onBulkUpdate:i.handleBulkUpdateImage,onClose:e[19]||(e[19]=v=>l.activeTab="info")},null,8,["vn-data","onBulkUpdate"])])):h("",!0)])])])])])}const Di=I(Ro,[["render",Si],["__scopeId","data-v-4f4c5899"]]);export{Di as default};
