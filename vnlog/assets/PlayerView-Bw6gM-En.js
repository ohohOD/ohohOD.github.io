import{S as O,u as V}from"./logStore-CZieOc6v.js";import{_ as k,c as a,e as h,F as b,f as j,r as p,o as i,n as w,a as t,b as d,t as c,g as x,h as P,w as S,T as g,i as I,d as _,j as T,v as D,k as M,l as H}from"./index-D_ibTvm6.js";const B={name:"StatusChange",props:{statusChanges:{type:Array,default:()=>[]}},methods:{getStatusIcon(s){const e=s.toLowerCase();return e.includes("Ïπ®Ïãù")?"‚ö°":e.includes("hp")||e.includes("ÏÉùÎ™Ö")||e.includes("Ï≤¥Î†•")?"‚ù§Ô∏è":e.includes("mp")||e.includes("ÎßàÎÇò")||e.includes("ÎßàÎ†•")?"üíô":e.includes("san")||e.includes("Ï†ïÏã†")||e.includes("Ïù¥ÏÑ±")?"üß†":"üìä"}}},U={key:0,class:"status-change-container"},K={class:"status-icon"},X={class:"status-info"},q={class:"character-name"},F={class:"status-name"},G={class:"status-values"},J={class:"old-value"},Q={class:"new-value"};function W(s,e,l,y,r,n){const u=p("EmojiToIcon");return l.statusChanges&&l.statusChanges.length>0?(i(),a("div",U,[(i(!0),a(b,null,j(l.statusChanges,(o,m)=>(i(),a("div",{key:m,class:w(["status-change",{"is-positive":o.delta>0,"is-negative":o.delta<0}])},[t("div",K,[d(u,{emoji:n.getStatusIcon(o.statusName),size:16},null,8,["emoji"])]),t("div",X,[t("span",q,c(o.characterName),1),t("span",F,c(o.statusName),1)]),t("div",G,[t("span",J,c(o.oldValue),1),e[0]||(e[0]=t("span",{class:"arrow"},"‚Üí",-1)),t("span",Q,c(o.newValue),1),t("span",{class:w(["delta",{"delta-positive":o.delta>0,"delta-negative":o.delta<0}])},c(o.delta>0?"+":"")+c(o.delta),3)])],2))),128))])):h("",!0)}const Y=k(B,[["render",W],["__scopeId","data-v-d7a39858"]]),Z={name:"DXCombo",props:{dxCombos:{type:Array,default:()=>[]}},methods:{decodeHtml(s){if(!s)return s;const e=document.createElement("textarea");e.innerHTML=s;let l=e.value;return l=l.replace(/\\n/g,`
`),l=l.replace(/\\t/g,"	"),l=l.replace(/\\r/g,"\r"),l}}},$={key:0,class:"dx-combo-container"},ee={class:"combo-header"},te={class:"combo-icon"},se={class:"combo-label"},oe={key:0,class:"combo-name"},ne={key:1,class:"erosion-cost"},le={class:"combo-effects"},ie={class:"effect-name"},ae={class:"effect-level"},re={key:0,class:"combo-info-row"},ce={key:0,class:"info-item"},de={class:"info-value"},ue={key:1,class:"info-item"},he={class:"info-value"},me={key:2,class:"info-item"},pe={class:"info-value"},ye={key:3,class:"info-item"},ve={class:"info-value"},fe={key:1,class:"combo-stats-row"},Se={key:0,class:"info-item"},ge={class:"info-value"},Ce={key:1,class:"info-item"},_e={class:"info-value"},be={key:2,class:"info-item"},ke={class:"info-value"},we={key:3,class:"info-item"},Te={class:"info-value"},xe={key:2,class:"combo-description"},De={key:3,class:"combo-dice-roll"},Ie={class:"dice-roll-header"},je={class:"dice-roll-content"},Pe={class:"dice-formula"},Ee={class:"dice-detail"},Oe={class:"dice-result"};function Ae(s,e,l,y,r,n){const u=p("EmojiToIcon");return l.dxCombos&&l.dxCombos.length>0?(i(),a("div",$,[(i(!0),a(b,null,j(l.dxCombos,(o,m)=>(i(),a("div",{key:m,class:"dx-combo"},[t("div",ee,[t("div",te,[d(u,{emoji:"‚ö°",size:16})]),t("span",se,c(o.isSingleEffect?"Ïù¥ÌéôÌä∏":"ÏΩ§Î≥¥"),1),o.comboName?(i(),a("span",oe,c(n.decodeHtml(o.comboName)),1)):h("",!0),o.erosionCost?(i(),a("span",ne,c(o.erosionCost)+"‚Üë",1)):h("",!0)]),t("div",le,[(i(!0),a(b,null,j(o.effects,(v,C)=>(i(),a("div",{key:C,class:"combo-effect"},[t("span",ie,c(n.decodeHtml(v.name)),1),t("span",ae,"Lv."+c(v.level),1)]))),128))]),o.timing||o.difficulty||o.target||o.range?(i(),a("div",re,[o.timing?(i(),a("span",ce,[e[0]||(e[0]=t("span",{class:"info-label"},"ÌÉÄÏù¥Î∞ç:",-1)),t("span",de,c(n.decodeHtml(o.timing)),1)])):h("",!0),o.difficulty?(i(),a("span",ue,[e[1]||(e[1]=t("span",{class:"info-label"},"ÎÇúÏù¥ÎèÑ:",-1)),t("span",he,c(n.decodeHtml(o.difficulty)),1)])):h("",!0),o.target?(i(),a("span",me,[e[2]||(e[2]=t("span",{class:"info-label"},"ÎåÄÏÉÅ:",-1)),t("span",pe,c(n.decodeHtml(o.target)),1)])):h("",!0),o.range?(i(),a("span",ye,[e[3]||(e[3]=t("span",{class:"info-label"},"ÏÇ¨Í±∞Î¶¨:",-1)),t("span",ve,c(n.decodeHtml(o.range)),1)])):h("",!0)])):h("",!0),o.dice||o.critical||o.attack||o.erosion?(i(),a("div",fe,[o.dice?(i(),a("span",Se,[e[4]||(e[4]=t("span",{class:"info-label"},"Îã§Ïù¥Ïä§:",-1)),t("span",ge,c(n.decodeHtml(o.dice)),1)])):h("",!0),o.critical?(i(),a("span",Ce,[e[5]||(e[5]=t("span",{class:"info-label"},"ÌÅ¨Î¶¨Ïπò:",-1)),t("span",_e,c(n.decodeHtml(o.critical)),1)])):h("",!0),o.attack?(i(),a("span",be,[e[6]||(e[6]=t("span",{class:"info-label"},"Í≥µÍ≤©Î†•:",-1)),t("span",ke,c(n.decodeHtml(o.attack)),1)])):h("",!0),o.erosion?(i(),a("span",we,[e[7]||(e[7]=t("span",{class:"info-label"},"Ïπ®Ïãù:",-1)),t("span",Te,c(n.decodeHtml(o.erosion)),1)])):h("",!0)])):h("",!0),o.description?(i(),a("div",xe,c(n.decodeHtml(o.description)),1)):h("",!0),o.diceRoll?(i(),a("div",De,[t("div",Ie,[d(u,{emoji:"üé≤",size:14}),e[8]||(e[8]=t("span",{class:"dice-roll-label"},"ÌåêÏ†ï",-1))]),t("div",je,[t("span",Pe,c(o.diceRoll.formula),1),e[9]||(e[9]=t("span",{class:"dice-separator"},"‚Üí",-1)),t("span",Ee,c(o.diceRoll.diceRolls),1),e[10]||(e[10]=t("span",{class:"dice-separator"},"‚Üí",-1)),t("span",Oe,c(o.diceRoll.result),1)])])):h("",!0)]))),128))])):h("",!0)}const N=k(Z,[["render",Ae],["__scopeId","data-v-73107c03"]]),Ne={name:"DialogBox",components:{StatusChange:Y,DXCombo:N},props:{characterName:{type:String,default:""},characterColor:{type:String,default:"#333333"},text:{type:String,required:!0},statusChanges:{type:Array,default:()=>[]},dxCombos:{type:Array,default:()=>[]},typingSpeed:{type:Number,default:50},autoAdvance:{type:Boolean,default:!1}},data(){return{displayedText:"",isTyping:!1,isComplete:!1,typingTimer:null,currentIndex:0}},computed:{decodedText(){return this.decodeHtmlEntities(this.displayedText)}},watch:{text:{immediate:!0,handler(s){this.startTyping(s)}}},methods:{decodeHtmlEntities(s){if(!s)return s;const e={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&#39;":"'","&apos;":"'"};return s.replace(/&[a-z]+;|&#\d+;/gi,l=>e[l]||l)},startTyping(s){if(this.stopTyping(),this.displayedText="",this.currentIndex=0,this.isTyping=!0,this.isComplete=!1,!s||s.length===0){this.displayedText=s,this.completeTyping(!0);return}this.typeNextCharacter(s)},typeNextCharacter(s){this.currentIndex<s.length?(this.displayedText+=s[this.currentIndex],this.currentIndex++,this.typingTimer=setTimeout(()=>{this.typeNextCharacter(s)},this.typingSpeed)):this.completeTyping()},completeTyping(s=!1){if(this.isTyping=!1,this.isComplete=!0,this.$emit("typing-complete"),this.autoAdvance){let e=1500;s&&(e=3e3);const l=this.text.length*this.typingSpeed,r=l+e<3e3?3e3-l:e;setTimeout(()=>{this.$emit("advance")},Math.max(r,e))}},handleClick(){this.skipTyping()},skipTyping(){this.isTyping?(this.stopTyping(),this.displayedText=this.text,this.completeTyping()):this.isComplete&&this.$emit("advance")},stopTyping(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null)}},beforeUnmount(){this.stopTyping()}},Le={class:"text-content"},ze={key:0,class:"continue-indicator"};function Re(s,e,l,y,r,n){const u=p("EmojiToIcon"),o=p("DXCombo"),m=p("StatusChange");return i(),a("div",{class:"dialog-box",style:P({borderColor:l.characterColor}),onClick:e[0]||(e[0]=(...v)=>n.handleClick&&n.handleClick(...v))},[l.characterName?(i(),a("div",{key:0,class:"character-name",style:P({color:l.characterColor})},c(l.characterName),5)):h("",!0),t("div",{class:w(["dialog-text",{"is-typing":r.isTyping}])},[t("p",Le,c(n.decodedText),1),!r.isTyping&&!r.isComplete?(i(),a("div",ze,[d(u,{emoji:"‚ñº",size:12})])):h("",!0)],2),l.dxCombos&&l.dxCombos.length>0?(i(),x(o,{key:1,dxCombos:l.dxCombos},null,8,["dxCombos"])):h("",!0),l.statusChanges&&l.statusChanges.length>0?(i(),x(m,{key:2,statusChanges:l.statusChanges},null,8,["statusChanges"])):h("",!0)],4)}const Ve=k(Ne,[["render",Re],["__scopeId","data-v-d0a070da"]]),Me={name:"CharacterDisplay",props:{currentStep:{type:Object,default:null},characters:{type:Object,default:()=>({})},maxVisibleCharacters:{type:Number,default:3},layout:{type:String,default:"single",validator:s=>["single","left","center","right"].includes(s)}},data(){return{activeCharacterIds:[],failedImageIds:new Set}},computed:{speakingCharacterId(){var s;return!this.currentStep||this.currentStep.type==="system"||this.currentStep.type==="narrator"?null:((s=this.currentStep.character)==null?void 0:s.id)||null},currentCharacter(){return this.currentStep?this.getCurrentCharacter():null}},methods:{getCurrentCharacter(){if(!this.currentStep||!this.currentStep.character)return null;const s=this.currentStep.character;return{id:s.id||s.name,name:s.name,avatarUrl:this.failedImageIds.has(s.id)?null:s.avatarUrl,color:s.color,emotion:s.emotion||"default"}},getCharacterStyle(s){const e={};return s.color&&s.id===this.speakingCharacterId&&(e.borderColor=s.color),e},handleImageError(s){console.warn(`Ï∫êÎ¶≠ÌÑ∞ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${s.name}`),this.failedImageIds.add(s.id)}},watch:{currentStep:{handler(s){if(!s)return;const e=this.speakingCharacterId;e&&!this.activeCharacterIds.includes(e)&&(this.activeCharacterIds.push(e),this.activeCharacterIds.length>this.maxVisibleCharacters&&this.activeCharacterIds.shift())},immediate:!0}}},He={class:"character-display"},Be={class:"character-container"},Ue={class:"character-avatar"},Ke=["src","alt"];function Xe(s,e,l,y,r,n){return i(),a("div",He,[t("div",Be,[d(g,{name:"character-fade",mode:"out-in"},{default:S(()=>[n.currentCharacter&&n.currentCharacter.avatarUrl?(i(),a("div",{key:n.currentCharacter.id,class:w(["character-wrapper",{"is-speaking":n.currentCharacter.id===n.speakingCharacterId}]),style:P(n.getCharacterStyle(n.currentCharacter))},[t("div",Ue,[t("img",{src:n.currentCharacter.avatarUrl,alt:n.currentCharacter.name,onError:e[0]||(e[0]=u=>n.handleImageError(n.currentCharacter))},null,40,Ke)])],6)):h("",!0)]),_:1})])])}const qe=k(Me,[["render",Xe],["__scopeId","data-v-ee134a29"]]),Fe={name:"PlaybackControls",props:{currentStepNumber:{type:Number,required:!0},totalSteps:{type:Number,required:!0},currentSceneName:{type:String,default:""},hasPreviousStep:{type:Boolean,default:!1},hasNextStep:{type:Boolean,default:!0},autoPlayEnabled:{type:Boolean,default:!1},showProgressBar:{type:Boolean,default:!0},showSceneSelector:{type:Boolean,default:!1}},computed:{progressPercentage(){return this.totalSteps===0?0:this.currentStepNumber/this.totalSteps*100}}},Ge={class:"playback-controls"},Je={key:0,class:"progress-bar"},Qe={class:"progress-info"},We={class:"scene-name"},Ye={class:"step-counter"},Ze={class:"controls-buttons"},$e=["disabled"],et=["disabled"],tt={key:1,class:"step-counter"};function st(s,e,l,y,r,n){const u=p("EmojiToIcon");return i(),a("div",Ge,[l.showProgressBar?(i(),a("div",Je,[t("div",{class:"progress-fill",style:P({width:n.progressPercentage+"%"})},null,4),t("div",Qe,[t("span",We,c(l.currentSceneName),1),t("span",Ye,c(l.currentStepNumber)+" / "+c(l.totalSteps),1)])])):h("",!0),t("div",Ze,[t("button",{class:"control-button",onClick:e[0]||(e[0]=o=>s.$emit("previous")),disabled:!l.hasPreviousStep,title:"Ïù¥Ï†Ñ (‚Üê)"},[d(u,{emoji:"‚èÆÔ∏è",size:20})],8,$e),t("button",{class:"control-button primary",onClick:e[1]||(e[1]=o=>s.$emit("next")),disabled:!l.hasNextStep,title:"Îã§Ïùå (‚Üí / Space)"},[d(u,{emoji:"‚ñ∂Ô∏è",size:24})],8,et),t("button",{class:w(["control-button",{"is-active":l.autoPlayEnabled}]),onClick:e[2]||(e[2]=o=>s.$emit("toggle-autoplay")),title:"ÏûêÎèô Ïû¨ÏÉù"},[d(u,{emoji:l.autoPlayEnabled?"‚è∏Ô∏è":"‚èØÔ∏è",size:20},null,8,["emoji"])],2),l.showSceneSelector?(i(),a("button",{key:0,class:"control-button",onClick:e[3]||(e[3]=o=>s.$emit("open-scene-selector")),title:"Ïî¨ ÏÑ†ÌÉù"},[d(u,{emoji:"üìë",size:20})])):h("",!0),l.showProgressBar?h("",!0):(i(),a("div",tt,c(l.currentStepNumber)+" / "+c(l.totalSteps),1))])])}const ot=k(Fe,[["render",st],["__scopeId","data-v-d1f0ea44"]]),nt={name:"HandoutDisplay",props:{handout:{type:Object,default:()=>({id:null,title:"",imageUrl:"",description:""})},isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{imageLoadError:!1}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},handleImageError(){this.imageLoadError=!0,console.error(`Ìï∏ÎìúÏïÑÏõÉ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${this.handout.imageUrl}`)},handleKeyPress(s){s.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(s){s?(window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.imageLoadError=!1)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},lt={key:0,class:"handout-header"},it={class:"handout-title"},at={class:"handout-content"},rt=["src","alt"],ct={key:1,class:"handout-placeholder"},dt={key:2,class:"handout-description"};function ut(s,e,l,y,r,n){const u=p("EmojiToIcon");return i(),x(g,{name:"handout-overlay"},{default:S(()=>[l.isVisible?(i(),a("div",{key:0,class:"handout-overlay",onClick:e[3]||(e[3]=(...o)=>n.handleOverlayClick&&n.handleOverlayClick(...o))},[t("div",{class:"handout-container",onClick:e[2]||(e[2]=I(()=>{},["stop"]))},[t("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>n.close&&n.close(...o)),title:"Îã´Í∏∞ (ESC)"},[d(u,{emoji:"‚úñÔ∏è",size:24})]),l.handout.title?(i(),a("div",lt,[t("h2",it,c(l.handout.title),1)])):h("",!0),t("div",at,[l.handout.imageUrl?(i(),a("img",{key:0,src:l.handout.imageUrl,alt:l.handout.title||"Ìï∏ÎìúÏïÑÏõÉ",class:"handout-image",onError:e[1]||(e[1]=(...o)=>n.handleImageError&&n.handleImageError(...o))},null,40,rt)):(i(),a("div",ct,[d(u,{emoji:"üñºÔ∏è",size:64}),e[4]||(e[4]=t("p",null,"Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§",-1))])),l.handout.description?(i(),a("div",dt,[t("p",null,c(l.handout.description),1)])):h("",!0)])])])):h("",!0)]),_:1})}const ht=k(nt,[["render",ut],["__scopeId","data-v-3b47a24b"]]),mt={name:"ThemeSettingsModal",props:{isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{localSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard"},defaultSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard"}}},computed:{previewStyles(){return{"--preview-primary":this.localSettings.primaryColor,"--preview-bg":this.localSettings.bgColor,"--preview-text":this.localSettings.textColor,"--preview-border":this.localSettings.borderColor,fontFamily:this.localSettings.fontFamily}}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},loadSettings(){const s=localStorage.getItem("vnlog-theme-settings");if(s)try{this.localSettings={...this.defaultSettings,...JSON.parse(s)}}catch(e){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®:",e)}},saveSettings(){localStorage.setItem("vnlog-theme-settings",JSON.stringify(this.localSettings)),this.applyTheme(this.localSettings),this.$emit("save",this.localSettings),this.$emit("close")},applyTheme(s){const e=document.documentElement;e.style.setProperty("--primary-color",s.primaryColor),e.style.setProperty("--bg-color",s.bgColor),e.style.setProperty("--text-color",s.textColor),e.style.setProperty("--border-color",s.borderColor),e.style.setProperty("--font-family",s.fontFamily)},resetToDefault(){this.localSettings={...this.defaultSettings}},handleKeyPress(s){s.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(s){s?(this.loadSettings(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="")}}},mounted(){this.loadSettings(),this.applyTheme(this.localSettings)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},pt={class:"modal-header"},yt={class:"modal-title"},vt={class:"modal-content"},ft={class:"setting-group"},St={class:"setting-label"},gt={class:"color-picker-wrapper"},Ct={class:"setting-group"},_t={class:"setting-label"},bt={class:"color-picker-wrapper"},kt={class:"setting-group"},wt={class:"setting-label"},Tt={class:"color-picker-wrapper"},xt={class:"setting-group"},Dt={class:"setting-label"},It={class:"color-picker-wrapper"},jt={class:"setting-group"},Pt={class:"setting-label"},Et={class:"preview-section"},Ot={class:"modal-footer"},At={class:"button-group"};function Nt(s,e,l,y,r,n){const u=p("EmojiToIcon");return i(),x(g,{name:"modal-overlay"},{default:S(()=>[l.isVisible?(i(),a("div",{key:0,class:"modal-overlay",onClick:e[14]||(e[14]=(...o)=>n.handleOverlayClick&&n.handleOverlayClick(...o))},[t("div",{class:"modal-container",onClick:e[13]||(e[13]=I(()=>{},["stop"]))},[t("div",pt,[t("h2",yt,[d(u,{emoji:"üé®",size:24}),e[15]||(e[15]=_(" ÌÖåÎßà ÏÑ§Ï†ï ",-1))]),t("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>n.close&&n.close(...o)),title:"Îã´Í∏∞ (ESC)"},[d(u,{emoji:"‚úñÔ∏è",size:20})])]),t("div",vt,[t("div",ft,[t("label",St,[d(u,{emoji:"üé®",size:16}),e[16]||(e[16]=_(" Ï£ºÏöî ÏÉâÏÉÅ ",-1))]),t("div",gt,[T(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.localSettings.primaryColor=o),type:"color",class:"color-picker"},null,512),[[D,r.localSettings.primaryColor]]),T(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.localSettings.primaryColor=o),type:"text",class:"color-input",placeholder:"#6366f1"},null,512),[[D,r.localSettings.primaryColor]])])]),t("div",Ct,[t("label",_t,[d(u,{emoji:"üñºÔ∏è",size:16}),e[17]||(e[17]=_(" Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),t("div",bt,[T(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.localSettings.bgColor=o),type:"color",class:"color-picker"},null,512),[[D,r.localSettings.bgColor]]),T(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.localSettings.bgColor=o),type:"text",class:"color-input",placeholder:"#1a1a2e"},null,512),[[D,r.localSettings.bgColor]])])]),t("div",kt,[t("label",wt,[d(u,{emoji:"üìù",size:16}),e[18]||(e[18]=_(" ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ ",-1))]),t("div",Tt,[T(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.localSettings.textColor=o),type:"color",class:"color-picker"},null,512),[[D,r.localSettings.textColor]]),T(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.localSettings.textColor=o),type:"text",class:"color-input",placeholder:"#ffffff"},null,512),[[D,r.localSettings.textColor]])])]),t("div",xt,[t("label",Dt,[d(u,{emoji:"‚¨ú",size:16}),e[19]||(e[19]=_(" ÌÖåÎëêÎ¶¨ ÏÉâÏÉÅ ",-1))]),t("div",It,[T(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.localSettings.borderColor=o),type:"color",class:"color-picker"},null,512),[[D,r.localSettings.borderColor]]),T(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>r.localSettings.borderColor=o),type:"text",class:"color-input",placeholder:"#666666"},null,512),[[D,r.localSettings.borderColor]])])]),t("div",jt,[t("label",Pt,[d(u,{emoji:"üî§",size:16}),e[20]||(e[20]=_(" Ìè∞Ìä∏ ",-1))]),T(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>r.localSettings.fontFamily=o),class:"font-select"},[...e[21]||(e[21]=[t("option",{value:"Pretendard"},"Pretendard (Í∏∞Î≥∏)",-1),t("option",{value:"NanumSquare"},"NanumSquare",-1),t("option",{value:"Nanum Myeongjo"},"Nanum Myeongjo",-1),t("option",{value:"NotoSerifKR"},"Noto Serif KR",-1)])],512),[[M,r.localSettings.fontFamily]])]),t("div",Et,[e[23]||(e[23]=t("p",{class:"preview-label"},"ÎØ∏Î¶¨Î≥¥Í∏∞",-1)),t("div",{class:"preview-box",style:P(n.previewStyles)},[...e[22]||(e[22]=[t("p",null,"ÏïàÎÖïÌïòÏÑ∏Ïöî!",-1),t("button",{class:"preview-button"},"Î≤ÑÌäº",-1)])],4)])]),t("div",Ot,[t("button",{class:"action-button secondary",onClick:e[10]||(e[10]=(...o)=>n.resetToDefault&&n.resetToDefault(...o))},[d(u,{emoji:"üîÑ",size:16}),e[24]||(e[24]=_(" Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõê ",-1))]),t("div",At,[t("button",{class:"action-button secondary",onClick:e[11]||(e[11]=(...o)=>n.close&&n.close(...o))}," Ï∑®ÏÜå "),t("button",{class:"action-button primary",onClick:e[12]||(e[12]=(...o)=>n.saveSettings&&n.saveSettings(...o))},[d(u,{emoji:"üíæ",size:16}),e[25]||(e[25]=_(" Ï†ÄÏû• ",-1))])])])])])):h("",!0)]),_:1})}const Lt=k(mt,[["render",Nt],["__scopeId","data-v-23ba65f7"]]),zt={name:"SaveLoadModal",props:{isVisible:{type:Boolean,default:!1},mode:{type:String,default:"save",validator:s=>["save","load"].includes(s)},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{saveSlots:[],deleteConfirmSlot:null}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.deleteConfirmSlot===null&&this.close()},loadSaveSlots(){this.saveSlots=O.getAllSaves()},handleSlotClick(s){this.mode==="save"?(this.$emit("save",s),this.close()):this.saveSlots[s].isEmpty||(this.$emit("load",s),this.close())},confirmDelete(s){this.deleteConfirmSlot=s},cancelDelete(){this.deleteConfirmSlot=null},executeDelete(){this.deleteConfirmSlot!==null&&(O.deleteSave(this.deleteConfirmSlot),this.loadSaveSlots(),this.deleteConfirmSlot=null)},formatInfo(s){return O.formatSaveInfo(s)},handleKeyPress(s){s.key==="Escape"&&this.isVisible&&(this.deleteConfirmSlot!==null?this.cancelDelete():this.close())}},watch:{isVisible:{immediate:!0,handler(s){s?(this.loadSaveSlots(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.deleteConfirmSlot=null)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},Rt={class:"modal-header"},Vt={class:"modal-title"},Mt={class:"modal-content"},Ht=["onClick"],Bt={class:"slot-header"},Ut={class:"slot-number"},Kt=["onClick"],Xt={class:"slot-content"},qt={key:0,class:"empty-slot"},Ft={key:1,class:"save-info"},Gt={class:"save-title"},Jt={class:"save-subtitle"},Qt={class:"save-date"},Wt={class:"modal-footer"},Yt={class:"footer-note"},Zt={class:"confirm-content"},$t={class:"confirm-buttons"};function es(s,e,l,y,r,n){const u=p("EmojiToIcon");return i(),x(g,{name:"modal-overlay"},{default:S(()=>[l.isVisible?(i(),a("div",{key:0,class:"modal-overlay",onClick:e[5]||(e[5]=(...o)=>n.handleOverlayClick&&n.handleOverlayClick(...o))},[t("div",{class:"modal-container",onClick:e[1]||(e[1]=I(()=>{},["stop"]))},[t("div",Rt,[t("h2",Vt,[d(u,{emoji:l.mode==="save"?"üíæ":"üìÇ",size:24},null,8,["emoji"]),_(" "+c(l.mode==="save"?"Ï†ÄÏû•ÌïòÍ∏∞":"Î∂àÎü¨Ïò§Í∏∞"),1)]),t("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>n.close&&n.close(...o)),title:"Îã´Í∏∞ (ESC)"},[d(u,{emoji:"‚úñÔ∏è",size:20})])]),t("div",Mt,[(i(!0),a(b,null,j(r.saveSlots,o=>(i(),a("div",{key:o.slotIndex,class:w(["save-slot",{"is-empty":o.isEmpty}]),onClick:m=>n.handleSlotClick(o.slotIndex)},[t("div",Bt,[t("span",Ut,"Ïä¨Î°Ø "+c(o.slotIndex+1),1),!o.isEmpty&&l.mode==="save"?(i(),a("button",{key:0,class:"delete-button",onClick:I(m=>n.confirmDelete(o.slotIndex),["stop"]),title:"ÏÇ≠Ï†ú"},[d(u,{emoji:"üóëÔ∏è",size:16})],8,Kt)):h("",!0)]),t("div",Xt,[o.isEmpty?(i(),a("div",qt,[d(u,{emoji:"üì≠",size:32}),e[6]||(e[6]=t("p",null,"Îπà Ïä¨Î°Ø",-1))])):(i(),a("div",Ft,[t("h3",Gt,c(n.formatInfo(o).title),1),t("p",Jt,c(n.formatInfo(o).subtitle),1),t("p",Qt,c(n.formatInfo(o).date),1)]))])],10,Ht))),128))]),t("div",Wt,[t("p",Yt,[d(u,{emoji:"‚ÑπÔ∏è",size:14}),_(" "+c(l.mode==="save"?"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÌòÑÏû¨ ÏßÑÌñâÎèÑÎ•º Ï†ÄÏû•Ìï©ÎãàÎã§.":"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ï†ÄÏû•Îêú ÏßÑÌñâÎèÑÎ•º Î∂àÎü¨ÏòµÎãàÎã§."),1)])])]),r.deleteConfirmSlot!==null?(i(),a("div",{key:0,class:"confirm-modal",onClick:e[4]||(e[4]=I(()=>{},["stop"]))},[t("div",Zt,[e[7]||(e[7]=t("h3",null,"Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú",-1)),t("p",null,"Ïä¨Î°Ø "+c(r.deleteConfirmSlot+1)+"Ïùò Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",1),t("div",$t,[t("button",{class:"action-button secondary",onClick:e[2]||(e[2]=(...o)=>n.cancelDelete&&n.cancelDelete(...o))}," Ï∑®ÏÜå "),t("button",{class:"action-button danger",onClick:e[3]||(e[3]=(...o)=>n.executeDelete&&n.executeDelete(...o))}," ÏÇ≠Ï†ú ")])])])):h("",!0)])):h("",!0)]),_:1})}const ts=k(zt,[["render",es],["__scopeId","data-v-88932176"]]),ss={name:"SceneSelectorModal",props:{isVisible:{type:Boolean,default:!1},scenes:{type:Array,default:()=>[]},currentSceneIndex:{type:Number,default:0},currentStepIndex:{type:Number,default:0},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{expandedScenes:new Set}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},toggleScene(s){this.expandedScenes.has(s)?this.expandedScenes.delete(s):this.expandedScenes.add(s),this.$forceUpdate()},goToStep(s,e){this.$emit("go-to-step",s,e),this.close()},getStepPreview(s){return s?s.length>50?s.substring(0,50)+"...":s:"(ÌÖçÏä§Ìä∏ ÏóÜÏùå)"},handleKeyPress(s){s.key==="Escape"&&this.isVisible&&this.close()},initExpandedScenes(){this.currentSceneIndex!==null&&this.expandedScenes.add(this.currentSceneIndex)},scrollToCurrentScene(){setTimeout(()=>{this.$nextTick(()=>{const s=this.$refs.currentStep;if(s){const e=Array.isArray(s)?s[0]:s;e&&e.scrollIntoView({behavior:"smooth",block:"center"})}})},250)}},watch:{isVisible:{immediate:!0,handler(s){s?(this.initExpandedScenes(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden",this.scrollToCurrentScene()):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.expandedScenes.clear())}},currentSceneIndex:{handler(s){this.isVisible&&s!==null&&(this.expandedScenes.add(s),this.$forceUpdate())}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},os={class:"modal-header"},ns={class:"modal-title"},ls={class:"modal-content"},is=["onClick"],as={class:"scene-info"},rs={class:"scene-number"},cs={class:"scene-name"},ds={class:"scene-meta"},us={class:"step-count"},hs={key:0,class:"steps-list"},ms=["onClick"],ps={class:"step-number"},ys={class:"step-preview"},vs={class:"step-text"},fs={key:0,class:"empty-state"},Ss={class:"modal-footer"},gs={class:"footer-info"};function Cs(s,e,l,y,r,n){const u=p("EmojiToIcon");return i(),x(g,{name:"modal-overlay"},{default:S(()=>[l.isVisible?(i(),a("div",{key:0,class:"modal-overlay",onClick:e[3]||(e[3]=(...o)=>n.handleOverlayClick&&n.handleOverlayClick(...o))},[t("div",{class:"modal-container",onClick:e[2]||(e[2]=I(()=>{},["stop"]))},[t("div",os,[t("h2",ns,[d(u,{emoji:"üìë",size:24}),e[4]||(e[4]=_(" Ïî¨ ÏÑ†ÌÉù ",-1))]),t("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>n.close&&n.close(...o)),title:"Îã´Í∏∞ (ESC)"},[d(u,{emoji:"‚úñÔ∏è",size:20})])]),t("div",ls,[(i(!0),a(b,null,j(l.scenes,(o,m)=>(i(),a("div",{key:`scene-${m}`,class:w(["scene-item",{"is-current":m===l.currentSceneIndex}])},[t("div",{class:"scene-header",onClick:v=>n.toggleScene(m)},[t("div",as,[t("span",rs,"Ïî¨ "+c(m+1),1),t("h3",cs,c(o.name||"Ï†úÎ™© ÏóÜÏùå"),1)]),t("div",ds,[t("span",us,c(o.steps.length)+"Í∞ú Ïä§ÌÖù",1),d(u,{emoji:r.expandedScenes.has(m)?"üîΩ":"‚ñ∂Ô∏è",size:16,class:"expand-icon"},null,8,["emoji"])])],8,is),d(g,{name:"steps-expand"},{default:S(()=>[r.expandedScenes.has(m)?(i(),a("div",hs,[(i(!0),a(b,null,j(o.steps,(v,C)=>{var E;return i(),a("div",{key:`step-${m}-${C}`,ref_for:!0,ref:m===l.currentSceneIndex&&C===l.currentStepIndex?"currentStep":null,class:w(["step-item",{"is-current":m===l.currentSceneIndex&&C===l.currentStepIndex}]),onClick:A=>n.goToStep(m,C)},[t("span",ps,c(C+1),1),t("div",ys,[(E=v.character)!=null&&E.name?(i(),a("span",{key:0,class:"step-character",style:P({color:v.character.color||"#ffffff"})},c(v.character.name)+": ",5)):h("",!0),t("span",vs,c(n.getStepPreview(v.text)),1)]),m===l.currentSceneIndex&&C===l.currentStepIndex?(i(),x(u,{key:0,emoji:"‚ñ∂Ô∏è",size:14,class:"current-indicator"})):h("",!0)],10,ms)}),128))])):h("",!0)]),_:2},1024)],2))),128)),l.scenes.length===0?(i(),a("div",fs,[d(u,{emoji:"üì≠",size:48}),e[5]||(e[5]=t("p",null,"Ïî¨Ïù¥ ÏóÜÏäµÎãàÎã§",-1))])):h("",!0)]),t("div",Ss,[t("div",gs,[d(u,{emoji:"‚ÑπÔ∏è",size:14}),e[6]||(e[6]=t("span",null,"Ïî¨ÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÌéºÏπòÍ≥†, Ïä§ÌÖùÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ïù¥ÎèôÌï©ÎãàÎã§.",-1))]),t("button",{class:"action-button primary",onClick:e[1]||(e[1]=(...o)=>n.close&&n.close(...o))}," Îã´Í∏∞ ")])])])):h("",!0)]),_:1})}const _s=k(ss,[["render",Cs],["__scopeId","data-v-887e5c5c"]]),bs={name:"DiceRoll",props:{diceRolls:{type:Array,default:()=>[]},characterName:{type:String,default:""},characterColor:{type:String,default:"#ffffff"},animated:{type:Boolean,default:!0},animationDuration:{type:Number,default:800},playSoundEffect:{type:Boolean,default:!1}},data(){return{processedRolls:[],audioContext:null}},watch:{diceRolls:{immediate:!0,handler(s){this.processRolls(s)}}},methods:{processRolls(s){if(!s||s.length===0){this.processedRolls=[];return}this.processedRolls=s.map((e,l)=>({...e,isAnimating:!1,showResult:e.type==="choice"||e.type==="judgement",showDetails:!1})),this.animated?this.processedRolls.forEach((e,l)=>{e.type==="choice"||e.type==="judgement"||setTimeout(()=>{this.animateRoll(l)},l*200)}):this.processedRolls.forEach(e=>{e.showResult=!0})},animateRoll(s){const e=this.processedRolls[s];e&&(e.isAnimating=!0,this.playSoundEffect&&this.playDiceSound(),setTimeout(()=>{e.isAnimating=!1,e.showResult=!0},this.animationDuration))},toggleDetails(s){const e=this.processedRolls[s];e&&(e.showDetails=!e.showDetails)},playDiceSound(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));const s=this.audioContext,e=s.createOscillator(),l=s.createGain();e.connect(l),l.connect(s.destination),e.type="square",e.frequency.setValueAtTime(200,s.currentTime),e.frequency.exponentialRampToValueAtTime(100,s.currentTime+.1),l.gain.setValueAtTime(.1,s.currentTime),l.gain.exponentialRampToValueAtTime(.01,s.currentTime+.1),e.start(s.currentTime),e.stop(s.currentTime+.1)}}},ks={class:"dice-roll-container"},ws={class:"dice-icon-wrapper"},Ts={class:"dice-result choice-result"},xs=["onClick","title"],Ds={key:0,class:"dice-details choice-options"},Is={class:"judgement-header"},js={class:"dice-icon-wrapper"},Ps={class:"judgement-info"},Es={class:"judgement-main"},Os={class:"dice-formula"},As={class:"judgement-result-line"},Ns={key:1,class:"dice-placeholder"},Ls={class:"judgement-text"},zs=["onClick","title"],Rs={key:0,class:"dice-details"},Vs={class:"dice-formula"},Ms={key:1,class:"dice-placeholder"},Hs={key:0,class:"dice-details-wrapper"},Bs=["onClick","title"],Us={key:0,class:"dice-details"};function Ks(s,e,l,y,r,n){const u=p("EmojiToIcon");return i(),a("div",ks,[d(H,{name:"dice-list",tag:"div",class:"dice-rolls"},{default:S(()=>[(i(!0),a(b,null,j(r.processedRolls,(o,m)=>(i(),a("div",{key:`${o.formula}-${m}`,class:w(["dice-roll",[{"is-animating":o.isAnimating},`roll-type-${o.type}`]])},[o.type==="choice"?(i(),a(b,{key:0},[t("div",ws,[d(u,{emoji:"üéØ",size:18,class:"dice-icon"})]),e[0]||(e[0]=t("span",{class:"dice-formula"},"ÏÑ†ÌÉù",-1)),e[1]||(e[1]=t("span",{class:"dice-arrow"},"‚Üí",-1)),t("span",Ts,c(o.result),1),t("button",{class:"details-toggle",onClick:v=>n.toggleDetails(m),title:o.showDetails?"ÏòµÏÖò Ïà®Í∏∞Í∏∞":"ÏòµÏÖò Î≥¥Í∏∞"},[d(u,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,xs),d(g,{name:"details-expand"},{default:S(()=>[o.showDetails?(i(),a("div",Ds,[(i(!0),a(b,null,j(o.options,(v,C)=>(i(),a("span",{key:C,class:"choice-option"},c(v),1))),128))])):h("",!0)]),_:2},1024)],64)):o.type==="judgement"?(i(),a(b,{key:1},[t("div",Is,[t("div",js,[d(u,{emoji:"‚öñÔ∏è",size:18,class:"dice-icon"})]),t("div",Ps,[t("div",Es,[t("span",{class:"judgement-character",style:P({color:l.characterColor})},c(l.characterName),5),t("span",Os,c(o.checkName),1)]),t("div",As,[e[2]||(e[2]=t("span",{class:"dice-arrow"},"‚Üí",-1)),d(g,{name:"dice-result",mode:"out-in"},{default:S(()=>[o.showResult?(i(),a("span",{key:o.result,class:"dice-result"},c(o.result),1)):(i(),a("span",Ns,"???"))]),_:2},1024),t("span",Ls,c(o.judgement),1)])])]),t("button",{class:"details-toggle",onClick:v=>n.toggleDetails(m),title:o.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[d(u,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,zs),d(g,{name:"details-expand"},{default:S(()=>[o.showDetails?(i(),a("div",Rs,c(o.formula),1)):h("",!0)]),_:2},1024)],64)):(i(),a(b,{key:2},[t("div",{class:w(["dice-icon-wrapper",{"is-rolling":o.isAnimating}])},[d(u,{emoji:"üé≤",size:18,class:"dice-icon"})],2),t("span",Vs,c(o.formula),1),e[3]||(e[3]=t("span",{class:"dice-arrow"},"‚Üí",-1)),d(g,{name:"dice-result",mode:"out-in"},{default:S(()=>[o.showResult?(i(),a("span",{key:o.result,class:"dice-result"},c(o.result),1)):(i(),a("span",Ms,"???"))]),_:2},1024),o.type==="dx3"&&o.diceRolls?(i(),a("div",Hs,[t("button",{class:"details-toggle",onClick:v=>n.toggleDetails(m),title:o.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[d(u,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Bs),d(g,{name:"details-expand"},{default:S(()=>[o.showDetails?(i(),a("div",Us,c(o.diceRolls),1)):h("",!0)]),_:2},1024)])):h("",!0)],64))],2))),128))]),_:1})])}const Xs=k(bs,[["render",Ks],["__scopeId","data-v-65fa6f7c"]]),qs={name:"PlayerView",components:{DialogBox:Ve,CharacterDisplay:qe,PlaybackControls:ot,HandoutDisplay:ht,ThemeSettingsModal:Lt,SaveLoadModal:ts,SceneSelectorModal:_s,DiceRoll:Xs,DXCombo:N},setup(){return{logStore:V()}},data(){return{autoPlayTimer:null,typingSpeed:50,showHandout:!1,currentHandout:null,showThemeSettings:!1,showSaveLoadModal:!1,saveLoadMode:"save",showSceneSelector:!1,showDiceOverlay:!1,currentDiceRolls:[],diceCharacterName:"",diceCharacterColor:"#ffffff",diceOverlayTimer:null,showComboOverlay:!1,currentDXCombos:[],comboCharacterName:"",comboCharacterColor:"#ffffff",comboOverlayTimer:null,previousSceneIndex:0,showSceneDescription:!1,sceneDescriptionData:null,sceneDescriptionTimer:null}},watch:{"logStore.playback.currentSceneIndex"(s,e){s!==e&&this.onSceneChange()}},computed:{logTitle(){return this.logStore.vnData.title||"Î°úÍ∑∏ ÌîåÎ†àÏù¥Ïñ¥"},currentScene(){const s=this.logStore.vnData.scenes,e=this.logStore.playback.currentSceneIndex;return s[e]||null},currentStep(){return this.logStore.currentStep},hasNextStep(){return this.logStore.hasNextStep},hasPreviousStep(){return this.logStore.hasPreviousStep},autoPlayEnabled(){return this.logStore.playback.autoPlayEnabled},currentScene(){const s=this.logStore.vnData.scenes,e=this.logStore.playback.currentSceneIndex;return s[e]||null},currentStepNumber(){var r;let s=0;const e=this.logStore.vnData.scenes,l=this.logStore.playback.currentSceneIndex,y=this.logStore.playback.currentStepIndex;for(let n=0;n<l;n++)s+=((r=e[n])==null?void 0:r.steps.length)||0;return s+=y+1,s},totalSteps(){return this.logStore.vnData.scenes.reduce((s,e)=>s+e.steps.length,0)},currentSceneName(){const s=this.logStore.currentScene;return(s==null?void 0:s.name)||""}},methods:{getCharacterName(s){return s.type==="system"?s.character.name||"ÏãúÏä§ÌÖú":s.type==="narrator"?"":s.character.name},handleAdvance(){this.hasNextStep?this.nextStep():this.autoPlayEnabled&&this.logStore.toggleAutoPlay()},handleTypingComplete(){},goHome(){this.stopAutoPlay(),this.$router.push("/")},openSettings(){this.showThemeSettings=!0},closeSettings(){this.showThemeSettings=!1},handleThemeSave(s){},openSceneSelector(){this.showSceneSelector=!0},closeSceneSelector(){this.showSceneSelector=!1},handleGoToStep(s,e){const l=this.logStore.playback.currentSceneIndex;this.logStore.goToStep(s,e),l!==s&&this.onSceneChange(),this.closeSceneSelector(),this.showOverlaysIfPresent()},openSaveModal(){this.saveLoadMode="save",this.showSaveLoadModal=!0},openLoadModal(){this.saveLoadMode="load",this.showSaveLoadModal=!0},closeSaveLoadModal(){this.showSaveLoadModal=!1},handleSave(s){this.logStore.saveProgress(s)},handleLoad(s){this.logStore.loadProgress(s)},openHandout(s){this.currentHandout=s,this.showHandout=!0},closeHandout(){this.showHandout=!1,this.currentHandout=null},onSceneChange(){this.showDiceOverlay=!1,this.showComboOverlay=!1,this.showHandout=!1,this.currentHandout=null,this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),this.displaySceneDescriptionIfPresent()},displaySceneDescriptionIfPresent(){if(!this.currentScene)return;const s=this.currentScene.steps[0];s&&s.isSceneDescription&&(this.sceneDescriptionData={number:s.sceneNumber,title:s.sceneTitle,pcs:s.scenePCs,description:s.sceneDescription,fullText:s.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance())},closeSceneDescription(){this.showSceneDescription=!1,this.stopSceneDescriptionAutoAdvance()},startSceneDescriptionAutoAdvance(){this.stopSceneDescriptionAutoAdvance(),this.sceneDescriptionTimer=setTimeout(()=>{this.closeSceneDescription(),this.hasNextStep?this.nextStep():this.autoPlayEnabled&&this.logStore.toggleAutoPlay()},3e3)},stopSceneDescriptionAutoAdvance(){this.sceneDescriptionTimer&&(clearTimeout(this.sceneDescriptionTimer),this.sceneDescriptionTimer=null)},nextStep(){const s=this.logStore.playback.currentSceneIndex;this.logStore.nextStep();const e=this.logStore.playback.currentSceneIndex;s!==e&&this.onSceneChange(),this.showOverlaysIfPresent(),this.logStore.playback.currentStepIndex%10===0&&this.logStore.autoSave()},previousStep(){const s=this.logStore.playback.currentSceneIndex;this.logStore.previousStep();const e=this.logStore.playback.currentSceneIndex;s!==e&&this.onSceneChange(),this.showOverlaysIfPresent()},showOverlaysIfPresent(){if(this.currentStep&&this.currentStep.isSceneDescription){this.sceneDescriptionData={number:this.currentStep.sceneNumber,title:this.currentStep.sceneTitle,pcs:this.currentStep.scenePCs,description:this.currentStep.sceneDescription,fullText:this.currentStep.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance();return}this.currentStep&&this.currentStep.diceRolls&&this.currentStep.diceRolls.length>0&&(this.currentDiceRolls=this.currentStep.diceRolls,this.diceCharacterName=this.getCharacterName(this.currentStep),this.diceCharacterColor=this.currentStep.character.color,this.showDiceOverlay=!0,this.autoPlayEnabled&&this.startDiceOverlayAutoClose()),this.currentStep&&this.currentStep.dxCombos&&this.currentStep.dxCombos.length>0&&(this.currentDXCombos=this.currentStep.dxCombos,this.comboCharacterName=this.getCharacterName(this.currentStep),this.comboCharacterColor=this.currentStep.character.color,this.showComboOverlay=!0,this.autoPlayEnabled&&this.startComboOverlayAutoClose())},closeDiceOverlay(){this.showDiceOverlay=!1,this.stopDiceOverlayAutoClose()},startDiceOverlayAutoClose(){this.stopDiceOverlayAutoClose(),this.diceOverlayTimer=setTimeout(()=>{this.closeDiceOverlay()},3e3)},stopDiceOverlayAutoClose(){this.diceOverlayTimer&&(clearTimeout(this.diceOverlayTimer),this.diceOverlayTimer=null)},closeComboOverlay(){this.showComboOverlay=!1,this.stopComboOverlayAutoClose()},startComboOverlayAutoClose(){this.stopComboOverlayAutoClose(),this.comboOverlayTimer=setTimeout(()=>{this.closeComboOverlay()},3e3)},stopComboOverlayAutoClose(){this.comboOverlayTimer&&(clearTimeout(this.comboOverlayTimer),this.comboOverlayTimer=null)},toggleAutoPlay(){this.logStore.toggleAutoPlay()},stopAutoPlay(){this.autoPlayTimer&&(clearInterval(this.autoPlayTimer),this.autoPlayTimer=null)},handleKeyPress(s){if(!(s.target.tagName==="INPUT"||s.target.tagName==="TEXTAREA"))switch(s.key){case" ":case"Enter":s.preventDefault(),this.handleAdvance();break;case"ArrowLeft":s.preventDefault(),this.hasPreviousStep&&this.previousStep();break;case"ArrowRight":s.preventDefault(),this.hasNextStep&&this.nextStep();break}}},mounted(){if(!this.logStore.rawLog){console.warn("Î°úÍ∑∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}window.addEventListener("keydown",this.handleKeyPress)},beforeUnmount(){this.stopAutoPlay(),this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),window.removeEventListener("keydown",this.handleKeyPress)}},Fs={class:"player-view"},Gs={class:"player-container"},Js={class:"player-header"},Qs={class:"log-title"},Ws={class:"header-buttons"},Ys={class:"player-stage"},Zs={key:1,class:"dialog-wrapper"},$s={key:1,class:"dialog-placeholder"},eo={class:"dice-overlay-hint"},to={class:"combo-overlay-header"},so={class:"combo-character-info"},oo={class:"dice-overlay-hint"},no={class:"scene-description-content"},lo={class:"scene-description-header"},io={class:"scene-number"},ao={class:"scene-title"},ro={key:0,class:"scene-pcs"},co={class:"scene-pcs-value"},uo={key:1,class:"scene-description-text"};function ho(s,e,l,y,r,n){const u=p("EmojiToIcon"),o=p("CharacterDisplay"),m=p("DialogBox"),v=p("DiceRoll"),C=p("DXCombo"),E=p("PlaybackControls"),A=p("SceneSelectorModal"),L=p("HandoutDisplay"),z=p("ThemeSettingsModal"),R=p("SaveLoadModal");return i(),a("div",Fs,[t("div",Gs,[t("div",Js,[t("button",{onClick:e[0]||(e[0]=(...f)=>n.goHome&&n.goHome(...f)),class:"back-button"},[d(u,{emoji:"üè†",size:20}),e[10]||(e[10]=_(" ÌôàÏúºÎ°ú ",-1))]),t("h2",Qs,c(n.logTitle),1),t("div",Ws,[t("button",{onClick:e[1]||(e[1]=(...f)=>n.openSceneSelector&&n.openSceneSelector(...f)),class:"header-button",title:"Ïî¨ ÏÑ†ÌÉù"},[d(u,{emoji:"üìë",size:20})]),t("button",{onClick:e[2]||(e[2]=(...f)=>n.openSaveModal&&n.openSaveModal(...f)),class:"header-button",title:"Ï†ÄÏû•"},[d(u,{emoji:"üíæ",size:20})]),t("button",{onClick:e[3]||(e[3]=(...f)=>n.openLoadModal&&n.openLoadModal(...f)),class:"header-button",title:"Î∂àÎü¨Ïò§Í∏∞"},[d(u,{emoji:"üìÇ",size:20})]),t("button",{onClick:e[4]||(e[4]=(...f)=>n.openSettings&&n.openSettings(...f)),class:"header-button",title:"ÏÑ§Ï†ï"},[d(u,{emoji:"‚öôÔ∏è",size:20})])])]),t("div",Ys,[!n.currentStep||!n.currentStep.isSceneDescription?(i(),x(o,{key:0,"current-step":n.currentStep,characters:y.logStore.vnData.characters,layout:"single"},null,8,["current-step","characters"])):h("",!0),!n.currentStep||!n.currentStep.isSceneDescription?(i(),a("div",Zs,[n.currentStep?(i(),x(m,{key:0,"character-name":n.getCharacterName(n.currentStep),"character-color":n.currentStep.character.color,text:n.currentStep.text,"status-changes":n.currentStep.statusChanges||[],"typing-speed":r.typingSpeed,"auto-advance":n.autoPlayEnabled,onAdvance:n.handleAdvance,onTypingComplete:n.handleTypingComplete},null,8,["character-name","character-color","text","status-changes","typing-speed","auto-advance","onAdvance","onTypingComplete"])):(i(),a("div",$s,[...e[11]||(e[11]=[t("p",null,"Î°úÍ∑∏Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...",-1)])]))])):h("",!0)]),d(g,{name:"dice-overlay"},{default:S(()=>[r.showDiceOverlay&&r.currentDiceRolls.length>0?(i(),a("div",{key:0,class:"dice-overlay",onClick:e[6]||(e[6]=(...f)=>n.closeDiceOverlay&&n.closeDiceOverlay(...f))},[t("div",{class:"dice-overlay-content",onClick:e[5]||(e[5]=I(()=>{},["stop"]))},[d(v,{"dice-rolls":r.currentDiceRolls,"character-name":r.diceCharacterName,"character-color":r.diceCharacterColor,animated:!0,"play-sound-effect":!1},null,8,["dice-rolls","character-name","character-color"]),t("div",eo,[d(u,{emoji:"üëÜ",size:14}),e[12]||(e[12]=t("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),d(g,{name:"dice-overlay"},{default:S(()=>[r.showComboOverlay&&r.currentDXCombos.length>0?(i(),a("div",{key:0,class:"dice-overlay",onClick:e[8]||(e[8]=(...f)=>n.closeComboOverlay&&n.closeComboOverlay(...f))},[t("div",{class:"dice-overlay-content",onClick:e[7]||(e[7]=I(()=>{},["stop"]))},[t("div",to,[t("div",so,[t("div",{class:"combo-character-name",style:P({color:r.comboCharacterColor})},c(r.comboCharacterName),5)])]),d(C,{dxCombos:r.currentDXCombos},null,8,["dxCombos"]),t("div",oo,[d(u,{emoji:"üëÜ",size:14}),e[13]||(e[13]=t("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),d(g,{name:"scene-description"},{default:S(()=>[r.showSceneDescription&&r.sceneDescriptionData?(i(),a("div",{key:0,class:"scene-description-overlay",onClick:e[9]||(e[9]=(...f)=>n.closeSceneDescription&&n.closeSceneDescription(...f))},[t("div",no,[t("div",lo,[t("span",io,"Ïî¨ "+c(r.sceneDescriptionData.number),1),t("span",ao,c(r.sceneDescriptionData.title),1)]),r.sceneDescriptionData.pcs?(i(),a("div",ro,[e[14]||(e[14]=t("span",{class:"scene-pcs-label"},"PC:",-1)),t("span",co,c(r.sceneDescriptionData.pcs),1)])):h("",!0),r.sceneDescriptionData.description?(i(),a("div",uo,c(r.sceneDescriptionData.description),1)):h("",!0),e[15]||(e[15]=t("div",{class:"scene-description-hint"},"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])):h("",!0)]),_:1}),d(E,{"current-step-number":n.currentStepNumber,"total-steps":n.totalSteps,"current-scene-name":n.currentSceneName,"has-previous-step":n.hasPreviousStep,"has-next-step":n.hasNextStep,"auto-play-enabled":n.autoPlayEnabled,"show-progress-bar":!0,"show-scene-selector":!0,onPrevious:n.previousStep,onNext:n.handleAdvance,onToggleAutoplay:n.toggleAutoPlay,onOpenSceneSelector:n.openSceneSelector},null,8,["current-step-number","total-steps","current-scene-name","has-previous-step","has-next-step","auto-play-enabled","onPrevious","onNext","onToggleAutoplay","onOpenSceneSelector"])]),d(A,{"is-visible":r.showSceneSelector,scenes:y.logStore.vnData.scenes,"current-scene-index":y.logStore.playback.currentSceneIndex,"current-step-index":y.logStore.playback.currentStepIndex,onClose:n.closeSceneSelector,onGoToStep:n.handleGoToStep},null,8,["is-visible","scenes","current-scene-index","current-step-index","onClose","onGoToStep"]),d(L,{handout:r.currentHandout,"is-visible":r.showHandout,onClose:n.closeHandout},null,8,["handout","is-visible","onClose"]),d(z,{"is-visible":r.showThemeSettings,onClose:n.closeSettings,onSave:n.handleThemeSave},null,8,["is-visible","onClose","onSave"]),d(R,{"is-visible":r.showSaveLoadModal,mode:r.saveLoadMode,onClose:n.closeSaveLoadModal,onSave:n.handleSave,onLoad:n.handleLoad},null,8,["is-visible","mode","onClose","onSave","onLoad"])])}const yo=k(qs,[["render",ho],["__scopeId","data-v-a61acf1d"]]);export{yo as default};
