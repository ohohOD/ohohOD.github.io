import{_ as k,c as n,f as u,F as f,m as C,r as _,o,n as v,a as i,d as h,t as l,g as w,l as P,w as g,T,q as I,e as x,i as S,v as A}from"./index-DETrj3Kh.js";const j={name:"StatusChange",props:{statusChanges:{type:Array,default:()=>[]}},methods:{getStatusIcon(s){const e=s.toLowerCase();return e.includes("Ïπ®Ïãù")?"‚ö°":e.includes("hp")||e.includes("ÏÉùÎ™Ö")||e.includes("Ï≤¥Î†•")?"‚ù§Ô∏è":e.includes("mp")||e.includes("ÎßàÎÇò")||e.includes("ÎßàÎ†•")?"üíô":e.includes("san")||e.includes("Ï†ïÏã†")||e.includes("Ïù¥ÏÑ±")?"üß†":"üìä"}}},N={key:0,class:"status-change-container"},D={class:"status-icon"},E={class:"status-info"},$={class:"character-name"},V={class:"status-name"},R={class:"status-values"},B={class:"old-value"},H={class:"new-value"},z={key:1,class:"new-value"},M={key:2,class:"old-value"};function O(s,e,a,p,c,r){const d=_("EmojiToIcon");return a.statusChanges&&a.statusChanges.length>0?(o(),n("div",N,[(o(!0),n(f,null,C(a.statusChanges,(t,m)=>(o(),n("div",{key:m,class:v(["status-change",{"is-positive":t.delta>0,"is-negative":t.delta<0}])},[i("div",D,[h(d,{emoji:r.getStatusIcon(t.statusName),size:16},null,8,["emoji"])]),i("div",E,[i("span",$,l(t.characterName),1),i("span",V,l(t.statusName),1)]),i("div",R,[t.oldValue!==null&&t.newValue!==null?(o(),n(f,{key:0},[i("span",B,l(t.oldValue),1),e[0]||(e[0]=i("span",{class:"arrow"},"‚Üí",-1)),i("span",H,l(t.newValue),1)],64)):t.oldValue===null&&t.newValue!==null?(o(),n("span",z,l(t.newValue),1)):t.oldValue!==null&&t.newValue===null?(o(),n("span",M,l(t.oldValue),1)):u("",!0),t.delta!==0?(o(),n("span",{key:3,class:v(["delta",{"delta-positive":t.delta>0,"delta-negative":t.delta<0}])},l(t.delta>0?"+":"")+l(t.delta),3)):u("",!0)])],2))),128))])):u("",!0)}const U=k(j,[["render",O],["__scopeId","data-v-820fc90f"]]),L={name:"DXCombo",props:{dxCombos:{type:Array,default:()=>[]}},methods:{decodeHtml(s){if(!s)return s;const e=document.createElement("textarea");e.innerHTML=s;let a=e.value;return a=a.replace(/\\n/g,`
`),a=a.replace(/\\t/g,"	"),a=a.replace(/\\r/g,"\r"),a}}},Y={key:0,class:"dx-combo-container"},q={class:"combo-header"},G={class:"combo-icon"},X={class:"combo-label"},F={key:0,class:"combo-name"},J={key:1,class:"erosion-cost"},K={class:"combo-effects"},Q={class:"effect-name"},W={class:"effect-level"},Z={key:0,class:"combo-info-row"},ee={key:0,class:"info-item"},te={class:"info-value"},se={key:1,class:"info-item"},ie={class:"info-value"},ae={key:2,class:"info-item"},oe={class:"info-value"},ne={key:3,class:"info-item"},le={class:"info-value"},re={key:1,class:"combo-stats-row"},ue={key:0,class:"info-item"},de={class:"info-value"},ce={key:1,class:"info-item"},he={class:"info-value"},me={key:2,class:"info-item"},ye={class:"info-value"},pe={key:3,class:"info-item"},fe={class:"info-value"},ge={key:2,class:"combo-description"},_e={key:3,class:"combo-dice-roll"},ve={class:"dice-roll-header"},be={class:"dice-roll-content"},Te={class:"dice-formula"},Ce={class:"dice-detail"},ke={class:"dice-result"};function Pe(s,e,a,p,c,r){const d=_("EmojiToIcon");return a.dxCombos&&a.dxCombos.length>0?(o(),n("div",Y,[(o(!0),n(f,null,C(a.dxCombos,(t,m)=>(o(),n("div",{key:m,class:"dx-combo"},[i("div",q,[i("div",G,[h(d,{emoji:"‚ö°",size:16})]),i("span",X,l(t.isSingleEffect?"Ïù¥ÌéôÌä∏":"ÏΩ§Î≥¥"),1),t.comboName?(o(),n("span",F,l(r.decodeHtml(t.comboName)),1)):u("",!0),t.erosionCost?(o(),n("span",J,l(t.erosionCost)+"‚Üë",1)):u("",!0)]),i("div",K,[(o(!0),n(f,null,C(t.effects,(y,b)=>(o(),n("div",{key:b,class:"combo-effect"},[i("span",Q,l(r.decodeHtml(y.name)),1),i("span",W,"Lv."+l(y.level),1)]))),128))]),t.timing||t.difficulty||t.target||t.range?(o(),n("div",Z,[t.timing?(o(),n("span",ee,[e[0]||(e[0]=i("span",{class:"info-label"},"ÌÉÄÏù¥Î∞ç:",-1)),i("span",te,l(r.decodeHtml(t.timing)),1)])):u("",!0),t.difficulty?(o(),n("span",se,[e[1]||(e[1]=i("span",{class:"info-label"},"ÎÇúÏù¥ÎèÑ:",-1)),i("span",ie,l(r.decodeHtml(t.difficulty)),1)])):u("",!0),t.target?(o(),n("span",ae,[e[2]||(e[2]=i("span",{class:"info-label"},"ÎåÄÏÉÅ:",-1)),i("span",oe,l(r.decodeHtml(t.target)),1)])):u("",!0),t.range?(o(),n("span",ne,[e[3]||(e[3]=i("span",{class:"info-label"},"ÏÇ¨Í±∞Î¶¨:",-1)),i("span",le,l(r.decodeHtml(t.range)),1)])):u("",!0)])):u("",!0),t.dice||t.critical||t.attack||t.erosion?(o(),n("div",re,[t.dice?(o(),n("span",ue,[e[4]||(e[4]=i("span",{class:"info-label"},"Îã§Ïù¥Ïä§:",-1)),i("span",de,l(r.decodeHtml(t.dice)),1)])):u("",!0),t.critical?(o(),n("span",ce,[e[5]||(e[5]=i("span",{class:"info-label"},"ÌÅ¨Î¶¨Ïπò:",-1)),i("span",he,l(r.decodeHtml(t.critical)),1)])):u("",!0),t.attack?(o(),n("span",me,[e[6]||(e[6]=i("span",{class:"info-label"},"Í≥µÍ≤©Î†•:",-1)),i("span",ye,l(r.decodeHtml(t.attack)),1)])):u("",!0),t.erosion?(o(),n("span",pe,[e[7]||(e[7]=i("span",{class:"info-label"},"Ïπ®Ïãù:",-1)),i("span",fe,l(r.decodeHtml(t.erosion)),1)])):u("",!0)])):u("",!0),t.description?(o(),n("div",ge,l(r.decodeHtml(t.description)),1)):u("",!0),t.diceRoll?(o(),n("div",_e,[i("div",ve,[h(d,{emoji:"üé≤",size:14}),e[8]||(e[8]=i("span",{class:"dice-roll-label"},"ÌåêÏ†ï",-1))]),i("div",be,[i("span",Te,l(t.diceRoll.formula),1),e[9]||(e[9]=i("span",{class:"dice-separator"},"‚Üí",-1)),i("span",Ce,l(t.diceRoll.diceRolls),1),e[10]||(e[10]=i("span",{class:"dice-separator"},"‚Üí",-1)),i("span",ke,l(t.diceRoll.result),1)])])):u("",!0)]))),128))])):u("",!0)}const we=k(L,[["render",Pe],["__scopeId","data-v-73107c03"]]),Ie={name:"Illustration",props:{illustrations:{type:Array,default:()=>[]}},data(){return{failedImages:new Set}},methods:{handleImageError(s){this.failedImages.add(s),this.$forceUpdate()},handleImageLoad(){}}},xe={key:0,class:"illustration-container"},Se=["src","alt","onError"];function Ae(s,e,a,p,c,r){return a.illustrations&&a.illustrations.length>0?(o(),n("div",xe,[(o(!0),n(f,null,C(a.illustrations,(d,t)=>(o(),n("div",{key:t,class:"illustration-item"},[c.failedImages.has(t)?u("",!0):(o(),n("img",{key:0,src:d.url,alt:d.alt||"ÏÇΩÌôî",class:"illustration-image",onError:m=>r.handleImageError(t),onLoad:e[0]||(e[0]=(...m)=>r.handleImageLoad&&r.handleImageLoad(...m))},null,40,Se))]))),128))])):u("",!0)}const je=k(Ie,[["render",Ae],["__scopeId","data-v-c3f90253"]]),Ne={name:"DialogBox",components:{StatusChange:U,DXCombo:we,Illustration:je},props:{stepType:{type:String,default:"dialogue",validator:s=>["dialogue","system","narrator","scene-description"].includes(s)},characterName:{type:String,default:""},characterColor:{type:String,default:"#333333"},text:{type:String,required:!0},statusChanges:{type:Array,default:()=>[]},dxCombos:{type:Array,default:()=>[]},illustrations:{type:Array,default:()=>[]},typingSpeed:{type:Number,default:50},autoPlaySpeed:{type:Number,default:1},autoAdvance:{type:Boolean,default:!1},hasOverlay:{type:Boolean,default:!1}},data(){return{displayedText:"",isTyping:!1,isComplete:!1,typingTimer:null,autoAdvanceTimer:null,currentIndex:0,originalHtmlText:null}},computed:{decodedText(){return this.decodeHtmlEntities(this.displayedText)}},watch:{text:{immediate:!0,handler(s){console.log("[DialogBox] text Î≥ÄÍ≤Ω, ÌÉÄÏù¥Ìïë ÏãúÏûë"),this.startTyping(s)}},autoAdvance(s,e){if(console.log("[DialogBox] autoAdvance Î≥ÄÍ≤Ω:",{old:e,new:s,isComplete:this.isComplete,hasOverlay:this.hasOverlay}),!s&&e){console.log("[DialogBox] ÏûêÎèôÏû¨ÏÉù Ï∑®ÏÜå - ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨"),this.stopAutoAdvance();return}s&&!e&&this.isComplete&&!this.hasOverlay&&(this.stopAutoAdvance(),this.autoAdvanceTimer=setTimeout(()=>{this.autoAdvance&&this.isComplete&&!this.hasOverlay&&(console.log("[DialogBox] autoAdvance watchÏóêÏÑú ÏßÑÌñâ"),this.autoAdvanceTimer=null,this.$emit("advance"))},1500))}},methods:{decodeHtmlEntities(s){if(!s)return s;const e={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&#39;":"'","&apos;":"'"};return s.replace(/&[a-z]+;|&#\d+;/gi,a=>e[a]||a)},startTyping(s){if(this.stopTyping(),this.stopAutoAdvance(),this.displayedText="",this.currentIndex=0,this.isTyping=!0,this.isComplete=!1,!s||s.length===0){this.displayedText=s,this.completeTyping(!0);return}if(s.includes("roll20-dx3-template")||s.includes("sheet-rolltemplate-")){this.displayedText=s,this.completeTyping(!0);return}if(this.hasHtmlTags(s)){const e=this.extractPlainText(s);this.originalHtmlText=s,this.typeNextCharacter(e,s);return}this.originalHtmlText=null,this.typeNextCharacter(s,s)},hasHtmlTags(s){return/<[^>]+>/i.test(s)},extractPlainText(s){const e=document.createElement("div");return e.innerHTML=s,e.textContent||e.innerText||""},typeNextCharacter(s,e){this.currentIndex<s.length?(this.originalHtmlText?this.displayedText=this.reconstructHtmlUpToIndex(this.originalHtmlText,this.currentIndex):this.displayedText+=s[this.currentIndex],this.currentIndex++,this.typingTimer=setTimeout(()=>{this.typeNextCharacter(s,e)},this.typingSpeed/this.autoPlaySpeed)):(this.displayedText=e,this.completeTyping())},reconstructHtmlUpToIndex(s,e){const a=document.createElement("div");a.innerHTML=s;let p=0,c="";const r=d=>{if(p>=e)return!1;if(d.nodeType===Node.TEXT_NODE){const t=d.textContent,m=e-p;if(p+t.length<=e)c+=t,p+=t.length;else return c+=t.substring(0,m),p=e,!1}else if(d.nodeType===Node.ELEMENT_NODE){const t=d.tagName.toLowerCase(),m=Array.from(d.attributes).map(y=>`${y.name}="${y.value}"`).join(" ");c+=`<${t}${m?" "+m:""}>`;for(let y of d.childNodes)if(!r(y))return!1;c+=`</${t}>`}return!0};for(let d of a.childNodes)if(!r(d))break;return c},completeTyping(s=!1){if(this.isTyping=!1,this.isComplete=!0,this.$emit("typing-complete"),console.log("[DialogBox] completeTyping:",{autoAdvance:this.autoAdvance,hasOverlay:this.hasOverlay,isEmpty:s,textLength:this.text.length}),this.autoAdvance&&!this.hasOverlay){let e=1500;s&&(e=3e3);const a=this.text.length*this.typingSpeed/this.autoPlaySpeed,c=a+e/this.autoPlaySpeed<3e3/this.autoPlaySpeed?3e3/this.autoPlaySpeed-a:e/this.autoPlaySpeed;console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ ÌÉÄÏù¥Î®∏ ÏãúÏûë:",Math.max(c,e),"ms"),this.autoAdvanceTimer=setTimeout(()=>{this.autoAdvance&&!this.hasOverlay?(console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ Ïã§Ìñâ"),this.autoAdvanceTimer=null,this.$emit("advance")):(console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ Ï∑®ÏÜåÎê® (autoAdvance:",this.autoAdvance,", hasOverlay:",this.hasOverlay,")"),this.autoAdvanceTimer=null)},Math.max(c,e))}},handleClick(){this.skipTyping()},skipTyping(){this.isTyping?(this.stopTyping(),this.displayedText=this.text,this.completeTyping()):this.isComplete&&this.$emit("advance")},stopTyping(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null)},stopAutoAdvance(){this.autoAdvanceTimer&&(clearTimeout(this.autoAdvanceTimer),this.autoAdvanceTimer=null)}},beforeUnmount(){this.stopTyping(),this.stopAutoAdvance()}},De=["innerHTML"],Ee={key:0,class:"continue-indicator"};function $e(s,e,a,p,c,r){const d=_("EmojiToIcon"),t=_("Illustration"),m=_("DXCombo"),y=_("StatusChange");return o(),n("div",{class:v(["dialog-box",{"dialog-system":a.stepType==="system","dialog-narrator":a.stepType==="narrator","dialog-scene-description":a.stepType==="scene-description"}]),style:P({borderColor:a.characterColor}),onClick:e[0]||(e[0]=(...b)=>r.handleClick&&r.handleClick(...b))},[a.characterName?(o(),n("div",{key:0,class:"character-name",style:P({color:a.characterColor})},l(a.characterName),5)):u("",!0),a.text&&a.text.trim().length>0?(o(),n("div",{key:1,class:v(["dialog-text",{"is-typing":c.isTyping,"is-narration":!a.characterName}])},[i("p",{class:"text-content",innerHTML:r.decodedText},null,8,De),!c.isTyping&&!c.isComplete?(o(),n("div",Ee,[h(d,{emoji:"‚ñº",size:12})])):u("",!0)],2)):u("",!0),a.illustrations&&a.illustrations.length>0?(o(),w(t,{key:2,illustrations:a.illustrations},null,8,["illustrations"])):u("",!0),a.dxCombos&&a.dxCombos.length>0?(o(),w(m,{key:3,dxCombos:a.dxCombos},null,8,["dxCombos"])):u("",!0),a.statusChanges&&a.statusChanges.length>0?(o(),w(y,{key:4,statusChanges:a.statusChanges},null,8,["statusChanges"])):u("",!0)],6)}const fs=k(Ne,[["render",$e],["__scopeId","data-v-23bf432c"]]),Ve={name:"CharacterDisplay",props:{currentStep:{type:Object,default:null},characters:{type:Object,default:()=>({})},maxVisibleCharacters:{type:Number,default:3},layout:{type:String,default:"single",validator:s=>["single","left","center","right"].includes(s)}},data(){return{activeCharacterIds:[],failedImageIds:new Set}},computed:{speakingCharacterId(){var s;return!this.currentStep||this.currentStep.type==="system"||this.currentStep.type==="narrator"?null:((s=this.currentStep.character)==null?void 0:s.id)||null},currentCharacter(){return this.currentStep?this.getCurrentCharacter():null}},methods:{getCurrentCharacter(){if(!this.currentStep||!this.currentStep.character)return null;const s=this.currentStep.character;return{id:s.id||s.name,name:s.name,avatarUrl:s.avatarUrl,color:s.color,emotion:s.emotion||"default"}},getCharacterStyle(s){const e={};return s.color&&s.id===this.speakingCharacterId&&(e.borderColor=s.color),e},handleImageError(s){console.warn(`Ï∫êÎ¶≠ÌÑ∞ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${s.name}`),this.failedImageIds.add(s.id),this.$forceUpdate()}},watch:{currentStep:{handler(s){if(!s)return;const e=this.speakingCharacterId;e&&!this.activeCharacterIds.includes(e)&&(this.activeCharacterIds.push(e),this.activeCharacterIds.length>this.maxVisibleCharacters&&this.activeCharacterIds.shift())},immediate:!0}}},Re={class:"character-display"},Be={class:"character-container"},He={class:"character-avatar"},ze=["src","alt"];function Me(s,e,a,p,c,r){return o(),n("div",Re,[i("div",Be,[h(T,{name:"character-fade",mode:"out-in"},{default:g(()=>[r.currentCharacter&&r.currentCharacter.avatarUrl&&!c.failedImageIds.has(r.currentCharacter.id)?(o(),n("div",{key:r.currentCharacter.id,class:v(["character-wrapper",{"is-speaking":r.currentCharacter.id===r.speakingCharacterId}]),style:P(r.getCharacterStyle(r.currentCharacter))},[i("div",He,[i("img",{src:r.currentCharacter.avatarUrl,alt:r.currentCharacter.name,onError:e[0]||(e[0]=d=>r.handleImageError(r.currentCharacter))},null,40,ze)])],6)):u("",!0)]),_:1})])])}const gs=k(Ve,[["render",Me],["__scopeId","data-v-a57cc8bc"]]),Oe={name:"PlaybackControls",data(){return{speedOptions:[.5,1,1.2,2]}},props:{currentStepNumber:{type:Number,required:!0},totalSteps:{type:Number,required:!0},currentSceneName:{type:String,default:""},hasPreviousStep:{type:Boolean,default:!1},hasNextStep:{type:Boolean,default:!0},autoPlayEnabled:{type:Boolean,default:!1},autoPlaySpeed:{type:Number,default:1},showProgressBar:{type:Boolean,default:!0},showSceneSelector:{type:Boolean,default:!1}},computed:{progressPercentage(){return this.totalSteps===0?0:this.currentStepNumber/this.totalSteps*100}},methods:{handleSceneSelectorClick(){console.log("[PlaybackControls] Ïî¨ ÏÑ†ÌÉù Î≤ÑÌäº ÌÅ¥Î¶≠Îê®"),console.log("[PlaybackControls] showSceneSelector prop:",this.showSceneSelector),this.$emit("open-scene-selector"),console.log("[PlaybackControls] open-scene-selector Ïù¥Î≤§Ìä∏ emit ÏôÑÎ£å")}}},Ue={class:"playback-controls"},Le={key:0,class:"progress-bar"},Ye={class:"progress-info"},qe={class:"scene-name"},Ge={class:"step-counter"},Xe={class:"controls-buttons"},Fe=["disabled"],Je=["disabled"],Ke={class:"speed-control"},Qe=["onClick","title"],We={key:1,class:"step-counter"};function Ze(s,e,a,p,c,r){const d=_("EmojiToIcon");return o(),n("div",Ue,[a.showProgressBar?(o(),n("div",Le,[i("div",{class:"progress-fill",style:P({width:r.progressPercentage+"%"})},null,4),i("div",Ye,[i("span",qe,l(a.currentSceneName),1),i("span",Ge,l(a.currentStepNumber)+" / "+l(a.totalSteps),1)])])):u("",!0),i("div",Xe,[i("button",{class:"control-button",onClick:e[0]||(e[0]=t=>s.$emit("previous")),disabled:!a.hasPreviousStep,title:"Ïù¥Ï†Ñ (‚Üê)"},[h(d,{emoji:"‚èÆÔ∏è",size:20})],8,Fe),i("button",{class:"control-button primary",onClick:e[1]||(e[1]=t=>s.$emit("next")),disabled:!a.hasNextStep,title:"Îã§Ïùå (‚Üí / Space)"},[h(d,{emoji:"‚ñ∂Ô∏è",size:24})],8,Je),i("button",{class:v(["control-button",{"is-active":a.autoPlayEnabled}]),onClick:e[2]||(e[2]=t=>s.$emit("toggle-autoplay")),title:"ÏûêÎèô Ïû¨ÏÉù"},[h(d,{emoji:a.autoPlayEnabled?"‚è∏Ô∏è":"‚èØÔ∏è",size:20},null,8,["emoji"])],2),i("div",Ke,[(o(!0),n(f,null,C(c.speedOptions,t=>(o(),n("button",{key:t,class:v(["speed-button",{"is-active":a.autoPlaySpeed===t}]),onClick:m=>s.$emit("change-speed",t),title:t+"Î∞∞ÏÜç"},l(t)+"x ",11,Qe))),128))]),a.showSceneSelector?(o(),n("button",{key:0,class:"control-button",onClick:e[3]||(e[3]=(...t)=>r.handleSceneSelectorClick&&r.handleSceneSelectorClick(...t)),title:"Ïî¨ ÏÑ†ÌÉù"},[h(d,{emoji:"üìë",size:20})])):u("",!0),a.showProgressBar?u("",!0):(o(),n("div",We,l(a.currentStepNumber)+" / "+l(a.totalSteps),1))])])}const _s=k(Oe,[["render",Ze],["__scopeId","data-v-229aeb67"]]),et={name:"DiceRoll",props:{diceRolls:{type:Array,default:()=>[]},characterName:{type:String,default:""},characterColor:{type:String,default:"#ffffff"},animated:{type:Boolean,default:!0},animationDuration:{type:Number,default:800},playSoundEffect:{type:Boolean,default:!1}},data(){return{processedRolls:[],audioContext:null}},watch:{diceRolls:{immediate:!0,handler(s){this.processRolls(s)}}},methods:{processRolls(s){if(!s||s.length===0){this.processedRolls=[];return}this.processedRolls=s.map((e,a)=>({...e,isAnimating:!1,showResult:e.type==="choice"||e.type==="judgement",showDetails:!1})),this.animated?this.processedRolls.forEach((e,a)=>{e.type==="choice"||e.type==="judgement"||setTimeout(()=>{this.animateRoll(a)},a*200)}):this.processedRolls.forEach(e=>{e.showResult=!0})},animateRoll(s){const e=this.processedRolls[s];e&&(e.isAnimating=!0,this.playSoundEffect&&this.playDiceSound(),setTimeout(()=>{e.isAnimating=!1,e.showResult=!0},this.animationDuration))},toggleDetails(s){const e=this.processedRolls[s];e&&(e.showDetails=!e.showDetails)},playDiceSound(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));const s=this.audioContext,e=s.createOscillator(),a=s.createGain();e.connect(a),a.connect(s.destination),e.type="square",e.frequency.setValueAtTime(200,s.currentTime),e.frequency.exponentialRampToValueAtTime(100,s.currentTime+.1),a.gain.setValueAtTime(.1,s.currentTime),a.gain.exponentialRampToValueAtTime(.01,s.currentTime+.1),e.start(s.currentTime),e.stop(s.currentTime+.1)}}},tt={class:"dice-roll-container"},st={class:"dice-icon-wrapper"},it={class:"dice-result choice-result"},at=["onClick","title"],ot={key:0,class:"dice-details choice-options"},nt={key:1,class:"ougi-full-wrapper"},lt={class:"ougi-header"},rt={class:"dice-icon-wrapper"},ut={class:"ougi-info"},dt={class:"ougi-title-line"},ct={class:"ougi-name"},ht={class:"ougi-main-name"},mt={class:"ougi-info-table"},yt={key:0},pt={key:0},ft={class:"ougi-presentation"},gt={key:1},_t={key:2},vt={class:"ougi-ninpou"},bt={class:"shinobigami-full-wrapper"},Tt={class:"shinobigami-header"},Ct={class:"dice-icon-wrapper"},kt={class:"shinobigami-info"},Pt={class:"shinobigami-main"},wt={class:"dice-formula"},It={class:"shinobigami-result-line"},xt={key:1,class:"dice-placeholder"},St={class:"shinobigami-judgement"},At={key:0,class:"shinobigami-info-table"},jt={key:0},Nt={key:1},Dt={key:2},Et={key:3},$t={key:4},Vt=["onClick","title"],Rt={key:0,class:"dice-details shinobigami-details"},Bt={class:"shinobigami-formula"},Ht={class:"shinobigami-rolls"},zt={key:0},Mt={key:1},Ot={class:"judgement-header"},Ut={class:"dice-icon-wrapper"},Lt={class:"judgement-info"},Yt={class:"judgement-main"},qt={class:"dice-formula"},Gt={class:"judgement-result-line"},Xt={key:1,class:"dice-placeholder"},Ft={class:"judgement-text"},Jt=["onClick","title"],Kt={key:0,class:"dice-details"},Qt={class:"dice-formula"},Wt={key:1,class:"dice-placeholder"},Zt={key:0,class:"dice-details-wrapper"},es=["onClick","title"],ts={key:0,class:"dice-details"};function ss(s,e,a,p,c,r){const d=_("EmojiToIcon");return o(),n("div",tt,[h(I,{name:"dice-list",tag:"div",class:"dice-rolls"},{default:g(()=>[(o(!0),n(f,null,C(c.processedRolls,(t,m)=>(o(),n("div",{key:`${t.formula}-${m}`,class:v(["dice-roll",[{"is-animating":t.isAnimating},`roll-type-${t.type}`]])},[t.type==="choice"?(o(),n(f,{key:0},[i("div",st,[h(d,{emoji:"üéØ",size:18,class:"dice-icon"})]),e[0]||(e[0]=i("span",{class:"dice-formula"},"ÏÑ†ÌÉù",-1)),e[1]||(e[1]=i("span",{class:"dice-arrow"},"‚Üí",-1)),i("span",it,l(t.result),1),i("button",{class:"details-toggle",onClick:y=>r.toggleDetails(m),title:t.showDetails?"ÏòµÏÖò Ïà®Í∏∞Í∏∞":"ÏòµÏÖò Î≥¥Í∏∞"},[h(d,{emoji:t.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,at),h(T,{name:"details-expand"},{default:g(()=>[t.showDetails?(o(),n("div",ot,[(o(!0),n(f,null,C(t.options,(y,b)=>(o(),n("span",{key:b,class:"choice-option"},l(y),1))),128))])):u("",!0)]),_:2},1024)],64)):t.type==="ougi"?(o(),n("div",nt,[i("div",lt,[i("div",rt,[h(d,{emoji:"üåü",size:20,class:"dice-icon"})]),i("div",ut,[i("div",dt,[i("span",{class:"ougi-character",style:P({color:a.characterColor})},l(a.characterName),5),i("span",ct,"„ÄêÂ••Áæ©: "+l(t.ougiType)+"„Äë",1),i("span",ht,l(t.ougiName),1)]),i("table",mt,[i("tbody",null,[i("tr",null,[e[2]||(e[2]=i("th",null,"ÏßÄÏ†ï ÌäπÍ∏∞",-1)),i("td",null,[(o(!0),n(f,null,C(t.skills,(y,b)=>(o(),n("span",{key:b,class:"ougi-skill"},[x(" „Ää"+l(y)+"„Äã",1),b<t.skills.length-1?(o(),n("span",yt,", ")):u("",!0)]))),128))])]),t.presentation?(o(),n("tr",pt,[e[3]||(e[3]=i("th",null,"Ïó∞Ï∂ú",-1)),i("td",ft,l(t.presentation),1)])):u("",!0),t.ougiEffect?(o(),n("tr",gt,[e[4]||(e[4]=i("th",null,"Ìö®Í≥º",-1)),i("td",null,l(t.ougiEffect),1)])):u("",!0),t.ninpouInfo?(o(),n("tr",_t,[e[5]||(e[5]=i("th",null,"Ïù∏Î≤ï",-1)),i("td",vt,l(t.ninpouInfo),1)])):u("",!0)])])])])])):t.type==="shinobigami"?(o(),n(f,{key:2},[i("div",bt,[i("div",Tt,[i("div",Ct,[h(d,{emoji:"‚öîÔ∏è",size:18,class:"dice-icon"})]),i("div",kt,[i("div",Pt,[i("span",{class:"shinobigami-character",style:P({color:a.characterColor})},l(a.characterName),5),i("span",wt,"„Äê"+l(t.checkName)+"„Äë",1)]),i("div",It,[e[6]||(e[6]=i("span",{class:"dice-arrow"},"‚Üí",-1)),h(T,{name:"dice-result",mode:"out-in"},{default:g(()=>[t.showResult?(o(),n("span",{key:t.result,class:"dice-result"},l(t.result),1)):(o(),n("span",xt,"???"))]),_:2},1024),i("span",St,l(t.judgement),1)]),t.additionalInfo?(o(),n("table",At,[i("tbody",null,[t.additionalInfo.type?(o(),n("tr",jt,[e[7]||(e[7]=i("th",null,"ÌÉÄÏûÖ",-1)),i("td",null,l(t.additionalInfo.type),1)])):u("",!0),t.additionalInfo.range?(o(),n("tr",Nt,[e[8]||(e[8]=i("th",null,"Í∞ÑÍ≤©",-1)),i("td",null,l(t.additionalInfo.range.replace("Í∞ÑÍ≤©:","").trim()),1)])):u("",!0),t.additionalInfo.cost?(o(),n("tr",Dt,[e[9]||(e[9]=i("th",null,"ÏΩîÏä§Ìä∏",-1)),i("td",null,l(t.additionalInfo.cost.replace("ÏΩîÏä§Ìä∏:","").trim()),1)])):u("",!0),t.additionalInfo.skill?(o(),n("tr",Et,[e[10]||(e[10]=i("th",null,"ÌäπÍ∏∞",-1)),i("td",null,l(t.additionalInfo.skill),1)])):u("",!0),t.additionalInfo.description?(o(),n("tr",$t,[e[11]||(e[11]=i("th",null,"ÏÑ§Î™Ö",-1)),i("td",null,l(t.additionalInfo.description),1)])):u("",!0)])])):u("",!0)])])]),i("button",{class:"details-toggle",onClick:y=>r.toggleDetails(m),title:t.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[h(d,{emoji:t.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Vt),h(T,{name:"details-expand"},{default:g(()=>[t.showDetails?(o(),n("div",Rt,[i("div",Bt,l(t.command),1),i("div",Ht,[t.diceExpression?(o(),n("span",zt,"Ï£ºÏÇ¨ÏúÑ: "+l(t.diceExpression),1)):(o(),n("span",Mt,"Í∞úÎ≥Ñ Ï£ºÏÇ¨ÏúÑ: "+l(t.diceRolls),1))])])):u("",!0)]),_:2},1024)],64)):t.type==="judgement"?(o(),n(f,{key:3},[i("div",Ot,[i("div",Ut,[h(d,{emoji:"‚öñÔ∏è",size:18,class:"dice-icon"})]),i("div",Lt,[i("div",Yt,[i("span",{class:"judgement-character",style:P({color:a.characterColor})},l(a.characterName),5),i("span",qt,l(t.checkName),1)]),i("div",Gt,[e[12]||(e[12]=i("span",{class:"dice-arrow"},"‚Üí",-1)),h(T,{name:"dice-result",mode:"out-in"},{default:g(()=>[t.showResult?(o(),n("span",{key:t.result,class:"dice-result"},l(t.result),1)):(o(),n("span",Xt,"???"))]),_:2},1024),i("span",Ft,l(t.judgement),1)])])]),i("button",{class:"details-toggle",onClick:y=>r.toggleDetails(m),title:t.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[h(d,{emoji:t.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Jt),h(T,{name:"details-expand"},{default:g(()=>[t.showDetails?(o(),n("div",Kt,l(t.formula),1)):u("",!0)]),_:2},1024)],64)):(o(),n(f,{key:4},[i("div",{class:v(["dice-icon-wrapper",{"is-rolling":t.isAnimating}])},[h(d,{emoji:"üé≤",size:18,class:"dice-icon"})],2),i("span",Qt,l(t.formula),1),e[13]||(e[13]=i("span",{class:"dice-arrow"},"‚Üí",-1)),h(T,{name:"dice-result",mode:"out-in"},{default:g(()=>[t.showResult?(o(),n("span",{key:t.result,class:"dice-result"},l(t.result),1)):(o(),n("span",Wt,"???"))]),_:2},1024),t.type==="dx3"&&t.diceRolls?(o(),n("div",Zt,[i("button",{class:"details-toggle",onClick:y=>r.toggleDetails(m),title:t.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[h(d,{emoji:t.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,es),h(T,{name:"details-expand"},{default:g(()=>[t.showDetails?(o(),n("div",ts,l(t.diceRolls),1)):u("",!0)]),_:2},1024)])):u("",!0)],64))],2))),128))]),_:1})])}const vs=k(et,[["render",ss],["__scopeId","data-v-3b3fb983"]]),is={name:"BGMPlayer",props:{bgmUrl:{type:String,default:""},bgmType:{type:String,default:"youtube",validator:s=>["youtube","audio"].includes(s)},volume:{type:Number,default:.5},autoPlay:{type:Boolean,default:!1}},data(){return{isPlaying:!1,isPaused:!1,isMuted:!1,currentVolume:this.volume,youtubePlayer:null,youtubeApiReady:!1}},computed:{youtubeVideoId(){if(this.bgmType!=="youtube"||!this.bgmUrl)return"";const s=[/(?:youtube\.com\/watch\?v=)([\w-]+)/,/(?:youtu\.be\/)([\w-]+)/,/(?:youtube\.com\/embed\/)([\w-]+)/,/^([\w-]{11})$/];for(const e of s){const a=this.bgmUrl.match(e);if(a)return a[1]}return""}},watch:{bgmUrl(s,e){s&&s!==e?(this.stopPlayer(),this.isPlaying=!1,this.isPaused=!1,this.initializePlayer()):s||this.stopPlayer()},volume(s){this.currentVolume=s,this.updateVolume()}},methods:{loadYouTubeAPI(){if(window.YT&&window.YT.Player){this.youtubeApiReady=!0;return}if(!document.getElementById("youtube-iframe-api")){const s=document.createElement("script");s.id="youtube-iframe-api",s.src="https://www.youtube.com/iframe_api";const e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(s,e),window.onYouTubeIframeAPIReady=()=>{this.youtubeApiReady=!0,this.initYouTubePlayer()}}},initializePlayer(){this.$nextTick(()=>{this.bgmType==="youtube"?(this.loadYouTubeAPI(),this.youtubeApiReady&&this.initYouTubePlayer()):this.bgmType==="audio"&&this.initAudioPlayer()})},initYouTubePlayer(){!this.youtubeApiReady||!this.youtubeVideoId||(this.youtubePlayer&&(this.youtubePlayer.destroy(),this.youtubePlayer=null),this.$nextTick(()=>{this.youtubePlayer=new window.YT.Player(this.$refs.youtubeIframe,{videoId:this.youtubeVideoId,playerVars:{autoplay:this.autoPlay?1:0,loop:1,playlist:this.youtubeVideoId,controls:0,disablekb:1,fs:0,modestbranding:1},events:{onReady:s=>{s.target.setVolume(this.currentVolume*100),this.autoPlay&&(s.target.playVideo(),this.isPlaying=!0,this.isPaused=!1)},onStateChange:s=>{s.data===1?(this.isPlaying=!0,this.isPaused=!1):s.data===2?(this.isPlaying=!1,this.isPaused=!0):(s.data===0||s.data===-1)&&(this.isPlaying=!1,this.isPaused=!1)}}})}))},initAudioPlayer(){const s=this.$refs.audioPlayer;s&&(s.volume=this.currentVolume,this.autoPlay&&s.play().then(()=>{this.isPlaying=!0,this.isPaused=!1}).catch(e=>{console.warn("ÏûêÎèôÏû¨ÏÉù Ïã§Ìå®:",e),this.isPaused=!0}))},togglePlay(){if(this.bgmType==="audio"){const s=this.$refs.audioPlayer;s&&(this.isPlaying?(s.pause(),this.isPlaying=!1,this.isPaused=!0):s.play().then(()=>{this.isPlaying=!0,this.isPaused=!1}).catch(e=>{console.error("Ïû¨ÏÉù Ïã§Ìå®:",e),this.isPlaying=!1,this.isPaused=!0}))}else if(this.bgmType==="youtube"){if(!this.youtubePlayer)return;this.isPlaying?this.youtubePlayer.pauseVideo():this.youtubePlayer.playVideo()}},toggleMute(){if(this.isMuted=!this.isMuted,this.bgmType==="audio"){const s=this.$refs.audioPlayer;s&&(s.muted=this.isMuted)}else this.bgmType==="youtube"&&this.youtubePlayer&&(this.isMuted?this.youtubePlayer.mute():this.youtubePlayer.unMute())},updateVolume(){if(this.bgmType==="audio"){const s=this.$refs.audioPlayer;s&&(s.volume=this.currentVolume)}else this.bgmType==="youtube"&&this.youtubePlayer&&this.youtubePlayer.setVolume(this.currentVolume*100)},stopPlayer(){if(this.bgmType==="audio"){const s=this.$refs.audioPlayer;s&&(s.pause(),s.currentTime=0)}else this.bgmType==="youtube"&&this.youtubePlayer&&this.youtubePlayer.stopVideo();this.isPlaying=!1,this.isPaused=!1},handleAudioError(s){console.error("Ïò§ÎîîÏò§ Î°úÎìú Ïã§Ìå®:",s),this.$emit("error","BGM ÌååÏùºÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.")}},mounted(){this.bgmUrl&&this.initializePlayer()},beforeUnmount(){this.stopPlayer(),this.youtubePlayer&&(this.youtubePlayer.destroy(),this.youtubePlayer=null)}},as={key:0,class:"bgm-player"},os={key:0,class:"youtube-container"},ns={ref:"youtubeIframe",style:{display:"none"}},ls=["src","autoplay"],rs={class:"bgm-controls"},us=["title"],ds={class:"bgm-info"},cs={class:"bgm-status"},hs={class:"volume-control"},ms=["title"];function ys(s,e,a,p,c,r){const d=_("EmojiToIcon");return a.bgmUrl?(o(),n("div",as,[a.bgmType==="youtube"&&r.youtubeVideoId?(o(),n("div",os,[i("div",ns,null,512)])):a.bgmType==="audio"?(o(),n("audio",{key:1,ref:"audioPlayer",src:a.bgmUrl,autoplay:a.autoPlay,loop:"",onError:e[0]||(e[0]=(...t)=>r.handleAudioError&&r.handleAudioError(...t))},null,40,ls)):u("",!0),i("div",rs,[i("button",{onClick:e[1]||(e[1]=(...t)=>r.togglePlay&&r.togglePlay(...t)),class:"bgm-button",title:c.isPlaying?"ÏùºÏãúÏ†ïÏßÄ":"Ïû¨ÏÉù"},[h(d,{emoji:c.isPlaying?"‚è∏Ô∏è":"‚ñ∂Ô∏è",size:16},null,8,["emoji"])],8,us),i("div",ds,[e[5]||(e[5]=i("span",{class:"bgm-label"},"BGM",-1)),i("span",cs,l(c.isPlaying?"Ïû¨ÏÉù Ï§ë":c.isPaused?"ÏùºÏãúÏ†ïÏßÄ":"Ï†ïÏßÄ"),1)]),i("div",hs,[i("button",{onClick:e[2]||(e[2]=(...t)=>r.toggleMute&&r.toggleMute(...t)),class:"volume-button",title:c.isMuted?"ÏùåÏÜåÍ±∞ Ìï¥Ï†ú":"ÏùåÏÜåÍ±∞"},[h(d,{emoji:c.isMuted?"üîá":"üîä",size:14},null,8,["emoji"])],8,ms),S(i("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>c.currentVolume=t),type:"range",min:"0",max:"1",step:"0.05",class:"volume-slider",onInput:e[4]||(e[4]=(...t)=>r.updateVolume&&r.updateVolume(...t))},null,544),[[A,c.currentVolume,void 0,{number:!0}]])])])])):u("",!0)}const bs=k(is,[["render",ys],["__scopeId","data-v-c8511153"]]);export{bs as B,gs as C,we as D,_s as P,vs as a,fs as b};
