import{S as O,u as L}from"./logStore-Ce2Wrt-9.js";import{_ as P,c as r,f as h,F as C,g as x,r as f,o as a,n as w,a as s,d as u,t as d,h as I,i as D,w as _,T as k,j as A,e as p,k as v,v as T,l as j,m as R,p as H}from"./index-BWNgo091.js";const F={name:"StatusChange",props:{statusChanges:{type:Array,default:()=>[]}},methods:{getStatusIcon(t){const e=t.toLowerCase();return e.includes("Ïπ®Ïãù")?"‚ö°":e.includes("hp")||e.includes("ÏÉùÎ™Ö")||e.includes("Ï≤¥Î†•")?"‚ù§Ô∏è":e.includes("mp")||e.includes("ÎßàÎÇò")||e.includes("ÎßàÎ†•")?"üíô":e.includes("san")||e.includes("Ï†ïÏã†")||e.includes("Ïù¥ÏÑ±")?"üß†":"üìä"}}},X={key:0,class:"status-change-container"},G={class:"status-icon"},K={class:"status-info"},Y={class:"character-name"},q={class:"status-name"},J={class:"status-values"},W={class:"old-value"},Q={class:"new-value"},Z={key:1,class:"new-value"},$={key:2,class:"old-value"};function ee(t,e,l,m,n,i){const c=f("EmojiToIcon");return l.statusChanges&&l.statusChanges.length>0?(a(),r("div",X,[(a(!0),r(C,null,x(l.statusChanges,(o,g)=>(a(),r("div",{key:g,class:w(["status-change",{"is-positive":o.delta>0,"is-negative":o.delta<0}])},[s("div",G,[u(c,{emoji:i.getStatusIcon(o.statusName),size:16},null,8,["emoji"])]),s("div",K,[s("span",Y,d(o.characterName),1),s("span",q,d(o.statusName),1)]),s("div",J,[o.oldValue!==null&&o.newValue!==null?(a(),r(C,{key:0},[s("span",W,d(o.oldValue),1),e[0]||(e[0]=s("span",{class:"arrow"},"‚Üí",-1)),s("span",Q,d(o.newValue),1)],64)):o.oldValue===null&&o.newValue!==null?(a(),r("span",Z,d(o.newValue),1)):o.oldValue!==null&&o.newValue===null?(a(),r("span",$,d(o.oldValue),1)):h("",!0),o.delta!==0?(a(),r("span",{key:3,class:w(["delta",{"delta-positive":o.delta>0,"delta-negative":o.delta<0}])},d(o.delta>0?"+":"")+d(o.delta),3)):h("",!0)])],2))),128))])):h("",!0)}const te=P(F,[["render",ee],["__scopeId","data-v-820fc90f"]]),se={name:"DXCombo",props:{dxCombos:{type:Array,default:()=>[]}},methods:{decodeHtml(t){if(!t)return t;const e=document.createElement("textarea");e.innerHTML=t;let l=e.value;return l=l.replace(/\\n/g,`
`),l=l.replace(/\\t/g,"	"),l=l.replace(/\\r/g,"\r"),l}}},oe={key:0,class:"dx-combo-container"},ie={class:"combo-header"},le={class:"combo-icon"},ne={class:"combo-label"},ae={key:0,class:"combo-name"},re={key:1,class:"erosion-cost"},ce={class:"combo-effects"},de={class:"effect-name"},ue={class:"effect-level"},he={key:0,class:"combo-info-row"},me={key:0,class:"info-item"},ge={class:"info-value"},ye={key:1,class:"info-item"},pe={class:"info-value"},fe={key:2,class:"info-item"},be={class:"info-value"},ve={key:3,class:"info-item"},Se={class:"info-value"},_e={key:1,class:"combo-stats-row"},Ce={key:0,class:"info-item"},ke={class:"info-value"},Te={key:1,class:"info-item"},we={class:"info-value"},Pe={key:2,class:"info-item"},xe={class:"info-value"},Ie={key:3,class:"info-item"},De={class:"info-value"},Ae={key:2,class:"combo-description"},Ee={key:3,class:"combo-dice-roll"},Oe={class:"dice-roll-header"},je={class:"dice-roll-content"},Ne={class:"dice-formula"},Be={class:"dice-detail"},Me={class:"dice-result"};function Ue(t,e,l,m,n,i){const c=f("EmojiToIcon");return l.dxCombos&&l.dxCombos.length>0?(a(),r("div",oe,[(a(!0),r(C,null,x(l.dxCombos,(o,g)=>(a(),r("div",{key:g,class:"dx-combo"},[s("div",ie,[s("div",le,[u(c,{emoji:"‚ö°",size:16})]),s("span",ne,d(o.isSingleEffect?"Ïù¥ÌéôÌä∏":"ÏΩ§Î≥¥"),1),o.comboName?(a(),r("span",ae,d(i.decodeHtml(o.comboName)),1)):h("",!0),o.erosionCost?(a(),r("span",re,d(o.erosionCost)+"‚Üë",1)):h("",!0)]),s("div",ce,[(a(!0),r(C,null,x(o.effects,(y,S)=>(a(),r("div",{key:S,class:"combo-effect"},[s("span",de,d(i.decodeHtml(y.name)),1),s("span",ue,"Lv."+d(y.level),1)]))),128))]),o.timing||o.difficulty||o.target||o.range?(a(),r("div",he,[o.timing?(a(),r("span",me,[e[0]||(e[0]=s("span",{class:"info-label"},"ÌÉÄÏù¥Î∞ç:",-1)),s("span",ge,d(i.decodeHtml(o.timing)),1)])):h("",!0),o.difficulty?(a(),r("span",ye,[e[1]||(e[1]=s("span",{class:"info-label"},"ÎÇúÏù¥ÎèÑ:",-1)),s("span",pe,d(i.decodeHtml(o.difficulty)),1)])):h("",!0),o.target?(a(),r("span",fe,[e[2]||(e[2]=s("span",{class:"info-label"},"ÎåÄÏÉÅ:",-1)),s("span",be,d(i.decodeHtml(o.target)),1)])):h("",!0),o.range?(a(),r("span",ve,[e[3]||(e[3]=s("span",{class:"info-label"},"ÏÇ¨Í±∞Î¶¨:",-1)),s("span",Se,d(i.decodeHtml(o.range)),1)])):h("",!0)])):h("",!0),o.dice||o.critical||o.attack||o.erosion?(a(),r("div",_e,[o.dice?(a(),r("span",Ce,[e[4]||(e[4]=s("span",{class:"info-label"},"Îã§Ïù¥Ïä§:",-1)),s("span",ke,d(i.decodeHtml(o.dice)),1)])):h("",!0),o.critical?(a(),r("span",Te,[e[5]||(e[5]=s("span",{class:"info-label"},"ÌÅ¨Î¶¨Ïπò:",-1)),s("span",we,d(i.decodeHtml(o.critical)),1)])):h("",!0),o.attack?(a(),r("span",Pe,[e[6]||(e[6]=s("span",{class:"info-label"},"Í≥µÍ≤©Î†•:",-1)),s("span",xe,d(i.decodeHtml(o.attack)),1)])):h("",!0),o.erosion?(a(),r("span",Ie,[e[7]||(e[7]=s("span",{class:"info-label"},"Ïπ®Ïãù:",-1)),s("span",De,d(i.decodeHtml(o.erosion)),1)])):h("",!0)])):h("",!0),o.description?(a(),r("div",Ae,d(i.decodeHtml(o.description)),1)):h("",!0),o.diceRoll?(a(),r("div",Ee,[s("div",Oe,[u(c,{emoji:"üé≤",size:14}),e[8]||(e[8]=s("span",{class:"dice-roll-label"},"ÌåêÏ†ï",-1))]),s("div",je,[s("span",Ne,d(o.diceRoll.formula),1),e[9]||(e[9]=s("span",{class:"dice-separator"},"‚Üí",-1)),s("span",Be,d(o.diceRoll.diceRolls),1),e[10]||(e[10]=s("span",{class:"dice-separator"},"‚Üí",-1)),s("span",Me,d(o.diceRoll.result),1)])])):h("",!0)]))),128))])):h("",!0)}const B=P(se,[["render",Ue],["__scopeId","data-v-73107c03"]]),Ve={name:"Illustration",props:{illustrations:{type:Array,default:()=>[]}},data(){return{failedImages:new Set}},methods:{handleImageError(t){this.failedImages.add(t),this.$forceUpdate()},handleImageLoad(){}}},ze={key:0,class:"illustration-container"},Le=["src","alt","onError"];function Re(t,e,l,m,n,i){return l.illustrations&&l.illustrations.length>0?(a(),r("div",ze,[(a(!0),r(C,null,x(l.illustrations,(c,o)=>(a(),r("div",{key:o,class:"illustration-item"},[n.failedImages.has(o)?h("",!0):(a(),r("img",{key:0,src:c.url,alt:c.alt||"ÏÇΩÌôî",class:"illustration-image",onError:g=>i.handleImageError(o),onLoad:e[0]||(e[0]=(...g)=>i.handleImageLoad&&i.handleImageLoad(...g))},null,40,Le))]))),128))])):h("",!0)}const He=P(Ve,[["render",Re],["__scopeId","data-v-c3f90253"]]),Fe={name:"DialogBox",components:{StatusChange:te,DXCombo:B,Illustration:He},props:{stepType:{type:String,default:"dialogue",validator:t=>["dialogue","system","narrator","scene-description"].includes(t)},characterName:{type:String,default:""},characterColor:{type:String,default:"#333333"},text:{type:String,required:!0},statusChanges:{type:Array,default:()=>[]},dxCombos:{type:Array,default:()=>[]},illustrations:{type:Array,default:()=>[]},typingSpeed:{type:Number,default:50},autoPlaySpeed:{type:Number,default:1},autoAdvance:{type:Boolean,default:!1},hasOverlay:{type:Boolean,default:!1}},data(){return{displayedText:"",isTyping:!1,isComplete:!1,typingTimer:null,autoAdvanceTimer:null,currentIndex:0,originalHtmlText:null}},computed:{decodedText(){return this.decodeHtmlEntities(this.displayedText)}},watch:{text:{immediate:!0,handler(t){console.log("[DialogBox] text Î≥ÄÍ≤Ω, ÌÉÄÏù¥Ìïë ÏãúÏûë"),this.startTyping(t)}},autoAdvance(t,e){if(console.log("[DialogBox] autoAdvance Î≥ÄÍ≤Ω:",{old:e,new:t,isComplete:this.isComplete,hasOverlay:this.hasOverlay}),!t&&e){console.log("[DialogBox] ÏûêÎèôÏû¨ÏÉù Ï∑®ÏÜå - ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨"),this.stopAutoAdvance();return}t&&!e&&this.isComplete&&!this.hasOverlay&&(this.stopAutoAdvance(),this.autoAdvanceTimer=setTimeout(()=>{this.autoAdvance&&this.isComplete&&!this.hasOverlay&&(console.log("[DialogBox] autoAdvance watchÏóêÏÑú ÏßÑÌñâ"),this.autoAdvanceTimer=null,this.$emit("advance"))},1500))}},methods:{decodeHtmlEntities(t){if(!t)return t;const e={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&#39;":"'","&apos;":"'"};return t.replace(/&[a-z]+;|&#\d+;/gi,l=>e[l]||l)},startTyping(t){if(this.stopTyping(),this.stopAutoAdvance(),this.displayedText="",this.currentIndex=0,this.isTyping=!0,this.isComplete=!1,!t||t.length===0){this.displayedText=t,this.completeTyping(!0);return}if(t.includes("roll20-dx3-template")||t.includes("sheet-rolltemplate-")){this.displayedText=t,this.completeTyping(!0);return}if(this.hasHtmlTags(t)){const e=this.extractPlainText(t);this.originalHtmlText=t,this.typeNextCharacter(e,t);return}this.originalHtmlText=null,this.typeNextCharacter(t,t)},hasHtmlTags(t){return/<[^>]+>/i.test(t)},extractPlainText(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},typeNextCharacter(t,e){this.currentIndex<t.length?(this.originalHtmlText?this.displayedText=this.reconstructHtmlUpToIndex(this.originalHtmlText,this.currentIndex):this.displayedText+=t[this.currentIndex],this.currentIndex++,this.typingTimer=setTimeout(()=>{this.typeNextCharacter(t,e)},this.typingSpeed/this.autoPlaySpeed)):(this.displayedText=e,this.completeTyping())},reconstructHtmlUpToIndex(t,e){const l=document.createElement("div");l.innerHTML=t;let m=0,n="";const i=c=>{if(m>=e)return!1;if(c.nodeType===Node.TEXT_NODE){const o=c.textContent,g=e-m;if(m+o.length<=e)n+=o,m+=o.length;else return n+=o.substring(0,g),m=e,!1}else if(c.nodeType===Node.ELEMENT_NODE){const o=c.tagName.toLowerCase(),g=Array.from(c.attributes).map(y=>`${y.name}="${y.value}"`).join(" ");n+=`<${o}${g?" "+g:""}>`;for(let y of c.childNodes)if(!i(y))return!1;n+=`</${o}>`}return!0};for(let c of l.childNodes)if(!i(c))break;return n},completeTyping(t=!1){if(this.isTyping=!1,this.isComplete=!0,this.$emit("typing-complete"),console.log("[DialogBox] completeTyping:",{autoAdvance:this.autoAdvance,hasOverlay:this.hasOverlay,isEmpty:t,textLength:this.text.length}),this.autoAdvance&&!this.hasOverlay){let e=1500;t&&(e=3e3);const l=this.text.length*this.typingSpeed/this.autoPlaySpeed,n=l+e/this.autoPlaySpeed<3e3/this.autoPlaySpeed?3e3/this.autoPlaySpeed-l:e/this.autoPlaySpeed;console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ ÌÉÄÏù¥Î®∏ ÏãúÏûë:",Math.max(n,e),"ms"),this.autoAdvanceTimer=setTimeout(()=>{this.autoAdvance&&!this.hasOverlay?(console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ Ïã§Ìñâ"),this.autoAdvanceTimer=null,this.$emit("advance")):(console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ Ï∑®ÏÜåÎê® (autoAdvance:",this.autoAdvance,", hasOverlay:",this.hasOverlay,")"),this.autoAdvanceTimer=null)},Math.max(n,e))}},handleClick(){this.skipTyping()},skipTyping(){this.isTyping?(this.stopTyping(),this.displayedText=this.text,this.completeTyping()):this.isComplete&&this.$emit("advance")},stopTyping(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null)},stopAutoAdvance(){this.autoAdvanceTimer&&(clearTimeout(this.autoAdvanceTimer),this.autoAdvanceTimer=null)}},beforeUnmount(){this.stopTyping(),this.stopAutoAdvance()}},Xe=["innerHTML"],Ge={key:0,class:"continue-indicator"};function Ke(t,e,l,m,n,i){const c=f("EmojiToIcon"),o=f("Illustration"),g=f("DXCombo"),y=f("StatusChange");return a(),r("div",{class:w(["dialog-box",{"dialog-system":l.stepType==="system","dialog-narrator":l.stepType==="narrator","dialog-scene-description":l.stepType==="scene-description"}]),style:D({borderColor:l.characterColor}),onClick:e[0]||(e[0]=(...S)=>i.handleClick&&i.handleClick(...S))},[l.characterName?(a(),r("div",{key:0,class:"character-name",style:D({color:l.characterColor})},d(l.characterName),5)):h("",!0),l.text&&l.text.trim().length>0?(a(),r("div",{key:1,class:w(["dialog-text",{"is-typing":n.isTyping,"is-narration":!l.characterName}])},[s("p",{class:"text-content",innerHTML:i.decodedText},null,8,Xe),!n.isTyping&&!n.isComplete?(a(),r("div",Ge,[u(c,{emoji:"‚ñº",size:12})])):h("",!0)],2)):h("",!0),l.illustrations&&l.illustrations.length>0?(a(),I(o,{key:2,illustrations:l.illustrations},null,8,["illustrations"])):h("",!0),l.dxCombos&&l.dxCombos.length>0?(a(),I(g,{key:3,dxCombos:l.dxCombos},null,8,["dxCombos"])):h("",!0),l.statusChanges&&l.statusChanges.length>0?(a(),I(y,{key:4,statusChanges:l.statusChanges},null,8,["statusChanges"])):h("",!0)],6)}const Ye=P(Fe,[["render",Ke],["__scopeId","data-v-23bf432c"]]),qe={name:"CharacterDisplay",props:{currentStep:{type:Object,default:null},characters:{type:Object,default:()=>({})},maxVisibleCharacters:{type:Number,default:3},layout:{type:String,default:"single",validator:t=>["single","left","center","right"].includes(t)}},data(){return{activeCharacterIds:[],failedImageIds:new Set}},computed:{speakingCharacterId(){var t;return!this.currentStep||this.currentStep.type==="system"||this.currentStep.type==="narrator"?null:((t=this.currentStep.character)==null?void 0:t.id)||null},currentCharacter(){return this.currentStep?this.getCurrentCharacter():null}},methods:{getCurrentCharacter(){if(!this.currentStep||!this.currentStep.character)return null;const t=this.currentStep.character;return{id:t.id||t.name,name:t.name,avatarUrl:t.avatarUrl,color:t.color,emotion:t.emotion||"default"}},getCharacterStyle(t){const e={};return t.color&&t.id===this.speakingCharacterId&&(e.borderColor=t.color),e},handleImageError(t){console.warn(`Ï∫êÎ¶≠ÌÑ∞ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${t.name}`),this.failedImageIds.add(t.id),this.$forceUpdate()}},watch:{currentStep:{handler(t){if(!t)return;const e=this.speakingCharacterId;e&&!this.activeCharacterIds.includes(e)&&(this.activeCharacterIds.push(e),this.activeCharacterIds.length>this.maxVisibleCharacters&&this.activeCharacterIds.shift())},immediate:!0}}},Je={class:"character-display"},We={class:"character-container"},Qe={class:"character-avatar"},Ze=["src","alt"];function $e(t,e,l,m,n,i){return a(),r("div",Je,[s("div",We,[u(k,{name:"character-fade",mode:"out-in"},{default:_(()=>[i.currentCharacter&&i.currentCharacter.avatarUrl&&!n.failedImageIds.has(i.currentCharacter.id)?(a(),r("div",{key:i.currentCharacter.id,class:w(["character-wrapper",{"is-speaking":i.currentCharacter.id===i.speakingCharacterId}]),style:D(i.getCharacterStyle(i.currentCharacter))},[s("div",Qe,[s("img",{src:i.currentCharacter.avatarUrl,alt:i.currentCharacter.name,onError:e[0]||(e[0]=c=>i.handleImageError(i.currentCharacter))},null,40,Ze)])],6)):h("",!0)]),_:1})])])}const et=P(qe,[["render",$e],["__scopeId","data-v-a57cc8bc"]]),tt={name:"PlaybackControls",data(){return{speedOptions:[.5,1,1.2,2]}},props:{currentStepNumber:{type:Number,required:!0},totalSteps:{type:Number,required:!0},currentSceneName:{type:String,default:""},hasPreviousStep:{type:Boolean,default:!1},hasNextStep:{type:Boolean,default:!0},autoPlayEnabled:{type:Boolean,default:!1},autoPlaySpeed:{type:Number,default:1},showProgressBar:{type:Boolean,default:!0},showSceneSelector:{type:Boolean,default:!1}},computed:{progressPercentage(){return this.totalSteps===0?0:this.currentStepNumber/this.totalSteps*100}},methods:{handleSceneSelectorClick(){console.log("[PlaybackControls] Ïî¨ ÏÑ†ÌÉù Î≤ÑÌäº ÌÅ¥Î¶≠Îê®"),console.log("[PlaybackControls] showSceneSelector prop:",this.showSceneSelector),this.$emit("open-scene-selector"),console.log("[PlaybackControls] open-scene-selector Ïù¥Î≤§Ìä∏ emit ÏôÑÎ£å")}}},st={class:"playback-controls"},ot={key:0,class:"progress-bar"},it={class:"progress-info"},lt={class:"scene-name"},nt={class:"step-counter"},at={class:"controls-buttons"},rt=["disabled"],ct=["disabled"],dt={class:"speed-control"},ut=["onClick","title"],ht={key:1,class:"step-counter"};function mt(t,e,l,m,n,i){const c=f("EmojiToIcon");return a(),r("div",st,[l.showProgressBar?(a(),r("div",ot,[s("div",{class:"progress-fill",style:D({width:i.progressPercentage+"%"})},null,4),s("div",it,[s("span",lt,d(l.currentSceneName),1),s("span",nt,d(l.currentStepNumber)+" / "+d(l.totalSteps),1)])])):h("",!0),s("div",at,[s("button",{class:"control-button",onClick:e[0]||(e[0]=o=>t.$emit("previous")),disabled:!l.hasPreviousStep,title:"Ïù¥Ï†Ñ (‚Üê)"},[u(c,{emoji:"‚èÆÔ∏è",size:20})],8,rt),s("button",{class:"control-button primary",onClick:e[1]||(e[1]=o=>t.$emit("next")),disabled:!l.hasNextStep,title:"Îã§Ïùå (‚Üí / Space)"},[u(c,{emoji:"‚ñ∂Ô∏è",size:24})],8,ct),s("button",{class:w(["control-button",{"is-active":l.autoPlayEnabled}]),onClick:e[2]||(e[2]=o=>t.$emit("toggle-autoplay")),title:"ÏûêÎèô Ïû¨ÏÉù"},[u(c,{emoji:l.autoPlayEnabled?"‚è∏Ô∏è":"‚èØÔ∏è",size:20},null,8,["emoji"])],2),s("div",dt,[(a(!0),r(C,null,x(n.speedOptions,o=>(a(),r("button",{key:o,class:w(["speed-button",{"is-active":l.autoPlaySpeed===o}]),onClick:g=>t.$emit("change-speed",o),title:o+"Î∞∞ÏÜç"},d(o)+"x ",11,ut))),128))]),l.showSceneSelector?(a(),r("button",{key:0,class:"control-button",onClick:e[3]||(e[3]=(...o)=>i.handleSceneSelectorClick&&i.handleSceneSelectorClick(...o)),title:"Ïî¨ ÏÑ†ÌÉù"},[u(c,{emoji:"üìë",size:20})])):h("",!0),l.showProgressBar?h("",!0):(a(),r("div",ht,d(l.currentStepNumber)+" / "+d(l.totalSteps),1))])])}const gt=P(tt,[["render",mt],["__scopeId","data-v-229aeb67"]]),yt={name:"HandoutDisplay",props:{handout:{type:Object,default:()=>({id:null,title:"",imageUrl:"",description:""})},isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{imageLoadError:!1}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},handleImageError(){this.imageLoadError=!0,console.error(`Ìï∏ÎìúÏïÑÏõÉ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${this.handout.imageUrl}`)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.imageLoadError=!1)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},pt={key:0,class:"handout-header"},ft={class:"handout-title"},bt={class:"handout-content"},vt=["src","alt"],St={key:1,class:"handout-placeholder"},_t={key:2,class:"handout-description"};function Ct(t,e,l,m,n,i){const c=f("EmojiToIcon");return a(),I(k,{name:"handout-overlay"},{default:_(()=>[l.isVisible?(a(),r("div",{key:0,class:"handout-overlay",onClick:e[3]||(e[3]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"handout-container",onClick:e[2]||(e[2]=A(()=>{},["stop"]))},[s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:24})]),l.handout.title?(a(),r("div",pt,[s("h2",ft,d(l.handout.title),1)])):h("",!0),s("div",bt,[l.handout.imageUrl?(a(),r("img",{key:0,src:l.handout.imageUrl,alt:l.handout.title||"Ìï∏ÎìúÏïÑÏõÉ",class:"handout-image",onError:e[1]||(e[1]=(...o)=>i.handleImageError&&i.handleImageError(...o))},null,40,vt)):(a(),r("div",St,[u(c,{emoji:"üñºÔ∏è",size:64}),e[4]||(e[4]=s("p",null,"Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§",-1))])),l.handout.description?(a(),r("div",_t,[s("p",null,d(l.handout.description),1)])):h("",!0)])])])):h("",!0)]),_:1})}const kt=P(yt,[["render",Ct],["__scopeId","data-v-051f2115"]]),Tt={name:"ThemeSettingsModal",props:{isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{localSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",bgSecondary:"#1f1f1f5",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard",bgImageUrl:"",bgImageOpacity:.3,bgImageSize:"cover",bgmUrl:"",bgmType:"youtube",bgmVolume:.5,bgmAutoPlay:!1},defaultSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",bgSecondary:"#1f1f1f5",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard",bgImageUrl:"",bgImageOpacity:.3,bgImageSize:"cover",bgmUrl:"",bgmType:"youtube",bgmVolume:.5,bgmAutoPlay:!1},youtubeVideoId:"",isLoadingFile:!1}},computed:{previewStyles(){const t={"--preview-primary":this.localSettings.primaryColor,"--preview-bg":this.localSettings.bgColor,"--preview-text":this.localSettings.textColor,"--preview-border":this.localSettings.borderColor,fontFamily:this.localSettings.fontFamily};return this.localSettings.bgImageUrl&&(t.backgroundImage=`linear-gradient(rgba(0, 0, 0, ${1-this.localSettings.bgImageOpacity}), rgba(0, 0, 0, ${1-this.localSettings.bgImageOpacity})), url(${this.localSettings.bgImageUrl})`,t.backgroundSize=this.localSettings.bgImageSize,t.backgroundPosition="center",t.backgroundRepeat="no-repeat"),t},extractedYoutubeId(){if(this.localSettings.bgmType!=="youtube"||!this.localSettings.bgmUrl)return"";const t=[/(?:youtube\.com\/watch\?v=)([\w-]+)/,/(?:youtu\.be\/)([\w-]+)/,/(?:youtube\.com\/embed\/)([\w-]+)/,/^([\w-]{11})$/];for(const e of t){const l=this.localSettings.bgmUrl.match(e);if(l)return l[1]}return""}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},loadSettings(){const t=localStorage.getItem("vnlog-theme-settings");if(t)try{this.localSettings={...this.defaultSettings,...JSON.parse(t)}}catch(e){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®:",e)}},saveSettings(){localStorage.setItem("vnlog-theme-settings",JSON.stringify(this.localSettings)),this.applyTheme(this.localSettings),this.$emit("bgm-change",{url:this.localSettings.bgmUrl,type:this.localSettings.bgmType,volume:this.localSettings.bgmVolume,autoPlay:this.localSettings.bgmAutoPlay}),this.$emit("save",this.localSettings),this.$emit("close")},applyTheme(t){const e=document.documentElement;if(e.style.setProperty("--primary-color",t.primaryColor),e.style.setProperty("--bg-color",t.bgColor),e.style.setProperty("--bg-secondary",t.bgSecondary),e.style.setProperty("--text-color",t.textColor),e.style.setProperty("--border-color",t.borderColor),e.style.setProperty("--font-family",t.fontFamily),t.bgImageUrl){const l=`linear-gradient(rgba(0, 0, 0, ${1-t.bgImageOpacity}), rgba(0, 0, 0, ${1-t.bgImageOpacity}))`;e.style.setProperty("--bg-image",`${l}, url(${t.bgImageUrl})`),e.style.setProperty("--bg-image-size",t.bgImageSize)}else e.style.setProperty("--bg-image","none")},resetToDefault(){this.localSettings={...this.defaultSettings}},async handleBgImageFileSelect(t){const e=t.target.files[0];if(e){if(e.size>2*1024*1024){alert("Ïù¥ÎØ∏ÏßÄ ÌååÏùº ÌÅ¨Í∏∞Îäî 2MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§."),t.target.value="";return}this.isLoadingFile=!0;try{const l=await this.fileToBase64(e);this.localSettings.bgImageUrl=l,console.log("[ThemeSettings] Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å:",{fileName:e.name,fileSize:e.size,base64Length:l.length})}catch(l){console.error("[ThemeSettings] ÌååÏùº Î°úÎìú Ïã§Ìå®:",l),alert("ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}finally{this.isLoadingFile=!1,t.target.value=""}}},async handleBgmFileSelect(t){const e=t.target.files[0];if(e){if(e.size>10*1024*1024){alert("BGM ÌååÏùº ÌÅ¨Í∏∞Îäî 10MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§."),t.target.value="";return}this.isLoadingFile=!0;try{const l=await this.fileToBase64(e);this.localSettings.bgmUrl=l,console.log("[ThemeSettings] BGM ÌååÏùº Î°úÎìú ÏôÑÎ£å:",{fileName:e.name,fileSize:e.size,base64Length:l.length})}catch(l){console.error("[ThemeSettings] ÌååÏùº Î°úÎìú Ïã§Ìå®:",l),alert("ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}finally{this.isLoadingFile=!1,t.target.value=""}}},fileToBase64(t){return new Promise((e,l)=>{const m=new FileReader;m.onload=()=>e(m.result),m.onerror=l,m.readAsDataURL(t)})},clearBgImage(){this.localSettings.bgImageUrl=""},clearBgm(){this.localSettings.bgmUrl=""},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSettings(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="")}}},mounted(){this.loadSettings(),this.applyTheme(this.localSettings)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},wt={class:"modal-header"},Pt={class:"modal-title"},xt={class:"modal-content"},It={class:"setting-group"},Dt={class:"setting-label"},At={class:"color-picker-wrapper"},Et={class:"setting-group"},Ot={class:"setting-label"},jt={class:"color-picker-wrapper"},Nt={class:"setting-group"},Bt={class:"setting-label"},Mt={class:"color-picker-wrapper"},Ut={class:"setting-group"},Vt={class:"setting-label"},zt={class:"color-picker-wrapper"},Lt={class:"setting-group"},Rt={class:"setting-label"},Ht={class:"color-picker-wrapper"},Ft={class:"setting-group"},Xt={class:"setting-label"},Gt={class:"setting-group"},Kt={class:"setting-label"},Yt={class:"file-input-group"},qt={class:"hint-text"},Jt={key:0,class:"setting-group"},Wt={class:"setting-label"},Qt={key:1,class:"setting-group"},Zt={class:"setting-label"},$t={class:"setting-group"},es={class:"setting-label"},ts={class:"setting-group"},ss={class:"setting-label"},os={class:"file-input-group"},is=["placeholder"],ls={key:0,class:"hint-text"},ns={key:1,class:"hint-text"},as={key:2,class:"setting-group"},rs={class:"setting-label"},cs={key:3,class:"setting-group"},ds={class:"checkbox-label"},us={class:"preview-section"},hs={class:"modal-footer"},ms={class:"button-group"};function gs(t,e,l,m,n,i){const c=f("EmojiToIcon");return a(),I(k,{name:"modal-overlay"},{default:_(()=>[l.isVisible?(a(),r("div",{key:0,class:"modal-overlay",onClick:e[29]||(e[29]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"modal-container",onClick:e[28]||(e[28]=A(()=>{},["stop"]))},[s("div",wt,[s("h2",Pt,[u(c,{emoji:"üé®",size:24}),e[30]||(e[30]=p(" ÌÖåÎßà ÏÑ§Ï†ï ",-1))]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:20})])]),s("div",xt,[s("div",It,[s("label",Dt,[u(c,{emoji:"üé®",size:16}),e[31]||(e[31]=p(" Ï£ºÏöî ÏÉâÏÉÅ ",-1))]),s("div",At,[v(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.localSettings.primaryColor=o),type:"color",class:"color-picker"},null,512),[[T,n.localSettings.primaryColor]]),v(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.localSettings.primaryColor=o),type:"text",class:"color-input",placeholder:"#6366f1"},null,512),[[T,n.localSettings.primaryColor]])])]),s("div",Et,[s("label",Ot,[u(c,{emoji:"üñºÔ∏è",size:16}),e[32]||(e[32]=p(" Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),s("div",jt,[v(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.localSettings.bgColor=o),type:"color",class:"color-picker"},null,512),[[T,n.localSettings.bgColor]]),v(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.localSettings.bgColor=o),type:"text",class:"color-input",placeholder:"#1a1a2e"},null,512),[[T,n.localSettings.bgColor]])])]),s("div",Nt,[s("label",Bt,[u(c,{emoji:"üé®",size:16}),e[33]||(e[33]=p(" Î≥¥Ï°∞ Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),s("div",Mt,[v(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>n.localSettings.bgSecondary=o),type:"color",class:"color-picker"},null,512),[[T,n.localSettings.bgSecondary]]),v(s("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>n.localSettings.bgSecondary=o),type:"text",class:"color-input",placeholder:"#f5f5f5"},null,512),[[T,n.localSettings.bgSecondary]])])]),s("div",Ut,[s("label",Vt,[u(c,{emoji:"üìù",size:16}),e[34]||(e[34]=p(" ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ ",-1))]),s("div",zt,[v(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>n.localSettings.textColor=o),type:"color",class:"color-picker"},null,512),[[T,n.localSettings.textColor]]),v(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>n.localSettings.textColor=o),type:"text",class:"color-input",placeholder:"#ffffff"},null,512),[[T,n.localSettings.textColor]])])]),s("div",Lt,[s("label",Rt,[u(c,{emoji:"‚¨ú",size:16}),e[35]||(e[35]=p(" ÌÖåÎëêÎ¶¨ ÏÉâÏÉÅ ",-1))]),s("div",Ht,[v(s("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>n.localSettings.borderColor=o),type:"color",class:"color-picker"},null,512),[[T,n.localSettings.borderColor]]),v(s("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>n.localSettings.borderColor=o),type:"text",class:"color-input",placeholder:"#666666"},null,512),[[T,n.localSettings.borderColor]])])]),s("div",Ft,[s("label",Xt,[u(c,{emoji:"üî§",size:16}),e[36]||(e[36]=p(" Ìè∞Ìä∏ ",-1))]),v(s("select",{"onUpdate:modelValue":e[11]||(e[11]=o=>n.localSettings.fontFamily=o),class:"font-select"},[...e[37]||(e[37]=[s("option",{value:"Pretendard"},"Pretendard (Í∏∞Î≥∏)",-1),s("option",{value:"NanumSquare"},"NanumSquare",-1),s("option",{value:"Nanum Myeongjo"},"Nanum Myeongjo",-1),s("option",{value:"NotoSerifKR"},"Noto Serif KR",-1)])],512),[[j,n.localSettings.fontFamily]])]),s("div",Gt,[s("label",Kt,[u(c,{emoji:"üåÑ",size:16}),e[38]||(e[38]=p(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ URL ",-1))]),s("div",Yt,[v(s("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>n.localSettings.bgImageUrl=o),type:"text",class:"url-input",placeholder:"Ïù¥ÎØ∏ÏßÄ URL ÏûÖÎ†• ÎòêÎäî ÌååÏùº ÏÑ†ÌÉù"},null,512),[[T,n.localSettings.bgImageUrl]]),s("input",{ref:"bgImageFileInput",type:"file",accept:"image/*",onChange:e[13]||(e[13]=(...o)=>i.handleBgImageFileSelect&&i.handleBgImageFileSelect(...o)),style:{display:"none"}},null,544),s("button",{onClick:e[14]||(e[14]=o=>t.$refs.bgImageFileInput.click()),class:"file-select-button"},[u(c,{emoji:"üìÅ",size:14}),e[39]||(e[39]=p(" ÌååÏùº ",-1))]),n.localSettings.bgImageUrl?(a(),r("button",{key:0,onClick:e[15]||(e[15]=(...o)=>i.clearBgImage&&i.clearBgImage(...o)),class:"clear-button"},[u(c,{emoji:"‚úñÔ∏è",size:14})])):h("",!0)]),s("p",qt,[u(c,{emoji:"üí°",size:12}),e[40]||(e[40]=p(" Î°úÏª¨ ÌååÏùºÏùÄ base64Î°ú Ïù∏ÏΩîÎî© (2MB Ïù¥Ìïò) ",-1))])]),n.localSettings.bgImageUrl?(a(),r("div",Jt,[s("label",Wt,[u(c,{emoji:"üíß",size:16}),p(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ Ìà¨Î™ÖÎèÑ ("+d(Math.round(n.localSettings.bgImageOpacity*100))+"%) ",1)]),v(s("input",{"onUpdate:modelValue":e[16]||(e[16]=o=>n.localSettings.bgImageOpacity=o),type:"range",min:"0",max:"1",step:"0.05",class:"slider"},null,512),[[T,n.localSettings.bgImageOpacity,void 0,{number:!0}]])])):h("",!0),n.localSettings.bgImageUrl?(a(),r("div",Qt,[s("label",Zt,[u(c,{emoji:"üìè",size:16}),e[41]||(e[41]=p(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ",-1))]),v(s("select",{"onUpdate:modelValue":e[17]||(e[17]=o=>n.localSettings.bgImageSize=o),class:"font-select"},[...e[42]||(e[42]=[s("option",{value:"cover"},"ÌôîÎ©¥ Ï±ÑÏö∞Í∏∞ (Cover)",-1),s("option",{value:"contain"},"ÎπÑÏú® Ïú†ÏßÄ (Contain)",-1),s("option",{value:"auto"},"ÏõêÎ≥∏ ÌÅ¨Í∏∞ (Auto)",-1)])],512),[[j,n.localSettings.bgImageSize]])])):h("",!0),e[51]||(e[51]=s("div",{class:"divider"},null,-1)),s("div",$t,[s("label",es,[u(c,{emoji:"üéµ",size:16}),e[43]||(e[43]=p(" BGM ÌÉÄÏûÖ ",-1))]),v(s("select",{"onUpdate:modelValue":e[18]||(e[18]=o=>n.localSettings.bgmType=o),class:"font-select"},[...e[44]||(e[44]=[s("option",{value:"youtube"},"Ïú†ÌäúÎ∏å ÏòÅÏÉÅ",-1),s("option",{value:"audio"},"Ïò§ÎîîÏò§ ÌååÏùº (MP3 Îì±)",-1)])],512),[[j,n.localSettings.bgmType]])]),s("div",ts,[s("label",ss,[u(c,{emoji:"üîó",size:16}),e[45]||(e[45]=p(" BGM URL ",-1))]),s("div",os,[v(s("input",{"onUpdate:modelValue":e[19]||(e[19]=o=>n.localSettings.bgmUrl=o),type:"text",class:"url-input",placeholder:n.localSettings.bgmType==="youtube"?"https://www.youtube.com/watch?v=...":"BGM URL ÏûÖÎ†• ÎòêÎäî ÌååÏùº ÏÑ†ÌÉù"},null,8,is),[[T,n.localSettings.bgmUrl]]),n.localSettings.bgmType==="audio"?(a(),r("input",{key:0,ref:"bgmFileInput",type:"file",accept:"audio/*",onChange:e[20]||(e[20]=(...o)=>i.handleBgmFileSelect&&i.handleBgmFileSelect(...o)),style:{display:"none"}},null,544)):h("",!0),n.localSettings.bgmType==="audio"?(a(),r("button",{key:1,onClick:e[21]||(e[21]=o=>t.$refs.bgmFileInput.click()),class:"file-select-button"},[u(c,{emoji:"üìÅ",size:14}),e[46]||(e[46]=p(" ÌååÏùº ",-1))])):h("",!0),n.localSettings.bgmUrl?(a(),r("button",{key:2,onClick:e[22]||(e[22]=(...o)=>i.clearBgm&&i.clearBgm(...o)),class:"clear-button"},[u(c,{emoji:"‚úñÔ∏è",size:14})])):h("",!0)]),n.localSettings.bgmType==="youtube"&&i.extractedYoutubeId?(a(),r("div",ls,[u(c,{emoji:"‚úì",size:12}),p(" ÎπÑÎîîÏò§ ID: "+d(i.extractedYoutubeId),1)])):n.localSettings.bgmType==="audio"?(a(),r("p",ns,[u(c,{emoji:"üí°",size:12}),e[47]||(e[47]=p(" Î°úÏª¨ ÌååÏùºÏùÄ base64Î°ú Ïù∏ÏΩîÎî© (10MB Ïù¥Ìïò) ",-1))])):h("",!0)]),n.localSettings.bgmUrl?(a(),r("div",as,[s("label",rs,[u(c,{emoji:"üîä",size:16}),p(" BGM Î≥ºÎ•® ("+d(Math.round(n.localSettings.bgmVolume*100))+"%) ",1)]),v(s("input",{"onUpdate:modelValue":e[23]||(e[23]=o=>n.localSettings.bgmVolume=o),type:"range",min:"0",max:"1",step:"0.05",class:"slider"},null,512),[[T,n.localSettings.bgmVolume,void 0,{number:!0}]])])):h("",!0),n.localSettings.bgmUrl?(a(),r("div",cs,[s("label",ds,[v(s("input",{"onUpdate:modelValue":e[24]||(e[24]=o=>n.localSettings.bgmAutoPlay=o),type:"checkbox",class:"checkbox-input"},null,512),[[R,n.localSettings.bgmAutoPlay]]),u(c,{emoji:"‚ñ∂Ô∏è",size:16}),e[48]||(e[48]=s("span",null,"PlayerView ÏßÑÏûÖ Ïãú ÏûêÎèô Ïû¨ÏÉù",-1))])])):h("",!0),s("div",us,[e[50]||(e[50]=s("p",{class:"preview-label"},"ÎØ∏Î¶¨Î≥¥Í∏∞",-1)),s("div",{class:"preview-box",style:D(i.previewStyles)},[...e[49]||(e[49]=[s("p",null,"ÏïàÎÖïÌïòÏÑ∏Ïöî!",-1),s("button",{class:"preview-button"},"Î≤ÑÌäº",-1)])],4)])]),s("div",hs,[s("button",{class:"action-button secondary",onClick:e[25]||(e[25]=(...o)=>i.resetToDefault&&i.resetToDefault(...o))},[u(c,{emoji:"üîÑ",size:16}),e[52]||(e[52]=p(" Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõê ",-1))]),s("div",ms,[s("button",{class:"action-button secondary",onClick:e[26]||(e[26]=(...o)=>i.close&&i.close(...o))}," Ï∑®ÏÜå "),s("button",{class:"action-button primary",onClick:e[27]||(e[27]=(...o)=>i.saveSettings&&i.saveSettings(...o))},[u(c,{emoji:"üíæ",size:16}),e[53]||(e[53]=p(" Ï†ÄÏû• ",-1))])])])])])):h("",!0)]),_:1})}const ys=P(Tt,[["render",gs],["__scopeId","data-v-28fe693b"]]),ps={name:"SaveLoadModal",props:{isVisible:{type:Boolean,default:!1},mode:{type:String,default:"save",validator:t=>["save","load"].includes(t)},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{saveSlots:[],deleteConfirmSlot:null}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.deleteConfirmSlot===null&&this.close()},loadSaveSlots(){this.saveSlots=O.getAllSaves()},handleSlotClick(t){this.mode==="save"?(this.$emit("save",t),this.close()):this.saveSlots[t].isEmpty||(this.$emit("load",t),this.close())},confirmDelete(t){this.deleteConfirmSlot=t},cancelDelete(){this.deleteConfirmSlot=null},executeDelete(){this.deleteConfirmSlot!==null&&(O.deleteSave(this.deleteConfirmSlot),this.loadSaveSlots(),this.deleteConfirmSlot=null)},formatInfo(t){return O.formatSaveInfo(t)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&(this.deleteConfirmSlot!==null?this.cancelDelete():this.close())}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSaveSlots(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.deleteConfirmSlot=null)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},fs={class:"modal-header"},bs={class:"modal-title"},vs={class:"modal-content"},Ss=["onClick"],_s={class:"slot-header"},Cs={class:"slot-number"},ks=["onClick"],Ts={class:"slot-content"},ws={key:0,class:"empty-slot"},Ps={key:1,class:"save-info"},xs={class:"save-title"},Is={class:"save-subtitle"},Ds={class:"save-date"},As={class:"modal-footer"},Es={class:"footer-note"},Os={class:"confirm-content"},js={class:"confirm-buttons"};function Ns(t,e,l,m,n,i){const c=f("EmojiToIcon");return a(),I(k,{name:"modal-overlay"},{default:_(()=>[l.isVisible?(a(),r("div",{key:0,class:"modal-overlay",onClick:e[5]||(e[5]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"modal-container",onClick:e[1]||(e[1]=A(()=>{},["stop"]))},[s("div",fs,[s("h2",bs,[u(c,{emoji:l.mode==="save"?"üíæ":"üìÇ",size:24},null,8,["emoji"]),p(" "+d(l.mode==="save"?"Ï†ÄÏû•ÌïòÍ∏∞":"Î∂àÎü¨Ïò§Í∏∞"),1)]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:20})])]),s("div",vs,[(a(!0),r(C,null,x(n.saveSlots,o=>(a(),r("div",{key:o.slotIndex,class:w(["save-slot",{"is-empty":o.isEmpty}]),onClick:g=>i.handleSlotClick(o.slotIndex)},[s("div",_s,[s("span",Cs,"Ïä¨Î°Ø "+d(o.slotIndex+1),1),!o.isEmpty&&l.mode==="save"?(a(),r("button",{key:0,class:"delete-button",onClick:A(g=>i.confirmDelete(o.slotIndex),["stop"]),title:"ÏÇ≠Ï†ú"},[u(c,{emoji:"üóëÔ∏è",size:16})],8,ks)):h("",!0)]),s("div",Ts,[o.isEmpty?(a(),r("div",ws,[u(c,{emoji:"üì≠",size:32}),e[6]||(e[6]=s("p",null,"Îπà Ïä¨Î°Ø",-1))])):(a(),r("div",Ps,[s("h3",xs,d(i.formatInfo(o).title),1),s("p",Is,d(i.formatInfo(o).subtitle),1),s("p",Ds,d(i.formatInfo(o).date),1)]))])],10,Ss))),128))]),s("div",As,[s("p",Es,[u(c,{emoji:"‚ÑπÔ∏è",size:14}),p(" "+d(l.mode==="save"?"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÌòÑÏû¨ ÏßÑÌñâÎèÑÎ•º Ï†ÄÏû•Ìï©ÎãàÎã§.":"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ï†ÄÏû•Îêú ÏßÑÌñâÎèÑÎ•º Î∂àÎü¨ÏòµÎãàÎã§."),1)])])]),n.deleteConfirmSlot!==null?(a(),r("div",{key:0,class:"confirm-modal",onClick:e[4]||(e[4]=A(()=>{},["stop"]))},[s("div",Os,[e[7]||(e[7]=s("h3",null,"Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú",-1)),s("p",null,"Ïä¨Î°Ø "+d(n.deleteConfirmSlot+1)+"Ïùò Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",1),s("div",js,[s("button",{class:"action-button secondary",onClick:e[2]||(e[2]=(...o)=>i.cancelDelete&&i.cancelDelete(...o))}," Ï∑®ÏÜå "),s("button",{class:"action-button danger",onClick:e[3]||(e[3]=(...o)=>i.executeDelete&&i.executeDelete(...o))}," ÏÇ≠Ï†ú ")])])])):h("",!0)])):h("",!0)]),_:1})}const Bs=P(ps,[["render",Ns],["__scopeId","data-v-4a7fd994"]]),Ms={name:"SceneSelectorModal",props:{isVisible:{type:Boolean,default:!1},scenes:{type:Array,default:()=>[]},currentSceneIndex:{type:Number,default:0},currentStepIndex:{type:Number,default:0},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{expandedScenes:new Set}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},toggleScene(t){this.expandedScenes.has(t)?this.expandedScenes.delete(t):this.expandedScenes.add(t),this.$forceUpdate()},goToStep(t,e){this.$emit("go-to-step",t,e),this.close()},getStepPreview(t){return t?t.length>50?t.substring(0,50)+"...":t:"(ÌÖçÏä§Ìä∏ ÏóÜÏùå)"},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()},initExpandedScenes(){this.currentSceneIndex!==null&&this.expandedScenes.add(this.currentSceneIndex)},scrollToCurrentScene(){setTimeout(()=>{this.$nextTick(()=>{const t=this.$refs.currentStep;if(t){const e=Array.isArray(t)?t[0]:t;e&&e.scrollIntoView({behavior:"smooth",block:"center"})}})},250)}},watch:{isVisible:{immediate:!0,handler(t){t?(this.initExpandedScenes(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden",this.scrollToCurrentScene()):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.expandedScenes.clear())}},currentSceneIndex:{handler(t){this.isVisible&&t!==null&&(this.expandedScenes.add(t),this.$forceUpdate())}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},Us={class:"modal-header"},Vs={class:"modal-title"},zs={class:"modal-content"},Ls=["onClick"],Rs={class:"scene-info"},Hs={class:"scene-number"},Fs={class:"scene-name"},Xs={class:"scene-meta"},Gs={class:"step-count"},Ks={key:0,class:"steps-list"},Ys=["onClick"],qs={class:"step-number"},Js={class:"step-preview"},Ws={class:"step-text"},Qs={key:0,class:"empty-state"},Zs={class:"modal-footer"},$s={class:"footer-info"};function eo(t,e,l,m,n,i){const c=f("EmojiToIcon");return a(),I(k,{name:"modal-overlay"},{default:_(()=>[l.isVisible?(a(),r("div",{key:0,class:"modal-overlay",onClick:e[3]||(e[3]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"modal-container",onClick:e[2]||(e[2]=A(()=>{},["stop"]))},[s("div",Us,[s("h2",Vs,[u(c,{emoji:"üìë",size:24}),e[4]||(e[4]=p(" Ïî¨ ÏÑ†ÌÉù ",-1))]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:20})])]),s("div",zs,[(a(!0),r(C,null,x(l.scenes,(o,g)=>(a(),r("div",{key:`scene-${g}`,class:w(["scene-item",{"is-current":g===l.currentSceneIndex}])},[s("div",{class:"scene-header",onClick:y=>i.toggleScene(g)},[s("div",Rs,[s("span",Hs,"Ïî¨ "+d(g+1),1),s("h3",Fs,d(o.name||"Ï†úÎ™© ÏóÜÏùå"),1)]),s("div",Xs,[s("span",Gs,d(o.steps.length)+"Í∞ú Ïä§ÌÖù",1),u(c,{emoji:n.expandedScenes.has(g)?"üîΩ":"‚ñ∂Ô∏è",size:16,class:"expand-icon"},null,8,["emoji"])])],8,Ls),u(k,{name:"steps-expand"},{default:_(()=>[n.expandedScenes.has(g)?(a(),r("div",Ks,[(a(!0),r(C,null,x(o.steps,(y,S)=>{var E;return a(),r("div",{key:`step-${g}-${S}`,ref_for:!0,ref:g===l.currentSceneIndex&&S===l.currentStepIndex?"currentStep":null,class:w(["step-item",{"is-current":g===l.currentSceneIndex&&S===l.currentStepIndex}]),onClick:N=>i.goToStep(g,S)},[s("span",qs,d(S+1),1),s("div",Js,[(E=y.character)!=null&&E.name?(a(),r("span",{key:0,class:"step-character",style:D({color:y.character.color||"#ffffff"})},d(y.character.name)+": ",5)):h("",!0),s("span",Ws,d(i.getStepPreview(y.text)),1)]),g===l.currentSceneIndex&&S===l.currentStepIndex?(a(),I(c,{key:0,emoji:"‚ñ∂Ô∏è",size:14,class:"current-indicator"})):h("",!0)],10,Ys)}),128))])):h("",!0)]),_:2},1024)],2))),128)),l.scenes.length===0?(a(),r("div",Qs,[u(c,{emoji:"üì≠",size:48}),e[5]||(e[5]=s("p",null,"Ïî¨Ïù¥ ÏóÜÏäµÎãàÎã§",-1))])):h("",!0)]),s("div",Zs,[s("div",$s,[u(c,{emoji:"‚ÑπÔ∏è",size:14}),e[6]||(e[6]=s("span",null,"Ïî¨ÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÌéºÏπòÍ≥†, Ïä§ÌÖùÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ïù¥ÎèôÌï©ÎãàÎã§.",-1))]),s("button",{class:"action-button primary",onClick:e[1]||(e[1]=(...o)=>i.close&&i.close(...o))}," Îã´Í∏∞ ")])])])):h("",!0)]),_:1})}const to=P(Ms,[["render",eo],["__scopeId","data-v-94d16136"]]),so={name:"DiceRoll",props:{diceRolls:{type:Array,default:()=>[]},characterName:{type:String,default:""},characterColor:{type:String,default:"#ffffff"},animated:{type:Boolean,default:!0},animationDuration:{type:Number,default:800},playSoundEffect:{type:Boolean,default:!1}},data(){return{processedRolls:[],audioContext:null}},watch:{diceRolls:{immediate:!0,handler(t){this.processRolls(t)}}},methods:{processRolls(t){if(!t||t.length===0){this.processedRolls=[];return}this.processedRolls=t.map((e,l)=>({...e,isAnimating:!1,showResult:e.type==="choice"||e.type==="judgement",showDetails:!1})),this.animated?this.processedRolls.forEach((e,l)=>{e.type==="choice"||e.type==="judgement"||setTimeout(()=>{this.animateRoll(l)},l*200)}):this.processedRolls.forEach(e=>{e.showResult=!0})},animateRoll(t){const e=this.processedRolls[t];e&&(e.isAnimating=!0,this.playSoundEffect&&this.playDiceSound(),setTimeout(()=>{e.isAnimating=!1,e.showResult=!0},this.animationDuration))},toggleDetails(t){const e=this.processedRolls[t];e&&(e.showDetails=!e.showDetails)},playDiceSound(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));const t=this.audioContext,e=t.createOscillator(),l=t.createGain();e.connect(l),l.connect(t.destination),e.type="square",e.frequency.setValueAtTime(200,t.currentTime),e.frequency.exponentialRampToValueAtTime(100,t.currentTime+.1),l.gain.setValueAtTime(.1,t.currentTime),l.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),e.start(t.currentTime),e.stop(t.currentTime+.1)}}},oo={class:"dice-roll-container"},io={class:"dice-icon-wrapper"},lo={class:"dice-result choice-result"},no=["onClick","title"],ao={key:0,class:"dice-details choice-options"},ro={key:1,class:"ougi-full-wrapper"},co={class:"ougi-header"},uo={class:"dice-icon-wrapper"},ho={class:"ougi-info"},mo={class:"ougi-title-line"},go={class:"ougi-name"},yo={class:"ougi-main-name"},po={class:"ougi-info-table"},fo={key:0},bo={key:0},vo={class:"ougi-presentation"},So={key:1},_o={key:2},Co={class:"ougi-ninpou"},ko={class:"shinobigami-full-wrapper"},To={class:"shinobigami-header"},wo={class:"dice-icon-wrapper"},Po={class:"shinobigami-info"},xo={class:"shinobigami-main"},Io={class:"dice-formula"},Do={class:"shinobigami-result-line"},Ao={key:1,class:"dice-placeholder"},Eo={class:"shinobigami-judgement"},Oo={key:0,class:"shinobigami-info-table"},jo={key:0},No={key:1},Bo={key:2},Mo={key:3},Uo={key:4},Vo=["onClick","title"],zo={key:0,class:"dice-details shinobigami-details"},Lo={class:"shinobigami-formula"},Ro={class:"shinobigami-rolls"},Ho={key:0},Fo={key:1},Xo={class:"judgement-header"},Go={class:"dice-icon-wrapper"},Ko={class:"judgement-info"},Yo={class:"judgement-main"},qo={class:"dice-formula"},Jo={class:"judgement-result-line"},Wo={key:1,class:"dice-placeholder"},Qo={class:"judgement-text"},Zo=["onClick","title"],$o={key:0,class:"dice-details"},ei={class:"dice-formula"},ti={key:1,class:"dice-placeholder"},si={key:0,class:"dice-details-wrapper"},oi=["onClick","title"],ii={key:0,class:"dice-details"};function li(t,e,l,m,n,i){const c=f("EmojiToIcon");return a(),r("div",oo,[u(H,{name:"dice-list",tag:"div",class:"dice-rolls"},{default:_(()=>[(a(!0),r(C,null,x(n.processedRolls,(o,g)=>(a(),r("div",{key:`${o.formula}-${g}`,class:w(["dice-roll",[{"is-animating":o.isAnimating},`roll-type-${o.type}`]])},[o.type==="choice"?(a(),r(C,{key:0},[s("div",io,[u(c,{emoji:"üéØ",size:18,class:"dice-icon"})]),e[0]||(e[0]=s("span",{class:"dice-formula"},"ÏÑ†ÌÉù",-1)),e[1]||(e[1]=s("span",{class:"dice-arrow"},"‚Üí",-1)),s("span",lo,d(o.result),1),s("button",{class:"details-toggle",onClick:y=>i.toggleDetails(g),title:o.showDetails?"ÏòµÏÖò Ïà®Í∏∞Í∏∞":"ÏòµÏÖò Î≥¥Í∏∞"},[u(c,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,no),u(k,{name:"details-expand"},{default:_(()=>[o.showDetails?(a(),r("div",ao,[(a(!0),r(C,null,x(o.options,(y,S)=>(a(),r("span",{key:S,class:"choice-option"},d(y),1))),128))])):h("",!0)]),_:2},1024)],64)):o.type==="ougi"?(a(),r("div",ro,[s("div",co,[s("div",uo,[u(c,{emoji:"üåü",size:20,class:"dice-icon"})]),s("div",ho,[s("div",mo,[s("span",{class:"ougi-character",style:D({color:l.characterColor})},d(l.characterName),5),s("span",go,"„ÄêÂ••Áæ©: "+d(o.ougiType)+"„Äë",1),s("span",yo,d(o.ougiName),1)]),s("table",po,[s("tbody",null,[s("tr",null,[e[2]||(e[2]=s("th",null,"ÏßÄÏ†ï ÌäπÍ∏∞",-1)),s("td",null,[(a(!0),r(C,null,x(o.skills,(y,S)=>(a(),r("span",{key:S,class:"ougi-skill"},[p(" „Ää"+d(y)+"„Äã",1),S<o.skills.length-1?(a(),r("span",fo,", ")):h("",!0)]))),128))])]),o.presentation?(a(),r("tr",bo,[e[3]||(e[3]=s("th",null,"Ïó∞Ï∂ú",-1)),s("td",vo,d(o.presentation),1)])):h("",!0),o.ougiEffect?(a(),r("tr",So,[e[4]||(e[4]=s("th",null,"Ìö®Í≥º",-1)),s("td",null,d(o.ougiEffect),1)])):h("",!0),o.ninpouInfo?(a(),r("tr",_o,[e[5]||(e[5]=s("th",null,"Ïù∏Î≤ï",-1)),s("td",Co,d(o.ninpouInfo),1)])):h("",!0)])])])])])):o.type==="shinobigami"?(a(),r(C,{key:2},[s("div",ko,[s("div",To,[s("div",wo,[u(c,{emoji:"‚öîÔ∏è",size:18,class:"dice-icon"})]),s("div",Po,[s("div",xo,[s("span",{class:"shinobigami-character",style:D({color:l.characterColor})},d(l.characterName),5),s("span",Io,"„Äê"+d(o.checkName)+"„Äë",1)]),s("div",Do,[e[6]||(e[6]=s("span",{class:"dice-arrow"},"‚Üí",-1)),u(k,{name:"dice-result",mode:"out-in"},{default:_(()=>[o.showResult?(a(),r("span",{key:o.result,class:"dice-result"},d(o.result),1)):(a(),r("span",Ao,"???"))]),_:2},1024),s("span",Eo,d(o.judgement),1)]),o.additionalInfo?(a(),r("table",Oo,[s("tbody",null,[o.additionalInfo.type?(a(),r("tr",jo,[e[7]||(e[7]=s("th",null,"ÌÉÄÏûÖ",-1)),s("td",null,d(o.additionalInfo.type),1)])):h("",!0),o.additionalInfo.range?(a(),r("tr",No,[e[8]||(e[8]=s("th",null,"Í∞ÑÍ≤©",-1)),s("td",null,d(o.additionalInfo.range.replace("Í∞ÑÍ≤©:","").trim()),1)])):h("",!0),o.additionalInfo.cost?(a(),r("tr",Bo,[e[9]||(e[9]=s("th",null,"ÏΩîÏä§Ìä∏",-1)),s("td",null,d(o.additionalInfo.cost.replace("ÏΩîÏä§Ìä∏:","").trim()),1)])):h("",!0),o.additionalInfo.skill?(a(),r("tr",Mo,[e[10]||(e[10]=s("th",null,"ÌäπÍ∏∞",-1)),s("td",null,d(o.additionalInfo.skill),1)])):h("",!0),o.additionalInfo.description?(a(),r("tr",Uo,[e[11]||(e[11]=s("th",null,"ÏÑ§Î™Ö",-1)),s("td",null,d(o.additionalInfo.description),1)])):h("",!0)])])):h("",!0)])])]),s("button",{class:"details-toggle",onClick:y=>i.toggleDetails(g),title:o.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[u(c,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Vo),u(k,{name:"details-expand"},{default:_(()=>[o.showDetails?(a(),r("div",zo,[s("div",Lo,d(o.command),1),s("div",Ro,[o.diceExpression?(a(),r("span",Ho,"Ï£ºÏÇ¨ÏúÑ: "+d(o.diceExpression),1)):(a(),r("span",Fo,"Í∞úÎ≥Ñ Ï£ºÏÇ¨ÏúÑ: "+d(o.diceRolls),1))])])):h("",!0)]),_:2},1024)],64)):o.type==="judgement"?(a(),r(C,{key:3},[s("div",Xo,[s("div",Go,[u(c,{emoji:"‚öñÔ∏è",size:18,class:"dice-icon"})]),s("div",Ko,[s("div",Yo,[s("span",{class:"judgement-character",style:D({color:l.characterColor})},d(l.characterName),5),s("span",qo,d(o.checkName),1)]),s("div",Jo,[e[12]||(e[12]=s("span",{class:"dice-arrow"},"‚Üí",-1)),u(k,{name:"dice-result",mode:"out-in"},{default:_(()=>[o.showResult?(a(),r("span",{key:o.result,class:"dice-result"},d(o.result),1)):(a(),r("span",Wo,"???"))]),_:2},1024),s("span",Qo,d(o.judgement),1)])])]),s("button",{class:"details-toggle",onClick:y=>i.toggleDetails(g),title:o.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[u(c,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Zo),u(k,{name:"details-expand"},{default:_(()=>[o.showDetails?(a(),r("div",$o,d(o.formula),1)):h("",!0)]),_:2},1024)],64)):(a(),r(C,{key:4},[s("div",{class:w(["dice-icon-wrapper",{"is-rolling":o.isAnimating}])},[u(c,{emoji:"üé≤",size:18,class:"dice-icon"})],2),s("span",ei,d(o.formula),1),e[13]||(e[13]=s("span",{class:"dice-arrow"},"‚Üí",-1)),u(k,{name:"dice-result",mode:"out-in"},{default:_(()=>[o.showResult?(a(),r("span",{key:o.result,class:"dice-result"},d(o.result),1)):(a(),r("span",ti,"???"))]),_:2},1024),o.type==="dx3"&&o.diceRolls?(a(),r("div",si,[s("button",{class:"details-toggle",onClick:y=>i.toggleDetails(g),title:o.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[u(c,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,oi),u(k,{name:"details-expand"},{default:_(()=>[o.showDetails?(a(),r("div",ii,d(o.diceRolls),1)):h("",!0)]),_:2},1024)])):h("",!0)],64))],2))),128))]),_:1})])}const ni=P(so,[["render",li],["__scopeId","data-v-3b3fb983"]]),ai={name:"BGMPlayer",props:{bgmUrl:{type:String,default:""},bgmType:{type:String,default:"youtube",validator:t=>["youtube","audio"].includes(t)},volume:{type:Number,default:.5},autoPlay:{type:Boolean,default:!1}},data(){return{isPlaying:!1,isPaused:!1,isMuted:!1,currentVolume:this.volume,youtubePlayer:null,youtubeApiReady:!1}},computed:{youtubeVideoId(){if(this.bgmType!=="youtube"||!this.bgmUrl)return"";const t=[/(?:youtube\.com\/watch\?v=)([\w-]+)/,/(?:youtu\.be\/)([\w-]+)/,/(?:youtube\.com\/embed\/)([\w-]+)/,/^([\w-]{11})$/];for(const e of t){const l=this.bgmUrl.match(e);if(l)return l[1]}return""}},watch:{bgmUrl(t,e){t&&t!==e?(this.stopPlayer(),this.isPlaying=!1,this.isPaused=!1,this.initializePlayer()):t||this.stopPlayer()},volume(t){this.currentVolume=t,this.updateVolume()}},methods:{loadYouTubeAPI(){if(window.YT&&window.YT.Player){this.youtubeApiReady=!0;return}if(!document.getElementById("youtube-iframe-api")){const t=document.createElement("script");t.id="youtube-iframe-api",t.src="https://www.youtube.com/iframe_api";const e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e),window.onYouTubeIframeAPIReady=()=>{this.youtubeApiReady=!0,this.initYouTubePlayer()}}},initializePlayer(){this.$nextTick(()=>{this.bgmType==="youtube"?(this.loadYouTubeAPI(),this.youtubeApiReady&&this.initYouTubePlayer()):this.bgmType==="audio"&&this.initAudioPlayer()})},initYouTubePlayer(){!this.youtubeApiReady||!this.youtubeVideoId||(this.youtubePlayer&&(this.youtubePlayer.destroy(),this.youtubePlayer=null),this.$nextTick(()=>{this.youtubePlayer=new window.YT.Player(this.$refs.youtubeIframe,{videoId:this.youtubeVideoId,playerVars:{autoplay:this.autoPlay?1:0,loop:1,playlist:this.youtubeVideoId,controls:0,disablekb:1,fs:0,modestbranding:1},events:{onReady:t=>{t.target.setVolume(this.currentVolume*100),this.autoPlay&&(t.target.playVideo(),this.isPlaying=!0,this.isPaused=!1)},onStateChange:t=>{t.data===1?(this.isPlaying=!0,this.isPaused=!1):t.data===2?(this.isPlaying=!1,this.isPaused=!0):(t.data===0||t.data===-1)&&(this.isPlaying=!1,this.isPaused=!1)}}})}))},initAudioPlayer(){const t=this.$refs.audioPlayer;t&&(t.volume=this.currentVolume,this.autoPlay&&t.play().then(()=>{this.isPlaying=!0,this.isPaused=!1}).catch(e=>{console.warn("ÏûêÎèôÏû¨ÏÉù Ïã§Ìå®:",e),this.isPaused=!0}))},togglePlay(){if(this.bgmType==="audio"){const t=this.$refs.audioPlayer;t&&(this.isPlaying?(t.pause(),this.isPlaying=!1,this.isPaused=!0):t.play().then(()=>{this.isPlaying=!0,this.isPaused=!1}).catch(e=>{console.error("Ïû¨ÏÉù Ïã§Ìå®:",e),this.isPlaying=!1,this.isPaused=!0}))}else if(this.bgmType==="youtube"){if(!this.youtubePlayer)return;this.isPlaying?this.youtubePlayer.pauseVideo():this.youtubePlayer.playVideo()}},toggleMute(){if(this.isMuted=!this.isMuted,this.bgmType==="audio"){const t=this.$refs.audioPlayer;t&&(t.muted=this.isMuted)}else this.bgmType==="youtube"&&this.youtubePlayer&&(this.isMuted?this.youtubePlayer.mute():this.youtubePlayer.unMute())},updateVolume(){if(this.bgmType==="audio"){const t=this.$refs.audioPlayer;t&&(t.volume=this.currentVolume)}else this.bgmType==="youtube"&&this.youtubePlayer&&this.youtubePlayer.setVolume(this.currentVolume*100)},stopPlayer(){if(this.bgmType==="audio"){const t=this.$refs.audioPlayer;t&&(t.pause(),t.currentTime=0)}else this.bgmType==="youtube"&&this.youtubePlayer&&this.youtubePlayer.stopVideo();this.isPlaying=!1,this.isPaused=!1},handleAudioError(t){console.error("Ïò§ÎîîÏò§ Î°úÎìú Ïã§Ìå®:",t),this.$emit("error","BGM ÌååÏùºÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.")}},mounted(){this.bgmUrl&&this.initializePlayer()},beforeUnmount(){this.stopPlayer(),this.youtubePlayer&&(this.youtubePlayer.destroy(),this.youtubePlayer=null)}},ri={key:0,class:"bgm-player"},ci={key:0,class:"youtube-container"},di={ref:"youtubeIframe",style:{display:"none"}},ui=["src","autoplay"],hi={class:"bgm-controls"},mi=["title"],gi={class:"bgm-info"},yi={class:"bgm-status"},pi={class:"volume-control"},fi=["title"];function bi(t,e,l,m,n,i){const c=f("EmojiToIcon");return l.bgmUrl?(a(),r("div",ri,[l.bgmType==="youtube"&&i.youtubeVideoId?(a(),r("div",ci,[s("div",di,null,512)])):l.bgmType==="audio"?(a(),r("audio",{key:1,ref:"audioPlayer",src:l.bgmUrl,autoplay:l.autoPlay,loop:"",onError:e[0]||(e[0]=(...o)=>i.handleAudioError&&i.handleAudioError(...o))},null,40,ui)):h("",!0),s("div",hi,[s("button",{onClick:e[1]||(e[1]=(...o)=>i.togglePlay&&i.togglePlay(...o)),class:"bgm-button",title:n.isPlaying?"ÏùºÏãúÏ†ïÏßÄ":"Ïû¨ÏÉù"},[u(c,{emoji:n.isPlaying?"‚è∏Ô∏è":"‚ñ∂Ô∏è",size:16},null,8,["emoji"])],8,mi),s("div",gi,[e[5]||(e[5]=s("span",{class:"bgm-label"},"BGM",-1)),s("span",yi,d(n.isPlaying?"Ïû¨ÏÉù Ï§ë":n.isPaused?"ÏùºÏãúÏ†ïÏßÄ":"Ï†ïÏßÄ"),1)]),s("div",pi,[s("button",{onClick:e[2]||(e[2]=(...o)=>i.toggleMute&&i.toggleMute(...o)),class:"volume-button",title:n.isMuted?"ÏùåÏÜåÍ±∞ Ìï¥Ï†ú":"ÏùåÏÜåÍ±∞"},[u(c,{emoji:n.isMuted?"üîá":"üîä",size:14},null,8,["emoji"])],8,fi),v(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.currentVolume=o),type:"range",min:"0",max:"1",step:"0.05",class:"volume-slider",onInput:e[4]||(e[4]=(...o)=>i.updateVolume&&i.updateVolume(...o))},null,544),[[T,n.currentVolume,void 0,{number:!0}]])])])])):h("",!0)}const vi=P(ai,[["render",bi],["__scopeId","data-v-c8511153"]]),Si={name:"PlayerView",components:{DialogBox:Ye,CharacterDisplay:et,PlaybackControls:gt,HandoutDisplay:kt,ThemeSettingsModal:ys,SaveLoadModal:Bs,SceneSelectorModal:to,DiceRoll:ni,DXCombo:B,BGMPlayer:vi},setup(){return{logStore:L()}},data(){return{autoPlayTimer:null,typingSpeed:50,theaterMode:!1,autoPlaySpeed:1,showHandout:!1,currentHandout:null,showThemeSettings:!1,showSaveLoadModal:!1,saveLoadMode:"save",showSceneSelector:!1,bgmSettings:{url:"",type:"youtube",volume:.5,autoPlay:!1},showDiceOverlay:!1,currentDiceRolls:[],diceCharacterName:"",diceCharacterColor:"#ffffff",diceOverlayTimer:null,showComboOverlay:!1,currentDXCombos:[],comboCharacterName:"",comboCharacterColor:"#ffffff",comboOverlayTimer:null,previousSceneIndex:0,showSceneDescription:!1,sceneDescriptionData:null,sceneDescriptionTimer:null,isMobile:!1,isTablet:!1,isTouchDevice:!1,sfxAudio:null,currentBackground:null,previousBgmUrl:null,defaultThemeBackground:{url:"",opacity:.3,size:"cover"}}},watch:{"logStore.playback.currentSceneIndex"(t,e){t!==e&&this.onSceneChange()}},computed:{logTitle(){var t;return((t=this.logStore.vnData)==null?void 0:t.title)||"Î°úÍ∑∏ ÌîåÎ†àÏù¥Ïñ¥"},currentScene(){var l,m;const t=((l=this.logStore.vnData)==null?void 0:l.scenes)||[],e=((m=this.logStore.playback)==null?void 0:m.currentSceneIndex)||0;return t[e]||null},currentStep(){return this.logStore.currentStep},hasNextStep(){return this.logStore.hasNextStep},hasPreviousStep(){return this.logStore.hasPreviousStep},autoPlayEnabled(){var t;return((t=this.logStore.playback)==null?void 0:t.autoPlayEnabled)||!1},currentStepNumber(){var n,i,c,o;let t=0;const e=((n=this.logStore.vnData)==null?void 0:n.scenes)||[],l=((i=this.logStore.playback)==null?void 0:i.currentSceneIndex)||0,m=((c=this.logStore.playback)==null?void 0:c.currentStepIndex)||0;for(let g=0;g<l;g++)t+=((o=e[g])==null?void 0:o.steps.length)||0;return t+=m+1,t},totalSteps(){var e;return(((e=this.logStore.vnData)==null?void 0:e.scenes)||[]).reduce((l,m)=>{var n;return l+(((n=m==null?void 0:m.steps)==null?void 0:n.length)||0)},0)},currentSceneName(){const t=this.logStore.currentScene;return(t==null?void 0:t.name)||""},hasActiveOverlay(){return this.showDiceOverlay||this.showComboOverlay||this.showSceneDescription}},methods:{navigateToTargetStep(){var n;const t=sessionStorage.getItem("player-target-step");if(!t)return;const e=parseInt(t,10);if(isNaN(e)||e<1){sessionStorage.removeItem("player-target-step");return}let l=0;const m=((n=this.logStore.vnData)==null?void 0:n.scenes)||[];for(let i=0;i<m.length;i++){const o=m[i].steps.length;if(e<=l+o){const g=e-l-1;this.logStore.goToStep(i,g),sessionStorage.removeItem("player-target-step");return}l+=o}sessionStorage.removeItem("player-target-step")},detectDevice(){const t=navigator.userAgent.toLowerCase(),e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t),l=/ipad|android(?!.*mobile)|tablet/i.test(t),m="ontouchstart"in window||navigator.maxTouchPoints>0,n=window.innerWidth,i=n<=767,c=n>=768&&n<=1023;this.isMobile=e&&i||m&&i,this.isTablet=l&&c||m&&c&&!e,this.isTouchDevice=m,this.isMobile&&(this.typingSpeed=30),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device"),this.isMobile?document.body.classList.add("device-mobile"):this.isTablet?document.body.classList.add("device-tablet"):document.body.classList.add("device-desktop"),this.isTouchDevice&&document.body.classList.add("touch-device"),console.log("Device Detection:",{isMobile:this.isMobile,isTablet:this.isTablet,isTouchDevice:this.isTouchDevice,screenWidth:n,userAgent:t})},getCharacterName(t){return t.type==="system"?t.character.name||"ÏãúÏä§ÌÖú":t.type==="narrator"?"":t.character.name},handleAdvance(){var t;console.log("[PlayerView] handleAdvance Ìò∏Ï∂ú:",{hasNextStep:this.hasNextStep,autoPlayEnabled:this.autoPlayEnabled,currentStepIndex:(t=this.logStore.playback)==null?void 0:t.currentStepIndex}),this.hasNextStep?this.nextStep():this.autoPlayEnabled&&this.logStore.toggleAutoPlay()},handleTypingComplete(){},goHome(){this.stopAutoPlay(),this.$router.push("/")},openEditor(){sessionStorage.setItem("editor-target-step",this.currentStepNumber),this.$router.push("/editor")},openSettings(){this.showThemeSettings=!0},closeSettings(){this.showThemeSettings=!1},handleThemeSave(t){},handleBgmChange(t){this.bgmSettings={...t}},openSceneSelector(){this.showSceneSelector=!0},closeSceneSelector(){this.showSceneSelector=!1},handleGoToStep(t,e){const l=this.logStore.playback.currentSceneIndex;this.logStore.goToStep(t,e),l!==t&&this.onSceneChange(),this.closeSceneSelector(),this.showOverlaysIfPresent()},openSaveModal(){this.saveLoadMode="save",this.showSaveLoadModal=!0},openLoadModal(){this.saveLoadMode="load",this.showSaveLoadModal=!0},closeSaveLoadModal(){this.showSaveLoadModal=!1},handleSave(t){this.logStore.saveProgress(t)},handleLoad(t){this.logStore.loadProgress(t)},openHandout(t){this.currentHandout=t,this.showHandout=!0},closeHandout(){this.showHandout=!1,this.currentHandout=null},onSceneChange(){this.showDiceOverlay=!1,this.showComboOverlay=!1,this.showHandout=!1,this.currentHandout=null,this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),this.displaySceneDescriptionIfPresent()},displaySceneDescriptionIfPresent(){if(!this.currentScene)return;const t=this.currentScene.steps[0];t&&t.type==="scene-description"&&(this.sceneDescriptionData={number:t.sceneNumber,title:t.sceneTitle,pcs:t.scenePCs,description:t.sceneDescription,fullText:t.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance())},closeSceneDescription(){this.showSceneDescription=!1;const t=this.sceneDescriptionTimer!==null;this.stopSceneDescriptionAutoAdvance(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startSceneDescriptionAutoAdvance(){this.stopSceneDescriptionAutoAdvance(),this.sceneDescriptionTimer=setTimeout(()=>{this.closeSceneDescription(),this.autoPlayEnabled&&(this.hasNextStep?this.nextStep():this.logStore.toggleAutoPlay())},3e3/this.autoPlaySpeed)},stopSceneDescriptionAutoAdvance(){this.sceneDescriptionTimer&&(clearTimeout(this.sceneDescriptionTimer),this.sceneDescriptionTimer=null)},nextStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.nextStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.applyStepEffects(),this.showOverlaysIfPresent(),this.logStore.playback.currentStepIndex%10===0&&this.logStore.autoSave()},previousStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.previousStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.applyStepEffects(),this.showOverlaysIfPresent()},showOverlaysIfPresent(){if(this.currentStep&&this.currentStep.type==="scene-description"){this.sceneDescriptionData={number:this.currentStep.sceneNumber,title:this.currentStep.sceneTitle,pcs:this.currentStep.scenePCs,description:this.currentStep.sceneDescription,fullText:this.currentStep.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance();return}const t=this.currentStep&&this.currentStep.diceRolls&&this.currentStep.diceRolls.length>0,e=this.currentStep&&this.currentStep.ougis&&this.currentStep.ougis.length>0,l=this.currentStep&&this.currentStep.shinobigamis&&this.currentStep.shinobigamis.length>0,m=this.currentStep&&this.currentStep.dxCombos&&this.currentStep.dxCombos.length>0;if(t||e||l){const n=[...this.currentStep.ougis||[],...this.currentStep.shinobigamis||[],...this.currentStep.diceRolls||[]];this.currentDiceRolls=n,this.diceCharacterName=this.getCharacterName(this.currentStep),this.diceCharacterColor=this.currentStep.character.color,this.showDiceOverlay=!0,this.autoPlayEnabled&&this.startDiceOverlayAutoClose();return}m&&(this.currentDXCombos=this.currentStep.dxCombos,this.comboCharacterName=this.getCharacterName(this.currentStep),this.comboCharacterColor=this.currentStep.character.color,this.showComboOverlay=!0,this.autoPlayEnabled&&this.startComboOverlayAutoClose())},closeDiceOverlay(){this.showDiceOverlay=!1;const t=this.diceOverlayTimer!==null;this.stopDiceOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startDiceOverlayAutoClose(){this.stopDiceOverlayAutoClose(),this.diceOverlayTimer=setTimeout(()=>{this.closeDiceOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3/this.autoPlaySpeed)},stopDiceOverlayAutoClose(){this.diceOverlayTimer&&(clearTimeout(this.diceOverlayTimer),this.diceOverlayTimer=null)},closeComboOverlay(){this.showComboOverlay=!1;const t=this.comboOverlayTimer!==null;this.stopComboOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startComboOverlayAutoClose(){this.stopComboOverlayAutoClose(),this.comboOverlayTimer=setTimeout(()=>{this.closeComboOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3/this.autoPlaySpeed)},stopComboOverlayAutoClose(){this.comboOverlayTimer&&(clearTimeout(this.comboOverlayTimer),this.comboOverlayTimer=null)},toggleAutoPlay(){const t=this.autoPlayEnabled;this.logStore.toggleAutoPlay(),!t&&this.autoPlayEnabled&&this.hasActiveOverlay},toggleTheaterMode(){this.theaterMode=!this.theaterMode,this.theaterMode&&!this.autoPlayEnabled&&(this.logStore.toggleAutoPlay(),!this.hasActiveOverlay&&this.hasNextStep&&this.nextStep()),console.log("[PlayerView] Í∞êÏÉÅ Î™®Îìú:",this.theaterMode?"ÌôúÏÑ±Ìôî":"ÎπÑÌôúÏÑ±Ìôî")},handleTheaterModeClick(t){if(this.theaterMode){if(t.target.closest("button")||t.target.closest(".dialog-box"))return;this.theaterMode=!1,console.log("[PlayerView] Í∞êÏÉÅ Î™®Îìú Ï¢ÖÎ£å (ÌÅ¥Î¶≠)")}},changeAutoPlaySpeed(t){this.autoPlaySpeed=t,console.log("[PlayerView] ÏûêÎèôÏû¨ÏÉù ÏÜçÎèÑ Î≥ÄÍ≤Ω:",t+"Î∞∞ÏÜç")},stopAutoPlay(){this.autoPlayTimer&&(clearInterval(this.autoPlayTimer),this.autoPlayTimer=null)},applyStepEffects(){if(!this.currentStep){console.log("[applyStepEffects] currentStepÏù¥ ÏóÜÏäµÎãàÎã§.");return}const t=this.currentStep.effects;console.log("[applyStepEffects] Ïä§ÌÖù Ìö®Í≥º Ï†ÅÏö©:",{stepNumber:this.currentStepNumber,hasEffects:!!t,effects:t}),t!=null&&t.sfx?(console.log("[applyStepEffects] Ìö®Í≥ºÏùå Î∞úÍ≤¨, Ïû¨ÏÉù ÏãúÏûë:",t.sfx),this.playSFX(t.sfx)):console.log("[applyStepEffects] Ìö®Í≥ºÏùå ÏóÜÏùå");const e=(t==null?void 0:t.bgm)||null;if(e!==this.previousBgmUrl&&(e?this.changeBGM(e):this.restoreDefaultBGM(),this.previousBgmUrl=e),t!=null&&t.background){const l=t.backgroundOpacity??.3;this.changeBackground(t.background,l)}else this.currentBackground&&this.currentBackground!==this.defaultThemeBackground.url&&this.restoreDefaultBackground()},async playSFX(t){if(!t||!t.trim()){console.warn("[playSFX] Ìö®Í≥ºÏùå URLÏù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.");return}console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏãúÎèÑ:",t);try{let e=t.trim();if(e.includes("youtube.com")||e.includes("youtu.be")){console.warn("[playSFX] YouTube Ìö®Í≥ºÏùåÏùÄ Ïò§ÎîîÏò§ ÌååÏùº URLÎ°ú Î≥ÄÌôòÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.");return}if(e.includes("drive.google.com")||e.includes("docs.google.com")){let m=null;const n=e.match(/\/file\/d\/([^\/\?]+)/);n&&(m=n[1]);const i=e.match(/[?&]id=([^&]+)/);i&&(m=i[1]),m&&(e=`https://docs.google.com/uc?export=download&id=${m}`,console.log("[playSFX] Google Drive URL Î≥ÄÌôò:",e))}const l=new Audio(e);l.volume=.7,l.loop=!1,console.log("[playSFX] Audio Í∞ùÏ≤¥ ÏÉùÏÑ± ÏôÑÎ£å, Î°úÎî© Ï§ë..."),l.addEventListener("loadeddata",()=>{console.log("[playSFX] Ïò§ÎîîÏò§ Î°úÎìú ÏôÑÎ£å, Ïû¨ÏÉù ÏãúÏûë")}),l.addEventListener("ended",()=>{console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏôÑÎ£å"),l.src="",this.sfxAudio===l&&(this.sfxAudio=null)}),l.addEventListener("error",m=>{console.error("[playSFX] Ìö®Í≥ºÏùå Î°úÎìú/Ïû¨ÏÉù Ïã§Ìå®:",{error:m,url:e,readyState:l.readyState,networkState:l.networkState}),e.includes("youtube.com")||e.includes("youtu.be")?console.warn("[playSFX] YouTube URLÏùÄ ÏßÅÏ†ë Ïò§ÎîîÏò§ Ïû¨ÏÉùÏù¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§. Ïò§ÎîîÏò§ ÌååÏùº URLÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî."):e.includes("google.com")&&(console.error("[playSFX] Google Drive/Docs ÌååÏùº Ïû¨ÏÉù Ïã§Ìå®"),console.warn("Ìï¥Í≤∞ Î∞©Î≤ï:"),console.warn('1. ÌååÏùºÏù¥ "ÎßÅÌÅ¨Í∞Ä ÏûàÎäî Î™®Îì† ÏÇ¨Ïö©Ïûê" Í≥µÏú† ÏÑ§Ï†ïÏù∏ÏßÄ ÌôïÏù∏'),console.warn("2. ÎòêÎäî Îã§Î•∏ Ìò∏Ïä§ÌåÖ ÏÑúÎπÑÏä§ ÏÇ¨Ïö© (Ïòà: GitHub, Dropbox, ÏßÅÏ†ë ÏÑúÎ≤Ñ)"),console.warn("3. ÎòêÎäî base64 Ïù∏ÏΩîÎî©Îêú data URL ÏÇ¨Ïö©"))});try{await l.play(),console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏãúÏûë ÏÑ±Í≥µ")}catch(m){console.error("[playSFX] Ïû¨ÏÉù Ïã§Ìå®:",{error:m,message:m.message,name:m.name}),m.name==="NotAllowedError"&&console.warn("[playSFX] Î∏åÎùºÏö∞Ï†Ä ÏûêÎèôÏû¨ÏÉù Ï†ïÏ±ÖÏúºÎ°ú Ïù∏Ìï¥ Ìö®Í≥ºÏùå Ïû¨ÏÉùÏù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§. ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© ÌõÑ Ïû¨ÏãúÎèÑÌïòÏÑ∏Ïöî.")}this.sfxAudio=l}catch(e){console.error("[playSFX] Ìö®Í≥ºÏùå Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò:",e)}},changeBGM(t){const e=t.includes("youtube.com")||t.includes("youtu.be");this.bgmSettings={url:t,type:e?"youtube":"audio",volume:this.bgmSettings.volume||.5,autoPlay:!0}},changeBackground(t,e=.3){this.currentBackground=t;const l=`linear-gradient(rgba(0, 0, 0, ${1-e}), rgba(0, 0, 0, ${1-e}))`;document.documentElement.style.setProperty("--bg-image",`${l}, url(${t})`),document.documentElement.style.setProperty("--bg-image-size","cover")},restoreDefaultBGM(){const t=localStorage.getItem("vnlog-theme-settings");if(t)try{const e=JSON.parse(t);if(e.bgmUrl){this.bgmSettings={url:e.bgmUrl,type:e.bgmType||"youtube",volume:e.bgmVolume||.5,autoPlay:!0};return}}catch(e){console.warn("ÌÖåÎßà ÏÑ§Ï†ï Î≥µÏõê Ïã§Ìå®:",e)}this.bgmSettings={url:"",type:"youtube",volume:this.bgmSettings.volume||.5,autoPlay:!1}},clearBackground(){this.currentBackground=null,document.documentElement.style.setProperty("--bg-image","none")},restoreDefaultBackground(){this.defaultThemeBackground.url?this.changeBackground(this.defaultThemeBackground.url,this.defaultThemeBackground.opacity):this.clearBackground()},handleKeyPress(t){if(!(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"))switch(t.key){case" ":case"Enter":t.preventDefault(),this.handleAdvance();break;case"ArrowLeft":t.preventDefault(),this.hasPreviousStep&&this.previousStep();break;case"ArrowRight":t.preventDefault(),this.hasNextStep&&this.nextStep();break}}},mounted(){var e,l;if(!this.logStore.rawLog){console.warn("Î°úÍ∑∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}if(!this.logStore.vnData||!this.logStore.vnData.scenes||this.logStore.vnData.scenes.length===0){console.warn("ÌååÏã±Îêú VN Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}const t=localStorage.getItem("vnlog-theme-settings");if(t)try{const m=JSON.parse(t);m.bgmUrl&&(this.bgmSettings={url:m.bgmUrl,type:m.bgmType||"youtube",volume:m.bgmVolume||.5,autoPlay:m.bgmAutoPlay||!1},this.previousBgmUrl=m.bgmUrl),m.bgImageUrl&&(this.defaultThemeBackground={url:m.bgImageUrl,opacity:m.bgImageOpacity??.3,size:m.bgImageSize||"cover"})}catch(m){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:",m)}this.detectDevice(),window.addEventListener("resize",this.detectDevice),window.addEventListener("keydown",this.handleKeyPress),this.navigateToTargetStep(),this.$nextTick(()=>{this.applyStepEffects(),this.showOverlaysIfPresent()}),console.log("PlayerView mounted:",{hasRawLog:!!this.logStore.rawLog,hasVNData:!!this.logStore.vnData,sceneCount:((l=(e=this.logStore.vnData)==null?void 0:e.scenes)==null?void 0:l.length)||0,currentStep:this.currentStep})},beforeUnmount(){this.stopAutoPlay(),this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),window.removeEventListener("keydown",this.handleKeyPress),window.removeEventListener("resize",this.detectDevice),this.sfxAudio&&(this.sfxAudio.pause(),this.sfxAudio=null),this.currentBackground&&(document.documentElement.style.removeProperty("--bg-image"),document.documentElement.style.removeProperty("--bg-image-size")),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device")}},_i={class:"player-container"},Ci={class:"log-title"},ki={class:"header-buttons"},Ti=["title"],wi={class:"player-stage"},Pi={key:1,class:"dialog-wrapper"},xi={key:1,class:"dialog-placeholder"},Ii={class:"dice-overlay-hint"},Di={class:"combo-overlay-header"},Ai={class:"combo-character-info"},Ei={class:"dice-overlay-hint"},Oi={class:"scene-description-content"},ji={class:"scene-description-header"},Ni={class:"scene-number"},Bi={class:"scene-title"},Mi={key:0,class:"scene-pcs"},Ui={class:"scene-pcs-value"},Vi={key:1,class:"scene-description-text"};function zi(t,e,l,m,n,i){const c=f("EmojiToIcon"),o=f("CharacterDisplay"),g=f("DialogBox"),y=f("DiceRoll"),S=f("DXCombo"),E=f("PlaybackControls"),N=f("SceneSelectorModal"),M=f("HandoutDisplay"),U=f("ThemeSettingsModal"),V=f("SaveLoadModal"),z=f("BGMPlayer");return a(),r("div",{class:"player-view",onClick:e[12]||(e[12]=(...b)=>i.handleTheaterModeClick&&i.handleTheaterModeClick(...b))},[s("div",_i,[s("div",{class:w(["player-header",{"theater-mode":n.theaterMode}])},[s("button",{onClick:e[0]||(e[0]=(...b)=>i.goHome&&i.goHome(...b)),class:"back-button"},[u(c,{emoji:"üè†",size:20})]),s("h2",Ci,d(i.logTitle),1),s("div",ki,[s("button",{onClick:e[1]||(e[1]=A((...b)=>i.toggleTheaterMode&&i.toggleTheaterMode(...b),["stop"])),class:"header-button",title:n.theaterMode?"Í∞êÏÉÅ Î™®Îìú Ï¢ÖÎ£å":"Í∞êÏÉÅ Î™®Îìú"},[u(c,{emoji:n.theaterMode?"üé¨":"üé•",size:20},null,8,["emoji"])],8,Ti),n.isMobile!=!0?(a(),r("button",{key:0,onClick:e[2]||(e[2]=(...b)=>i.openEditor&&i.openEditor(...b)),class:"header-button",title:"Ìö®Í≥º Ìé∏Ïßë"},[u(c,{emoji:"‚ú®",size:20})])):h("",!0),s("button",{onClick:e[3]||(e[3]=(...b)=>i.openSceneSelector&&i.openSceneSelector(...b)),class:"header-button",title:"Ïî¨ ÏÑ†ÌÉù"},[u(c,{emoji:"üìë",size:20})]),s("button",{onClick:e[4]||(e[4]=(...b)=>i.openSaveModal&&i.openSaveModal(...b)),class:"header-button",title:"Ï†ÄÏû•"},[u(c,{emoji:"üíæ",size:20})]),s("button",{onClick:e[5]||(e[5]=(...b)=>i.openLoadModal&&i.openLoadModal(...b)),class:"header-button",title:"Î∂àÎü¨Ïò§Í∏∞"},[u(c,{emoji:"üìÇ",size:20})]),s("button",{onClick:e[6]||(e[6]=(...b)=>i.openSettings&&i.openSettings(...b)),class:"header-button",title:"ÏÑ§Ï†ï"},[u(c,{emoji:"‚öôÔ∏è",size:20})])])],2),s("div",wi,[i.currentStep&&!i.currentStep.isSceneDescription&&m.logStore.vnData.characters?(a(),I(o,{key:0,"current-step":i.currentStep,characters:m.logStore.vnData.characters,layout:"single"},null,8,["current-step","characters"])):h("",!0),!i.currentStep||i.currentStep.type!=="scene-description"?(a(),r("div",Pi,[i.currentStep&&i.currentStep.character?(a(),I(g,{key:0,"step-type":i.currentStep.type||"dialogue","character-name":i.getCharacterName(i.currentStep),"character-color":i.currentStep.character.color,text:i.currentStep.text,"status-changes":i.currentStep.statusChanges||[],illustrations:i.currentStep.illustrations||[],"typing-speed":n.typingSpeed,"auto-play-speed":n.autoPlaySpeed,"auto-advance":i.autoPlayEnabled,"has-overlay":i.hasActiveOverlay,onAdvance:i.handleAdvance,onTypingComplete:i.handleTypingComplete},null,8,["step-type","character-name","character-color","text","status-changes","illustrations","typing-speed","auto-play-speed","auto-advance","has-overlay","onAdvance","onTypingComplete"])):(a(),r("div",xi,[...e[13]||(e[13]=[s("p",null,"Î°úÍ∑∏Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...",-1)])]))])):h("",!0)]),u(k,{name:"dice-overlay"},{default:_(()=>[n.showDiceOverlay&&n.currentDiceRolls.length>0?(a(),r("div",{key:0,class:"dice-overlay",onClick:e[8]||(e[8]=(...b)=>i.closeDiceOverlay&&i.closeDiceOverlay(...b))},[s("div",{class:"dice-overlay-content",onClick:e[7]||(e[7]=A(()=>{},["stop"]))},[u(y,{"dice-rolls":n.currentDiceRolls,"character-name":n.diceCharacterName,"character-color":n.diceCharacterColor,animated:!0,"play-sound-effect":!1},null,8,["dice-rolls","character-name","character-color"]),s("div",Ii,[u(c,{emoji:"üëÜ",size:14}),e[14]||(e[14]=s("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),u(k,{name:"dice-overlay"},{default:_(()=>[n.showComboOverlay&&n.currentDXCombos.length>0?(a(),r("div",{key:0,class:"dice-overlay",onClick:e[10]||(e[10]=(...b)=>i.closeComboOverlay&&i.closeComboOverlay(...b))},[s("div",{class:"dice-overlay-content",onClick:e[9]||(e[9]=A(()=>{},["stop"]))},[s("div",Di,[s("div",Ai,[s("div",{class:"combo-character-name",style:D({color:n.comboCharacterColor})},d(n.comboCharacterName),5)])]),u(S,{dxCombos:n.currentDXCombos},null,8,["dxCombos"]),s("div",Ei,[u(c,{emoji:"üëÜ",size:14}),e[15]||(e[15]=s("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),u(k,{name:"scene-description"},{default:_(()=>[n.showSceneDescription&&n.sceneDescriptionData?(a(),r("div",{key:0,class:"scene-description-overlay",onClick:e[11]||(e[11]=(...b)=>i.closeSceneDescription&&i.closeSceneDescription(...b))},[s("div",Oi,[s("div",ji,[s("span",Ni,"Ïî¨ "+d(n.sceneDescriptionData.number),1),s("span",Bi,d(n.sceneDescriptionData.title),1)]),n.sceneDescriptionData.pcs?(a(),r("div",Mi,[e[16]||(e[16]=s("span",{class:"scene-pcs-label"},"PC:",-1)),s("span",Ui,d(n.sceneDescriptionData.pcs),1)])):h("",!0),n.sceneDescriptionData.description?(a(),r("div",Vi,d(n.sceneDescriptionData.description),1)):h("",!0),e[17]||(e[17]=s("div",{class:"scene-description-hint"},"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])):h("",!0)]),_:1}),n.theaterMode?h("",!0):(a(),I(E,{key:0,"current-step-number":i.currentStepNumber,"total-steps":i.totalSteps,"current-scene-name":i.currentSceneName,"has-previous-step":i.hasPreviousStep,"has-next-step":i.hasNextStep,"auto-play-enabled":i.autoPlayEnabled,"auto-play-speed":n.autoPlaySpeed,"show-progress-bar":!0,"show-scene-selector":!0,onPrevious:i.previousStep,onNext:i.handleAdvance,onToggleAutoplay:i.toggleAutoPlay,onChangeSpeed:i.changeAutoPlaySpeed,onOpenSceneSelector:i.openSceneSelector},null,8,["current-step-number","total-steps","current-scene-name","has-previous-step","has-next-step","auto-play-enabled","auto-play-speed","onPrevious","onNext","onToggleAutoplay","onChangeSpeed","onOpenSceneSelector"]))]),u(N,{"is-visible":n.showSceneSelector,scenes:m.logStore.vnData.scenes,"current-scene-index":m.logStore.playback.currentSceneIndex,"current-step-index":m.logStore.playback.currentStepIndex,onClose:i.closeSceneSelector,onGoToStep:i.handleGoToStep},null,8,["is-visible","scenes","current-scene-index","current-step-index","onClose","onGoToStep"]),u(M,{handout:n.currentHandout,"is-visible":n.showHandout,onClose:i.closeHandout},null,8,["handout","is-visible","onClose"]),u(U,{"is-visible":n.showThemeSettings,onClose:i.closeSettings,onSave:i.handleThemeSave,onBgmChange:i.handleBgmChange},null,8,["is-visible","onClose","onSave","onBgmChange"]),u(V,{"is-visible":n.showSaveLoadModal,mode:n.saveLoadMode,onClose:i.closeSaveLoadModal,onSave:i.handleSave,onLoad:i.handleLoad},null,8,["is-visible","mode","onClose","onSave","onLoad"]),u(z,{"bgm-url":n.bgmSettings.url,"bgm-type":n.bgmSettings.type,volume:n.bgmSettings.volume,"auto-play":n.bgmSettings.autoPlay},null,8,["bgm-url","bgm-type","volume","auto-play"])])}const Hi=P(Si,[["render",zi],["__scopeId","data-v-a4833d6c"]]);export{Hi as default};
