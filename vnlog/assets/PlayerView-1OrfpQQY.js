import{S as O,u as N}from"./logStore-D9VA4ea1.js";import{B as V,D as F,a as R,P as X,C as H,b as K}from"./BGMPlayer-BmQRYUjo.js";import{_ as x,g as f,w,T as D,r as b,o as d,c as u,f as h,a as o,h as C,d as c,t as m,e as g,i as S,v,j as _,k as G,l as M,F as E,m as A,n as I}from"./index-ClAIIpdQ.js";const Y={name:"HandoutDisplay",props:{handout:{type:Object,default:()=>({id:null,title:"",imageUrl:"",description:""})},isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{imageLoadError:!1}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},handleImageError(){this.imageLoadError=!0,console.error(`Ìï∏ÎìúÏïÑÏõÉ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${this.handout.imageUrl}`)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.imageLoadError=!1)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},J={key:0,class:"handout-header"},W={class:"handout-title"},q={class:"handout-content"},Q=["src","alt"],Z={key:1,class:"handout-placeholder"},$={key:2,class:"handout-description"};function ee(t,e,n,r,l,s){const a=b("EmojiToIcon");return d(),f(D,{name:"handout-overlay"},{default:w(()=>[n.isVisible?(d(),u("div",{key:0,class:"handout-overlay",onClick:e[3]||(e[3]=(...i)=>s.handleOverlayClick&&s.handleOverlayClick(...i))},[o("div",{class:"handout-container",onClick:e[2]||(e[2]=C(()=>{},["stop"]))},[o("button",{class:"close-button",onClick:e[0]||(e[0]=(...i)=>s.close&&s.close(...i)),title:"Îã´Í∏∞ (ESC)"},[c(a,{emoji:"‚úñÔ∏è",size:24})]),n.handout.title?(d(),u("div",J,[o("h2",W,m(n.handout.title),1)])):h("",!0),o("div",q,[n.handout.imageUrl?(d(),u("img",{key:0,src:n.handout.imageUrl,alt:n.handout.title||"Ìï∏ÎìúÏïÑÏõÉ",class:"handout-image",onError:e[1]||(e[1]=(...i)=>s.handleImageError&&s.handleImageError(...i))},null,40,Q)):(d(),u("div",Z,[c(a,{emoji:"üñºÔ∏è",size:64}),e[4]||(e[4]=o("p",null,"Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§",-1))])),n.handout.description?(d(),u("div",$,[o("p",null,m(n.handout.description),1)])):h("",!0)])])])):h("",!0)]),_:1})}const te=x(Y,[["render",ee],["__scopeId","data-v-051f2115"]]),oe={name:"ThemeSettingsModal",props:{isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{localSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",bgSecondary:"#1f1f1f5",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard",bgImageUrl:"",bgImageOpacity:.3,bgImageSize:"cover",bgmUrl:"",bgmType:"youtube",bgmVolume:.5,bgmAutoPlay:!1},defaultSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",bgSecondary:"#1f1f1f5",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard",bgImageUrl:"",bgImageOpacity:.3,bgImageSize:"cover",bgmUrl:"",bgmType:"youtube",bgmVolume:.5,bgmAutoPlay:!1},youtubeVideoId:"",isLoadingFile:!1}},computed:{previewStyles(){const t={"--preview-primary":this.localSettings.primaryColor,"--preview-bg":this.localSettings.bgColor,"--preview-text":this.localSettings.textColor,"--preview-border":this.localSettings.borderColor,fontFamily:this.localSettings.fontFamily};return this.localSettings.bgImageUrl&&(t.backgroundImage=`linear-gradient(rgba(0, 0, 0, ${1-this.localSettings.bgImageOpacity}), rgba(0, 0, 0, ${1-this.localSettings.bgImageOpacity})), url(${this.localSettings.bgImageUrl})`,t.backgroundSize=this.localSettings.bgImageSize,t.backgroundPosition="center",t.backgroundRepeat="no-repeat"),t},extractedYoutubeId(){if(this.localSettings.bgmType!=="youtube"||!this.localSettings.bgmUrl)return"";const t=[/(?:youtube\.com\/watch\?v=)([\w-]+)/,/(?:youtu\.be\/)([\w-]+)/,/(?:youtube\.com\/embed\/)([\w-]+)/,/^([\w-]{11})$/];for(const e of t){const n=this.localSettings.bgmUrl.match(e);if(n)return n[1]}return""}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},loadSettings(){const t=localStorage.getItem("vnlog-theme-settings");if(t)try{this.localSettings={...this.defaultSettings,...JSON.parse(t)}}catch(e){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®:",e)}},saveSettings(){localStorage.setItem("vnlog-theme-settings",JSON.stringify(this.localSettings)),this.applyTheme(this.localSettings),this.$emit("bgm-change",{url:this.localSettings.bgmUrl,type:this.localSettings.bgmType,volume:this.localSettings.bgmVolume,autoPlay:this.localSettings.bgmAutoPlay}),this.$emit("save",this.localSettings),this.$emit("close")},applyTheme(t){const e=document.documentElement;if(e.style.setProperty("--primary-color",t.primaryColor),e.style.setProperty("--bg-color",t.bgColor),e.style.setProperty("--bg-secondary",t.bgSecondary),e.style.setProperty("--text-color",t.textColor),e.style.setProperty("--border-color",t.borderColor),e.style.setProperty("--font-family",t.fontFamily),t.bgImageUrl){const n=`linear-gradient(rgba(0, 0, 0, ${1-t.bgImageOpacity}), rgba(0, 0, 0, ${1-t.bgImageOpacity}))`;e.style.setProperty("--bg-image",`${n}, url(${t.bgImageUrl})`),e.style.setProperty("--bg-image-size",t.bgImageSize)}else e.style.setProperty("--bg-image","none")},resetToDefault(){this.localSettings={...this.defaultSettings}},async handleBgImageFileSelect(t){const e=t.target.files[0];if(e){if(e.size>2*1024*1024){alert("Ïù¥ÎØ∏ÏßÄ ÌååÏùº ÌÅ¨Í∏∞Îäî 2MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§."),t.target.value="";return}this.isLoadingFile=!0;try{const n=await this.fileToBase64(e);this.localSettings.bgImageUrl=n,console.log("[ThemeSettings] Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å:",{fileName:e.name,fileSize:e.size,base64Length:n.length})}catch(n){console.error("[ThemeSettings] ÌååÏùº Î°úÎìú Ïã§Ìå®:",n),alert("ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}finally{this.isLoadingFile=!1,t.target.value=""}}},async handleBgmFileSelect(t){const e=t.target.files[0];if(e){if(e.size>10*1024*1024){alert("BGM ÌååÏùº ÌÅ¨Í∏∞Îäî 10MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§."),t.target.value="";return}this.isLoadingFile=!0;try{const n=await this.fileToBase64(e);this.localSettings.bgmUrl=n,console.log("[ThemeSettings] BGM ÌååÏùº Î°úÎìú ÏôÑÎ£å:",{fileName:e.name,fileSize:e.size,base64Length:n.length})}catch(n){console.error("[ThemeSettings] ÌååÏùº Î°úÎìú Ïã§Ìå®:",n),alert("ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}finally{this.isLoadingFile=!1,t.target.value=""}}},fileToBase64(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)})},clearBgImage(){this.localSettings.bgImageUrl=""},clearBgm(){this.localSettings.bgmUrl=""},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSettings(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="")}}},mounted(){this.loadSettings(),this.applyTheme(this.localSettings)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},se={class:"modal-header"},le={class:"modal-title"},ie={class:"modal-content"},ne={class:"setting-group"},re={class:"setting-label"},ae={class:"color-picker-wrapper"},ce={class:"setting-group"},de={class:"setting-label"},ue={class:"color-picker-wrapper"},he={class:"setting-group"},me={class:"setting-label"},ge={class:"color-picker-wrapper"},pe={class:"setting-group"},ye={class:"setting-label"},Se={class:"color-picker-wrapper"},be={class:"setting-group"},ve={class:"setting-label"},fe={class:"color-picker-wrapper"},Ce={class:"setting-group"},ke={class:"setting-label"},we={class:"setting-group"},De={class:"setting-label"},Te={class:"file-input-group"},xe={class:"hint-text"},Pe={key:0,class:"setting-group"},Ie={class:"setting-label"},Oe={key:1,class:"setting-group"},_e={class:"setting-label"},Ee={class:"setting-group"},Ae={class:"setting-label"},Me={class:"setting-group"},Ue={class:"setting-label"},Be={class:"file-input-group"},Le=["placeholder"],ze={key:0,class:"hint-text"},je={key:1,class:"hint-text"},Ne={key:2,class:"setting-group"},Ve={class:"setting-label"},Fe={key:3,class:"setting-group"},Re={class:"checkbox-label"},Xe={class:"preview-section"},He={class:"modal-footer"},Ke={class:"button-group"};function Ge(t,e,n,r,l,s){const a=b("EmojiToIcon");return d(),f(D,{name:"modal-overlay"},{default:w(()=>[n.isVisible?(d(),u("div",{key:0,class:"modal-overlay",onClick:e[29]||(e[29]=(...i)=>s.handleOverlayClick&&s.handleOverlayClick(...i))},[o("div",{class:"modal-container",onClick:e[28]||(e[28]=C(()=>{},["stop"]))},[o("div",se,[o("h2",le,[c(a,{emoji:"üé®",size:24}),e[30]||(e[30]=g(" ÌÖåÎßà ÏÑ§Ï†ï ",-1))]),o("button",{class:"close-button",onClick:e[0]||(e[0]=(...i)=>s.close&&s.close(...i)),title:"Îã´Í∏∞ (ESC)"},[c(a,{emoji:"‚úñÔ∏è",size:20})])]),o("div",ie,[o("div",ne,[o("label",re,[c(a,{emoji:"üé®",size:16}),e[31]||(e[31]=g(" Ï£ºÏöî ÏÉâÏÉÅ ",-1))]),o("div",ae,[S(o("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>l.localSettings.primaryColor=i),type:"color",class:"color-picker"},null,512),[[v,l.localSettings.primaryColor]]),S(o("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>l.localSettings.primaryColor=i),type:"text",class:"color-input",placeholder:"#6366f1"},null,512),[[v,l.localSettings.primaryColor]])])]),o("div",ce,[o("label",de,[c(a,{emoji:"üñºÔ∏è",size:16}),e[32]||(e[32]=g(" Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),o("div",ue,[S(o("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>l.localSettings.bgColor=i),type:"color",class:"color-picker"},null,512),[[v,l.localSettings.bgColor]]),S(o("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>l.localSettings.bgColor=i),type:"text",class:"color-input",placeholder:"#1a1a2e"},null,512),[[v,l.localSettings.bgColor]])])]),o("div",he,[o("label",me,[c(a,{emoji:"üé®",size:16}),e[33]||(e[33]=g(" Î≥¥Ï°∞ Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),o("div",ge,[S(o("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>l.localSettings.bgSecondary=i),type:"color",class:"color-picker"},null,512),[[v,l.localSettings.bgSecondary]]),S(o("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>l.localSettings.bgSecondary=i),type:"text",class:"color-input",placeholder:"#f5f5f5"},null,512),[[v,l.localSettings.bgSecondary]])])]),o("div",pe,[o("label",ye,[c(a,{emoji:"üìù",size:16}),e[34]||(e[34]=g(" ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ ",-1))]),o("div",Se,[S(o("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>l.localSettings.textColor=i),type:"color",class:"color-picker"},null,512),[[v,l.localSettings.textColor]]),S(o("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>l.localSettings.textColor=i),type:"text",class:"color-input",placeholder:"#ffffff"},null,512),[[v,l.localSettings.textColor]])])]),o("div",be,[o("label",ve,[c(a,{emoji:"‚¨ú",size:16}),e[35]||(e[35]=g(" ÌÖåÎëêÎ¶¨ ÏÉâÏÉÅ ",-1))]),o("div",fe,[S(o("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>l.localSettings.borderColor=i),type:"color",class:"color-picker"},null,512),[[v,l.localSettings.borderColor]]),S(o("input",{"onUpdate:modelValue":e[10]||(e[10]=i=>l.localSettings.borderColor=i),type:"text",class:"color-input",placeholder:"#666666"},null,512),[[v,l.localSettings.borderColor]])])]),o("div",Ce,[o("label",ke,[c(a,{emoji:"üî§",size:16}),e[36]||(e[36]=g(" Ìè∞Ìä∏ ",-1))]),S(o("select",{"onUpdate:modelValue":e[11]||(e[11]=i=>l.localSettings.fontFamily=i),class:"font-select"},[...e[37]||(e[37]=[o("option",{value:"Pretendard"},"Pretendard (Í∏∞Î≥∏)",-1),o("option",{value:"NanumSquare"},"NanumSquare",-1),o("option",{value:"Nanum Myeongjo"},"Nanum Myeongjo",-1),o("option",{value:"NotoSerifKR"},"Noto Serif KR",-1)])],512),[[_,l.localSettings.fontFamily]])]),o("div",we,[o("label",De,[c(a,{emoji:"üåÑ",size:16}),e[38]||(e[38]=g(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ URL ",-1))]),o("div",Te,[S(o("input",{"onUpdate:modelValue":e[12]||(e[12]=i=>l.localSettings.bgImageUrl=i),type:"text",class:"url-input",placeholder:"Ïù¥ÎØ∏ÏßÄ URL ÏûÖÎ†• ÎòêÎäî ÌååÏùº ÏÑ†ÌÉù"},null,512),[[v,l.localSettings.bgImageUrl]]),o("input",{ref:"bgImageFileInput",type:"file",accept:"image/*",onChange:e[13]||(e[13]=(...i)=>s.handleBgImageFileSelect&&s.handleBgImageFileSelect(...i)),style:{display:"none"}},null,544),o("button",{onClick:e[14]||(e[14]=i=>t.$refs.bgImageFileInput.click()),class:"file-select-button"},[c(a,{emoji:"üìÅ",size:14}),e[39]||(e[39]=g(" ÌååÏùº ",-1))]),l.localSettings.bgImageUrl?(d(),u("button",{key:0,onClick:e[15]||(e[15]=(...i)=>s.clearBgImage&&s.clearBgImage(...i)),class:"clear-button"},[c(a,{emoji:"‚úñÔ∏è",size:14})])):h("",!0)]),o("p",xe,[c(a,{emoji:"üí°",size:12}),e[40]||(e[40]=g(" Î°úÏª¨ ÌååÏùºÏùÄ base64Î°ú Ïù∏ÏΩîÎî© (2MB Ïù¥Ìïò) ",-1))])]),l.localSettings.bgImageUrl?(d(),u("div",Pe,[o("label",Ie,[c(a,{emoji:"üíß",size:16}),g(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ Ìà¨Î™ÖÎèÑ ("+m(Math.round(l.localSettings.bgImageOpacity*100))+"%) ",1)]),S(o("input",{"onUpdate:modelValue":e[16]||(e[16]=i=>l.localSettings.bgImageOpacity=i),type:"range",min:"0",max:"1",step:"0.05",class:"slider"},null,512),[[v,l.localSettings.bgImageOpacity,void 0,{number:!0}]])])):h("",!0),l.localSettings.bgImageUrl?(d(),u("div",Oe,[o("label",_e,[c(a,{emoji:"üìè",size:16}),e[41]||(e[41]=g(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ",-1))]),S(o("select",{"onUpdate:modelValue":e[17]||(e[17]=i=>l.localSettings.bgImageSize=i),class:"font-select"},[...e[42]||(e[42]=[o("option",{value:"cover"},"ÌôîÎ©¥ Ï±ÑÏö∞Í∏∞ (Cover)",-1),o("option",{value:"contain"},"ÎπÑÏú® Ïú†ÏßÄ (Contain)",-1),o("option",{value:"auto"},"ÏõêÎ≥∏ ÌÅ¨Í∏∞ (Auto)",-1)])],512),[[_,l.localSettings.bgImageSize]])])):h("",!0),e[51]||(e[51]=o("div",{class:"divider"},null,-1)),o("div",Ee,[o("label",Ae,[c(a,{emoji:"üéµ",size:16}),e[43]||(e[43]=g(" BGM ÌÉÄÏûÖ ",-1))]),S(o("select",{"onUpdate:modelValue":e[18]||(e[18]=i=>l.localSettings.bgmType=i),class:"font-select"},[...e[44]||(e[44]=[o("option",{value:"youtube"},"Ïú†ÌäúÎ∏å ÏòÅÏÉÅ",-1),o("option",{value:"audio"},"Ïò§ÎîîÏò§ ÌååÏùº (MP3 Îì±)",-1)])],512),[[_,l.localSettings.bgmType]])]),o("div",Me,[o("label",Ue,[c(a,{emoji:"üîó",size:16}),e[45]||(e[45]=g(" BGM URL ",-1))]),o("div",Be,[S(o("input",{"onUpdate:modelValue":e[19]||(e[19]=i=>l.localSettings.bgmUrl=i),type:"text",class:"url-input",placeholder:l.localSettings.bgmType==="youtube"?"https://www.youtube.com/watch?v=...":"BGM URL ÏûÖÎ†• ÎòêÎäî ÌååÏùº ÏÑ†ÌÉù"},null,8,Le),[[v,l.localSettings.bgmUrl]]),l.localSettings.bgmType==="audio"?(d(),u("input",{key:0,ref:"bgmFileInput",type:"file",accept:"audio/*",onChange:e[20]||(e[20]=(...i)=>s.handleBgmFileSelect&&s.handleBgmFileSelect(...i)),style:{display:"none"}},null,544)):h("",!0),l.localSettings.bgmType==="audio"?(d(),u("button",{key:1,onClick:e[21]||(e[21]=i=>t.$refs.bgmFileInput.click()),class:"file-select-button"},[c(a,{emoji:"üìÅ",size:14}),e[46]||(e[46]=g(" ÌååÏùº ",-1))])):h("",!0),l.localSettings.bgmUrl?(d(),u("button",{key:2,onClick:e[22]||(e[22]=(...i)=>s.clearBgm&&s.clearBgm(...i)),class:"clear-button"},[c(a,{emoji:"‚úñÔ∏è",size:14})])):h("",!0)]),l.localSettings.bgmType==="youtube"&&s.extractedYoutubeId?(d(),u("div",ze,[c(a,{emoji:"‚úì",size:12}),g(" ÎπÑÎîîÏò§ ID: "+m(s.extractedYoutubeId),1)])):l.localSettings.bgmType==="audio"?(d(),u("p",je,[c(a,{emoji:"üí°",size:12}),e[47]||(e[47]=g(" Î°úÏª¨ ÌååÏùºÏùÄ base64Î°ú Ïù∏ÏΩîÎî© (10MB Ïù¥Ìïò) ",-1))])):h("",!0)]),l.localSettings.bgmUrl?(d(),u("div",Ne,[o("label",Ve,[c(a,{emoji:"üîä",size:16}),g(" BGM Î≥ºÎ•® ("+m(Math.round(l.localSettings.bgmVolume*100))+"%) ",1)]),S(o("input",{"onUpdate:modelValue":e[23]||(e[23]=i=>l.localSettings.bgmVolume=i),type:"range",min:"0",max:"1",step:"0.05",class:"slider"},null,512),[[v,l.localSettings.bgmVolume,void 0,{number:!0}]])])):h("",!0),l.localSettings.bgmUrl?(d(),u("div",Fe,[o("label",Re,[S(o("input",{"onUpdate:modelValue":e[24]||(e[24]=i=>l.localSettings.bgmAutoPlay=i),type:"checkbox",class:"checkbox-input"},null,512),[[G,l.localSettings.bgmAutoPlay]]),c(a,{emoji:"‚ñ∂Ô∏è",size:16}),e[48]||(e[48]=o("span",null,"PlayerView ÏßÑÏûÖ Ïãú ÏûêÎèô Ïû¨ÏÉù",-1))])])):h("",!0),o("div",Xe,[e[50]||(e[50]=o("p",{class:"preview-label"},"ÎØ∏Î¶¨Î≥¥Í∏∞",-1)),o("div",{class:"preview-box",style:M(s.previewStyles)},[...e[49]||(e[49]=[o("p",null,"ÏïàÎÖïÌïòÏÑ∏Ïöî!",-1),o("button",{class:"preview-button"},"Î≤ÑÌäº",-1)])],4)])]),o("div",He,[o("button",{class:"action-button secondary",onClick:e[25]||(e[25]=(...i)=>s.resetToDefault&&s.resetToDefault(...i))},[c(a,{emoji:"üîÑ",size:16}),e[52]||(e[52]=g(" Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõê ",-1))]),o("div",Ke,[o("button",{class:"action-button secondary",onClick:e[26]||(e[26]=(...i)=>s.close&&s.close(...i))}," Ï∑®ÏÜå "),o("button",{class:"action-button primary",onClick:e[27]||(e[27]=(...i)=>s.saveSettings&&s.saveSettings(...i))},[c(a,{emoji:"üíæ",size:16}),e[53]||(e[53]=g(" Ï†ÄÏû• ",-1))])])])])])):h("",!0)]),_:1})}const Ye=x(oe,[["render",Ge],["__scopeId","data-v-28fe693b"]]),Je={name:"SaveLoadModal",props:{isVisible:{type:Boolean,default:!1},mode:{type:String,default:"save",validator:t=>["save","load"].includes(t)},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{saveSlots:[],deleteConfirmSlot:null}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.deleteConfirmSlot===null&&this.close()},loadSaveSlots(){this.saveSlots=O.getAllSaves()},handleSlotClick(t){this.mode==="save"?(this.$emit("save",t),this.close()):this.saveSlots[t].isEmpty||(this.$emit("load",t),this.close())},confirmDelete(t){this.deleteConfirmSlot=t},cancelDelete(){this.deleteConfirmSlot=null},executeDelete(){this.deleteConfirmSlot!==null&&(O.deleteSave(this.deleteConfirmSlot),this.loadSaveSlots(),this.deleteConfirmSlot=null)},formatInfo(t){return O.formatSaveInfo(t)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&(this.deleteConfirmSlot!==null?this.cancelDelete():this.close())}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSaveSlots(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.deleteConfirmSlot=null)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},We={class:"modal-header"},qe={class:"modal-title"},Qe={class:"modal-content"},Ze=["onClick"],$e={class:"slot-header"},et={class:"slot-number"},tt=["onClick"],ot={class:"slot-content"},st={key:0,class:"empty-slot"},lt={key:1,class:"save-info"},it={class:"save-title"},nt={class:"save-subtitle"},rt={class:"save-date"},at={class:"modal-footer"},ct={class:"footer-note"},dt={class:"confirm-content"},ut={class:"confirm-buttons"};function ht(t,e,n,r,l,s){const a=b("EmojiToIcon");return d(),f(D,{name:"modal-overlay"},{default:w(()=>[n.isVisible?(d(),u("div",{key:0,class:"modal-overlay",onClick:e[5]||(e[5]=(...i)=>s.handleOverlayClick&&s.handleOverlayClick(...i))},[o("div",{class:"modal-container",onClick:e[1]||(e[1]=C(()=>{},["stop"]))},[o("div",We,[o("h2",qe,[c(a,{emoji:n.mode==="save"?"üíæ":"üìÇ",size:24},null,8,["emoji"]),g(" "+m(n.mode==="save"?"Ï†ÄÏû•ÌïòÍ∏∞":"Î∂àÎü¨Ïò§Í∏∞"),1)]),o("button",{class:"close-button",onClick:e[0]||(e[0]=(...i)=>s.close&&s.close(...i)),title:"Îã´Í∏∞ (ESC)"},[c(a,{emoji:"‚úñÔ∏è",size:20})])]),o("div",Qe,[(d(!0),u(E,null,A(l.saveSlots,i=>(d(),u("div",{key:i.slotIndex,class:I(["save-slot",{"is-empty":i.isEmpty}]),onClick:p=>s.handleSlotClick(i.slotIndex)},[o("div",$e,[o("span",et,"Ïä¨Î°Ø "+m(i.slotIndex+1),1),!i.isEmpty&&n.mode==="save"?(d(),u("button",{key:0,class:"delete-button",onClick:C(p=>s.confirmDelete(i.slotIndex),["stop"]),title:"ÏÇ≠Ï†ú"},[c(a,{emoji:"üóëÔ∏è",size:16})],8,tt)):h("",!0)]),o("div",ot,[i.isEmpty?(d(),u("div",st,[c(a,{emoji:"üì≠",size:32}),e[6]||(e[6]=o("p",null,"Îπà Ïä¨Î°Ø",-1))])):(d(),u("div",lt,[o("h3",it,m(s.formatInfo(i).title),1),o("p",nt,m(s.formatInfo(i).subtitle),1),o("p",rt,m(s.formatInfo(i).date),1)]))])],10,Ze))),128))]),o("div",at,[o("p",ct,[c(a,{emoji:"‚ÑπÔ∏è",size:14}),g(" "+m(n.mode==="save"?"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÌòÑÏû¨ ÏßÑÌñâÎèÑÎ•º Ï†ÄÏû•Ìï©ÎãàÎã§.":"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ï†ÄÏû•Îêú ÏßÑÌñâÎèÑÎ•º Î∂àÎü¨ÏòµÎãàÎã§."),1)])])]),l.deleteConfirmSlot!==null?(d(),u("div",{key:0,class:"confirm-modal",onClick:e[4]||(e[4]=C(()=>{},["stop"]))},[o("div",dt,[e[7]||(e[7]=o("h3",null,"Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú",-1)),o("p",null,"Ïä¨Î°Ø "+m(l.deleteConfirmSlot+1)+"Ïùò Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",1),o("div",ut,[o("button",{class:"action-button secondary",onClick:e[2]||(e[2]=(...i)=>s.cancelDelete&&s.cancelDelete(...i))}," Ï∑®ÏÜå "),o("button",{class:"action-button danger",onClick:e[3]||(e[3]=(...i)=>s.executeDelete&&s.executeDelete(...i))}," ÏÇ≠Ï†ú ")])])])):h("",!0)])):h("",!0)]),_:1})}const mt=x(Je,[["render",ht],["__scopeId","data-v-4a7fd994"]]),gt={name:"SceneSelectorModal",props:{isVisible:{type:Boolean,default:!1},scenes:{type:Array,default:()=>[]},currentSceneIndex:{type:Number,default:0},currentStepIndex:{type:Number,default:0},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{expandedScenes:new Set}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},toggleScene(t){this.expandedScenes.has(t)?this.expandedScenes.delete(t):this.expandedScenes.add(t),this.$forceUpdate()},goToStep(t,e){this.$emit("go-to-step",t,e),this.close()},getStepPreview(t){return t?t.length>50?t.substring(0,50)+"...":t:"(ÌÖçÏä§Ìä∏ ÏóÜÏùå)"},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()},initExpandedScenes(){this.currentSceneIndex!==null&&this.expandedScenes.add(this.currentSceneIndex)},scrollToCurrentScene(){setTimeout(()=>{this.$nextTick(()=>{const t=this.$refs.currentStep;if(t){const e=Array.isArray(t)?t[0]:t;e&&e.scrollIntoView({behavior:"smooth",block:"center"})}})},250)}},watch:{isVisible:{immediate:!0,handler(t){t?(this.initExpandedScenes(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden",this.scrollToCurrentScene()):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.expandedScenes.clear())}},currentSceneIndex:{handler(t){this.isVisible&&t!==null&&(this.expandedScenes.add(t),this.$forceUpdate())}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},pt={class:"modal-header"},yt={class:"modal-title"},St={class:"modal-content"},bt=["onClick"],vt={class:"scene-info"},ft={class:"scene-number"},Ct={class:"scene-name"},kt={class:"scene-meta"},wt={class:"step-count"},Dt={key:0,class:"steps-list"},Tt=["onClick"],xt={class:"step-number"},Pt={class:"step-preview"},It={class:"step-text"},Ot={key:0,class:"empty-state"},_t={class:"modal-footer"},Et={class:"footer-info"};function At(t,e,n,r,l,s){const a=b("EmojiToIcon");return d(),f(D,{name:"modal-overlay"},{default:w(()=>[n.isVisible?(d(),u("div",{key:0,class:"modal-overlay",onClick:e[3]||(e[3]=(...i)=>s.handleOverlayClick&&s.handleOverlayClick(...i))},[o("div",{class:"modal-container",onClick:e[2]||(e[2]=C(()=>{},["stop"]))},[o("div",pt,[o("h2",yt,[c(a,{emoji:"üìë",size:24}),e[4]||(e[4]=g(" Ïî¨ ÏÑ†ÌÉù ",-1))]),o("button",{class:"close-button",onClick:e[0]||(e[0]=(...i)=>s.close&&s.close(...i)),title:"Îã´Í∏∞ (ESC)"},[c(a,{emoji:"‚úñÔ∏è",size:20})])]),o("div",St,[(d(!0),u(E,null,A(n.scenes,(i,p)=>(d(),u("div",{key:`scene-${p}`,class:I(["scene-item",{"is-current":p===n.currentSceneIndex}])},[o("div",{class:"scene-header",onClick:T=>s.toggleScene(p)},[o("div",vt,[o("span",ft,"Ïî¨ "+m(p+1),1),o("h3",Ct,m(i.name||"Ï†úÎ™© ÏóÜÏùå"),1)]),o("div",kt,[o("span",wt,m(i.steps.length)+"Í∞ú Ïä§ÌÖù",1),c(a,{emoji:l.expandedScenes.has(p)?"üîΩ":"‚ñ∂Ô∏è",size:16,class:"expand-icon"},null,8,["emoji"])])],8,bt),c(D,{name:"steps-expand"},{default:w(()=>[l.expandedScenes.has(p)?(d(),u("div",Dt,[(d(!0),u(E,null,A(i.steps,(T,k)=>{var P;return d(),u("div",{key:`step-${p}-${k}`,ref_for:!0,ref:p===n.currentSceneIndex&&k===n.currentStepIndex?"currentStep":null,class:I(["step-item",{"is-current":p===n.currentSceneIndex&&k===n.currentStepIndex}]),onClick:U=>s.goToStep(p,k)},[o("span",xt,m(k+1),1),o("div",Pt,[(P=T.character)!=null&&P.name?(d(),u("span",{key:0,class:"step-character",style:M({color:T.character.color||"#ffffff"})},m(T.character.name)+": ",5)):h("",!0),o("span",It,m(s.getStepPreview(T.text)),1)]),p===n.currentSceneIndex&&k===n.currentStepIndex?(d(),f(a,{key:0,emoji:"‚ñ∂Ô∏è",size:14,class:"current-indicator"})):h("",!0)],10,Tt)}),128))])):h("",!0)]),_:2},1024)],2))),128)),n.scenes.length===0?(d(),u("div",Ot,[c(a,{emoji:"üì≠",size:48}),e[5]||(e[5]=o("p",null,"Ïî¨Ïù¥ ÏóÜÏäµÎãàÎã§",-1))])):h("",!0)]),o("div",_t,[o("div",Et,[c(a,{emoji:"‚ÑπÔ∏è",size:14}),e[6]||(e[6]=o("span",null,"Ïî¨ÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÌéºÏπòÍ≥†, Ïä§ÌÖùÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ïù¥ÎèôÌï©ÎãàÎã§.",-1))]),o("button",{class:"action-button primary",onClick:e[1]||(e[1]=(...i)=>s.close&&s.close(...i))}," Îã´Í∏∞ ")])])])):h("",!0)]),_:1})}const Mt=x(gt,[["render",At],["__scopeId","data-v-94d16136"]]),Ut={name:"PlayerView",components:{DialogBox:K,CharacterDisplay:H,PlaybackControls:X,HandoutDisplay:te,ThemeSettingsModal:Ye,SaveLoadModal:mt,SceneSelectorModal:Mt,DiceRoll:R,DXCombo:F,BGMPlayer:V},setup(){return{logStore:N()}},data(){return{autoPlayTimer:null,typingSpeed:50,theaterMode:!1,autoPlaySpeed:1,showHandout:!1,currentHandout:null,showThemeSettings:!1,showSaveLoadModal:!1,saveLoadMode:"save",showSceneSelector:!1,bgmSettings:{url:"",type:"youtube",volume:.5,autoPlay:!1},showDiceOverlay:!1,currentDiceRolls:[],diceCharacterName:"",diceCharacterColor:"#ffffff",diceOverlayTimer:null,showComboOverlay:!1,currentDXCombos:[],comboCharacterName:"",comboCharacterColor:"#ffffff",comboOverlayTimer:null,previousSceneIndex:0,showSceneDescription:!1,sceneDescriptionData:null,sceneDescriptionTimer:null,isMobile:!1,isTablet:!1,isTouchDevice:!1,sfxAudio:null,currentBackground:null,previousBgmUrl:null,defaultThemeBackground:{url:"",opacity:.3,size:"cover"}}},watch:{"logStore.playback.currentSceneIndex"(t,e){t!==e&&this.onSceneChange()}},computed:{logTitle(){var t;return((t=this.logStore.vnData)==null?void 0:t.title)||"Î°úÍ∑∏ ÌîåÎ†àÏù¥Ïñ¥"},currentScene(){var n,r;const t=((n=this.logStore.vnData)==null?void 0:n.scenes)||[],e=((r=this.logStore.playback)==null?void 0:r.currentSceneIndex)||0;return t[e]||null},currentStep(){return this.logStore.currentStep},hasNextStep(){return this.logStore.hasNextStep},hasPreviousStep(){return this.logStore.hasPreviousStep},autoPlayEnabled(){var t;return((t=this.logStore.playback)==null?void 0:t.autoPlayEnabled)||!1},currentStepNumber(){var l,s,a,i;let t=0;const e=((l=this.logStore.vnData)==null?void 0:l.scenes)||[],n=((s=this.logStore.playback)==null?void 0:s.currentSceneIndex)||0,r=((a=this.logStore.playback)==null?void 0:a.currentStepIndex)||0;for(let p=0;p<n;p++)t+=((i=e[p])==null?void 0:i.steps.length)||0;return t+=r+1,t},totalSteps(){var e;return(((e=this.logStore.vnData)==null?void 0:e.scenes)||[]).reduce((n,r)=>{var l;return n+(((l=r==null?void 0:r.steps)==null?void 0:l.length)||0)},0)},currentSceneName(){const t=this.logStore.currentScene;return(t==null?void 0:t.name)||""},hasActiveOverlay(){return this.showDiceOverlay||this.showComboOverlay||this.showSceneDescription}},methods:{navigateToTargetStep(){var l;const t=sessionStorage.getItem("player-target-step");if(!t)return;const e=parseInt(t,10);if(isNaN(e)||e<1){sessionStorage.removeItem("player-target-step");return}let n=0;const r=((l=this.logStore.vnData)==null?void 0:l.scenes)||[];for(let s=0;s<r.length;s++){const i=r[s].steps.length;if(e<=n+i){const p=e-n-1;this.logStore.goToStep(s,p),sessionStorage.removeItem("player-target-step");return}n+=i}sessionStorage.removeItem("player-target-step")},detectDevice(){const t=navigator.userAgent.toLowerCase(),e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t),n=/ipad|android(?!.*mobile)|tablet/i.test(t),r="ontouchstart"in window||navigator.maxTouchPoints>0,l=window.innerWidth,s=l<=767,a=l>=768&&l<=1023;this.isMobile=e&&s||r&&s,this.isTablet=n&&a||r&&a&&!e,this.isTouchDevice=r,this.isMobile&&(this.typingSpeed=30),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device"),this.isMobile?document.body.classList.add("device-mobile"):this.isTablet?document.body.classList.add("device-tablet"):document.body.classList.add("device-desktop"),this.isTouchDevice&&document.body.classList.add("touch-device"),console.log("Device Detection:",{isMobile:this.isMobile,isTablet:this.isTablet,isTouchDevice:this.isTouchDevice,screenWidth:l,userAgent:t})},getCharacterName(t){return t.type==="system"?t.character.name||"ÏãúÏä§ÌÖú":t.type==="narrator"?"":t.character.name},handleAdvance(){var t;console.log("[PlayerView] handleAdvance Ìò∏Ï∂ú:",{hasNextStep:this.hasNextStep,autoPlayEnabled:this.autoPlayEnabled,currentStepIndex:(t=this.logStore.playback)==null?void 0:t.currentStepIndex}),this.hasNextStep?this.nextStep():this.autoPlayEnabled&&this.logStore.toggleAutoPlay()},handleTypingComplete(){},goHome(){this.stopAutoPlay(),this.$router.push("/")},openEditor(){sessionStorage.setItem("editor-target-step",this.currentStepNumber),this.$router.push("/editor")},openSettings(){this.showThemeSettings=!0},closeSettings(){this.showThemeSettings=!1},handleThemeSave(t){},handleBgmChange(t){this.bgmSettings={...t}},openSceneSelector(){this.showSceneSelector=!0},closeSceneSelector(){this.showSceneSelector=!1},handleGoToStep(t,e){const n=this.logStore.playback.currentSceneIndex;this.logStore.goToStep(t,e),n!==t&&this.onSceneChange(),this.closeSceneSelector(),this.showOverlaysIfPresent()},openSaveModal(){this.saveLoadMode="save",this.showSaveLoadModal=!0},openLoadModal(){this.saveLoadMode="load",this.showSaveLoadModal=!0},closeSaveLoadModal(){this.showSaveLoadModal=!1},handleSave(t){this.logStore.saveProgress(t)},handleLoad(t){this.logStore.loadProgress(t)},openHandout(t){this.currentHandout=t,this.showHandout=!0},closeHandout(){this.showHandout=!1,this.currentHandout=null},onSceneChange(){this.showDiceOverlay=!1,this.showComboOverlay=!1,this.showHandout=!1,this.currentHandout=null,this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),this.displaySceneDescriptionIfPresent()},displaySceneDescriptionIfPresent(){if(!this.currentScene)return;const t=this.currentScene.steps[0];t&&t.type==="scene-description"&&(this.sceneDescriptionData={number:t.sceneNumber,title:t.sceneTitle,pcs:t.scenePCs,description:t.sceneDescription,fullText:t.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance())},closeSceneDescription(){this.showSceneDescription=!1;const t=this.sceneDescriptionTimer!==null;this.stopSceneDescriptionAutoAdvance(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startSceneDescriptionAutoAdvance(){this.stopSceneDescriptionAutoAdvance(),this.sceneDescriptionTimer=setTimeout(()=>{this.closeSceneDescription(),this.autoPlayEnabled&&(this.hasNextStep?this.nextStep():this.logStore.toggleAutoPlay())},3e3/this.autoPlaySpeed)},stopSceneDescriptionAutoAdvance(){this.sceneDescriptionTimer&&(clearTimeout(this.sceneDescriptionTimer),this.sceneDescriptionTimer=null)},nextStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.nextStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.applyStepEffects(),this.showOverlaysIfPresent(),this.logStore.playback.currentStepIndex%10===0&&this.logStore.autoSave()},previousStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.previousStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.applyStepEffects(),this.showOverlaysIfPresent()},showOverlaysIfPresent(){if(this.currentStep&&this.currentStep.type==="scene-description"){this.sceneDescriptionData={number:this.currentStep.sceneNumber,title:this.currentStep.sceneTitle,pcs:this.currentStep.scenePCs,description:this.currentStep.sceneDescription,fullText:this.currentStep.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance();return}const t=this.currentStep&&this.currentStep.diceRolls&&this.currentStep.diceRolls.length>0,e=this.currentStep&&this.currentStep.ougis&&this.currentStep.ougis.length>0,n=this.currentStep&&this.currentStep.shinobigamis&&this.currentStep.shinobigamis.length>0,r=this.currentStep&&this.currentStep.dxCombos&&this.currentStep.dxCombos.length>0;if(t||e||n){const l=[...this.currentStep.ougis||[],...this.currentStep.shinobigamis||[],...this.currentStep.diceRolls||[]];this.currentDiceRolls=l,this.diceCharacterName=this.getCharacterName(this.currentStep),this.diceCharacterColor=this.currentStep.character.color,this.showDiceOverlay=!0,this.autoPlayEnabled&&this.startDiceOverlayAutoClose();return}r&&(this.currentDXCombos=this.currentStep.dxCombos,this.comboCharacterName=this.getCharacterName(this.currentStep),this.comboCharacterColor=this.currentStep.character.color,this.showComboOverlay=!0,this.autoPlayEnabled&&this.startComboOverlayAutoClose())},closeDiceOverlay(){this.showDiceOverlay=!1;const t=this.diceOverlayTimer!==null;this.stopDiceOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startDiceOverlayAutoClose(){this.stopDiceOverlayAutoClose(),this.diceOverlayTimer=setTimeout(()=>{this.closeDiceOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3/this.autoPlaySpeed)},stopDiceOverlayAutoClose(){this.diceOverlayTimer&&(clearTimeout(this.diceOverlayTimer),this.diceOverlayTimer=null)},closeComboOverlay(){this.showComboOverlay=!1;const t=this.comboOverlayTimer!==null;this.stopComboOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startComboOverlayAutoClose(){this.stopComboOverlayAutoClose(),this.comboOverlayTimer=setTimeout(()=>{this.closeComboOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3/this.autoPlaySpeed)},stopComboOverlayAutoClose(){this.comboOverlayTimer&&(clearTimeout(this.comboOverlayTimer),this.comboOverlayTimer=null)},toggleAutoPlay(){const t=this.autoPlayEnabled;this.logStore.toggleAutoPlay(),!t&&this.autoPlayEnabled&&this.hasActiveOverlay},toggleTheaterMode(){this.theaterMode=!this.theaterMode,this.theaterMode&&!this.autoPlayEnabled&&(this.logStore.toggleAutoPlay(),!this.hasActiveOverlay&&this.hasNextStep&&this.nextStep()),console.log("[PlayerView] Í∞êÏÉÅ Î™®Îìú:",this.theaterMode?"ÌôúÏÑ±Ìôî":"ÎπÑÌôúÏÑ±Ìôî")},handleTheaterModeClick(t){if(this.theaterMode){if(t.target.closest("button")||t.target.closest(".dialog-box"))return;this.theaterMode=!1,console.log("[PlayerView] Í∞êÏÉÅ Î™®Îìú Ï¢ÖÎ£å (ÌÅ¥Î¶≠)")}},changeAutoPlaySpeed(t){this.autoPlaySpeed=t,console.log("[PlayerView] ÏûêÎèôÏû¨ÏÉù ÏÜçÎèÑ Î≥ÄÍ≤Ω:",t+"Î∞∞ÏÜç")},stopAutoPlay(){this.autoPlayTimer&&(clearInterval(this.autoPlayTimer),this.autoPlayTimer=null)},applyStepEffects(){if(!this.currentStep){console.log("[applyStepEffects] currentStepÏù¥ ÏóÜÏäµÎãàÎã§.");return}const t=this.currentStep.effects;console.log("[applyStepEffects] Ïä§ÌÖù Ìö®Í≥º Ï†ÅÏö©:",{stepNumber:this.currentStepNumber,hasEffects:!!t,effects:t}),t!=null&&t.sfx?(console.log("[applyStepEffects] Ìö®Í≥ºÏùå Î∞úÍ≤¨, Ïû¨ÏÉù ÏãúÏûë:",t.sfx),this.playSFX(t.sfx)):console.log("[applyStepEffects] Ìö®Í≥ºÏùå ÏóÜÏùå");const e=(t==null?void 0:t.bgm)||null;if(e!==this.previousBgmUrl&&(e?this.changeBGM(e):this.restoreDefaultBGM(),this.previousBgmUrl=e),t!=null&&t.background){const n=t.backgroundOpacity??.3;this.changeBackground(t.background,n)}else this.currentBackground&&this.currentBackground!==this.defaultThemeBackground.url&&this.restoreDefaultBackground()},async playSFX(t){if(!t||!t.trim()){console.warn("[playSFX] Ìö®Í≥ºÏùå URLÏù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.");return}console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏãúÎèÑ:",t);try{let e=t.trim();if(e.includes("youtube.com")||e.includes("youtu.be")){console.warn("[playSFX] YouTube Ìö®Í≥ºÏùåÏùÄ Ïò§ÎîîÏò§ ÌååÏùº URLÎ°ú Î≥ÄÌôòÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.");return}if(e.includes("drive.google.com")||e.includes("docs.google.com")){let r=null;const l=e.match(/\/file\/d\/([^\/\?]+)/);l&&(r=l[1]);const s=e.match(/[?&]id=([^&]+)/);s&&(r=s[1]),r&&(e=`https://docs.google.com/uc?export=download&id=${r}`,console.log("[playSFX] Google Drive URL Î≥ÄÌôò:",e))}const n=new Audio(e);n.volume=.7,n.loop=!1,console.log("[playSFX] Audio Í∞ùÏ≤¥ ÏÉùÏÑ± ÏôÑÎ£å, Î°úÎî© Ï§ë..."),n.addEventListener("loadeddata",()=>{console.log("[playSFX] Ïò§ÎîîÏò§ Î°úÎìú ÏôÑÎ£å, Ïû¨ÏÉù ÏãúÏûë")}),n.addEventListener("ended",()=>{console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏôÑÎ£å"),n.src="",this.sfxAudio===n&&(this.sfxAudio=null)}),n.addEventListener("error",r=>{console.error("[playSFX] Ìö®Í≥ºÏùå Î°úÎìú/Ïû¨ÏÉù Ïã§Ìå®:",{error:r,url:e,readyState:n.readyState,networkState:n.networkState}),e.includes("youtube.com")||e.includes("youtu.be")?console.warn("[playSFX] YouTube URLÏùÄ ÏßÅÏ†ë Ïò§ÎîîÏò§ Ïû¨ÏÉùÏù¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§. Ïò§ÎîîÏò§ ÌååÏùº URLÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî."):e.includes("google.com")&&(console.error("[playSFX] Google Drive/Docs ÌååÏùº Ïû¨ÏÉù Ïã§Ìå®"),console.warn("Ìï¥Í≤∞ Î∞©Î≤ï:"),console.warn('1. ÌååÏùºÏù¥ "ÎßÅÌÅ¨Í∞Ä ÏûàÎäî Î™®Îì† ÏÇ¨Ïö©Ïûê" Í≥µÏú† ÏÑ§Ï†ïÏù∏ÏßÄ ÌôïÏù∏'),console.warn("2. ÎòêÎäî Îã§Î•∏ Ìò∏Ïä§ÌåÖ ÏÑúÎπÑÏä§ ÏÇ¨Ïö© (Ïòà: GitHub, Dropbox, ÏßÅÏ†ë ÏÑúÎ≤Ñ)"),console.warn("3. ÎòêÎäî base64 Ïù∏ÏΩîÎî©Îêú data URL ÏÇ¨Ïö©"))});try{await n.play(),console.log("[playSFX] Ìö®Í≥ºÏùå Ïû¨ÏÉù ÏãúÏûë ÏÑ±Í≥µ")}catch(r){console.error("[playSFX] Ïû¨ÏÉù Ïã§Ìå®:",{error:r,message:r.message,name:r.name}),r.name==="NotAllowedError"&&console.warn("[playSFX] Î∏åÎùºÏö∞Ï†Ä ÏûêÎèôÏû¨ÏÉù Ï†ïÏ±ÖÏúºÎ°ú Ïù∏Ìï¥ Ìö®Í≥ºÏùå Ïû¨ÏÉùÏù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§. ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© ÌõÑ Ïû¨ÏãúÎèÑÌïòÏÑ∏Ïöî.")}this.sfxAudio=n}catch(e){console.error("[playSFX] Ìö®Í≥ºÏùå Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò:",e)}},changeBGM(t){const e=t.includes("youtube.com")||t.includes("youtu.be");this.bgmSettings={url:t,type:e?"youtube":"audio",volume:this.bgmSettings.volume||.5,autoPlay:!0}},changeBackground(t,e=.3){this.currentBackground=t;const n=`linear-gradient(rgba(0, 0, 0, ${1-e}), rgba(0, 0, 0, ${1-e}))`;document.documentElement.style.setProperty("--bg-image",`${n}, url(${t})`),document.documentElement.style.setProperty("--bg-image-size","cover")},restoreDefaultBGM(){const t=localStorage.getItem("vnlog-theme-settings");if(t)try{const e=JSON.parse(t);if(e.bgmUrl){this.bgmSettings={url:e.bgmUrl,type:e.bgmType||"youtube",volume:e.bgmVolume||.5,autoPlay:!0};return}}catch(e){console.warn("ÌÖåÎßà ÏÑ§Ï†ï Î≥µÏõê Ïã§Ìå®:",e)}this.bgmSettings={url:"",type:"youtube",volume:this.bgmSettings.volume||.5,autoPlay:!1}},clearBackground(){this.currentBackground=null,document.documentElement.style.setProperty("--bg-image","none")},restoreDefaultBackground(){this.defaultThemeBackground.url?this.changeBackground(this.defaultThemeBackground.url,this.defaultThemeBackground.opacity):this.clearBackground()},handleKeyPress(t){if(!(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"))switch(t.key){case" ":case"Enter":t.preventDefault(),this.handleAdvance();break;case"ArrowLeft":t.preventDefault(),this.hasPreviousStep&&this.previousStep();break;case"ArrowRight":t.preventDefault(),this.hasNextStep&&this.nextStep();break}}},mounted(){var e,n;if(!this.logStore.rawLog){console.warn("Î°úÍ∑∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}if(!this.logStore.vnData||!this.logStore.vnData.scenes||this.logStore.vnData.scenes.length===0){console.warn("ÌååÏã±Îêú VN Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}const t=localStorage.getItem("vnlog-theme-settings");if(t)try{const r=JSON.parse(t);r.bgmUrl&&(this.bgmSettings={url:r.bgmUrl,type:r.bgmType||"youtube",volume:r.bgmVolume||.5,autoPlay:r.bgmAutoPlay||!1},this.previousBgmUrl=r.bgmUrl),r.bgImageUrl&&(this.defaultThemeBackground={url:r.bgImageUrl,opacity:r.bgImageOpacity??.3,size:r.bgImageSize||"cover"})}catch(r){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:",r)}this.detectDevice(),window.addEventListener("resize",this.detectDevice),window.addEventListener("keydown",this.handleKeyPress),this.navigateToTargetStep(),this.$nextTick(()=>{this.applyStepEffects(),this.showOverlaysIfPresent()}),console.log("PlayerView mounted:",{hasRawLog:!!this.logStore.rawLog,hasVNData:!!this.logStore.vnData,sceneCount:((n=(e=this.logStore.vnData)==null?void 0:e.scenes)==null?void 0:n.length)||0,currentStep:this.currentStep})},beforeUnmount(){this.stopAutoPlay(),this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),window.removeEventListener("keydown",this.handleKeyPress),window.removeEventListener("resize",this.detectDevice),this.sfxAudio&&(this.sfxAudio.pause(),this.sfxAudio=null),this.currentBackground&&(document.documentElement.style.removeProperty("--bg-image"),document.documentElement.style.removeProperty("--bg-image-size")),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device")}},Bt={class:"player-container"},Lt={class:"log-title"},zt={class:"header-buttons"},jt=["title"],Nt={class:"player-stage"},Vt={key:1,class:"dialog-wrapper"},Ft={key:1,class:"dialog-placeholder"},Rt={class:"dice-overlay-hint"},Xt={class:"combo-overlay-header"},Ht={class:"combo-character-info"},Kt={class:"dice-overlay-hint"},Gt={class:"scene-description-content"},Yt={class:"scene-description-header"},Jt={class:"scene-number"},Wt={class:"scene-title"},qt={key:0,class:"scene-pcs"},Qt={class:"scene-pcs-value"},Zt={key:1,class:"scene-description-text"};function $t(t,e,n,r,l,s){const a=b("EmojiToIcon"),i=b("CharacterDisplay"),p=b("DialogBox"),T=b("DiceRoll"),k=b("DXCombo"),P=b("PlaybackControls"),U=b("SceneSelectorModal"),B=b("HandoutDisplay"),L=b("ThemeSettingsModal"),z=b("SaveLoadModal"),j=b("BGMPlayer");return d(),u("div",{class:"player-view",onClick:e[12]||(e[12]=(...y)=>s.handleTheaterModeClick&&s.handleTheaterModeClick(...y))},[o("div",Bt,[o("div",{class:I(["player-header",{"theater-mode":l.theaterMode}])},[o("button",{onClick:e[0]||(e[0]=(...y)=>s.goHome&&s.goHome(...y)),class:"back-button"},[c(a,{emoji:"üè†",size:20})]),o("h2",Lt,m(s.logTitle),1),o("div",zt,[o("button",{onClick:e[1]||(e[1]=C((...y)=>s.toggleTheaterMode&&s.toggleTheaterMode(...y),["stop"])),class:"header-button",title:l.theaterMode?"Í∞êÏÉÅ Î™®Îìú Ï¢ÖÎ£å":"Í∞êÏÉÅ Î™®Îìú"},[c(a,{emoji:l.theaterMode?"üé¨":"üé•",size:20},null,8,["emoji"])],8,jt),l.isMobile!=!0?(d(),u("button",{key:0,onClick:e[2]||(e[2]=(...y)=>s.openEditor&&s.openEditor(...y)),class:"header-button",title:"Ìö®Í≥º Ìé∏Ïßë"},[c(a,{emoji:"‚ú®",size:20})])):h("",!0),o("button",{onClick:e[3]||(e[3]=(...y)=>s.openSceneSelector&&s.openSceneSelector(...y)),class:"header-button",title:"Ïî¨ ÏÑ†ÌÉù"},[c(a,{emoji:"üìë",size:20})]),o("button",{onClick:e[4]||(e[4]=(...y)=>s.openSaveModal&&s.openSaveModal(...y)),class:"header-button",title:"Ï†ÄÏû•"},[c(a,{emoji:"üíæ",size:20})]),o("button",{onClick:e[5]||(e[5]=(...y)=>s.openLoadModal&&s.openLoadModal(...y)),class:"header-button",title:"Î∂àÎü¨Ïò§Í∏∞"},[c(a,{emoji:"üìÇ",size:20})]),o("button",{onClick:e[6]||(e[6]=(...y)=>s.openSettings&&s.openSettings(...y)),class:"header-button",title:"ÏÑ§Ï†ï"},[c(a,{emoji:"‚öôÔ∏è",size:20})])])],2),o("div",Nt,[s.currentStep&&!s.currentStep.isSceneDescription&&r.logStore.vnData.characters?(d(),f(i,{key:0,"current-step":s.currentStep,characters:r.logStore.vnData.characters,layout:"single"},null,8,["current-step","characters"])):h("",!0),!s.currentStep||s.currentStep.type!=="scene-description"?(d(),u("div",Vt,[s.currentStep&&s.currentStep.character?(d(),f(p,{key:0,"step-type":s.currentStep.type||"dialogue","character-name":s.getCharacterName(s.currentStep),"character-color":s.currentStep.character.color,text:s.currentStep.text,"status-changes":s.currentStep.statusChanges||[],illustrations:s.currentStep.illustrations||[],"typing-speed":l.typingSpeed,"auto-play-speed":l.autoPlaySpeed,"auto-advance":s.autoPlayEnabled,"has-overlay":s.hasActiveOverlay,onAdvance:s.handleAdvance,onTypingComplete:s.handleTypingComplete},null,8,["step-type","character-name","character-color","text","status-changes","illustrations","typing-speed","auto-play-speed","auto-advance","has-overlay","onAdvance","onTypingComplete"])):(d(),u("div",Ft,[...e[13]||(e[13]=[o("p",null,"Î°úÍ∑∏Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...",-1)])]))])):h("",!0)]),c(D,{name:"dice-overlay"},{default:w(()=>[l.showDiceOverlay&&l.currentDiceRolls.length>0?(d(),u("div",{key:0,class:"dice-overlay",onClick:e[8]||(e[8]=(...y)=>s.closeDiceOverlay&&s.closeDiceOverlay(...y))},[o("div",{class:"dice-overlay-content",onClick:e[7]||(e[7]=C(()=>{},["stop"]))},[c(T,{"dice-rolls":l.currentDiceRolls,"character-name":l.diceCharacterName,"character-color":l.diceCharacterColor,animated:!0,"play-sound-effect":!1},null,8,["dice-rolls","character-name","character-color"]),o("div",Rt,[c(a,{emoji:"üëÜ",size:14}),e[14]||(e[14]=o("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),c(D,{name:"dice-overlay"},{default:w(()=>[l.showComboOverlay&&l.currentDXCombos.length>0?(d(),u("div",{key:0,class:"dice-overlay",onClick:e[10]||(e[10]=(...y)=>s.closeComboOverlay&&s.closeComboOverlay(...y))},[o("div",{class:"dice-overlay-content",onClick:e[9]||(e[9]=C(()=>{},["stop"]))},[o("div",Xt,[o("div",Ht,[o("div",{class:"combo-character-name",style:M({color:l.comboCharacterColor})},m(l.comboCharacterName),5)])]),c(k,{dxCombos:l.currentDXCombos},null,8,["dxCombos"]),o("div",Kt,[c(a,{emoji:"üëÜ",size:14}),e[15]||(e[15]=o("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),c(D,{name:"scene-description"},{default:w(()=>[l.showSceneDescription&&l.sceneDescriptionData?(d(),u("div",{key:0,class:"scene-description-overlay",onClick:e[11]||(e[11]=(...y)=>s.closeSceneDescription&&s.closeSceneDescription(...y))},[o("div",Gt,[o("div",Yt,[o("span",Jt,"Ïî¨ "+m(l.sceneDescriptionData.number),1),o("span",Wt,m(l.sceneDescriptionData.title),1)]),l.sceneDescriptionData.pcs?(d(),u("div",qt,[e[16]||(e[16]=o("span",{class:"scene-pcs-label"},"PC:",-1)),o("span",Qt,m(l.sceneDescriptionData.pcs),1)])):h("",!0),l.sceneDescriptionData.description?(d(),u("div",Zt,m(l.sceneDescriptionData.description),1)):h("",!0),e[17]||(e[17]=o("div",{class:"scene-description-hint"},"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])):h("",!0)]),_:1}),l.theaterMode?h("",!0):(d(),f(P,{key:0,"current-step-number":s.currentStepNumber,"total-steps":s.totalSteps,"current-scene-name":s.currentSceneName,"has-previous-step":s.hasPreviousStep,"has-next-step":s.hasNextStep,"auto-play-enabled":s.autoPlayEnabled,"auto-play-speed":l.autoPlaySpeed,"show-progress-bar":!0,"show-scene-selector":!0,onPrevious:s.previousStep,onNext:s.handleAdvance,onToggleAutoplay:s.toggleAutoPlay,onChangeSpeed:s.changeAutoPlaySpeed,onOpenSceneSelector:s.openSceneSelector},null,8,["current-step-number","total-steps","current-scene-name","has-previous-step","has-next-step","auto-play-enabled","auto-play-speed","onPrevious","onNext","onToggleAutoplay","onChangeSpeed","onOpenSceneSelector"]))]),c(U,{"is-visible":l.showSceneSelector,scenes:r.logStore.vnData.scenes,"current-scene-index":r.logStore.playback.currentSceneIndex,"current-step-index":r.logStore.playback.currentStepIndex,onClose:s.closeSceneSelector,onGoToStep:s.handleGoToStep},null,8,["is-visible","scenes","current-scene-index","current-step-index","onClose","onGoToStep"]),c(B,{handout:l.currentHandout,"is-visible":l.showHandout,onClose:s.closeHandout},null,8,["handout","is-visible","onClose"]),c(L,{"is-visible":l.showThemeSettings,onClose:s.closeSettings,onSave:s.handleThemeSave,onBgmChange:s.handleBgmChange},null,8,["is-visible","onClose","onSave","onBgmChange"]),c(z,{"is-visible":l.showSaveLoadModal,mode:l.saveLoadMode,onClose:s.closeSaveLoadModal,onSave:s.handleSave,onLoad:s.handleLoad},null,8,["is-visible","mode","onClose","onSave","onLoad"]),l.theaterMode?h("",!0):(d(),f(j,{key:0,"bgm-url":l.bgmSettings.url,"bgm-type":l.bgmSettings.type,volume:l.bgmSettings.volume,"auto-play":l.bgmSettings.autoPlay},null,8,["bgm-url","bgm-type","volume","auto-play"]))])}const so=x(Ut,[["render",$t],["__scopeId","data-v-58d2b47d"]]);export{so as default};
