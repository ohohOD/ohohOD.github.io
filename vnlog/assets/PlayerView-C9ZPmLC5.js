import{S as P,u as z}from"./logStore-BYeFJ-vw.js";import{_,c as r,e as h,F as b,f as D,r as v,o as l,n as T,a as s,b as u,t as d,g as w,h as I,w as S,T as C,i as E,d as k,j as x,v as A,k as H,l as R}from"./index-CR2A5hbH.js";const B={name:"StatusChange",props:{statusChanges:{type:Array,default:()=>[]}},methods:{getStatusIcon(t){const e=t.toLowerCase();return e.includes("Ïπ®Ïãù")?"‚ö°":e.includes("hp")||e.includes("ÏÉùÎ™Ö")||e.includes("Ï≤¥Î†•")?"‚ù§Ô∏è":e.includes("mp")||e.includes("ÎßàÎÇò")||e.includes("ÎßàÎ†•")?"üíô":e.includes("san")||e.includes("Ï†ïÏã†")||e.includes("Ïù¥ÏÑ±")?"üß†":"üìä"}}},U={key:0,class:"status-change-container"},K={class:"status-icon"},X={class:"status-info"},q={class:"character-name"},F={class:"status-name"},G={class:"status-values"},W={class:"old-value"},J={class:"new-value"},$={key:1,class:"new-value"},Q={key:2,class:"old-value"};function Y(t,e,n,p,a,i){const c=v("EmojiToIcon");return n.statusChanges&&n.statusChanges.length>0?(l(),r("div",U,[(l(!0),r(b,null,D(n.statusChanges,(o,m)=>(l(),r("div",{key:m,class:T(["status-change",{"is-positive":o.delta>0,"is-negative":o.delta<0}])},[s("div",K,[u(c,{emoji:i.getStatusIcon(o.statusName),size:16},null,8,["emoji"])]),s("div",X,[s("span",q,d(o.characterName),1),s("span",F,d(o.statusName),1)]),s("div",G,[o.oldValue!==null&&o.newValue!==null?(l(),r(b,{key:0},[s("span",W,d(o.oldValue),1),e[0]||(e[0]=s("span",{class:"arrow"},"‚Üí",-1)),s("span",J,d(o.newValue),1)],64)):o.oldValue===null&&o.newValue!==null?(l(),r("span",$,d(o.newValue),1)):o.oldValue!==null&&o.newValue===null?(l(),r("span",Q,d(o.oldValue),1)):h("",!0),o.delta!==0?(l(),r("span",{key:3,class:T(["delta",{"delta-positive":o.delta>0,"delta-negative":o.delta<0}])},d(o.delta>0?"+":"")+d(o.delta),3)):h("",!0)])],2))),128))])):h("",!0)}const Z=_(B,[["render",Y],["__scopeId","data-v-820fc90f"]]),ee={name:"DXCombo",props:{dxCombos:{type:Array,default:()=>[]}},methods:{decodeHtml(t){if(!t)return t;const e=document.createElement("textarea");e.innerHTML=t;let n=e.value;return n=n.replace(/\\n/g,`
`),n=n.replace(/\\t/g,"	"),n=n.replace(/\\r/g,"\r"),n}}},te={key:0,class:"dx-combo-container"},se={class:"combo-header"},oe={class:"combo-icon"},ie={class:"combo-label"},ne={key:0,class:"combo-name"},le={key:1,class:"erosion-cost"},ae={class:"combo-effects"},re={class:"effect-name"},ce={class:"effect-level"},de={key:0,class:"combo-info-row"},ue={key:0,class:"info-item"},he={class:"info-value"},me={key:1,class:"info-item"},pe={class:"info-value"},ye={key:2,class:"info-item"},ve={class:"info-value"},fe={key:3,class:"info-item"},Se={class:"info-value"},ge={key:1,class:"combo-stats-row"},Ce={key:0,class:"info-item"},be={class:"info-value"},_e={key:1,class:"info-item"},ke={class:"info-value"},we={key:2,class:"info-item"},Te={class:"info-value"},xe={key:3,class:"info-item"},De={class:"info-value"},Ae={key:2,class:"combo-description"},Ee={key:3,class:"combo-dice-roll"},Ie={class:"dice-roll-header"},Oe={class:"dice-roll-content"},Pe={class:"dice-formula"},Ne={class:"dice-detail"},je={class:"dice-result"};function Le(t,e,n,p,a,i){const c=v("EmojiToIcon");return n.dxCombos&&n.dxCombos.length>0?(l(),r("div",te,[(l(!0),r(b,null,D(n.dxCombos,(o,m)=>(l(),r("div",{key:m,class:"dx-combo"},[s("div",se,[s("div",oe,[u(c,{emoji:"‚ö°",size:16})]),s("span",ie,d(o.isSingleEffect?"Ïù¥ÌéôÌä∏":"ÏΩ§Î≥¥"),1),o.comboName?(l(),r("span",ne,d(i.decodeHtml(o.comboName)),1)):h("",!0),o.erosionCost?(l(),r("span",le,d(o.erosionCost)+"‚Üë",1)):h("",!0)]),s("div",ae,[(l(!0),r(b,null,D(o.effects,(y,g)=>(l(),r("div",{key:g,class:"combo-effect"},[s("span",re,d(i.decodeHtml(y.name)),1),s("span",ce,"Lv."+d(y.level),1)]))),128))]),o.timing||o.difficulty||o.target||o.range?(l(),r("div",de,[o.timing?(l(),r("span",ue,[e[0]||(e[0]=s("span",{class:"info-label"},"ÌÉÄÏù¥Î∞ç:",-1)),s("span",he,d(i.decodeHtml(o.timing)),1)])):h("",!0),o.difficulty?(l(),r("span",me,[e[1]||(e[1]=s("span",{class:"info-label"},"ÎÇúÏù¥ÎèÑ:",-1)),s("span",pe,d(i.decodeHtml(o.difficulty)),1)])):h("",!0),o.target?(l(),r("span",ye,[e[2]||(e[2]=s("span",{class:"info-label"},"ÎåÄÏÉÅ:",-1)),s("span",ve,d(i.decodeHtml(o.target)),1)])):h("",!0),o.range?(l(),r("span",fe,[e[3]||(e[3]=s("span",{class:"info-label"},"ÏÇ¨Í±∞Î¶¨:",-1)),s("span",Se,d(i.decodeHtml(o.range)),1)])):h("",!0)])):h("",!0),o.dice||o.critical||o.attack||o.erosion?(l(),r("div",ge,[o.dice?(l(),r("span",Ce,[e[4]||(e[4]=s("span",{class:"info-label"},"Îã§Ïù¥Ïä§:",-1)),s("span",be,d(i.decodeHtml(o.dice)),1)])):h("",!0),o.critical?(l(),r("span",_e,[e[5]||(e[5]=s("span",{class:"info-label"},"ÌÅ¨Î¶¨Ïπò:",-1)),s("span",ke,d(i.decodeHtml(o.critical)),1)])):h("",!0),o.attack?(l(),r("span",we,[e[6]||(e[6]=s("span",{class:"info-label"},"Í≥µÍ≤©Î†•:",-1)),s("span",Te,d(i.decodeHtml(o.attack)),1)])):h("",!0),o.erosion?(l(),r("span",xe,[e[7]||(e[7]=s("span",{class:"info-label"},"Ïπ®Ïãù:",-1)),s("span",De,d(i.decodeHtml(o.erosion)),1)])):h("",!0)])):h("",!0),o.description?(l(),r("div",Ae,d(i.decodeHtml(o.description)),1)):h("",!0),o.diceRoll?(l(),r("div",Ee,[s("div",Ie,[u(c,{emoji:"üé≤",size:14}),e[8]||(e[8]=s("span",{class:"dice-roll-label"},"ÌåêÏ†ï",-1))]),s("div",Oe,[s("span",Pe,d(o.diceRoll.formula),1),e[9]||(e[9]=s("span",{class:"dice-separator"},"‚Üí",-1)),s("span",Ne,d(o.diceRoll.diceRolls),1),e[10]||(e[10]=s("span",{class:"dice-separator"},"‚Üí",-1)),s("span",je,d(o.diceRoll.result),1)])])):h("",!0)]))),128))])):h("",!0)}const j=_(ee,[["render",Le],["__scopeId","data-v-73107c03"]]),Me={name:"Illustration",props:{illustrations:{type:Array,default:()=>[]}},data(){return{failedImages:new Set}},methods:{handleImageError(t){this.failedImages.add(t),this.$forceUpdate()},handleImageLoad(){}}},Ve={key:0,class:"illustration-container"},ze=["src","alt","onError"];function He(t,e,n,p,a,i){return n.illustrations&&n.illustrations.length>0?(l(),r("div",Ve,[(l(!0),r(b,null,D(n.illustrations,(c,o)=>(l(),r("div",{key:o,class:"illustration-item"},[a.failedImages.has(o)?h("",!0):(l(),r("img",{key:0,src:c.url,alt:c.alt||"ÏÇΩÌôî",class:"illustration-image",onError:m=>i.handleImageError(o),onLoad:e[0]||(e[0]=(...m)=>i.handleImageLoad&&i.handleImageLoad(...m))},null,40,ze))]))),128))])):h("",!0)}const Re=_(Me,[["render",He],["__scopeId","data-v-c3f90253"]]),Be={name:"DialogBox",components:{StatusChange:Z,DXCombo:j,Illustration:Re},props:{characterName:{type:String,default:""},characterColor:{type:String,default:"#333333"},text:{type:String,required:!0},statusChanges:{type:Array,default:()=>[]},dxCombos:{type:Array,default:()=>[]},illustrations:{type:Array,default:()=>[]},typingSpeed:{type:Number,default:50},autoAdvance:{type:Boolean,default:!1},hasOverlay:{type:Boolean,default:!1}},data(){return{displayedText:"",isTyping:!1,isComplete:!1,typingTimer:null,autoAdvanceTimer:null,currentIndex:0,originalHtmlText:null}},computed:{decodedText(){return this.decodeHtmlEntities(this.displayedText)}},watch:{text:{immediate:!0,handler(t){console.log("[DialogBox] text Î≥ÄÍ≤Ω, ÌÉÄÏù¥Ìïë ÏãúÏûë"),this.startTyping(t)}},autoAdvance(t,e){if(console.log("[DialogBox] autoAdvance Î≥ÄÍ≤Ω:",{old:e,new:t,isComplete:this.isComplete,hasOverlay:this.hasOverlay}),!t&&e){console.log("[DialogBox] ÏûêÎèôÏû¨ÏÉù Ï∑®ÏÜå - ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨"),this.stopAutoAdvance();return}t&&!e&&this.isComplete&&!this.hasOverlay&&(this.stopAutoAdvance(),this.autoAdvanceTimer=setTimeout(()=>{this.autoAdvance&&this.isComplete&&!this.hasOverlay&&(console.log("[DialogBox] autoAdvance watchÏóêÏÑú ÏßÑÌñâ"),this.autoAdvanceTimer=null,this.$emit("advance"))},1500))}},methods:{decodeHtmlEntities(t){if(!t)return t;const e={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&#39;":"'","&apos;":"'"};return t.replace(/&[a-z]+;|&#\d+;/gi,n=>e[n]||n)},startTyping(t){if(this.stopTyping(),this.stopAutoAdvance(),this.displayedText="",this.currentIndex=0,this.isTyping=!0,this.isComplete=!1,!t||t.length===0){this.displayedText=t,this.completeTyping(!0);return}if(t.includes("roll20-dx3-template")||t.includes("sheet-rolltemplate-")){this.displayedText=t,this.completeTyping(!0);return}if(this.hasHtmlTags(t)){const e=this.extractPlainText(t);this.originalHtmlText=t,this.typeNextCharacter(e,t);return}this.originalHtmlText=null,this.typeNextCharacter(t,t)},hasHtmlTags(t){return/<[^>]+>/i.test(t)},extractPlainText(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},typeNextCharacter(t,e){this.currentIndex<t.length?(this.originalHtmlText?this.displayedText=this.reconstructHtmlUpToIndex(this.originalHtmlText,this.currentIndex):this.displayedText+=t[this.currentIndex],this.currentIndex++,this.typingTimer=setTimeout(()=>{this.typeNextCharacter(t,e)},this.typingSpeed)):(this.displayedText=e,this.completeTyping())},reconstructHtmlUpToIndex(t,e){const n=document.createElement("div");n.innerHTML=t;let p=0,a="";const i=c=>{if(p>=e)return!1;if(c.nodeType===Node.TEXT_NODE){const o=c.textContent,m=e-p;if(p+o.length<=e)a+=o,p+=o.length;else return a+=o.substring(0,m),p=e,!1}else if(c.nodeType===Node.ELEMENT_NODE){const o=c.tagName.toLowerCase(),m=Array.from(c.attributes).map(y=>`${y.name}="${y.value}"`).join(" ");a+=`<${o}${m?" "+m:""}>`;for(let y of c.childNodes)if(!i(y))return!1;a+=`</${o}>`}return!0};for(let c of n.childNodes)if(!i(c))break;return a},completeTyping(t=!1){if(this.isTyping=!1,this.isComplete=!0,this.$emit("typing-complete"),console.log("[DialogBox] completeTyping:",{autoAdvance:this.autoAdvance,hasOverlay:this.hasOverlay,isEmpty:t,textLength:this.text.length}),this.autoAdvance&&!this.hasOverlay){let e=1500;t&&(e=3e3);const n=this.text.length*this.typingSpeed,a=n+e<3e3?3e3-n:e;console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ ÌÉÄÏù¥Î®∏ ÏãúÏûë:",Math.max(a,e),"ms"),this.autoAdvanceTimer=setTimeout(()=>{this.autoAdvance&&!this.hasOverlay?(console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ Ïã§Ìñâ"),this.autoAdvanceTimer=null,this.$emit("advance")):(console.log("[DialogBox] ÏûêÎèô ÏßÑÌñâ Ï∑®ÏÜåÎê® (autoAdvance:",this.autoAdvance,", hasOverlay:",this.hasOverlay,")"),this.autoAdvanceTimer=null)},Math.max(a,e))}},handleClick(){this.skipTyping()},skipTyping(){this.isTyping?(this.stopTyping(),this.displayedText=this.text,this.completeTyping()):this.isComplete&&this.$emit("advance")},stopTyping(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null)},stopAutoAdvance(){this.autoAdvanceTimer&&(clearTimeout(this.autoAdvanceTimer),this.autoAdvanceTimer=null)}},beforeUnmount(){this.stopTyping(),this.stopAutoAdvance()}},Ue=["innerHTML"],Ke={key:0,class:"continue-indicator"};function Xe(t,e,n,p,a,i){const c=v("EmojiToIcon"),o=v("Illustration"),m=v("DXCombo"),y=v("StatusChange");return l(),r("div",{class:"dialog-box",style:I({borderColor:n.characterColor}),onClick:e[0]||(e[0]=(...g)=>i.handleClick&&i.handleClick(...g))},[n.characterName?(l(),r("div",{key:0,class:"character-name",style:I({color:n.characterColor})},d(n.characterName),5)):h("",!0),n.text&&n.text.trim().length>0?(l(),r("div",{key:1,class:T(["dialog-text",{"is-typing":a.isTyping}])},[s("p",{class:"text-content",innerHTML:i.decodedText},null,8,Ue),!a.isTyping&&!a.isComplete?(l(),r("div",Ke,[u(c,{emoji:"‚ñº",size:12})])):h("",!0)],2)):h("",!0),n.illustrations&&n.illustrations.length>0?(l(),w(o,{key:2,illustrations:n.illustrations},null,8,["illustrations"])):h("",!0),n.dxCombos&&n.dxCombos.length>0?(l(),w(m,{key:3,dxCombos:n.dxCombos},null,8,["dxCombos"])):h("",!0),n.statusChanges&&n.statusChanges.length>0?(l(),w(y,{key:4,statusChanges:n.statusChanges},null,8,["statusChanges"])):h("",!0)],4)}const qe=_(Be,[["render",Xe],["__scopeId","data-v-edde12b8"]]),Fe={name:"CharacterDisplay",props:{currentStep:{type:Object,default:null},characters:{type:Object,default:()=>({})},maxVisibleCharacters:{type:Number,default:3},layout:{type:String,default:"single",validator:t=>["single","left","center","right"].includes(t)}},data(){return{activeCharacterIds:[],failedImageIds:new Set}},computed:{speakingCharacterId(){var t;return!this.currentStep||this.currentStep.type==="system"||this.currentStep.type==="narrator"?null:((t=this.currentStep.character)==null?void 0:t.id)||null},currentCharacter(){return this.currentStep?this.getCurrentCharacter():null}},methods:{getCurrentCharacter(){if(!this.currentStep||!this.currentStep.character)return null;const t=this.currentStep.character;return{id:t.id||t.name,name:t.name,avatarUrl:t.avatarUrl,color:t.color,emotion:t.emotion||"default"}},getCharacterStyle(t){const e={};return t.color&&t.id===this.speakingCharacterId&&(e.borderColor=t.color),e},handleImageError(t){console.warn(`Ï∫êÎ¶≠ÌÑ∞ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${t.name}`),this.failedImageIds.add(t.id),this.$forceUpdate()}},watch:{currentStep:{handler(t){if(!t)return;const e=this.speakingCharacterId;e&&!this.activeCharacterIds.includes(e)&&(this.activeCharacterIds.push(e),this.activeCharacterIds.length>this.maxVisibleCharacters&&this.activeCharacterIds.shift())},immediate:!0}}},Ge={class:"character-display"},We={class:"character-container"},Je={class:"character-avatar"},$e=["src","alt"];function Qe(t,e,n,p,a,i){return l(),r("div",Ge,[s("div",We,[u(C,{name:"character-fade",mode:"out-in"},{default:S(()=>[i.currentCharacter&&i.currentCharacter.avatarUrl&&!a.failedImageIds.has(i.currentCharacter.id)?(l(),r("div",{key:i.currentCharacter.id,class:T(["character-wrapper",{"is-speaking":i.currentCharacter.id===i.speakingCharacterId}]),style:I(i.getCharacterStyle(i.currentCharacter))},[s("div",Je,[s("img",{src:i.currentCharacter.avatarUrl,alt:i.currentCharacter.name,onError:e[0]||(e[0]=c=>i.handleImageError(i.currentCharacter))},null,40,$e)])],6)):h("",!0)]),_:1})])])}const Ye=_(Fe,[["render",Qe],["__scopeId","data-v-a57cc8bc"]]),Ze={name:"PlaybackControls",props:{currentStepNumber:{type:Number,required:!0},totalSteps:{type:Number,required:!0},currentSceneName:{type:String,default:""},hasPreviousStep:{type:Boolean,default:!1},hasNextStep:{type:Boolean,default:!0},autoPlayEnabled:{type:Boolean,default:!1},showProgressBar:{type:Boolean,default:!0},showSceneSelector:{type:Boolean,default:!1}},computed:{progressPercentage(){return this.totalSteps===0?0:this.currentStepNumber/this.totalSteps*100}}},et={class:"playback-controls"},tt={key:0,class:"progress-bar"},st={class:"progress-info"},ot={class:"scene-name"},it={class:"step-counter"},nt={class:"controls-buttons"},lt=["disabled"],at=["disabled"],rt={key:1,class:"step-counter"};function ct(t,e,n,p,a,i){const c=v("EmojiToIcon");return l(),r("div",et,[n.showProgressBar?(l(),r("div",tt,[s("div",{class:"progress-fill",style:I({width:i.progressPercentage+"%"})},null,4),s("div",st,[s("span",ot,d(n.currentSceneName),1),s("span",it,d(n.currentStepNumber)+" / "+d(n.totalSteps),1)])])):h("",!0),s("div",nt,[s("button",{class:"control-button",onClick:e[0]||(e[0]=o=>t.$emit("previous")),disabled:!n.hasPreviousStep,title:"Ïù¥Ï†Ñ (‚Üê)"},[u(c,{emoji:"‚èÆÔ∏è",size:20})],8,lt),s("button",{class:"control-button primary",onClick:e[1]||(e[1]=o=>t.$emit("next")),disabled:!n.hasNextStep,title:"Îã§Ïùå (‚Üí / Space)"},[u(c,{emoji:"‚ñ∂Ô∏è",size:24})],8,at),s("button",{class:T(["control-button",{"is-active":n.autoPlayEnabled}]),onClick:e[2]||(e[2]=o=>t.$emit("toggle-autoplay")),title:"ÏûêÎèô Ïû¨ÏÉù"},[u(c,{emoji:n.autoPlayEnabled?"‚è∏Ô∏è":"‚èØÔ∏è",size:20},null,8,["emoji"])],2),n.showSceneSelector?(l(),r("button",{key:0,class:"control-button",onClick:e[3]||(e[3]=o=>t.$emit("open-scene-selector")),title:"Ïî¨ ÏÑ†ÌÉù"},[u(c,{emoji:"üìë",size:20})])):h("",!0),n.showProgressBar?h("",!0):(l(),r("div",rt,d(n.currentStepNumber)+" / "+d(n.totalSteps),1))])])}const dt=_(Ze,[["render",ct],["__scopeId","data-v-d1f0ea44"]]),ut={name:"HandoutDisplay",props:{handout:{type:Object,default:()=>({id:null,title:"",imageUrl:"",description:""})},isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{imageLoadError:!1}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},handleImageError(){this.imageLoadError=!0,console.error(`Ìï∏ÎìúÏïÑÏõÉ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®: ${this.handout.imageUrl}`)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.imageLoadError=!1)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},ht={key:0,class:"handout-header"},mt={class:"handout-title"},pt={class:"handout-content"},yt=["src","alt"],vt={key:1,class:"handout-placeholder"},ft={key:2,class:"handout-description"};function St(t,e,n,p,a,i){const c=v("EmojiToIcon");return l(),w(C,{name:"handout-overlay"},{default:S(()=>[n.isVisible?(l(),r("div",{key:0,class:"handout-overlay",onClick:e[3]||(e[3]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"handout-container",onClick:e[2]||(e[2]=E(()=>{},["stop"]))},[s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:24})]),n.handout.title?(l(),r("div",ht,[s("h2",mt,d(n.handout.title),1)])):h("",!0),s("div",pt,[n.handout.imageUrl?(l(),r("img",{key:0,src:n.handout.imageUrl,alt:n.handout.title||"Ìï∏ÎìúÏïÑÏõÉ",class:"handout-image",onError:e[1]||(e[1]=(...o)=>i.handleImageError&&i.handleImageError(...o))},null,40,yt)):(l(),r("div",vt,[u(c,{emoji:"üñºÔ∏è",size:64}),e[4]||(e[4]=s("p",null,"Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§",-1))])),n.handout.description?(l(),r("div",ft,[s("p",null,d(n.handout.description),1)])):h("",!0)])])])):h("",!0)]),_:1})}const gt=_(ut,[["render",St],["__scopeId","data-v-3b47a24b"]]),Ct={name:"ThemeSettingsModal",props:{isVisible:{type:Boolean,default:!1},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{localSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard"},defaultSettings:{primaryColor:"#6366f1",bgColor:"#1a1a2e",textColor:"#ffffff",borderColor:"#666666",fontFamily:"Pretendard"}}},computed:{previewStyles(){return{"--preview-primary":this.localSettings.primaryColor,"--preview-bg":this.localSettings.bgColor,"--preview-text":this.localSettings.textColor,"--preview-border":this.localSettings.borderColor,fontFamily:this.localSettings.fontFamily}}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},loadSettings(){const t=localStorage.getItem("vnlog-theme-settings");if(t)try{this.localSettings={...this.defaultSettings,...JSON.parse(t)}}catch(e){console.error("ÌÖåÎßà ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®:",e)}},saveSettings(){localStorage.setItem("vnlog-theme-settings",JSON.stringify(this.localSettings)),this.applyTheme(this.localSettings),this.$emit("save",this.localSettings),this.$emit("close")},applyTheme(t){const e=document.documentElement;e.style.setProperty("--primary-color",t.primaryColor),e.style.setProperty("--bg-color",t.bgColor),e.style.setProperty("--text-color",t.textColor),e.style.setProperty("--border-color",t.borderColor),e.style.setProperty("--font-family",t.fontFamily)},resetToDefault(){this.localSettings={...this.defaultSettings}},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSettings(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="")}}},mounted(){this.loadSettings(),this.applyTheme(this.localSettings)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},bt={class:"modal-header"},_t={class:"modal-title"},kt={class:"modal-content"},wt={class:"setting-group"},Tt={class:"setting-label"},xt={class:"color-picker-wrapper"},Dt={class:"setting-group"},At={class:"setting-label"},Et={class:"color-picker-wrapper"},It={class:"setting-group"},Ot={class:"setting-label"},Pt={class:"color-picker-wrapper"},Nt={class:"setting-group"},jt={class:"setting-label"},Lt={class:"color-picker-wrapper"},Mt={class:"setting-group"},Vt={class:"setting-label"},zt={class:"preview-section"},Ht={class:"modal-footer"},Rt={class:"button-group"};function Bt(t,e,n,p,a,i){const c=v("EmojiToIcon");return l(),w(C,{name:"modal-overlay"},{default:S(()=>[n.isVisible?(l(),r("div",{key:0,class:"modal-overlay",onClick:e[14]||(e[14]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"modal-container",onClick:e[13]||(e[13]=E(()=>{},["stop"]))},[s("div",bt,[s("h2",_t,[u(c,{emoji:"üé®",size:24}),e[15]||(e[15]=k(" ÌÖåÎßà ÏÑ§Ï†ï ",-1))]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:20})])]),s("div",kt,[s("div",wt,[s("label",Tt,[u(c,{emoji:"üé®",size:16}),e[16]||(e[16]=k(" Ï£ºÏöî ÏÉâÏÉÅ ",-1))]),s("div",xt,[x(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>a.localSettings.primaryColor=o),type:"color",class:"color-picker"},null,512),[[A,a.localSettings.primaryColor]]),x(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.localSettings.primaryColor=o),type:"text",class:"color-input",placeholder:"#6366f1"},null,512),[[A,a.localSettings.primaryColor]])])]),s("div",Dt,[s("label",At,[u(c,{emoji:"üñºÔ∏è",size:16}),e[17]||(e[17]=k(" Î∞∞Í≤Ω ÏÉâÏÉÅ ",-1))]),s("div",Et,[x(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.localSettings.bgColor=o),type:"color",class:"color-picker"},null,512),[[A,a.localSettings.bgColor]]),x(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.localSettings.bgColor=o),type:"text",class:"color-input",placeholder:"#1a1a2e"},null,512),[[A,a.localSettings.bgColor]])])]),s("div",It,[s("label",Ot,[u(c,{emoji:"üìù",size:16}),e[18]||(e[18]=k(" ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ ",-1))]),s("div",Pt,[x(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>a.localSettings.textColor=o),type:"color",class:"color-picker"},null,512),[[A,a.localSettings.textColor]]),x(s("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>a.localSettings.textColor=o),type:"text",class:"color-input",placeholder:"#ffffff"},null,512),[[A,a.localSettings.textColor]])])]),s("div",Nt,[s("label",jt,[u(c,{emoji:"‚¨ú",size:16}),e[19]||(e[19]=k(" ÌÖåÎëêÎ¶¨ ÏÉâÏÉÅ ",-1))]),s("div",Lt,[x(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>a.localSettings.borderColor=o),type:"color",class:"color-picker"},null,512),[[A,a.localSettings.borderColor]]),x(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>a.localSettings.borderColor=o),type:"text",class:"color-input",placeholder:"#666666"},null,512),[[A,a.localSettings.borderColor]])])]),s("div",Mt,[s("label",Vt,[u(c,{emoji:"üî§",size:16}),e[20]||(e[20]=k(" Ìè∞Ìä∏ ",-1))]),x(s("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>a.localSettings.fontFamily=o),class:"font-select"},[...e[21]||(e[21]=[s("option",{value:"Pretendard"},"Pretendard (Í∏∞Î≥∏)",-1),s("option",{value:"NanumSquare"},"NanumSquare",-1),s("option",{value:"Nanum Myeongjo"},"Nanum Myeongjo",-1),s("option",{value:"NotoSerifKR"},"Noto Serif KR",-1)])],512),[[H,a.localSettings.fontFamily]])]),s("div",zt,[e[23]||(e[23]=s("p",{class:"preview-label"},"ÎØ∏Î¶¨Î≥¥Í∏∞",-1)),s("div",{class:"preview-box",style:I(i.previewStyles)},[...e[22]||(e[22]=[s("p",null,"ÏïàÎÖïÌïòÏÑ∏Ïöî!",-1),s("button",{class:"preview-button"},"Î≤ÑÌäº",-1)])],4)])]),s("div",Ht,[s("button",{class:"action-button secondary",onClick:e[10]||(e[10]=(...o)=>i.resetToDefault&&i.resetToDefault(...o))},[u(c,{emoji:"üîÑ",size:16}),e[24]||(e[24]=k(" Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõê ",-1))]),s("div",Rt,[s("button",{class:"action-button secondary",onClick:e[11]||(e[11]=(...o)=>i.close&&i.close(...o))}," Ï∑®ÏÜå "),s("button",{class:"action-button primary",onClick:e[12]||(e[12]=(...o)=>i.saveSettings&&i.saveSettings(...o))},[u(c,{emoji:"üíæ",size:16}),e[25]||(e[25]=k(" Ï†ÄÏû• ",-1))])])])])])):h("",!0)]),_:1})}const Ut=_(Ct,[["render",Bt],["__scopeId","data-v-23ba65f7"]]),Kt={name:"SaveLoadModal",props:{isVisible:{type:Boolean,default:!1},mode:{type:String,default:"save",validator:t=>["save","load"].includes(t)},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{saveSlots:[],deleteConfirmSlot:null}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.deleteConfirmSlot===null&&this.close()},loadSaveSlots(){this.saveSlots=P.getAllSaves()},handleSlotClick(t){this.mode==="save"?(this.$emit("save",t),this.close()):this.saveSlots[t].isEmpty||(this.$emit("load",t),this.close())},confirmDelete(t){this.deleteConfirmSlot=t},cancelDelete(){this.deleteConfirmSlot=null},executeDelete(){this.deleteConfirmSlot!==null&&(P.deleteSave(this.deleteConfirmSlot),this.loadSaveSlots(),this.deleteConfirmSlot=null)},formatInfo(t){return P.formatSaveInfo(t)},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&(this.deleteConfirmSlot!==null?this.cancelDelete():this.close())}},watch:{isVisible:{immediate:!0,handler(t){t?(this.loadSaveSlots(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden"):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.deleteConfirmSlot=null)}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},Xt={class:"modal-header"},qt={class:"modal-title"},Ft={class:"modal-content"},Gt=["onClick"],Wt={class:"slot-header"},Jt={class:"slot-number"},$t=["onClick"],Qt={class:"slot-content"},Yt={key:0,class:"empty-slot"},Zt={key:1,class:"save-info"},es={class:"save-title"},ts={class:"save-subtitle"},ss={class:"save-date"},os={class:"modal-footer"},is={class:"footer-note"},ns={class:"confirm-content"},ls={class:"confirm-buttons"};function as(t,e,n,p,a,i){const c=v("EmojiToIcon");return l(),w(C,{name:"modal-overlay"},{default:S(()=>[n.isVisible?(l(),r("div",{key:0,class:"modal-overlay",onClick:e[5]||(e[5]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"modal-container",onClick:e[1]||(e[1]=E(()=>{},["stop"]))},[s("div",Xt,[s("h2",qt,[u(c,{emoji:n.mode==="save"?"üíæ":"üìÇ",size:24},null,8,["emoji"]),k(" "+d(n.mode==="save"?"Ï†ÄÏû•ÌïòÍ∏∞":"Î∂àÎü¨Ïò§Í∏∞"),1)]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:20})])]),s("div",Ft,[(l(!0),r(b,null,D(a.saveSlots,o=>(l(),r("div",{key:o.slotIndex,class:T(["save-slot",{"is-empty":o.isEmpty}]),onClick:m=>i.handleSlotClick(o.slotIndex)},[s("div",Wt,[s("span",Jt,"Ïä¨Î°Ø "+d(o.slotIndex+1),1),!o.isEmpty&&n.mode==="save"?(l(),r("button",{key:0,class:"delete-button",onClick:E(m=>i.confirmDelete(o.slotIndex),["stop"]),title:"ÏÇ≠Ï†ú"},[u(c,{emoji:"üóëÔ∏è",size:16})],8,$t)):h("",!0)]),s("div",Qt,[o.isEmpty?(l(),r("div",Yt,[u(c,{emoji:"üì≠",size:32}),e[6]||(e[6]=s("p",null,"Îπà Ïä¨Î°Ø",-1))])):(l(),r("div",Zt,[s("h3",es,d(i.formatInfo(o).title),1),s("p",ts,d(i.formatInfo(o).subtitle),1),s("p",ss,d(i.formatInfo(o).date),1)]))])],10,Gt))),128))]),s("div",os,[s("p",is,[u(c,{emoji:"‚ÑπÔ∏è",size:14}),k(" "+d(n.mode==="save"?"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÌòÑÏû¨ ÏßÑÌñâÎèÑÎ•º Ï†ÄÏû•Ìï©ÎãàÎã§.":"Ïä¨Î°ØÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ï†ÄÏû•Îêú ÏßÑÌñâÎèÑÎ•º Î∂àÎü¨ÏòµÎãàÎã§."),1)])])]),a.deleteConfirmSlot!==null?(l(),r("div",{key:0,class:"confirm-modal",onClick:e[4]||(e[4]=E(()=>{},["stop"]))},[s("div",ns,[e[7]||(e[7]=s("h3",null,"Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú",-1)),s("p",null,"Ïä¨Î°Ø "+d(a.deleteConfirmSlot+1)+"Ïùò Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",1),s("div",ls,[s("button",{class:"action-button secondary",onClick:e[2]||(e[2]=(...o)=>i.cancelDelete&&i.cancelDelete(...o))}," Ï∑®ÏÜå "),s("button",{class:"action-button danger",onClick:e[3]||(e[3]=(...o)=>i.executeDelete&&i.executeDelete(...o))}," ÏÇ≠Ï†ú ")])])])):h("",!0)])):h("",!0)]),_:1})}const rs=_(Kt,[["render",as],["__scopeId","data-v-88932176"]]),cs={name:"SceneSelectorModal",props:{isVisible:{type:Boolean,default:!1},scenes:{type:Array,default:()=>[]},currentSceneIndex:{type:Number,default:0},currentStepIndex:{type:Number,default:0},closeOnOverlayClick:{type:Boolean,default:!0}},data(){return{expandedScenes:new Set}},methods:{close(){this.$emit("close")},handleOverlayClick(){this.closeOnOverlayClick&&this.close()},toggleScene(t){this.expandedScenes.has(t)?this.expandedScenes.delete(t):this.expandedScenes.add(t),this.$forceUpdate()},goToStep(t,e){this.$emit("go-to-step",t,e),this.close()},getStepPreview(t){return t?t.length>50?t.substring(0,50)+"...":t:"(ÌÖçÏä§Ìä∏ ÏóÜÏùå)"},handleKeyPress(t){t.key==="Escape"&&this.isVisible&&this.close()},initExpandedScenes(){this.currentSceneIndex!==null&&this.expandedScenes.add(this.currentSceneIndex)},scrollToCurrentScene(){setTimeout(()=>{this.$nextTick(()=>{const t=this.$refs.currentStep;if(t){const e=Array.isArray(t)?t[0]:t;e&&e.scrollIntoView({behavior:"smooth",block:"center"})}})},250)}},watch:{isVisible:{immediate:!0,handler(t){t?(this.initExpandedScenes(),window.addEventListener("keydown",this.handleKeyPress),document.body.style.overflow="hidden",this.scrollToCurrentScene()):(window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow="",this.expandedScenes.clear())}},currentSceneIndex:{handler(t){this.isVisible&&t!==null&&(this.expandedScenes.add(t),this.$forceUpdate())}}},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress),document.body.style.overflow=""}},ds={class:"modal-header"},us={class:"modal-title"},hs={class:"modal-content"},ms=["onClick"],ps={class:"scene-info"},ys={class:"scene-number"},vs={class:"scene-name"},fs={class:"scene-meta"},Ss={class:"step-count"},gs={key:0,class:"steps-list"},Cs=["onClick"],bs={class:"step-number"},_s={class:"step-preview"},ks={class:"step-text"},ws={key:0,class:"empty-state"},Ts={class:"modal-footer"},xs={class:"footer-info"};function Ds(t,e,n,p,a,i){const c=v("EmojiToIcon");return l(),w(C,{name:"modal-overlay"},{default:S(()=>[n.isVisible?(l(),r("div",{key:0,class:"modal-overlay",onClick:e[3]||(e[3]=(...o)=>i.handleOverlayClick&&i.handleOverlayClick(...o))},[s("div",{class:"modal-container",onClick:e[2]||(e[2]=E(()=>{},["stop"]))},[s("div",ds,[s("h2",us,[u(c,{emoji:"üìë",size:24}),e[4]||(e[4]=k(" Ïî¨ ÏÑ†ÌÉù ",-1))]),s("button",{class:"close-button",onClick:e[0]||(e[0]=(...o)=>i.close&&i.close(...o)),title:"Îã´Í∏∞ (ESC)"},[u(c,{emoji:"‚úñÔ∏è",size:20})])]),s("div",hs,[(l(!0),r(b,null,D(n.scenes,(o,m)=>(l(),r("div",{key:`scene-${m}`,class:T(["scene-item",{"is-current":m===n.currentSceneIndex}])},[s("div",{class:"scene-header",onClick:y=>i.toggleScene(m)},[s("div",ps,[s("span",ys,"Ïî¨ "+d(m+1),1),s("h3",vs,d(o.name||"Ï†úÎ™© ÏóÜÏùå"),1)]),s("div",fs,[s("span",Ss,d(o.steps.length)+"Í∞ú Ïä§ÌÖù",1),u(c,{emoji:a.expandedScenes.has(m)?"üîΩ":"‚ñ∂Ô∏è",size:16,class:"expand-icon"},null,8,["emoji"])])],8,ms),u(C,{name:"steps-expand"},{default:S(()=>[a.expandedScenes.has(m)?(l(),r("div",gs,[(l(!0),r(b,null,D(o.steps,(y,g)=>{var O;return l(),r("div",{key:`step-${m}-${g}`,ref_for:!0,ref:m===n.currentSceneIndex&&g===n.currentStepIndex?"currentStep":null,class:T(["step-item",{"is-current":m===n.currentSceneIndex&&g===n.currentStepIndex}]),onClick:N=>i.goToStep(m,g)},[s("span",bs,d(g+1),1),s("div",_s,[(O=y.character)!=null&&O.name?(l(),r("span",{key:0,class:"step-character",style:I({color:y.character.color||"#ffffff"})},d(y.character.name)+": ",5)):h("",!0),s("span",ks,d(i.getStepPreview(y.text)),1)]),m===n.currentSceneIndex&&g===n.currentStepIndex?(l(),w(c,{key:0,emoji:"‚ñ∂Ô∏è",size:14,class:"current-indicator"})):h("",!0)],10,Cs)}),128))])):h("",!0)]),_:2},1024)],2))),128)),n.scenes.length===0?(l(),r("div",ws,[u(c,{emoji:"üì≠",size:48}),e[5]||(e[5]=s("p",null,"Ïî¨Ïù¥ ÏóÜÏäµÎãàÎã§",-1))])):h("",!0)]),s("div",Ts,[s("div",xs,[u(c,{emoji:"‚ÑπÔ∏è",size:14}),e[6]||(e[6]=s("span",null,"Ïî¨ÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÌéºÏπòÍ≥†, Ïä§ÌÖùÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ïù¥ÎèôÌï©ÎãàÎã§.",-1))]),s("button",{class:"action-button primary",onClick:e[1]||(e[1]=(...o)=>i.close&&i.close(...o))}," Îã´Í∏∞ ")])])])):h("",!0)]),_:1})}const As=_(cs,[["render",Ds],["__scopeId","data-v-887e5c5c"]]),Es={name:"DiceRoll",props:{diceRolls:{type:Array,default:()=>[]},characterName:{type:String,default:""},characterColor:{type:String,default:"#ffffff"},animated:{type:Boolean,default:!0},animationDuration:{type:Number,default:800},playSoundEffect:{type:Boolean,default:!1}},data(){return{processedRolls:[],audioContext:null}},watch:{diceRolls:{immediate:!0,handler(t){this.processRolls(t)}}},methods:{processRolls(t){if(!t||t.length===0){this.processedRolls=[];return}this.processedRolls=t.map((e,n)=>({...e,isAnimating:!1,showResult:e.type==="choice"||e.type==="judgement",showDetails:!1})),this.animated?this.processedRolls.forEach((e,n)=>{e.type==="choice"||e.type==="judgement"||setTimeout(()=>{this.animateRoll(n)},n*200)}):this.processedRolls.forEach(e=>{e.showResult=!0})},animateRoll(t){const e=this.processedRolls[t];e&&(e.isAnimating=!0,this.playSoundEffect&&this.playDiceSound(),setTimeout(()=>{e.isAnimating=!1,e.showResult=!0},this.animationDuration))},toggleDetails(t){const e=this.processedRolls[t];e&&(e.showDetails=!e.showDetails)},playDiceSound(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));const t=this.audioContext,e=t.createOscillator(),n=t.createGain();e.connect(n),n.connect(t.destination),e.type="square",e.frequency.setValueAtTime(200,t.currentTime),e.frequency.exponentialRampToValueAtTime(100,t.currentTime+.1),n.gain.setValueAtTime(.1,t.currentTime),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),e.start(t.currentTime),e.stop(t.currentTime+.1)}}},Is={class:"dice-roll-container"},Os={class:"dice-icon-wrapper"},Ps={class:"dice-result choice-result"},Ns=["onClick","title"],js={key:0,class:"dice-details choice-options"},Ls={class:"judgement-header"},Ms={class:"dice-icon-wrapper"},Vs={class:"judgement-info"},zs={class:"judgement-main"},Hs={class:"dice-formula"},Rs={class:"judgement-result-line"},Bs={key:1,class:"dice-placeholder"},Us={class:"judgement-text"},Ks=["onClick","title"],Xs={key:0,class:"dice-details"},qs={class:"dice-formula"},Fs={key:1,class:"dice-placeholder"},Gs={key:0,class:"dice-details-wrapper"},Ws=["onClick","title"],Js={key:0,class:"dice-details"};function $s(t,e,n,p,a,i){const c=v("EmojiToIcon");return l(),r("div",Is,[u(R,{name:"dice-list",tag:"div",class:"dice-rolls"},{default:S(()=>[(l(!0),r(b,null,D(a.processedRolls,(o,m)=>(l(),r("div",{key:`${o.formula}-${m}`,class:T(["dice-roll",[{"is-animating":o.isAnimating},`roll-type-${o.type}`]])},[o.type==="choice"?(l(),r(b,{key:0},[s("div",Os,[u(c,{emoji:"üéØ",size:18,class:"dice-icon"})]),e[0]||(e[0]=s("span",{class:"dice-formula"},"ÏÑ†ÌÉù",-1)),e[1]||(e[1]=s("span",{class:"dice-arrow"},"‚Üí",-1)),s("span",Ps,d(o.result),1),s("button",{class:"details-toggle",onClick:y=>i.toggleDetails(m),title:o.showDetails?"ÏòµÏÖò Ïà®Í∏∞Í∏∞":"ÏòµÏÖò Î≥¥Í∏∞"},[u(c,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Ns),u(C,{name:"details-expand"},{default:S(()=>[o.showDetails?(l(),r("div",js,[(l(!0),r(b,null,D(o.options,(y,g)=>(l(),r("span",{key:g,class:"choice-option"},d(y),1))),128))])):h("",!0)]),_:2},1024)],64)):o.type==="judgement"?(l(),r(b,{key:1},[s("div",Ls,[s("div",Ms,[u(c,{emoji:"‚öñÔ∏è",size:18,class:"dice-icon"})]),s("div",Vs,[s("div",zs,[s("span",{class:"judgement-character",style:I({color:n.characterColor})},d(n.characterName),5),s("span",Hs,d(o.checkName),1)]),s("div",Rs,[e[2]||(e[2]=s("span",{class:"dice-arrow"},"‚Üí",-1)),u(C,{name:"dice-result",mode:"out-in"},{default:S(()=>[o.showResult?(l(),r("span",{key:o.result,class:"dice-result"},d(o.result),1)):(l(),r("span",Bs,"???"))]),_:2},1024),s("span",Us,d(o.judgement),1)])])]),s("button",{class:"details-toggle",onClick:y=>i.toggleDetails(m),title:o.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[u(c,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Ks),u(C,{name:"details-expand"},{default:S(()=>[o.showDetails?(l(),r("div",Xs,d(o.formula),1)):h("",!0)]),_:2},1024)],64)):(l(),r(b,{key:2},[s("div",{class:T(["dice-icon-wrapper",{"is-rolling":o.isAnimating}])},[u(c,{emoji:"üé≤",size:18,class:"dice-icon"})],2),s("span",qs,d(o.formula),1),e[3]||(e[3]=s("span",{class:"dice-arrow"},"‚Üí",-1)),u(C,{name:"dice-result",mode:"out-in"},{default:S(()=>[o.showResult?(l(),r("span",{key:o.result,class:"dice-result"},d(o.result),1)):(l(),r("span",Fs,"???"))]),_:2},1024),o.type==="dx3"&&o.diceRolls?(l(),r("div",Gs,[s("button",{class:"details-toggle",onClick:y=>i.toggleDetails(m),title:o.showDetails?"ÏÉÅÏÑ∏ Ïà®Í∏∞Í∏∞":"ÏÉÅÏÑ∏ Î≥¥Í∏∞"},[u(c,{emoji:o.showDetails?"üîΩ":"‚ñ∂Ô∏è",size:12},null,8,["emoji"])],8,Ws),u(C,{name:"details-expand"},{default:S(()=>[o.showDetails?(l(),r("div",Js,d(o.diceRolls),1)):h("",!0)]),_:2},1024)])):h("",!0)],64))],2))),128))]),_:1})])}const Qs=_(Es,[["render",$s],["__scopeId","data-v-65fa6f7c"]]),Ys={name:"PlayerView",components:{DialogBox:qe,CharacterDisplay:Ye,PlaybackControls:dt,HandoutDisplay:gt,ThemeSettingsModal:Ut,SaveLoadModal:rs,SceneSelectorModal:As,DiceRoll:Qs,DXCombo:j},setup(){return{logStore:z()}},data(){return{autoPlayTimer:null,typingSpeed:50,showHandout:!1,currentHandout:null,showThemeSettings:!1,showSaveLoadModal:!1,saveLoadMode:"save",showSceneSelector:!1,showDiceOverlay:!1,currentDiceRolls:[],diceCharacterName:"",diceCharacterColor:"#ffffff",diceOverlayTimer:null,showComboOverlay:!1,currentDXCombos:[],comboCharacterName:"",comboCharacterColor:"#ffffff",comboOverlayTimer:null,previousSceneIndex:0,showSceneDescription:!1,sceneDescriptionData:null,sceneDescriptionTimer:null,isMobile:!1,isTablet:!1,isTouchDevice:!1}},watch:{"logStore.playback.currentSceneIndex"(t,e){t!==e&&this.onSceneChange()}},computed:{logTitle(){var t;return((t=this.logStore.vnData)==null?void 0:t.title)||"Î°úÍ∑∏ ÌîåÎ†àÏù¥Ïñ¥"},currentScene(){var n,p;const t=((n=this.logStore.vnData)==null?void 0:n.scenes)||[],e=((p=this.logStore.playback)==null?void 0:p.currentSceneIndex)||0;return t[e]||null},currentStep(){return this.logStore.currentStep},hasNextStep(){return this.logStore.hasNextStep},hasPreviousStep(){return this.logStore.hasPreviousStep},autoPlayEnabled(){var t;return((t=this.logStore.playback)==null?void 0:t.autoPlayEnabled)||!1},currentStepNumber(){var a,i,c,o;let t=0;const e=((a=this.logStore.vnData)==null?void 0:a.scenes)||[],n=((i=this.logStore.playback)==null?void 0:i.currentSceneIndex)||0,p=((c=this.logStore.playback)==null?void 0:c.currentStepIndex)||0;for(let m=0;m<n;m++)t+=((o=e[m])==null?void 0:o.steps.length)||0;return t+=p+1,t},totalSteps(){var e;return(((e=this.logStore.vnData)==null?void 0:e.scenes)||[]).reduce((n,p)=>{var a;return n+(((a=p==null?void 0:p.steps)==null?void 0:a.length)||0)},0)},currentSceneName(){const t=this.logStore.currentScene;return(t==null?void 0:t.name)||""},hasActiveOverlay(){return this.showDiceOverlay||this.showComboOverlay||this.showSceneDescription}},methods:{detectDevice(){const t=navigator.userAgent.toLowerCase(),e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t),n=/ipad|android(?!.*mobile)|tablet/i.test(t),p="ontouchstart"in window||navigator.maxTouchPoints>0,a=window.innerWidth,i=a<=767,c=a>=768&&a<=1023;this.isMobile=e&&i||p&&i,this.isTablet=n&&c||p&&c&&!e,this.isTouchDevice=p,this.isMobile&&(this.typingSpeed=30),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device"),this.isMobile?document.body.classList.add("device-mobile"):this.isTablet?document.body.classList.add("device-tablet"):document.body.classList.add("device-desktop"),this.isTouchDevice&&document.body.classList.add("touch-device"),console.log("Device Detection:",{isMobile:this.isMobile,isTablet:this.isTablet,isTouchDevice:this.isTouchDevice,screenWidth:a,userAgent:t})},getCharacterName(t){return t.type==="system"?t.character.name||"ÏãúÏä§ÌÖú":t.type==="narrator"?"":t.character.name},handleAdvance(){var t;console.log("[PlayerView] handleAdvance Ìò∏Ï∂ú:",{hasNextStep:this.hasNextStep,autoPlayEnabled:this.autoPlayEnabled,currentStepIndex:(t=this.logStore.playback)==null?void 0:t.currentStepIndex}),this.hasNextStep?this.nextStep():this.autoPlayEnabled&&this.logStore.toggleAutoPlay()},handleTypingComplete(){},goHome(){this.stopAutoPlay(),this.$router.push("/")},openSettings(){this.showThemeSettings=!0},closeSettings(){this.showThemeSettings=!1},handleThemeSave(t){},openSceneSelector(){this.showSceneSelector=!0},closeSceneSelector(){this.showSceneSelector=!1},handleGoToStep(t,e){const n=this.logStore.playback.currentSceneIndex;this.logStore.goToStep(t,e),n!==t&&this.onSceneChange(),this.closeSceneSelector(),this.showOverlaysIfPresent()},openSaveModal(){this.saveLoadMode="save",this.showSaveLoadModal=!0},openLoadModal(){this.saveLoadMode="load",this.showSaveLoadModal=!0},closeSaveLoadModal(){this.showSaveLoadModal=!1},handleSave(t){this.logStore.saveProgress(t)},handleLoad(t){this.logStore.loadProgress(t)},openHandout(t){this.currentHandout=t,this.showHandout=!0},closeHandout(){this.showHandout=!1,this.currentHandout=null},onSceneChange(){this.showDiceOverlay=!1,this.showComboOverlay=!1,this.showHandout=!1,this.currentHandout=null,this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),this.displaySceneDescriptionIfPresent()},displaySceneDescriptionIfPresent(){if(!this.currentScene)return;const t=this.currentScene.steps[0];t&&t.isSceneDescription&&(this.sceneDescriptionData={number:t.sceneNumber,title:t.sceneTitle,pcs:t.scenePCs,description:t.sceneDescription,fullText:t.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance())},closeSceneDescription(){this.showSceneDescription=!1;const t=this.sceneDescriptionTimer!==null;this.stopSceneDescriptionAutoAdvance(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startSceneDescriptionAutoAdvance(){this.stopSceneDescriptionAutoAdvance(),this.sceneDescriptionTimer=setTimeout(()=>{this.closeSceneDescription(),this.autoPlayEnabled&&(this.hasNextStep?this.nextStep():this.logStore.toggleAutoPlay())},3e3)},stopSceneDescriptionAutoAdvance(){this.sceneDescriptionTimer&&(clearTimeout(this.sceneDescriptionTimer),this.sceneDescriptionTimer=null)},nextStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.nextStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.showOverlaysIfPresent(),this.logStore.playback.currentStepIndex%10===0&&this.logStore.autoSave()},previousStep(){const t=this.logStore.playback.currentSceneIndex;this.logStore.previousStep();const e=this.logStore.playback.currentSceneIndex;t!==e&&this.onSceneChange(),this.showOverlaysIfPresent()},showOverlaysIfPresent(){if(this.currentStep&&this.currentStep.isSceneDescription){this.sceneDescriptionData={number:this.currentStep.sceneNumber,title:this.currentStep.sceneTitle,pcs:this.currentStep.scenePCs,description:this.currentStep.sceneDescription,fullText:this.currentStep.text},this.showSceneDescription=!0,this.autoPlayEnabled&&this.startSceneDescriptionAutoAdvance();return}const t=this.currentStep&&this.currentStep.diceRolls&&this.currentStep.diceRolls.length>0,e=this.currentStep&&this.currentStep.dxCombos&&this.currentStep.dxCombos.length>0;if(t){this.currentDiceRolls=this.currentStep.diceRolls,this.diceCharacterName=this.getCharacterName(this.currentStep),this.diceCharacterColor=this.currentStep.character.color,this.showDiceOverlay=!0,this.autoPlayEnabled&&this.startDiceOverlayAutoClose();return}e&&(this.currentDXCombos=this.currentStep.dxCombos,this.comboCharacterName=this.getCharacterName(this.currentStep),this.comboCharacterColor=this.currentStep.character.color,this.showComboOverlay=!0,this.autoPlayEnabled&&this.startComboOverlayAutoClose())},closeDiceOverlay(){this.showDiceOverlay=!1;const t=this.diceOverlayTimer!==null;this.stopDiceOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startDiceOverlayAutoClose(){this.stopDiceOverlayAutoClose(),this.diceOverlayTimer=setTimeout(()=>{this.closeDiceOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3)},stopDiceOverlayAutoClose(){this.diceOverlayTimer&&(clearTimeout(this.diceOverlayTimer),this.diceOverlayTimer=null)},closeComboOverlay(){this.showComboOverlay=!1;const t=this.comboOverlayTimer!==null;this.stopComboOverlayAutoClose(),!t&&this.autoPlayEnabled&&this.hasNextStep&&setTimeout(()=>{this.nextStep()},500)},startComboOverlayAutoClose(){this.stopComboOverlayAutoClose(),this.comboOverlayTimer=setTimeout(()=>{this.closeComboOverlay(),this.autoPlayEnabled&&this.hasNextStep&&this.nextStep()},3e3)},stopComboOverlayAutoClose(){this.comboOverlayTimer&&(clearTimeout(this.comboOverlayTimer),this.comboOverlayTimer=null)},toggleAutoPlay(){const t=this.autoPlayEnabled;this.logStore.toggleAutoPlay(),!t&&this.autoPlayEnabled&&this.hasActiveOverlay},stopAutoPlay(){this.autoPlayTimer&&(clearInterval(this.autoPlayTimer),this.autoPlayTimer=null)},handleKeyPress(t){if(!(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"))switch(t.key){case" ":case"Enter":t.preventDefault(),this.handleAdvance();break;case"ArrowLeft":t.preventDefault(),this.hasPreviousStep&&this.previousStep();break;case"ArrowRight":t.preventDefault(),this.hasNextStep&&this.nextStep();break}}},mounted(){var t,e;if(!this.logStore.rawLog){console.warn("Î°úÍ∑∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}if(!this.logStore.vnData||!this.logStore.vnData.scenes||this.logStore.vnData.scenes.length===0){console.warn("ÌååÏã±Îêú VN Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌôàÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§."),this.$router.push("/");return}this.detectDevice(),window.addEventListener("resize",this.detectDevice),window.addEventListener("keydown",this.handleKeyPress),console.log("PlayerView mounted:",{hasRawLog:!!this.logStore.rawLog,hasVNData:!!this.logStore.vnData,sceneCount:((e=(t=this.logStore.vnData)==null?void 0:t.scenes)==null?void 0:e.length)||0,currentStep:this.currentStep})},beforeUnmount(){this.stopAutoPlay(),this.stopSceneDescriptionAutoAdvance(),this.stopDiceOverlayAutoClose(),this.stopComboOverlayAutoClose(),window.removeEventListener("keydown",this.handleKeyPress),window.removeEventListener("resize",this.detectDevice),document.body.classList.remove("device-mobile","device-tablet","device-desktop","touch-device")}},Zs={class:"player-view"},eo={class:"player-container"},to={class:"player-header"},so={class:"log-title"},oo={class:"header-buttons"},io={class:"player-stage"},no={key:1,class:"dialog-wrapper"},lo={key:1,class:"dialog-placeholder"},ao={class:"dice-overlay-hint"},ro={class:"combo-overlay-header"},co={class:"combo-character-info"},uo={class:"dice-overlay-hint"},ho={class:"scene-description-content"},mo={class:"scene-description-header"},po={class:"scene-number"},yo={class:"scene-title"},vo={key:0,class:"scene-pcs"},fo={class:"scene-pcs-value"},So={key:1,class:"scene-description-text"};function go(t,e,n,p,a,i){const c=v("EmojiToIcon"),o=v("CharacterDisplay"),m=v("DialogBox"),y=v("DiceRoll"),g=v("DXCombo"),O=v("PlaybackControls"),N=v("SceneSelectorModal"),L=v("HandoutDisplay"),M=v("ThemeSettingsModal"),V=v("SaveLoadModal");return l(),r("div",Zs,[s("div",eo,[s("div",to,[s("button",{onClick:e[0]||(e[0]=(...f)=>i.goHome&&i.goHome(...f)),class:"back-button"},[u(c,{emoji:"üè†",size:20})]),s("h2",so,d(i.logTitle),1),s("div",oo,[s("button",{onClick:e[1]||(e[1]=(...f)=>i.openSceneSelector&&i.openSceneSelector(...f)),class:"header-button",title:"Ïî¨ ÏÑ†ÌÉù"},[u(c,{emoji:"üìë",size:20})]),s("button",{onClick:e[2]||(e[2]=(...f)=>i.openSaveModal&&i.openSaveModal(...f)),class:"header-button",title:"Ï†ÄÏû•"},[u(c,{emoji:"üíæ",size:20})]),s("button",{onClick:e[3]||(e[3]=(...f)=>i.openLoadModal&&i.openLoadModal(...f)),class:"header-button",title:"Î∂àÎü¨Ïò§Í∏∞"},[u(c,{emoji:"üìÇ",size:20})]),s("button",{onClick:e[4]||(e[4]=(...f)=>i.openSettings&&i.openSettings(...f)),class:"header-button",title:"ÏÑ§Ï†ï"},[u(c,{emoji:"‚öôÔ∏è",size:20})])])]),s("div",io,[i.currentStep&&!i.currentStep.isSceneDescription&&p.logStore.vnData.characters?(l(),w(o,{key:0,"current-step":i.currentStep,characters:p.logStore.vnData.characters,layout:"single"},null,8,["current-step","characters"])):h("",!0),!i.currentStep||!i.currentStep.isSceneDescription?(l(),r("div",no,[i.currentStep&&i.currentStep.character?(l(),w(m,{key:0,"character-name":i.getCharacterName(i.currentStep),"character-color":i.currentStep.character.color,text:i.currentStep.text,"status-changes":i.currentStep.statusChanges||[],illustrations:i.currentStep.illustrations||[],"typing-speed":a.typingSpeed,"auto-advance":i.autoPlayEnabled,"has-overlay":i.hasActiveOverlay,onAdvance:i.handleAdvance,onTypingComplete:i.handleTypingComplete},null,8,["character-name","character-color","text","status-changes","illustrations","typing-speed","auto-advance","has-overlay","onAdvance","onTypingComplete"])):(l(),r("div",lo,[...e[10]||(e[10]=[s("p",null,"Î°úÍ∑∏Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...",-1)])]))])):h("",!0)]),u(C,{name:"dice-overlay"},{default:S(()=>[a.showDiceOverlay&&a.currentDiceRolls.length>0?(l(),r("div",{key:0,class:"dice-overlay",onClick:e[6]||(e[6]=(...f)=>i.closeDiceOverlay&&i.closeDiceOverlay(...f))},[s("div",{class:"dice-overlay-content",onClick:e[5]||(e[5]=E(()=>{},["stop"]))},[u(y,{"dice-rolls":a.currentDiceRolls,"character-name":a.diceCharacterName,"character-color":a.diceCharacterColor,animated:!0,"play-sound-effect":!1},null,8,["dice-rolls","character-name","character-color"]),s("div",ao,[u(c,{emoji:"üëÜ",size:14}),e[11]||(e[11]=s("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),u(C,{name:"dice-overlay"},{default:S(()=>[a.showComboOverlay&&a.currentDXCombos.length>0?(l(),r("div",{key:0,class:"dice-overlay",onClick:e[8]||(e[8]=(...f)=>i.closeComboOverlay&&i.closeComboOverlay(...f))},[s("div",{class:"dice-overlay-content",onClick:e[7]||(e[7]=E(()=>{},["stop"]))},[s("div",ro,[s("div",co,[s("div",{class:"combo-character-name",style:I({color:a.comboCharacterColor})},d(a.comboCharacterName),5)])]),u(g,{dxCombos:a.currentDXCombos},null,8,["dxCombos"]),s("div",uo,[u(c,{emoji:"üëÜ",size:14}),e[12]||(e[12]=s("span",null,"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])])):h("",!0)]),_:1}),u(C,{name:"scene-description"},{default:S(()=>[a.showSceneDescription&&a.sceneDescriptionData?(l(),r("div",{key:0,class:"scene-description-overlay",onClick:e[9]||(e[9]=(...f)=>i.closeSceneDescription&&i.closeSceneDescription(...f))},[s("div",ho,[s("div",mo,[s("span",po,"Ïî¨ "+d(a.sceneDescriptionData.number),1),s("span",yo,d(a.sceneDescriptionData.title),1)]),a.sceneDescriptionData.pcs?(l(),r("div",vo,[e[13]||(e[13]=s("span",{class:"scene-pcs-label"},"PC:",-1)),s("span",fo,d(a.sceneDescriptionData.pcs),1)])):h("",!0),a.sceneDescriptionData.description?(l(),r("div",So,d(a.sceneDescriptionData.description),1)):h("",!0),e[14]||(e[14]=s("div",{class:"scene-description-hint"},"ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞",-1))])])):h("",!0)]),_:1}),u(O,{"current-step-number":i.currentStepNumber,"total-steps":i.totalSteps,"current-scene-name":i.currentSceneName,"has-previous-step":i.hasPreviousStep,"has-next-step":i.hasNextStep,"auto-play-enabled":i.autoPlayEnabled,"show-progress-bar":!0,"show-scene-selector":!0,onPrevious:i.previousStep,onNext:i.handleAdvance,onToggleAutoplay:i.toggleAutoPlay,onOpenSceneSelector:i.openSceneSelector},null,8,["current-step-number","total-steps","current-scene-name","has-previous-step","has-next-step","auto-play-enabled","onPrevious","onNext","onToggleAutoplay","onOpenSceneSelector"])]),u(N,{"is-visible":a.showSceneSelector,scenes:p.logStore.vnData.scenes,"current-scene-index":p.logStore.playback.currentSceneIndex,"current-step-index":p.logStore.playback.currentStepIndex,onClose:i.closeSceneSelector,onGoToStep:i.handleGoToStep},null,8,["is-visible","scenes","current-scene-index","current-step-index","onClose","onGoToStep"]),u(L,{handout:a.currentHandout,"is-visible":a.showHandout,onClose:i.closeHandout},null,8,["handout","is-visible","onClose"]),u(M,{"is-visible":a.showThemeSettings,onClose:i.closeSettings,onSave:i.handleThemeSave},null,8,["is-visible","onClose","onSave"]),u(V,{"is-visible":a.showSaveLoadModal,mode:a.saveLoadMode,onClose:i.closeSaveLoadModal,onSave:i.handleSave,onLoad:i.handleLoad},null,8,["is-visible","mode","onClose","onSave","onLoad"])])}const _o=_(Ys,[["render",go],["__scopeId","data-v-5bd75f40"]]);export{_o as default};
