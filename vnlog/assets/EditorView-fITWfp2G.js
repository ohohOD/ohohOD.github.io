import{u as T}from"./logStore-sUWh6rcs.js";import{_ as V,c,a as t,b as p,d as v,r as U,e as f,j as u,v as m,t as g,o as d,p as I,F as k,f as D,k as E,n as S,l as z,h as w,g as j}from"./index-Bui2BkPo.js";const N={name:"StepEffectsEditor",props:{totalSteps:{type:Number,required:!0},selectedStep:{type:Number,default:null},currentEffects:{type:Object,default:null}},data(){return{startStep:1,endStep:1,effects:{sfx:"",bgm:"",background:"",backgroundOpacity:.3}}},computed:{canApply(){return this.startStep>=1&&this.endStep>=this.startStep&&this.endStep<=this.totalSteps},hasAnyEffect(){return this.effects.sfx||this.effects.bgm||this.effects.background}},methods:{applyEffects(){this.canApply&&(this.$emit("apply",{startStep:this.startStep,endStep:this.endStep,effects:{sfx:this.effects.sfx||null,bgm:this.effects.bgm||null,background:this.effects.background||null,backgroundOpacity:this.effects.backgroundOpacity}}),this.resetForm())},removeEffects(){this.canApply&&(this.$emit("remove",{startStep:this.startStep,endStep:this.endStep}),this.resetForm())},resetForm(){this.effects={sfx:"",bgm:"",background:"",backgroundOpacity:.3}},loadStepEffects(){this.selectedStep!==null&&(this.startStep=this.selectedStep,this.endStep=this.selectedStep),this.currentEffects&&(this.effects={sfx:this.currentEffects.sfx||"",bgm:this.currentEffects.bgm||"",background:this.currentEffects.background||"",backgroundOpacity:this.currentEffects.backgroundOpacity??.3})}},watch:{selectedStep:{immediate:!0,handler(){this.loadStepEffects()}},currentEffects:{immediate:!0,handler(){this.loadStepEffects()}}}},O={class:"step-effects-editor"},R={class:"editor-header"},A={class:"editor-body"},G={class:"section"},J={class:"step-range"},L={class:"input-group"},B=["max"],P={class:"input-group"},F=["min","max"],M={class:"section"},X={class:"section"},q={class:"section"},H={key:0,class:"opacity-control"},Y={key:0,class:"section preview-section"},K={class:"preview-list"},Q={key:0,class:"preview-item"},W={key:1,class:"preview-item"},Z={key:2,class:"preview-item"},$={key:3,class:"preview-item"},ee={class:"actions"},te=["disabled"],se=["disabled"];function le(o,e,n,h,l,a){const r=U("EmojiToIcon");return d(),c("div",O,[t("div",R,[t("h3",null,[p(r,{emoji:"‚ú®",size:20}),e[8]||(e[8]=v(" Ïä§ÌÖù Ìö®Í≥º Ìé∏ÏßëÍ∏∞ ",-1))])]),t("div",A,[t("div",G,[e[11]||(e[11]=t("h4",null,"ÎåÄÏÉÅ Ïä§ÌÖù ÏÑ†ÌÉù",-1)),t("div",J,[t("div",L,[e[9]||(e[9]=t("label",null,"ÏãúÏûë Ïä§ÌÖù",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.startStep=s),type:"number",min:1,max:n.totalSteps,placeholder:"1"},null,8,B),[[m,l.startStep,void 0,{number:!0}]])]),t("div",P,[e[10]||(e[10]=t("label",null,"Ï¢ÖÎ£å Ïä§ÌÖù",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.endStep=s),type:"number",min:l.startStep,max:n.totalSteps,placeholder:"1"},null,8,F),[[m,l.endStep,void 0,{number:!0}]])])]),e[12]||(e[12]=t("p",{class:"hint-text"}," Îã®Ïùº Ïä§ÌÖù: ÏãúÏûëÍ≥º Ï¢ÖÎ£åÎ•º Í∞ôÏùÄ Î≤àÌò∏Î°ú ÏÑ§Ï†ï | Î≤îÏúÑ: Îã§Î•∏ Î≤àÌò∏Î°ú ÏÑ§Ï†ï ",-1))]),t("div",M,[t("h4",null,[p(r,{emoji:"üîä",size:16}),e[13]||(e[13]=v(" Ìö®Í≥ºÏùå (SFX) ",-1))]),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.effects.sfx=s),type:"text",placeholder:"Ìö®Í≥ºÏùå ÌååÏùº URL (Ïòà: https://example.com/sound.mp3)",class:"url-input"},null,512),[[m,l.effects.sfx]])]),t("div",X,[t("h4",null,[p(r,{emoji:"üéµ",size:16}),e[14]||(e[14]=v(" Î∞∞Í≤ΩÏùåÏïÖ (BGM) ",-1))]),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.effects.bgm=s),type:"text",placeholder:"BGM URL (YouTube ÎòêÎäî Ïò§ÎîîÏò§ ÌååÏùº)",class:"url-input"},null,512),[[m,l.effects.bgm]])]),t("div",q,[t("h4",null,[p(r,{emoji:"üñºÔ∏è",size:16}),e[15]||(e[15]=v(" Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ ",-1))]),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.effects.background=s),type:"text",placeholder:"Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ URL (Ïòà: https://example.com/bg.jpg)",class:"url-input"},null,512),[[m,l.effects.background]]),l.effects.background?(d(),c("div",H,[t("label",null,[p(r,{emoji:"üíß",size:14}),v(" Î∞∞Í≤Ω Ìà¨Î™ÖÎèÑ ("+g(Math.round(l.effects.backgroundOpacity*100))+"%) ",1)]),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.effects.backgroundOpacity=s),type:"range",min:"0",max:"1",step:"0.05",class:"opacity-slider"},null,512),[[m,l.effects.backgroundOpacity,void 0,{number:!0}]])])):f("",!0)]),a.hasAnyEffect?(d(),c("div",Y,[t("h4",null,[p(r,{emoji:"üëÅÔ∏è",size:16}),e[16]||(e[16]=v(" ÏÑ§Ï†ï ÎØ∏Î¶¨Î≥¥Í∏∞ ",-1))]),t("div",K,[l.effects.sfx?(d(),c("div",Q,[e[17]||(e[17]=t("strong",null,"Ìö®Í≥ºÏùå:",-1)),t("span",null,g(l.effects.sfx),1)])):f("",!0),l.effects.bgm?(d(),c("div",W,[e[18]||(e[18]=t("strong",null,"BGM:",-1)),t("span",null,g(l.effects.bgm),1)])):f("",!0),l.effects.background?(d(),c("div",Z,[e[19]||(e[19]=t("strong",null,"Î∞∞Í≤Ω:",-1)),t("span",null,g(l.effects.background),1)])):f("",!0),l.effects.background?(d(),c("div",$,[e[20]||(e[20]=t("strong",null,"Ìà¨Î™ÖÎèÑ:",-1)),t("span",null,g(Math.round(l.effects.backgroundOpacity*100))+"%",1)])):f("",!0)])])):f("",!0),t("div",ee,[t("button",{onClick:e[6]||(e[6]=(...s)=>a.applyEffects&&a.applyEffects(...s)),class:"apply-button",disabled:!a.canApply},[p(r,{emoji:"‚úÖ",size:16}),e[21]||(e[21]=v(" Ìö®Í≥º Ï†ÅÏö© ",-1))],8,te),t("button",{onClick:e[7]||(e[7]=(...s)=>a.removeEffects&&a.removeEffects(...s)),class:"remove-button",disabled:!a.canApply},[p(r,{emoji:"üóëÔ∏è",size:16}),e[22]||(e[22]=v(" Ìö®Í≥º Ï†úÍ±∞ ",-1))],8,se)])])])}const oe=V(N,[["render",le],["__scopeId","data-v-ad38d2b9"]]),ae={name:"StepInfoEditor",props:{stepData:{type:Object,default:null}},data(){return{localData:null,showRawJSON:!1}},computed:{hasDice(){var o,e;return((e=(o=this.localData)==null?void 0:o.diceRolls)==null?void 0:e.length)>0},hasStatusChange(){var o,e;return((e=(o=this.localData)==null?void 0:o.statusChanges)==null?void 0:e.length)>0},hasDXCombo(){var o,e;return((e=(o=this.localData)==null?void 0:o.dxCombos)==null?void 0:e.length)>0},hasIllustration(){var o,e;return((e=(o=this.localData)==null?void 0:o.illustrations)==null?void 0:e.length)>0},hasOugi(){var o,e;return((e=(o=this.localData)==null?void 0:o.ougis)==null?void 0:e.length)>0},hasShinobigami(){var o,e;return((e=(o=this.localData)==null?void 0:o.shinobigamis)==null?void 0:e.length)>0}},watch:{"localData.statusChanges":{handler(o){o&&o.forEach(e=>{e.oldValue!==null&&e.newValue!==null&&(e.delta=e.newValue-e.oldValue)})},deep:!0},"localData.diceRolls":{handler(o){o&&o.forEach(e=>{e.type==="choice"&&e.optionsText&&(e.options=e.optionsText.split(",").map(n=>n.trim()))})},deep:!0}},methods:{initializeLocalData(){var o,e,n;if(!this.stepData){this.localData=null;return}this.localData={id:this.stepData.id,sceneNumber:this.stepData.sceneNumber,type:this.stepData.type||"dialogue",character:{name:((o=this.stepData.character)==null?void 0:o.name)||"",color:((e=this.stepData.character)==null?void 0:e.color)||"#ffffff",avatarUrl:((n=this.stepData.character)==null?void 0:n.avatarUrl)||""},text:this.stepData.text||"",rawText:this.stepData.rawText||"",isSceneDescription:this.stepData.isSceneDescription||!1,sceneTitle:this.stepData.sceneTitle||"",scenePCs:this.stepData.scenePCs||"",sceneDescription:this.stepData.sceneDescription||"",illustrations:JSON.parse(JSON.stringify(this.stepData.illustrations||[])),diceRolls:this.initializeDiceRolls(this.stepData.diceRolls||[]),statusChanges:JSON.parse(JSON.stringify(this.stepData.statusChanges||[])),dxCombos:JSON.parse(JSON.stringify(this.stepData.dxCombos||[])),ougis:this.initializeOugis(this.stepData.ougis||[]),shinobigamis:JSON.parse(JSON.stringify(this.stepData.shinobigamis||[])),effects:JSON.parse(JSON.stringify(this.stepData.effects||{sfx:null,bgm:null,background:null,backgroundOpacity:.3}))}},initializeDiceRolls(o){return o.map(e=>{const n={...e};return e.type==="choice"&&e.options&&Array.isArray(e.options)&&(n.optionsText=e.options.join(", ")),n})},initializeOugis(o){return o.map(e=>{const n={...e};return e.skills&&Array.isArray(e.skills)&&(n.skills=e.skills.join(", ")),n})},addIllustration(){this.localData.illustrations||(this.localData.illustrations=[]),this.localData.illustrations.push({url:"",alt:"img"})},removeIllustration(o){this.localData.illustrations.splice(o,1)},handleImageError(o){o.target.style.display="none"},addDiceRoll(){this.localData.diceRolls||(this.localData.diceRolls=[]),this.localData.diceRolls.push({type:"normal",formula:"",result:0,fullFormula:"",diceRolls:"",command:"",checkName:"",judgement:"",options:[],optionsText:""})},removeDiceRoll(o){this.localData.diceRolls.splice(o,1)},addStatusChange(){this.localData.statusChanges||(this.localData.statusChanges=[]),this.localData.statusChanges.push({characterName:"",statusName:"",oldValue:null,newValue:null,delta:0})},toggleStatusMode(o,e){e.target.checked?(o.oldValue=0,o.newValue=0,o.delta=0):(o.oldValue=null,o.newValue=null)},computeDelta(o){return o.oldValue!==null&&o.newValue!==null?o.newValue-o.oldValue:o.delta||0},removeStatusChange(o){this.localData.statusChanges.splice(o,1)},addDXCombo(){this.localData.dxCombos||(this.localData.dxCombos=[]),this.localData.dxCombos.push({type:"dx-combo",isSingleEffect:!1,comboName:"",description:"",effects:[],timing:"",difficulty:"",target:"",range:"",erosion:"",erosionCost:null,diceRoll:null})},removeDXCombo(o){this.localData.dxCombos.splice(o,1)},addOugi(){this.localData.ougis||(this.localData.ougis=[]),this.localData.ougis.push({type:"ougi",ougiName:"",skills:"",presentation:"",ougiEffect:"",ninpouInfo:"",ougiType:""})},removeOugi(o){this.localData.ougis.splice(o,1)},addShinobigami(){this.localData.shinobigamis||(this.localData.shinobigamis=[]),this.localData.shinobigamis.push({type:"shinobigami",command:"",checkName:"",formula:"",diceRolls:"",diceExpression:"",result:0,judgement:"",additionalInfo:null})},removeShinobigami(o){this.localData.shinobigamis.splice(o,1)},addShinobiAdditionalInfo(o){o.additionalInfo={type:"",range:"",cost:"",skill:"",description:""}},deleteStep(){!this.stepData||!confirm(`Ïä§ÌÖù #${this.stepData.id}ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.`)||this.$emit("delete",this.stepData.id)},duplicateStep(){this.stepData&&this.$emit("duplicate",this.stepData.id)},saveChanges(){if(!this.localData)return;const o={...this.localData,hasDice:this.hasDice,hasStatusChange:this.hasStatusChange,hasDXCombo:this.hasDXCombo,hasIllustration:this.hasIllustration,hasOugi:this.hasOugi,hasShinobigami:this.hasShinobigami};o.ougis&&(o.ougis=o.ougis.map(e=>({...e,skills:typeof e.skills=="string"?e.skills.split(/[,„ÄÅ]/).map(n=>n.trim()).filter(n=>n):e.skills}))),this.$emit("save",{id:this.stepData.id,updates:o})}},watch:{stepData:{immediate:!0,handler(){this.initializeLocalData(),this.showRawJSON=!1}}}},ie={class:"step-info-editor"},ne={class:"editor-header"},re={class:"editor-body"},de={key:0,class:"no-selection"},ce={key:1,class:"info-form"},ue={class:"field-group"},pe=["value"],me={key:0,class:"field-group"},he={key:1,class:"field-group"},fe={key:2,class:"field-group"},ge={class:"color-picker-wrapper"},ve={key:3,class:"field-group"},be={key:4,class:"field-group"},ye={key:5,class:"field-group"},_e=["value"],ke={key:6,class:"field-group"},Ce={class:"type-selection"},De={class:"radio-label"},Se={class:"radio-label"},Ue={class:"radio-label"},we={class:"radio-label"},xe={key:7,class:"scene-desc-section"},Ve={class:"field-group"},Ie={class:"field-label"},je={class:"field-row"},Ee={key:8,class:"field-group section-header"},Te={class:"field-label"},ze={key:9,class:"items-list"},Ne={class:"item-content"},Oe=["onUpdate:modelValue"],Re=["src"],Ae=["onClick"],Ge={key:10,class:"field-group section-header"},Je={class:"field-label"},Le={key:11,class:"items-list"},Be={class:"item-content"},Pe={class:"field-row"},Fe=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],Xe={key:0,class:"field-row"},qe=["onUpdate:modelValue"],He={key:1,class:"dx3-fields"},Ye={class:"field-row"},Ke=["onUpdate:modelValue"],Qe={class:"field-row"},We=["onUpdate:modelValue"],Ze={class:"field-row"},$e=["onUpdate:modelValue"],et={key:2,class:"judgement-fields"},tt={class:"field-row"},st=["onUpdate:modelValue"],lt=["onUpdate:modelValue"],ot={class:"field-row"},at=["onUpdate:modelValue"],it=["onUpdate:modelValue"],nt={key:3,class:"choice-fields"},rt={class:"field-row"},dt=["onUpdate:modelValue"],ct={class:"field-row"},ut=["onUpdate:modelValue"],pt=["onClick"],mt={key:12,class:"field-group section-header"},ht={class:"field-label"},ft={key:13,class:"items-list"},gt={class:"item-content"},vt={class:"field-row"},bt=["onUpdate:modelValue"],yt=["onUpdate:modelValue"],_t={class:"field-row"},kt={class:"checkbox-label"},Ct=["checked","onChange"],Dt={key:0,class:"field-row"},St=["onUpdate:modelValue"],Ut=["onUpdate:modelValue"],wt={key:1,class:"field-row"},xt=["onUpdate:modelValue"],Vt=["onClick"],It={key:14,class:"field-group section-header"},jt={class:"field-label"},Et={key:15,class:"items-list"},Tt={class:"item-content"},zt=["onUpdate:modelValue"],Nt=["onUpdate:modelValue"],Ot=["onUpdate:modelValue"],Rt=["onUpdate:modelValue"],At=["onUpdate:modelValue"],Gt=["onUpdate:modelValue"],Jt=["onClick"],Lt={key:16,class:"field-group section-header"},Bt={class:"field-label"},Pt={key:17,class:"items-list"},Ft={class:"item-content"},Mt={class:"field-row"},Xt=["onUpdate:modelValue"],qt=["onUpdate:modelValue"],Ht={class:"field-row"},Yt=["onUpdate:modelValue"],Kt=["onUpdate:modelValue"],Qt={class:"field-row"},Wt=["onUpdate:modelValue"],Zt=["onUpdate:modelValue"],$t={key:0,class:"shinobi-additional-info"},es={class:"field-row"},ts=["onUpdate:modelValue"],ss=["onUpdate:modelValue"],ls=["onUpdate:modelValue"],os=["onUpdate:modelValue"],as=["onUpdate:modelValue"],is=["onClick"],ns=["onClick"],rs={key:18,class:"field-group section-header"},ds={class:"field-label"},cs={key:19,class:"items-list"},us={class:"item-content"},ps={class:"field-row"},ms=["onUpdate:modelValue"],hs={class:"checkbox-label"},fs=["onUpdate:modelValue"],gs=["onUpdate:modelValue"],vs={class:"field-row"},bs=["onUpdate:modelValue"],ys=["onUpdate:modelValue"],_s={class:"field-row"},ks=["onUpdate:modelValue"],Cs=["onUpdate:modelValue"],Ds=["onUpdate:modelValue"],Ss={class:"field-row"},Us=["onUpdate:modelValue"],ws=["onUpdate:modelValue"],xs=["onClick"],Vs={key:20,class:"field-group"},Is={class:"field-label"},js={key:21,class:"json-viewer"},Es={key:22,class:"actions"},Ts={class:"action-group left"};function zs(o,e,n,h,l,a){const r=U("EmojiToIcon");return d(),c("div",ie,[t("div",ne,[t("h3",null,[p(r,{emoji:"üìù",size:20}),e[25]||(e[25]=v(" Ïä§ÌÖù Ï†ïÎ≥¥ Ìé∏ÏßëÍ∏∞ ",-1))])]),t("div",re,[n.stepData?(d(),c("div",ce,[t("div",ue,[e[27]||(e[27]=t("label",{class:"field-label"},"Ïä§ÌÖù ID (ÏùΩÍ∏∞ Ï†ÑÏö©)",-1)),t("input",{type:"text",value:n.stepData.id,disabled:"",class:"field-input disabled"},null,8,pe)]),l.localData?(d(),c("div",me,[e[28]||(e[28]=t("label",{class:"field-label"},"Ïî¨ Î≤àÌò∏",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.localData.sceneNumber=s),type:"number",class:"field-input",placeholder:"Ïî¨ Î≤àÌò∏"},null,512),[[m,l.localData.sceneNumber,void 0,{number:!0}]])])):f("",!0),l.localData?(d(),c("div",he,[e[29]||(e[29]=t("label",{class:"field-label"},"Ï∫êÎ¶≠ÌÑ∞ Ïù¥Î¶Ñ",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.localData.character.name=s),type:"text",class:"field-input",placeholder:"Ï∫êÎ¶≠ÌÑ∞ Ïù¥Î¶Ñ"},null,512),[[m,l.localData.character.name]])])):f("",!0),l.localData?(d(),c("div",fe,[e[30]||(e[30]=t("label",{class:"field-label"},"Ï∫êÎ¶≠ÌÑ∞ ÏÉâÏÉÅ",-1)),t("div",ge,[u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.localData.character.color=s),type:"color",class:"color-picker"},null,512),[[m,l.localData.character.color]]),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.localData.character.color=s),type:"text",class:"color-input",placeholder:"#ffffff"},null,512),[[m,l.localData.character.color]])])])):f("",!0),l.localData?(d(),c("div",ve,[e[31]||(e[31]=t("label",{class:"field-label"},"ÏïÑÎ∞îÌÉÄ URL",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.localData.character.avatarUrl=s),type:"text",class:"field-input",placeholder:"https://example.com/avatar.png"},null,512),[[m,l.localData.character.avatarUrl]])])):f("",!0),l.localData?(d(),c("div",be,[e[32]||(e[32]=t("label",{class:"field-label"},"ÎåÄÏÇ¨ ÌÖçÏä§Ìä∏",-1)),u(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.localData.text=s),class:"field-textarea",rows:"4",placeholder:"Ï∫êÎ¶≠ÌÑ∞Ïùò ÎåÄÏÇ¨Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"},null,512),[[m,l.localData.text]])])):f("",!0),n.stepData?(d(),c("div",ye,[e[33]||(e[33]=t("label",{class:"field-label"},"ÏõêÎ≥∏ ÌÖçÏä§Ìä∏ (ÏùΩÍ∏∞ Ï†ÑÏö©)",-1)),t("textarea",{value:n.stepData.rawText,disabled:"",class:"field-textarea disabled",rows:"3"},null,8,_e)])):f("",!0),l.localData?(d(),c("div",ke,[e[38]||(e[38]=t("label",{class:"field-label"},"Ïä§ÌÖù ÌÉÄÏûÖ (ÌïòÎÇòÎßå ÏÑ†ÌÉù Í∞ÄÎä•)",-1)),t("div",Ce,[t("label",De,[u(t("input",{type:"radio",value:"dialogue","onUpdate:modelValue":e[6]||(e[6]=s=>l.localData.type=s)},null,512),[[I,l.localData.type]]),e[34]||(e[34]=t("span",null,"ÏùºÎ∞ò ÎåÄÌôî",-1))]),t("label",Se,[u(t("input",{type:"radio",value:"system","onUpdate:modelValue":e[7]||(e[7]=s=>l.localData.type=s)},null,512),[[I,l.localData.type]]),e[35]||(e[35]=t("span",null,"ÏãúÏä§ÌÖú Î©îÏãúÏßÄ",-1))]),t("label",Ue,[u(t("input",{type:"radio",value:"narrator","onUpdate:modelValue":e[8]||(e[8]=s=>l.localData.type=s)},null,512),[[I,l.localData.type]]),e[36]||(e[36]=t("span",null,"ÎÇòÎ†àÏù¥ÌÑ∞",-1))]),t("label",we,[u(t("input",{type:"radio",value:"scene-description","onUpdate:modelValue":e[9]||(e[9]=s=>l.localData.type=s)},null,512),[[I,l.localData.type]]),e[37]||(e[37]=t("span",null,"Ïî¨ ÏÑ§Î™Ö",-1))])])])):f("",!0),l.localData&&l.localData.type==="scene-description"?(d(),c("div",xe,[t("div",Ve,[t("label",Ie,[p(r,{emoji:"üé¨",size:14}),e[39]||(e[39]=v(" Ïî¨ Ï†ïÎ≥¥ ",-1))])]),t("div",je,[u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.localData.sceneNumber=s),type:"text",class:"field-input small",placeholder:"Ïî¨ Î≤àÌò∏"},null,512),[[m,l.localData.sceneNumber]]),u(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.localData.sceneTitle=s),type:"text",class:"field-input",placeholder:"Ïî¨ Ï†úÎ™©"},null,512),[[m,l.localData.sceneTitle]])]),u(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>l.localData.scenePCs=s),type:"text",class:"field-input",placeholder:"Ï∞∏Í∞Ä PC (Ïòà: ÌôçÍ∏∏Îèô, ÍπÄÏ≤†Ïàò)"},null,512),[[m,l.localData.scenePCs]]),u(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.localData.sceneDescription=s),class:"field-textarea",rows:"3",placeholder:"Ïî¨ ÏÉÅÏÑ∏ ÏÑ§Î™Ö"},null,512),[[m,l.localData.sceneDescription]])])):f("",!0),l.localData?(d(),c("div",Ee,[t("label",Te,[p(r,{emoji:"üñºÔ∏è",size:14}),v(" ÏùºÎü¨Ïä§Ìä∏ ("+g(l.localData.illustrations.length)+"Í∞ú) ",1)]),t("button",{onClick:e[14]||(e[14]=(...s)=>a.addIllustration&&a.addIllustration(...s)),class:"add-button"},[p(r,{emoji:"‚ûï",size:12}),e[40]||(e[40]=v(" Ï∂îÍ∞Ä ",-1))])])):f("",!0),l.localData.illustrations.length>0?(d(),c("div",ze,[(d(!0),c(k,null,D(l.localData.illustrations,(s,b)=>(d(),c("div",{key:b,class:"item-card"},[t("div",Ne,[u(t("input",{"onUpdate:modelValue":i=>s.url=i,type:"text",class:"field-input",placeholder:"Ïù¥ÎØ∏ÏßÄ URL"},null,8,Oe),[[m,s.url]]),s.url?(d(),c("img",{key:0,src:s.url,class:"preview-img",onError:e[15]||(e[15]=(...i)=>a.handleImageError&&a.handleImageError(...i))},null,40,Re)):f("",!0)]),t("button",{onClick:i=>a.removeIllustration(b),class:"remove-button"},[p(r,{emoji:"üóëÔ∏è",size:14})],8,Ae)]))),128))])):f("",!0),l.localData?(d(),c("div",Ge,[t("label",Je,[p(r,{emoji:"üé≤",size:14}),v(" Îã§Ïù¥Ïä§ Î°§ ("+g(l.localData.diceRolls.length)+"Í∞ú) ",1)]),t("button",{onClick:e[16]||(e[16]=(...s)=>a.addDiceRoll&&a.addDiceRoll(...s)),class:"add-button"},[p(r,{emoji:"‚ûï",size:12}),e[41]||(e[41]=v(" Ï∂îÍ∞Ä ",-1))])])):f("",!0),l.localData.diceRolls.length>0?(d(),c("div",Le,[(d(!0),c(k,null,D(l.localData.diceRolls,(s,b)=>(d(),c("div",{key:b,class:"item-card dice-card"},[t("div",Be,[t("div",Pe,[u(t("select",{"onUpdate:modelValue":i=>s.type=i,class:"field-input small"},[...e[42]||(e[42]=[t("option",{value:"normal"},"ÏùºÎ∞ò",-1),t("option",{value:"dx3"},"DX3",-1),t("option",{value:"judgement"},"ÌåêÏ†ï",-1),t("option",{value:"choice"},"ÏÑ†ÌÉù",-1)])],8,Fe),[[E,s.type]]),u(t("input",{"onUpdate:modelValue":i=>s.formula=i,type:"text",class:"field-input",placeholder:"Í≥µÏãù (Ïòà: 1D100, 8dx+16)"},null,8,Me),[[m,s.formula]])]),s.type==="normal"?(d(),c("div",Xe,[e[43]||(e[43]=t("span",{class:"field-label-inline"},"Í≤∞Í≥º:",-1)),u(t("input",{"onUpdate:modelValue":i=>s.result=i,type:"number",class:"field-input small",placeholder:"Í≤∞Í≥º"},null,8,qe),[[m,s.result,void 0,{number:!0}]])])):f("",!0),s.type==="dx3"?(d(),c("div",He,[t("div",Ye,[u(t("input",{"onUpdate:modelValue":i=>s.fullFormula=i,type:"text",class:"field-input",placeholder:"Ï†ÑÏ≤¥ Í≥µÏãù (Ïòà: 8DX10+16)"},null,8,Ke),[[m,s.fullFormula]])]),t("div",Qe,[u(t("input",{"onUpdate:modelValue":i=>s.diceRolls=i,type:"text",class:"field-input",placeholder:"Îã§Ïù¥Ïä§ Î°§ (Ïòà: 10[5,6,7,8,9,10]+5[5]+16)"},null,8,We),[[m,s.diceRolls]])]),t("div",Ze,[e[44]||(e[44]=t("span",{class:"field-label-inline"},"ÏµúÏ¢Ö Í≤∞Í≥º:",-1)),u(t("input",{"onUpdate:modelValue":i=>s.result=i,type:"number",class:"field-input small",placeholder:"Í≤∞Í≥º"},null,8,$e),[[m,s.result,void 0,{number:!0}]])])])):f("",!0),s.type==="judgement"?(d(),c("div",et,[t("div",tt,[u(t("input",{"onUpdate:modelValue":i=>s.command=i,type:"text",class:"field-input small",placeholder:"Ïª§Îß®Îìú (cc<=70)"},null,8,st),[[m,s.command]]),u(t("input",{"onUpdate:modelValue":i=>s.checkName=i,type:"text",class:"field-input",placeholder:"ÌåêÏ†ïÎ™Ö"},null,8,lt),[[m,s.checkName]])]),t("div",ot,[u(t("input",{"onUpdate:modelValue":i=>s.result=i,type:"number",class:"field-input small",placeholder:"Í≤∞Í≥º"},null,8,at),[[m,s.result,void 0,{number:!0}]]),u(t("input",{"onUpdate:modelValue":i=>s.judgement=i,type:"text",class:"field-input",placeholder:"ÌåêÏ†ï (Î≥¥ÌÜµ ÏÑ±Í≥µ, Ïã§Ìå® Îì±)"},null,8,it),[[m,s.judgement]])])])):f("",!0),s.type==="choice"?(d(),c("div",nt,[t("div",rt,[u(t("textarea",{"onUpdate:modelValue":i=>s.optionsText=i,class:"field-textarea small",rows:"2",placeholder:"ÏÑ†ÌÉùÏßÄ (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)"},null,8,dt),[[m,s.optionsText]])]),t("div",ct,[e[45]||(e[45]=t("span",{class:"field-label-inline"},"ÏÑ†ÌÉùÎê®:",-1)),u(t("input",{"onUpdate:modelValue":i=>s.result=i,type:"text",class:"field-input",placeholder:"ÏÑ†ÌÉùÎêú ÏòµÏÖò"},null,8,ut),[[m,s.result]])])])):f("",!0)]),t("button",{onClick:i=>a.removeDiceRoll(b),class:"remove-button"},[p(r,{emoji:"üóëÔ∏è",size:14})],8,pt)]))),128))])):f("",!0),l.localData?(d(),c("div",mt,[t("label",ht,[p(r,{emoji:"üìä",size:14}),v(" Ïä§ÌÖåÏù¥ÌÑ∞Ïä§ Î≥ÄÌôî ("+g(l.localData.statusChanges.length)+"Í∞ú) ",1)]),t("button",{onClick:e[17]||(e[17]=(...s)=>a.addStatusChange&&a.addStatusChange(...s)),class:"add-button"},[p(r,{emoji:"‚ûï",size:12}),e[46]||(e[46]=v(" Ï∂îÍ∞Ä ",-1))])])):f("",!0),l.localData.statusChanges.length>0?(d(),c("div",ft,[(d(!0),c(k,null,D(l.localData.statusChanges,(s,b)=>(d(),c("div",{key:b,class:"item-card"},[t("div",gt,[t("div",vt,[u(t("input",{"onUpdate:modelValue":i=>s.characterName=i,type:"text",class:"field-input",placeholder:"Ï∫êÎ¶≠ÌÑ∞Î™Ö"},null,8,bt),[[m,s.characterName]]),u(t("input",{"onUpdate:modelValue":i=>s.statusName=i,type:"text",class:"field-input",placeholder:"ÏÉÅÌÉúÎ™Ö (HP, Ïπ®ÏãùÎ•† Îì±)"},null,8,yt),[[m,s.statusName]])]),t("div",_t,[t("label",kt,[t("input",{type:"checkbox",checked:s.oldValue!==null&&s.newValue!==null,onChange:i=>a.toggleStatusMode(s,i)},null,40,Ct),e[47]||(e[47]=t("span",null,"Ïù¥Ï†ÑÍ∞í/ÏÉàÍ∞í Î™®Îìú",-1))])]),s.oldValue!==null&&s.newValue!==null?(d(),c("div",Dt,[u(t("input",{"onUpdate:modelValue":i=>s.oldValue=i,type:"number",class:"field-input small",placeholder:"Ïù¥Ï†ÑÍ∞í"},null,8,St),[[m,s.oldValue,void 0,{number:!0}]]),e[48]||(e[48]=t("span",{class:"arrow"},"‚Üí",-1)),u(t("input",{"onUpdate:modelValue":i=>s.newValue=i,type:"number",class:"field-input small",placeholder:"ÏÉàÍ∞í"},null,8,Ut),[[m,s.newValue,void 0,{number:!0}]]),t("span",{class:S(["delta",{positive:a.computeDelta(s)>0,negative:a.computeDelta(s)<0}])},g(a.computeDelta(s)>0?"+":"")+g(a.computeDelta(s)),3)])):(d(),c("div",wt,[e[49]||(e[49]=t("span",{class:"field-label-inline"},"Î≥ÄÌôîÎüâ:",-1)),u(t("input",{"onUpdate:modelValue":i=>s.delta=i,type:"number",class:"field-input small",placeholder:"¬±Î≥ÄÌôîÎüâ"},null,8,xt),[[m,s.delta,void 0,{number:!0}]]),t("span",{class:S(["delta",{positive:s.delta>0,negative:s.delta<0}])},g(s.delta>0?"+":"")+g(s.delta),3)]))]),t("button",{onClick:i=>a.removeStatusChange(b),class:"remove-button"},[p(r,{emoji:"üóëÔ∏è",size:14})],8,Vt)]))),128))])):f("",!0),l.localData?(d(),c("div",It,[t("label",jt,[p(r,{emoji:"üåü",size:14}),v(" ÏãúÎÖ∏ÎπÑÍ∞ÄÎØ∏ Ïò§Ïùò ("+g((l.localData.ougis||[]).length)+"Í∞ú) ",1)]),t("button",{onClick:e[18]||(e[18]=(...s)=>a.addOugi&&a.addOugi(...s)),class:"add-button"},[p(r,{emoji:"‚ûï",size:12}),e[50]||(e[50]=v(" Ï∂îÍ∞Ä ",-1))])])):f("",!0),(l.localData.ougis||[]).length>0?(d(),c("div",Et,[(d(!0),c(k,null,D(l.localData.ougis,(s,b)=>(d(),c("div",{key:b,class:"item-card ougi-card"},[t("div",Tt,[u(t("input",{"onUpdate:modelValue":i=>s.ougiName=i,type:"text",class:"field-input",placeholder:"Ïò§ÏùòÎ™Ö (Ïòà: Ï†ÑÏüÅÏùò ÏßïÏ°∞)"},null,8,zt),[[m,s.ougiName]]),u(t("input",{"onUpdate:modelValue":i=>s.skills=i,type:"text",class:"field-input",placeholder:"ÏßÄÏ†ï ÌäπÍ∏∞ (ÏâºÌëú Íµ¨Î∂Ñ, Ïòà: ÎèÑÍ≤ÄÏà†, Ïù∏Îß•)"},null,8,Nt),[[m,s.skills]]),u(t("textarea",{"onUpdate:modelValue":i=>s.presentation=i,class:"field-textarea small",rows:"2",placeholder:"Ïó∞Ï∂ú (Ïò§Ïùò ÏÇ¨Ïö© Ïãú Î¨òÏÇ¨)"},null,8,Ot),[[m,s.presentation]]),u(t("textarea",{"onUpdate:modelValue":i=>s.ougiEffect=i,class:"field-textarea small",rows:"2",placeholder:"Ïò§Ïùò Ìö®Í≥º (Ï†ÑÌà¨ÏóêÏÑúÏùò Ìö®Í≥º Îì±, ÏÑ†ÌÉùÏÇ¨Ìï≠)"},null,8,Rt),[[m,s.ougiEffect]]),u(t("input",{"onUpdate:modelValue":i=>s.ninpouInfo=i,type:"text",class:"field-input",placeholder:"Ïù∏Î≤ï Ï†ïÎ≥¥ (Ïòà: Îß∫Ïùå/ÌÅ¨ÎÇòÌÅ∞ Î∂ÑÎÖ∏)"},null,8,At),[[m,s.ninpouInfo]]),u(t("input",{"onUpdate:modelValue":i=>s.ougiType=i,type:"text",class:"field-input",placeholder:"Ïò§Ïùò Ï¢ÖÎ•ò (Ïòà: Ï†ÑÏüÅÏùò Ïã†, Ï†àÎåÄ Î∞©Ïñ¥)"},null,8,Gt),[[m,s.ougiType]])]),t("button",{onClick:i=>a.removeOugi(b),class:"remove-button"},[p(r,{emoji:"üóëÔ∏è",size:14})],8,Jt)]))),128))])):f("",!0),l.localData?(d(),c("div",Lt,[t("label",Bt,[p(r,{emoji:"‚öîÔ∏è",size:14}),v(" ÏãúÎÖ∏ÎπÑÍ∞ÄÎØ∏ Ïù∏Î≤ï ("+g((l.localData.shinobigamis||[]).length)+"Í∞ú) ",1)]),t("button",{onClick:e[19]||(e[19]=(...s)=>a.addShinobigami&&a.addShinobigami(...s)),class:"add-button"},[p(r,{emoji:"‚ûï",size:12}),e[51]||(e[51]=v(" Ï∂îÍ∞Ä ",-1))])])):f("",!0),(l.localData.shinobigamis||[]).length>0?(d(),c("div",Pt,[(d(!0),c(k,null,D(l.localData.shinobigamis,(s,b)=>(d(),c("div",{key:b,class:"item-card shinobi-card"},[t("div",Ft,[t("div",Mt,[u(t("input",{"onUpdate:modelValue":i=>s.command=i,type:"text",class:"field-input small",placeholder:"Î™ÖÎ†πÏñ¥ (Ïòà: SG@12#2>=5)"},null,8,Xt),[[m,s.command]]),u(t("input",{"onUpdate:modelValue":i=>s.checkName=i,type:"text",class:"field-input",placeholder:"ÌåêÏ†ïÎ™Ö (Ïòà: ÎèÑÍ≤ÄÏà†, Í¥¥Î†•)"},null,8,qt),[[m,s.checkName]])]),t("div",Ht,[u(t("input",{"onUpdate:modelValue":i=>s.diceRolls=i,type:"text",class:"field-input small",placeholder:"Ï£ºÏÇ¨ÏúÑ (Ïòà: 1,2)"},null,8,Yt),[[m,s.diceRolls]]),u(t("input",{"onUpdate:modelValue":i=>s.diceExpression=i,type:"text",class:"field-input",placeholder:"Îã§Ïù¥Ïä§ ÌëúÌòÑ (Ïòà: 3[1,2])"},null,8,Kt),[[m,s.diceExpression]])]),t("div",Qt,[u(t("input",{"onUpdate:modelValue":i=>s.result=i,type:"number",class:"field-input small",placeholder:"Í≤∞Í≥º"},null,8,Wt),[[m,s.result,void 0,{number:!0}]]),u(t("input",{"onUpdate:modelValue":i=>s.judgement=i,type:"text",class:"field-input small",placeholder:"ÌåêÏ†ï (ÊàêÂäü/Â§±Êïó)"},null,8,Zt),[[m,s.judgement]])]),s.additionalInfo?(d(),c("div",$t,[t("div",es,[u(t("input",{"onUpdate:modelValue":i=>s.additionalInfo.type=i,type:"text",class:"field-input small",placeholder:"ÌÉÄÏûÖ"},null,8,ts),[[m,s.additionalInfo.type]]),u(t("input",{"onUpdate:modelValue":i=>s.additionalInfo.range=i,type:"text",class:"field-input small",placeholder:"ÏÇ¨Í±∞Î¶¨"},null,8,ss),[[m,s.additionalInfo.range]]),u(t("input",{"onUpdate:modelValue":i=>s.additionalInfo.cost=i,type:"text",class:"field-input small",placeholder:"ÏΩîÏä§Ìä∏"},null,8,ls),[[m,s.additionalInfo.cost]])]),u(t("input",{"onUpdate:modelValue":i=>s.additionalInfo.skill=i,type:"text",class:"field-input",placeholder:"ÌäπÍ∏∞"},null,8,os),[[m,s.additionalInfo.skill]]),u(t("textarea",{"onUpdate:modelValue":i=>s.additionalInfo.description=i,class:"field-textarea small",rows:"2",placeholder:"ÏÑ§Î™Ö"},null,8,as),[[m,s.additionalInfo.description]])])):(d(),c("button",{key:1,onClick:i=>a.addShinobiAdditionalInfo(s),class:"add-info-button"},[p(r,{emoji:"‚ûï",size:10}),e[52]||(e[52]=v(" Ï∂îÍ∞Ä Ï†ïÎ≥¥ ÏûÖÎ†• ",-1))],8,is))]),t("button",{onClick:i=>a.removeShinobigami(b),class:"remove-button"},[p(r,{emoji:"üóëÔ∏è",size:14})],8,ns)]))),128))])):f("",!0),l.localData?(d(),c("div",rs,[t("label",ds,[p(r,{emoji:"‚öîÔ∏è",size:14}),v(" DX ÏΩ§Î≥¥/Ïù¥ÌéôÌä∏ ("+g(l.localData.dxCombos.length)+"Í∞ú) ",1)]),t("button",{onClick:e[20]||(e[20]=(...s)=>a.addDXCombo&&a.addDXCombo(...s)),class:"add-button"},[p(r,{emoji:"‚ûï",size:12}),e[53]||(e[53]=v(" Ï∂îÍ∞Ä ",-1))])])):f("",!0),l.localData.dxCombos.length>0?(d(),c("div",cs,[(d(!0),c(k,null,D(l.localData.dxCombos,(s,b)=>(d(),c("div",{key:b,class:"item-card combo-card"},[t("div",us,[t("div",ps,[u(t("select",{"onUpdate:modelValue":i=>s.type=i,class:"field-input small"},[...e[54]||(e[54]=[t("option",{value:"dx-combo"},"ÏΩ§Î≥¥",-1),t("option",{value:"dx-effect"},"Îã®Ïùº Ïù¥ÌéôÌä∏",-1)])],8,ms),[[E,s.type]]),t("label",hs,[u(t("input",{type:"checkbox","onUpdate:modelValue":i=>s.isSingleEffect=i},null,8,fs),[[z,s.isSingleEffect]]),e[55]||(e[55]=t("span",null,"Îã®Ïùº Ïù¥ÌéôÌä∏",-1))])]),u(t("input",{"onUpdate:modelValue":i=>s.comboName=i,type:"text",class:"field-input",placeholder:"ÏΩ§Î≥¥/Ïù¥ÌéôÌä∏Î™Ö"},null,8,gs),[[m,s.comboName]]),t("div",vs,[u(t("input",{"onUpdate:modelValue":i=>s.timing=i,type:"text",class:"field-input",placeholder:"ÌÉÄÏù¥Î∞ç (Î©îÏù¥Ï†Ä, ÎßàÏù¥ÎÑà Îì±)"},null,8,bs),[[m,s.timing]]),u(t("input",{"onUpdate:modelValue":i=>s.difficulty=i,type:"text",class:"field-input",placeholder:"ÎÇúÏù¥ÎèÑ (ÏûêÎèô, ÎåÄÌï≠ Îì±)"},null,8,ys),[[m,s.difficulty]])]),t("div",_s,[u(t("input",{"onUpdate:modelValue":i=>s.target=i,type:"text",class:"field-input",placeholder:"ÎåÄÏÉÅ"},null,8,ks),[[m,s.target]]),u(t("input",{"onUpdate:modelValue":i=>s.range=i,type:"text",class:"field-input",placeholder:"ÏÇ¨Í±∞Î¶¨"},null,8,Cs),[[m,s.range]])]),u(t("textarea",{"onUpdate:modelValue":i=>s.description=i,class:"field-textarea small",rows:"2",placeholder:"ÏÑ§Î™Ö/Í∏∞Îä•"},null,8,Ds),[[m,s.description]]),t("div",Ss,[u(t("input",{"onUpdate:modelValue":i=>s.erosion=i,type:"text",class:"field-input small",placeholder:"Ïπ®ÏãùÏπò"},null,8,Us),[[m,s.erosion]]),u(t("input",{"onUpdate:modelValue":i=>s.erosionCost=i,type:"number",class:"field-input small",placeholder:"Ïπ®Ïãù ÏΩîÏä§Ìä∏"},null,8,ws),[[m,s.erosionCost,void 0,{number:!0}]])])]),t("button",{onClick:i=>a.removeDXCombo(b),class:"remove-button"},[p(r,{emoji:"üóëÔ∏è",size:14})],8,xs)]))),128))])):f("",!0),n.stepData?(d(),c("div",Vs,[t("label",Is,[p(r,{emoji:"üîç",size:14}),e[56]||(e[56]=v(" JSON ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ ",-1))]),t("button",{onClick:e[21]||(e[21]=s=>l.showRawJSON=!l.showRawJSON),class:"toggle-json-button"},g(l.showRawJSON?"Ïà®Í∏∞Í∏∞":"Î≥¥Í∏∞"),1)])):f("",!0),l.showRawJSON?(d(),c("div",js,[t("pre",null,g(JSON.stringify(n.stepData,null,2)),1)])):f("",!0),l.localData?(d(),c("div",Es,[t("div",Ts,[t("button",{onClick:e[22]||(e[22]=(...s)=>a.deleteStep&&a.deleteStep(...s)),class:"delete-button"},[p(r,{emoji:"üóëÔ∏è",size:16}),e[57]||(e[57]=v(" Ïä§ÌÖù ÏÇ≠Ï†ú ",-1))]),t("button",{onClick:e[23]||(e[23]=(...s)=>a.duplicateStep&&a.duplicateStep(...s)),class:"duplicate-button"},[p(r,{emoji:"üìã",size:16}),e[58]||(e[58]=v(" Ïä§ÌÖù Î≥µÏÇ¨ ",-1))])]),t("button",{onClick:e[24]||(e[24]=(...s)=>a.saveChanges&&a.saveChanges(...s)),class:"save-button"},[p(r,{emoji:"üíæ",size:16}),e[59]||(e[59]=v(" Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Ï†ÄÏû• ",-1))])])):f("",!0)])):(d(),c("div",de,[p(r,{emoji:"üëÜ",size:48}),e[26]||(e[26]=t("p",null,"ÏôºÏ™ΩÏóêÏÑú Ïä§ÌÖùÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî",-1))]))])])}const Ns=V(ae,[["render",zs],["__scopeId","data-v-7c1bb5be"]]),Os={name:"CharacterBulkEditor",props:{allSteps:{type:Array,required:!0}},data(){return{selectedCharacter:null,newCharacterName:"",newCharacterColor:"",isApplying:!1,progressCurrent:0,progressTotal:0}},computed:{characterGroups(){const o={};return this.allSteps.forEach(e=>{var l,a;const n=((l=e.character)==null?void 0:l.name)||"",h=((a=e.character)==null?void 0:a.color)||"#ffffff";o[n]||(o[n]={name:n,color:h,count:0}),o[n].count++}),Object.values(o).sort((e,n)=>n.count-e.count)},selectedGroup(){return this.selectedCharacter?this.characterGroups.find(o=>o.name===this.selectedCharacter):null},hasChanges(){if(!this.selectedCharacter)return!1;const o=this.newCharacterName&&this.newCharacterName!==this.selectedCharacter,e=this.newCharacterColor&&this.newCharacterColor!==this.selectedGroup.color;return o||e},progressPercentage(){return this.progressTotal===0?0:Math.round(this.progressCurrent/this.progressTotal*100)}},methods:{selectCharacter(o){this.selectedCharacter=o,this.newCharacterName=o,this.newCharacterColor=this.selectedGroup.color},resetForm(){this.selectedGroup&&(this.newCharacterName=this.selectedCharacter,this.newCharacterColor=this.selectedGroup.color)},async applyChanges(){if(!this.hasChanges||this.isApplying)return;const o=this.selectedCharacter,e=this.newCharacterName||o,n=this.newCharacterColor;this.isApplying=!0,this.progressCurrent=0,this.progressTotal=this.selectedGroup.count;try{this.$emit("bulk-update",{oldName:o,newName:e,newColor:n,onProgress:(h,l)=>{this.progressCurrent=h,this.progressTotal=l},onComplete:async h=>{await new Promise(l=>setTimeout(l,300)),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(l=>setTimeout(l,150)),alert(h.message),this.selectedCharacter=null,this.newCharacterName="",this.newCharacterColor=""}})}catch(h){console.error("ÏùºÍ¥Ñ Î≥ÄÍ≤Ω Ïã§Ìå®:",h),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(l=>setTimeout(l,150)),alert("Ï∫êÎ¶≠ÌÑ∞ ÏùºÍ¥Ñ Î≥ÄÍ≤Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.")}}}},Rs={class:"character-bulk-editor"},As={key:0,class:"loading-overlay"},Gs={class:"loading-content"},Js={class:"progress-section"},Ls={class:"progress-bar"},Bs={class:"progress-text"},Ps={class:"editor-header"},Fs={class:"editor-body"},Ms={class:"info-message"},Xs={class:"character-list"},qs={class:"list-header"},Hs={class:"list-body"},Ys=["onClick"],Ks={class:"character-info"},Qs={class:"character-name"},Ws={class:"character-count"},Zs={key:0,class:"edit-form"},$s={class:"form-header"},el={class:"affected-count"},tl={class:"field-group"},sl=["placeholder"],ll={class:"field-group"},ol={class:"color-picker-wrapper"},al=["placeholder"],il={class:"preview-section"},nl={class:"preview-comparison"},rl={class:"preview-item before"},dl={class:"preview-box"},cl={class:"preview-arrow"},ul={class:"preview-item after"},pl={class:"preview-box"},ml={class:"actions"},hl=["disabled"],fl=["disabled"],gl={key:1,class:"no-selection"};function vl(o,e,n,h,l,a){const r=U("EmojiToIcon");return d(),c("div",Rs,[l.isApplying?(d(),c("div",As,[t("div",Gs,[e[5]||(e[5]=t("div",{class:"spinner"},null,-1)),e[6]||(e[6]=t("p",{class:"loading-text"},"Ï∫êÎ¶≠ÌÑ∞ Ï†ïÎ≥¥Î•º ÏùºÍ¥Ñ Î≥ÄÍ≤ΩÌïòÎäî Ï§ë...",-1)),t("div",Js,[t("div",Ls,[t("div",{class:"progress-fill",style:w({width:a.progressPercentage+"%"})},null,4)]),t("p",Bs,g(l.progressCurrent)+" / "+g(l.progressTotal)+" Ïä§ÌÖù ("+g(a.progressPercentage)+"%)",1)]),e[7]||(e[7]=t("p",{class:"loading-subtext"},"Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî",-1))])])):f("",!0),t("div",Ps,[t("h3",null,[p(r,{emoji:"üë•",size:20}),e[8]||(e[8]=v(" Ï∫êÎ¶≠ÌÑ∞ ÏùºÍ¥Ñ Ìé∏Ïßë ",-1))])]),t("div",Fs,[t("div",Ms,[p(r,{emoji:"üí°",size:18}),e[9]||(e[9]=t("p",null,"Í∞ôÏùÄ Ïù¥Î¶ÑÏùò Ï∫êÎ¶≠ÌÑ∞Î•º Î™®Îëê ÏÑ†ÌÉùÌïòÏó¨ Ïù¥Î¶ÑÍ≥º ÏÉâÏÉÅÏùÑ ÏùºÍ¥Ñ Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§.",-1))]),t("div",Xs,[t("div",qs,[t("h4",null,"Ï∫êÎ¶≠ÌÑ∞ Î™©Î°ù ("+g(a.characterGroups.length)+"Î™Ö)",1)]),t("div",Hs,[(d(!0),c(k,null,D(a.characterGroups,s=>(d(),c("div",{key:s.name,class:S(["character-item",{selected:l.selectedCharacter===s.name}]),onClick:b=>a.selectCharacter(s.name)},[t("div",{class:"character-color-preview",style:w({backgroundColor:s.color})},null,4),t("div",Ks,[t("div",Qs,g(s.name||"(Ïù¥Î¶Ñ ÏóÜÏùå)"),1),t("div",Ws,g(s.count)+"Í∞ú Ïä§ÌÖù",1)])],10,Ys))),128))])]),l.selectedCharacter?(d(),c("div",Zs,[t("div",$s,[t("h4",null,[p(r,{emoji:"‚úèÔ∏è",size:16}),v(' "'+g(l.selectedCharacter)+'" Ìé∏Ïßë ',1)]),t("span",el,g(a.selectedGroup.count)+"Í∞ú Ïä§ÌÖùÏóê Ï†ÅÏö©Îê©ÎãàÎã§",1)]),t("div",tl,[e[10]||(e[10]=t("label",{class:"field-label"},"ÏÉà Ï∫êÎ¶≠ÌÑ∞ Ïù¥Î¶Ñ",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.newCharacterName=s),type:"text",class:"field-input",placeholder:l.selectedCharacter},null,8,sl),[[m,l.newCharacterName]])]),t("div",ll,[e[11]||(e[11]=t("label",{class:"field-label"},"ÏÉà Ï∫êÎ¶≠ÌÑ∞ ÏÉâÏÉÅ",-1)),t("div",ol,[u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.newCharacterColor=s),type:"color",class:"color-picker"},null,512),[[m,l.newCharacterColor]]),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.newCharacterColor=s),type:"text",class:"color-input",placeholder:a.selectedGroup.color},null,8,al),[[m,l.newCharacterColor]])])]),t("div",il,[e[14]||(e[14]=t("h5",null,"Î≥ÄÍ≤Ω Ï†Ñ/ÌõÑ ÎØ∏Î¶¨Î≥¥Í∏∞",-1)),t("div",nl,[t("div",rl,[e[12]||(e[12]=t("span",{class:"preview-label"},"Î≥ÄÍ≤Ω Ï†Ñ",-1)),t("div",dl,[t("div",{class:"preview-avatar",style:w({backgroundColor:a.selectedGroup.color})},g(l.selectedCharacter.charAt(0)),5),t("span",{class:"preview-name",style:w({color:a.selectedGroup.color})},g(l.selectedCharacter),5)])]),t("div",cl,[p(r,{emoji:"‚û°Ô∏è",size:24})]),t("div",ul,[e[13]||(e[13]=t("span",{class:"preview-label"},"Î≥ÄÍ≤Ω ÌõÑ",-1)),t("div",pl,[t("div",{class:"preview-avatar",style:w({backgroundColor:l.newCharacterColor})},g((l.newCharacterName||l.selectedCharacter).charAt(0)),5),t("span",{class:"preview-name",style:w({color:l.newCharacterColor})},g(l.newCharacterName||l.selectedCharacter),5)])])])]),t("div",ml,[t("button",{onClick:e[3]||(e[3]=(...s)=>a.resetForm&&a.resetForm(...s)),class:"reset-button",disabled:l.isApplying},[p(r,{emoji:"üîÑ",size:16}),e[15]||(e[15]=v(" Ï¥àÍ∏∞Ìôî ",-1))],8,hl),t("button",{onClick:e[4]||(e[4]=(...s)=>a.applyChanges&&a.applyChanges(...s)),class:"apply-button",disabled:!a.hasChanges||l.isApplying},[l.isApplying?(d(),c(k,{key:0},[e[16]||(e[16]=t("div",{class:"button-spinner"},null,-1)),e[17]||(e[17]=v(" Ï≤òÎ¶¨ Ï§ë... ",-1))],64)):(d(),c(k,{key:1},[p(r,{emoji:"‚úÖ",size:16}),e[18]||(e[18]=v(" ÏùºÍ¥Ñ Ï†ÅÏö© ",-1))],64))],8,fl)])])):(d(),c("div",gl,[p(r,{emoji:"üëÜ",size:48}),e[19]||(e[19]=t("p",null,"ÏôºÏ™ΩÏóêÏÑú Ï∫êÎ¶≠ÌÑ∞Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî",-1))]))])])}const bl=V(Os,[["render",vl],["__scopeId","data-v-73d9619b"]]),yl={name:"ImageBulkEditor",props:{vnData:{type:Object,required:!0}},data(){return{selectedImageUrl:null,newImageUrl:"",isApplying:!1,progressCurrent:0,progressTotal:0,activeFilter:"all",imageTypes:[{value:"all",label:"Ï†ÑÏ≤¥",emoji:"üåê"},{value:"avatar",label:"ÏïÑÎ∞îÌÉÄ",emoji:"üë§"},{value:"background",label:"Î∞∞Í≤Ω",emoji:"üé®"},{value:"handout",label:"Ìï∏ÎìúÏïÑÏõÉ",emoji:"üìÑ"},{value:"illustration",label:"ÏùºÎü¨Ïä§Ìä∏",emoji:"üñºÔ∏è"}]}},computed:{imageGroups(){const o={};return this.vnData.characters&&Object.values(this.vnData.characters).forEach(e=>{const n=e.avatarUrl;n&&(o[n]||(o[n]={url:n,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[n].count++,o[n].types.add("avatar"),o[n].locations.avatar.push(e.name))}),this.vnData.scenes&&this.vnData.scenes.forEach((e,n)=>{var h;(h=e.steps)==null||h.forEach((l,a)=>{var s,b;const r=(s=l.effects)==null?void 0:s.background;if(r&&(o[r]||(o[r]={url:r,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[r].count++,o[r].types.add("background"),o[r].locations.background.push(`Ïî¨${n+1} Ïä§ÌÖù${a+1}`)),(b=l.illustration)!=null&&b.imageUrl){const i=l.illustration.imageUrl;o[i]||(o[i]={url:i,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[i].count++,o[i].types.add("illustration"),o[i].locations.illustration.push(`Ïî¨${n+1} Ïä§ÌÖù${a+1}`)}})}),this.vnData.handouts&&this.vnData.handouts.forEach(e=>{const n=e.imageUrl;n&&(o[n]||(o[n]={url:n,count:0,types:new Set,locations:{avatar:[],background:[],handout:[],illustration:[]}}),o[n].count++,o[n].types.add("handout"),o[n].locations.handout.push(e.title||e.id))}),Object.values(o).map(e=>({...e,types:Array.from(e.types)})).sort((e,n)=>n.count-e.count)},filteredImageGroups(){return this.activeFilter==="all"?this.imageGroups:this.imageGroups.filter(o=>o.types.includes(this.activeFilter))},selectedGroup(){return this.selectedImageUrl?this.imageGroups.find(o=>o.url===this.selectedImageUrl):null},hasChanges(){return this.selectedImageUrl?this.newImageUrl&&this.newImageUrl!==this.selectedImageUrl:!1},progressPercentage(){return this.progressTotal===0?0:Math.round(this.progressCurrent/this.progressTotal*100)}},methods:{selectImage(o){this.selectedImageUrl=o,this.newImageUrl=o},resetForm(){this.selectedGroup&&(this.newImageUrl=this.selectedImageUrl)},truncateUrl(o,e=50){return o?o.length<=e?o:o.substring(0,e-3)+"...":""},handleImageError(o){o.target.style.display="none",o.target.parentElement.classList.add("error")},async applyChanges(){if(!this.hasChanges||this.isApplying)return;const o=this.selectedImageUrl,e=this.newImageUrl;this.isApplying=!0,this.progressCurrent=0,this.progressTotal=this.selectedGroup.count;try{this.$emit("bulk-update",{oldUrl:o,newUrl:e,onProgress:(n,h)=>{this.progressCurrent=n,this.progressTotal=h},onComplete:async n=>{await new Promise(h=>setTimeout(h,300)),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(h=>setTimeout(h,150)),alert(n.message),this.selectedImageUrl=null,this.newImageUrl=""}})}catch(n){console.error("ÏùºÍ¥Ñ Î≥ÄÍ≤Ω Ïã§Ìå®:",n),this.isApplying=!1,this.progressCurrent=0,this.progressTotal=0,await new Promise(h=>setTimeout(h,150)),alert("Ïù¥ÎØ∏ÏßÄ URL ÏùºÍ¥Ñ Î≥ÄÍ≤Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.")}}}},_l={class:"image-bulk-editor"},kl={key:0,class:"loading-overlay"},Cl={class:"loading-content"},Dl={class:"progress-section"},Sl={class:"progress-bar"},Ul={class:"progress-text"},wl={class:"editor-header"},xl={class:"editor-body"},Vl={class:"info-message"},Il={class:"image-list"},jl={class:"list-header"},El={class:"filter-buttons"},Tl=["onClick"],zl={class:"list-body"},Nl=["onClick"],Ol={class:"image-preview"},Rl=["src","alt"],Al={class:"image-info"},Gl=["title"],Jl={class:"image-meta"},Ll={class:"usage-count"},Bl={class:"usage-types"},Pl={key:0,class:"edit-form"},Fl={class:"form-header"},Ml={class:"affected-count"},Xl={class:"field-group"},ql={class:"current-url"},Hl={class:"field-group"},Yl={class:"preview-section"},Kl={class:"preview-comparison"},Ql={class:"preview-item before"},Wl={class:"preview-box"},Zl=["src"],$l={class:"preview-arrow"},eo={class:"preview-item after"},to={class:"preview-box"},so=["src"],lo={key:1,class:"preview-placeholder"},oo={class:"usage-details"},ao={class:"usage-list"},io={key:0,class:"usage-type"},no={key:1,class:"usage-type"},ro={key:2,class:"usage-type"},co={key:3,class:"usage-type"},uo={class:"actions"},po=["disabled"],mo=["disabled"],ho={key:1,class:"no-selection"};function fo(o,e,n,h,l,a){const r=U("EmojiToIcon");return d(),c("div",_l,[l.isApplying?(d(),c("div",kl,[t("div",Cl,[e[6]||(e[6]=t("div",{class:"spinner"},null,-1)),e[7]||(e[7]=t("p",{class:"loading-text"},"Ïù¥ÎØ∏ÏßÄ URLÏùÑ ÏùºÍ¥Ñ Î≥ÄÍ≤ΩÌïòÎäî Ï§ë...",-1)),t("div",Dl,[t("div",Sl,[t("div",{class:"progress-fill",style:w({width:a.progressPercentage+"%"})},null,4)]),t("p",Ul,g(l.progressCurrent)+" / "+g(l.progressTotal)+" Ìï≠Î™© ("+g(a.progressPercentage)+"%)",1)]),e[8]||(e[8]=t("p",{class:"loading-subtext"},"Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî",-1))])])):f("",!0),t("div",wl,[t("h3",null,[p(r,{emoji:"üñºÔ∏è",size:20}),e[9]||(e[9]=v(" Ïù¥ÎØ∏ÏßÄ URL ÏùºÍ¥Ñ Ìé∏Ïßë ",-1))])]),t("div",xl,[t("div",Vl,[p(r,{emoji:"üí°",size:18}),e[10]||(e[10]=t("p",null,"ÎèôÏùºÌïú Ïù¥ÎØ∏ÏßÄ URLÏùÑ Î™®Îëê ÏÑ†ÌÉùÌïòÏó¨ Ìïú Î≤àÏóê Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§. (ÏïÑÎ∞îÌÉÄ, Î∞∞Í≤Ω, Ìï∏ÎìúÏïÑÏõÉ Îì±)",-1))]),t("div",Il,[t("div",jl,[t("h4",null,"Ïù¥ÎØ∏ÏßÄ URL Î™©Î°ù ("+g(a.imageGroups.length)+"Í∞ú)",1),t("div",El,[(d(!0),c(k,null,D(l.imageTypes,s=>(d(),c("button",{key:s.value,class:S(["filter-button",{active:l.activeFilter===s.value}]),onClick:b=>l.activeFilter=s.value},[p(r,{emoji:s.emoji,size:14},null,8,["emoji"]),v(" "+g(s.label),1)],10,Tl))),128))])]),t("div",zl,[(d(!0),c(k,null,D(a.filteredImageGroups,s=>(d(),c("div",{key:s.url,class:S(["image-item",{selected:l.selectedImageUrl===s.url}]),onClick:b=>a.selectImage(s.url)},[t("div",Ol,[t("img",{src:s.url,alt:s.url,onError:e[0]||(e[0]=(...b)=>a.handleImageError&&a.handleImageError(...b))},null,40,Rl)]),t("div",Al,[t("div",{class:"image-url",title:s.url},g(a.truncateUrl(s.url)),9,Gl),t("div",Jl,[t("span",Ll,g(s.count)+"Ìöå ÏÇ¨Ïö©",1),t("span",Bl,[s.types.includes("avatar")?(d(),j(r,{key:0,emoji:"üë§",size:12,title:"ÏïÑÎ∞îÌÉÄ"})):f("",!0),s.types.includes("background")?(d(),j(r,{key:1,emoji:"üé®",size:12,title:"Î∞∞Í≤Ω"})):f("",!0),s.types.includes("handout")?(d(),j(r,{key:2,emoji:"üìÑ",size:12,title:"Ìï∏ÎìúÏïÑÏõÉ"})):f("",!0),s.types.includes("illustration")?(d(),j(r,{key:3,emoji:"üñºÔ∏è",size:12,title:"ÏùºÎü¨Ïä§Ìä∏"})):f("",!0)])])])],10,Nl))),128))])]),l.selectedImageUrl?(d(),c("div",Pl,[t("div",Fl,[t("h4",null,[p(r,{emoji:"‚úèÔ∏è",size:16}),e[11]||(e[11]=v(" URL Î≥ÄÍ≤Ω ",-1))]),t("span",Ml,g(a.selectedGroup.count)+"Í∞ú Ìï≠Î™©Ïóê Ï†ÅÏö©Îê©ÎãàÎã§",1)]),t("div",Xl,[e[12]||(e[12]=t("label",{class:"field-label"},"ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ URL",-1)),t("div",ql,g(l.selectedImageUrl),1)]),t("div",Hl,[e[13]||(e[13]=t("label",{class:"field-label"},"ÏÉà Ïù¥ÎØ∏ÏßÄ URL",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.newImageUrl=s),type:"text",class:"field-input",placeholder:"ÏÉà Ïù¥ÎØ∏ÏßÄ URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"},null,512),[[m,l.newImageUrl]])]),t("div",Yl,[e[17]||(e[17]=t("h5",null,"Î≥ÄÍ≤Ω Ï†Ñ/ÌõÑ ÎØ∏Î¶¨Î≥¥Í∏∞",-1)),t("div",Kl,[t("div",Ql,[e[14]||(e[14]=t("span",{class:"preview-label"},"Î≥ÄÍ≤Ω Ï†Ñ",-1)),t("div",Wl,[t("img",{src:l.selectedImageUrl,alt:"Î≥ÄÍ≤Ω Ï†Ñ",onError:e[2]||(e[2]=(...s)=>a.handleImageError&&a.handleImageError(...s))},null,40,Zl)])]),t("div",$l,[p(r,{emoji:"‚û°Ô∏è",size:24})]),t("div",eo,[e[16]||(e[16]=t("span",{class:"preview-label"},"Î≥ÄÍ≤Ω ÌõÑ",-1)),t("div",to,[l.newImageUrl?(d(),c("img",{key:0,src:l.newImageUrl,alt:"Î≥ÄÍ≤Ω ÌõÑ",onError:e[3]||(e[3]=(...s)=>a.handleImageError&&a.handleImageError(...s))},null,40,so)):(d(),c("div",lo,[p(r,{emoji:"üñºÔ∏è",size:32}),e[15]||(e[15]=t("span",null,"URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî",-1))]))])])])]),t("div",oo,[e[18]||(e[18]=t("h5",null,"ÏÇ¨Ïö© ÏúÑÏπò ÏÉÅÏÑ∏",-1)),t("div",ao,[a.selectedGroup.types.includes("avatar")?(d(),c("div",io,[p(r,{emoji:"üë§",size:16}),t("span",null,"ÏïÑÎ∞îÌÉÄ ("+g(a.selectedGroup.locations.avatar.length)+"Í∞ú Ï∫êÎ¶≠ÌÑ∞)",1)])):f("",!0),a.selectedGroup.types.includes("background")?(d(),c("div",no,[p(r,{emoji:"üé®",size:16}),t("span",null,"Î∞∞Í≤Ω ("+g(a.selectedGroup.locations.background.length)+"Í∞ú Ïä§ÌÖù)",1)])):f("",!0),a.selectedGroup.types.includes("handout")?(d(),c("div",ro,[p(r,{emoji:"üìÑ",size:16}),t("span",null,"Ìï∏ÎìúÏïÑÏõÉ ("+g(a.selectedGroup.locations.handout.length)+"Í∞ú)",1)])):f("",!0),a.selectedGroup.types.includes("illustration")?(d(),c("div",co,[p(r,{emoji:"üñºÔ∏è",size:16}),t("span",null,"ÏùºÎü¨Ïä§Ìä∏ ("+g(a.selectedGroup.locations.illustration.length)+"Í∞ú)",1)])):f("",!0)])]),t("div",uo,[t("button",{onClick:e[4]||(e[4]=(...s)=>a.resetForm&&a.resetForm(...s)),class:"reset-button",disabled:l.isApplying},[p(r,{emoji:"üîÑ",size:16}),e[19]||(e[19]=v(" Ï¥àÍ∏∞Ìôî ",-1))],8,po),t("button",{onClick:e[5]||(e[5]=(...s)=>a.applyChanges&&a.applyChanges(...s)),class:"apply-button",disabled:!a.hasChanges||l.isApplying},[l.isApplying?(d(),c(k,{key:0},[e[20]||(e[20]=t("div",{class:"button-spinner"},null,-1)),e[21]||(e[21]=v(" Ï≤òÎ¶¨ Ï§ë... ",-1))],64)):(d(),c(k,{key:1},[p(r,{emoji:"‚úÖ",size:16}),e[22]||(e[22]=v(" ÏùºÍ¥Ñ Ï†ÅÏö© ",-1))],64))],8,mo)])])):(d(),c("div",ho,[p(r,{emoji:"üëÜ",size:48}),e[23]||(e[23]=t("p",null,"ÏôºÏ™ΩÏóêÏÑú Ïù¥ÎØ∏ÏßÄ URLÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî",-1))]))])])}const go=V(yl,[["render",fo],["__scopeId","data-v-eaab8ed4"]]),vo={name:"EditorView",components:{StepEffectsEditor:oe,StepInfoEditor:Ns,CharacterBulkEditor:bl,ImageBulkEditor:go},setup(){return{logStore:T()}},data(){return{activeTab:"info",selectedStepIndex:null}},computed:{allSteps(){var n;const o=[];return(((n=this.logStore.vnData)==null?void 0:n.scenes)||[]).forEach(h=>{o.push(...h.steps||[])}),o},totalSteps(){return this.allSteps.length},selectedStep(){return this.selectedStepIndex===null?null:this.allSteps[this.selectedStepIndex]||null},selectedStepEffects(){var o;return((o=this.selectedStep)==null?void 0:o.effects)||null}},methods:{selectStep(o){this.selectedStepIndex=o},goBack(){this.$router.push("/player")},saveAndPlay(){this.saveToLocalStorage(),this.selectedStepIndex!==null&&sessionStorage.setItem("player-target-step",this.selectedStepIndex+1),this.$router.push("/player")},exportJSON(){const o=this.logStore.vnData;if(!o){alert("ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.");return}const e=JSON.stringify(o,null,2),n=new Blob([e],{type:"application/json"}),h=URL.createObjectURL(n),l=document.createElement("a");l.href=h,l.download=`${o.title||"vnlog"}_edited.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(h)},saveToLocalStorage(){try{const o=this.logStore.vnData;localStorage.setItem("vnlog-edited-data",JSON.stringify(o))}catch(o){console.error("Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Ï†ÄÏû• Ïã§Ìå®:",o)}},handleSaveStepInfo({id:o,updates:e}){const n=this.allSteps.find(h=>h.id===o);if(!n){alert("Ïä§ÌÖùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");return}n.sceneNumber=e.sceneNumber,n.type=e.type,n.character.name=e.character.name,n.character.color=e.character.color,n.character.avatarUrl=e.character.avatarUrl,n.text=e.text,n.isSceneDescription=e.isSceneDescription,n.sceneTitle=e.sceneTitle,n.scenePCs=e.scenePCs,n.sceneDescription=e.sceneDescription,n.illustrations=JSON.parse(JSON.stringify(e.illustrations||[])),n.diceRolls=JSON.parse(JSON.stringify(e.diceRolls||[])),n.statusChanges=JSON.parse(JSON.stringify(e.statusChanges||[])),n.dxCombos=JSON.parse(JSON.stringify(e.dxCombos||[])),n.effects=JSON.parse(JSON.stringify(e.effects||{})),n.hasDice=e.hasDice,n.hasStatusChange=e.hasStatusChange,n.hasDXCombo=e.hasDXCombo,n.hasIllustration=e.hasIllustration,this.saveToLocalStorage(),alert("Ïä§ÌÖù Ï†ïÎ≥¥Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.")},handleDeleteStep(o){const e=this.logStore.vnData.scenes;let n=!1;for(let l=0;l<e.length;l++){const a=e[l],r=a.steps.findIndex(s=>s.id===o);if(r!==-1){a.steps.splice(r,1),n=!0;break}}if(!n){alert("Ïä§ÌÖùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");return}const h=this.allSteps.length;this.selectedStepIndex>=h&&(this.selectedStepIndex=h>0?h-1:null),this.saveToLocalStorage(),alert("Ïä§ÌÖùÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.")},handleDuplicateStep(o){const e=this.logStore.vnData.scenes;let n=!1,h=0;const a=(Math.max(...this.allSteps.map(r=>parseInt(r.id)||0))+1).toString();for(let r=0;r<e.length;r++){const s=e[r],b=s.steps.findIndex(i=>i.id===o);if(b!==-1){const i=s.steps[b],_=JSON.parse(JSON.stringify(i));_.id=a,s.steps.splice(b+1,0,_);for(let y=0;y<r;y++)h+=e[y].steps.length;h+=b+1,n=!0;break}h+=s.steps.length}if(!n){alert("Ïä§ÌÖùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");return}this.selectedStepIndex=h,this.saveToLocalStorage(),alert(`Ïä§ÌÖùÏù¥ Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§. (ÏÉà ID: ${a})`)},handleApplyEffects({startStep:o,endStep:e,effects:n}){const h=this.allSteps;for(let l=o-1;l<e&&l<h.length;l++){const a=h[l];a.effects&&(a.effects.sfx=n.sfx,a.effects.bgm=n.bgm,a.effects.background=n.background,a.effects.backgroundOpacity=n.backgroundOpacity)}this.saveToLocalStorage(),alert(`Ïä§ÌÖù ${o}~${e}Ïóê Ìö®Í≥ºÍ∞Ä Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§.`)},handleRemoveEffects({startStep:o,endStep:e}){const n=this.allSteps;for(let h=o-1;h<e&&h<n.length;h++){const l=n[h];l.effects&&(l.effects.sfx=null,l.effects.bgm=null,l.effects.background=null)}this.saveToLocalStorage(),alert(`Ïä§ÌÖù ${o}~${e}Ïùò Ìö®Í≥ºÍ∞Ä Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§.`)},async handleBulkUpdateCharacter({oldName:o,newName:e,newColor:n,onProgress:h,onComplete:l}){let a=0,r=0;this.allSteps.forEach(s=>{s.character&&s.character.name===o&&r++});for(let s=0;s<this.allSteps.length;s++){const b=this.allSteps[s];b.character&&b.character.name===o&&(b.character.name=e,b.character.color=n,a++,h&&h(a,r),a%10===0&&await new Promise(i=>setTimeout(i,10)))}this.saveToLocalStorage(),l&&await l({success:!0,updatedCount:a,message:`"${o}" ‚Üí "${e}"
${a}Í∞ú Ïä§ÌÖùÏùò Ï∫êÎ¶≠ÌÑ∞ Ï†ïÎ≥¥Í∞Ä ÏùºÍ¥Ñ Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.`})},async handleBulkUpdateImage({oldUrl:o,newUrl:e,onProgress:n,onComplete:h}){var s,b;let l=0,a=0;const r=this.logStore.vnData;if(r.characters&&Object.values(r.characters).forEach(i=>{i.avatarUrl===o&&a++}),r.scenes&&r.scenes.forEach(i=>{var _;(_=i.steps)==null||_.forEach(y=>{var C,x;((C=y.effects)==null?void 0:C.background)===o&&a++,((x=y.illustration)==null?void 0:x.imageUrl)===o&&a++})}),r.handouts&&r.handouts.forEach(i=>{i.imageUrl===o&&a++}),r.characters)for(const i in r.characters){const _=r.characters[i];_.avatarUrl===o&&(_.avatarUrl=e,l++,n&&n(l,a),l%10===0&&await new Promise(y=>setTimeout(y,10)))}if(r.scenes)for(let i=0;i<r.scenes.length;i++){const _=r.scenes[i];if(_.steps)for(let y=0;y<_.steps.length;y++){const C=_.steps[y];((s=C.effects)==null?void 0:s.background)===o&&(C.effects.background=e,l++,n&&n(l,a)),((b=C.illustration)==null?void 0:b.imageUrl)===o&&(C.illustration.imageUrl=e,l++,n&&n(l,a)),l%10===0&&await new Promise(x=>setTimeout(x,10))}}if(r.handouts)for(let i=0;i<r.handouts.length;i++){const _=r.handouts[i];_.imageUrl===o&&(_.imageUrl=e,l++,n&&n(l,a),l%10===0&&await new Promise(y=>setTimeout(y,10)))}this.saveToLocalStorage(),h&&await h({success:!0,updatedCount:l,message:`Ïù¥ÎØ∏ÏßÄ URLÏù¥ ÏùºÍ¥Ñ Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.
Ï¥ù ${l}Í∞ú Ìï≠Î™©Ïù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.`})},hasEffects(o){return o.effects&&(o.effects.sfx||o.effects.bgm||o.effects.background)},truncateText(o,e){return o?o.length>e?o.substring(0,e)+"...":o:""},scrollToTargetStep(){const o=sessionStorage.getItem("editor-target-step");if(o){const e=parseInt(o,10);if(e>=1&&e<=this.totalSteps){const n=e-1;this.$nextTick(()=>{this.selectStep(n);const h=document.querySelectorAll(".step-item");h[n]&&h[n].scrollIntoView({behavior:"smooth",block:"center"})})}sessionStorage.removeItem("editor-target-step")}}},mounted(){if(!this.logStore.vnData){this.$router.push("/");return}this.scrollToTargetStep()}},bo={class:"editor-view"},yo={class:"editor-container"},_o={class:"editor-header"},ko={class:"header-actions"},Co={class:"editor-content"},Do={class:"steps-list"},So={class:"list-header"},Uo={class:"list-body"},wo=["onClick"],xo={class:"step-number"},Vo={class:"step-info"},Io={class:"step-character"},jo={class:"step-text"},Eo={key:0,class:"step-effects-tags"},To={key:0,class:"effect-tag sfx"},zo={key:1,class:"effect-tag bgm"},No={key:2,class:"effect-tag bg"},Oo={class:"editor-panel"},Ro={class:"tab-header"},Ao={class:"tab-content"},Go={key:0,class:"tab-pane"},Jo={key:1,class:"tab-pane"},Lo={key:2,class:"tab-pane"},Bo={key:3,class:"tab-pane"};function Po(o,e,n,h,l,a){const r=U("EmojiToIcon"),s=U("StepInfoEditor"),b=U("StepEffectsEditor"),i=U("CharacterBulkEditor"),_=U("ImageBulkEditor");return d(),c("div",bo,[t("div",yo,[t("header",_o,[t("button",{onClick:e[0]||(e[0]=(...y)=>a.goBack&&a.goBack(...y)),class:"back-button"},[p(r,{emoji:"‚¨ÖÔ∏è",size:20})]),t("h2",null,[p(r,{emoji:"‚úèÔ∏è",size:24}),e[11]||(e[11]=v(" Î°úÍ∑∏ Ìé∏ÏßëÍ∏∞ ",-1))]),t("div",ko,[t("button",{onClick:e[1]||(e[1]=(...y)=>a.exportJSON&&a.exportJSON(...y)),class:"export-button"},[p(r,{emoji:"üì§",size:18}),e[12]||(e[12]=v(" JSON ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ",-1))]),t("button",{onClick:e[2]||(e[2]=(...y)=>a.saveAndPlay&&a.saveAndPlay(...y)),class:"save-button"},[p(r,{emoji:"‚ñ∂Ô∏è",size:18}),e[13]||(e[13]=v(" Ïû¨ÏÉùÌïòÍ∏∞ ",-1))])])]),t("div",Co,[t("div",Do,[t("div",So,[t("h3",null,"Ïä§ÌÖù Î™©Î°ù ("+g(a.totalSteps)+"Í∞ú)",1)]),t("div",Uo,[(d(!0),c(k,null,D(a.allSteps,(y,C)=>(d(),c("div",{key:y.id,class:S(["step-item",{"has-effects":a.hasEffects(y),selected:l.selectedStepIndex===C}]),onClick:x=>a.selectStep(C)},[t("div",xo,g(C+1),1),t("div",Vo,[t("div",Io,g(y.character.name||"ÏãúÏä§ÌÖú"),1),t("div",jo,g(a.truncateText(y.text,50)),1),a.hasEffects(y)?(d(),c("div",Eo,[y.effects.sfx?(d(),c("span",To,[p(r,{emoji:"üîä",size:12})])):f("",!0),y.effects.bgm?(d(),c("span",zo,[p(r,{emoji:"üéµ",size:12})])):f("",!0),y.effects.background?(d(),c("span",No,[p(r,{emoji:"üñºÔ∏è",size:12})])):f("",!0)])):f("",!0)])],10,wo))),128))])]),t("div",Oo,[t("div",Ro,[t("button",{class:S(["tab-button",{active:l.activeTab==="info"}]),onClick:e[3]||(e[3]=y=>l.activeTab="info")},[p(r,{emoji:"üìù",size:16}),e[14]||(e[14]=v(" Ï†ïÎ≥¥ ÏàòÏ†ï ",-1))],2),t("button",{class:S(["tab-button",{active:l.activeTab==="effects"}]),onClick:e[4]||(e[4]=y=>l.activeTab="effects")},[p(r,{emoji:"‚ú®",size:16}),e[15]||(e[15]=v(" Ìö®Í≥º Ìé∏Ïßë ",-1))],2),t("button",{class:S(["tab-button",{active:l.activeTab==="characters"}]),onClick:e[5]||(e[5]=y=>l.activeTab="characters")},[p(r,{emoji:"üë•",size:16}),e[16]||(e[16]=v(" Ï∫êÎ¶≠ÌÑ∞ ÏùºÍ¥ÑÌé∏Ïßë ",-1))],2),t("button",{class:S(["tab-button",{active:l.activeTab==="images"}]),onClick:e[6]||(e[6]=y=>l.activeTab="images")},[p(r,{emoji:"üñºÔ∏è",size:16}),e[17]||(e[17]=v(" Ïù¥ÎØ∏ÏßÄ ÏùºÍ¥ÑÌé∏Ïßë ",-1))],2)]),t("div",Ao,[l.activeTab==="info"?(d(),c("div",Go,[p(s,{"step-data":a.selectedStep,onSave:a.handleSaveStepInfo,onDelete:a.handleDeleteStep,onDuplicate:a.handleDuplicateStep,onClose:e[7]||(e[7]=y=>l.activeTab="effects")},null,8,["step-data","onSave","onDelete","onDuplicate"])])):f("",!0),l.activeTab==="effects"?(d(),c("div",Jo,[p(b,{"total-steps":a.totalSteps,"selected-step":l.selectedStepIndex!==null?l.selectedStepIndex+1:null,"current-effects":a.selectedStepEffects,onApply:a.handleApplyEffects,onRemove:a.handleRemoveEffects,onClose:e[8]||(e[8]=y=>l.activeTab="info")},null,8,["total-steps","selected-step","current-effects","onApply","onRemove"])])):f("",!0),l.activeTab==="characters"?(d(),c("div",Lo,[p(i,{"all-steps":a.allSteps,onBulkUpdate:a.handleBulkUpdateCharacter,onClose:e[9]||(e[9]=y=>l.activeTab="info")},null,8,["all-steps","onBulkUpdate"])])):f("",!0),l.activeTab==="images"?(d(),c("div",Bo,[p(_,{"vn-data":h.logStore.vnData,onBulkUpdate:a.handleBulkUpdateImage,onClose:e[10]||(e[10]=y=>l.activeTab="info")},null,8,["vn-data","onBulkUpdate"])])):f("",!0)])])])])])}const Xo=V(vo,[["render",Po],["__scopeId","data-v-1ac6e006"]]);export{Xo as default};
